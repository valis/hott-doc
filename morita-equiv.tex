\documentclass[reqno]{amsart}

\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{verbatim}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{turnstile}
\usepackage{etex}

\hypersetup{colorlinks=true,linkcolor=blue}

\renewcommand{\turnstile}[6][s]
    {\ifthenelse{\equal{#1}{d}}
        {\sbox{\first}{$\displaystyle{#4}$}
        \sbox{\second}{$\displaystyle{#5}$}}{}
    \ifthenelse{\equal{#1}{t}}
        {\sbox{\first}{$\textstyle{#4}$}
        \sbox{\second}{$\textstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{s}}
        {\sbox{\first}{$\scriptstyle{#4}$}
        \sbox{\second}{$\scriptstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{ss}}
        {\sbox{\first}{$\scriptscriptstyle{#4}$}
        \sbox{\second}{$\scriptscriptstyle{#5}$}}{}
    \setlength{\dashthickness}{0.111ex}
    \setlength{\ddashthickness}{0.35ex}
    \setlength{\leasturnstilewidth}{2em}
    \setlength{\extrawidth}{0.2em}
    \ifthenelse{%
      \equal{#3}{n}}{\setlength{\tinyverdistance}{0ex}}{}
    \ifthenelse{%
      \equal{#3}{s}}{\setlength{\tinyverdistance}{0.5\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{d}}{\setlength{\tinyverdistance}{0.5\ddashthickness}
        \addtolength{\tinyverdistance}{\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{t}}{\setlength{\tinyverdistance}{1.5\dashthickness}
        \addtolength{\tinyverdistance}{\ddashthickness}}{}
        \setlength{\verdistance}{0.4ex}
        \settoheight{\lengthvar}{\usebox{\first}}
        \setlength{\raisedown}{-\lengthvar}
        \addtolength{\raisedown}{-\tinyverdistance}
        \addtolength{\raisedown}{-\verdistance}
        \settodepth{\raiseup}{\usebox{\second}}
        \addtolength{\raiseup}{\tinyverdistance}
        \addtolength{\raiseup}{\verdistance}
        \setlength{\lift}{0.8ex}
        \settowidth{\firstwidth}{\usebox{\first}}
        \settowidth{\secondwidth}{\usebox{\second}}
        \ifthenelse{\lengthtest{\firstwidth = 0ex}
            \and
            \lengthtest{\secondwidth = 0ex}}
                {\setlength{\turnstilewidth}{\leasturnstilewidth}}
                {\setlength{\turnstilewidth}{2\extrawidth}
        \ifthenelse{\lengthtest{\firstwidth < \secondwidth}}
            {\addtolength{\turnstilewidth}{\secondwidth}}
            {\addtolength{\turnstilewidth}{\firstwidth}}}
        \ifthenelse{\lengthtest{\turnstilewidth < \leasturnstilewidth}}{\setlength{\turnstilewidth}{\leasturnstilewidth}}{}
    \setlength{\turnstileheight}{1.5ex}
    \sbox{\turnstilebox}
    {\raisebox{\lift}{\ensuremath{
        \makever{#2}{\dashthickness}{\turnstileheight}{\ddashthickness}
        \makehor{#3}{\dashthickness}{\turnstilewidth}{\ddashthickness}
        \hspace{-\turnstilewidth}
        \raisebox{\raisedown}
        {\makebox[\turnstilewidth]{\usebox{\first}}}
            \hspace{-\turnstilewidth}
            \raisebox{\raiseup}
            {\makebox[\turnstilewidth]{\usebox{\second}}}
        \makever{#6}{\dashthickness}{\turnstileheight}{\ddashthickness}}}}
        \mathrel{\usebox{\turnstilebox}}}

\newcommand{\axlabel}[1]{(#1) \phantomsection \label{ax:#1}}
\newcommand{\axtag}[1]{\label{ax:#1} \tag{#1}}
\newcommand{\axref}[1]{(\hyperref[ax:#1]{#1})}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{#3~\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\expandafter\newcommand\csname n#2\endcsname[1]{\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{Theorem}{Theorem}
\newref{lem}{Lemma}{Lemma}
\newref{prop}{Proposition}{Proposition}
\newref{cor}{Corollary}{Corollary}
\newref{cond}{Condition}{Condition}

\theoremstyle{definition}
\newref{defn}{Definition}{Definition}
\newref{example}{Example}{Example}

\theoremstyle{remark}
\newref{remark}{Remark}{Remark}

\newcommand{\cat}[1]{\mathbf{#1}}
\newcommand{\colim}{\mathrm{colim}}
\newcommand{\C}{\cat{C}}
\newcommand{\PAlg}[1]{#1\text{-}\cat{PAlg}}
\newcommand{\Mod}[1]{#1\text{-}\cat{Mod}}
\newcommand{\Th}{\cat{Th}}
\newcommand{\St}{\cat{St}}
\newcommand{\PSt}{\cat{PSt}}
\newcommand{\algtt}{\cat{TT}}
\newcommand{\ThC}{\Th_{\mathcal{C}}}
\newcommand{\emptyCtx}{\mathbf{1}}
\newcommand{\nf}{\mathrm{nf}}
\newcommand{\red}{\Rightarrow}
\newcommand{\deq}{\equiv}
\newcommand{\repl}{:=}
\newcommand{\type}{\mathrm{type}}

\newcommand{\we}{\mathcal{W}}
\newcommand{\fib}{\mathcal{F}}
\newcommand{\cof}{\mathcal{C}}
\newcommand{\I}{\mathrm{I}}
\newcommand{\J}{\mathrm{J}}
\newcommand{\class}[2]{#1\text{-}\mathrm{#2}}
\newcommand{\Iinj}[1][\I]{\class{#1}{inj}}
\newcommand{\Icell}[1][\I]{\class{#1}{cell}}
\newcommand{\Icof}[1][\I]{\class{#1}{cof}}
\newcommand{\Jinj}[1][]{\Iinj[\J#1]}
\newcommand{\Jcell}[1][]{\Icell[\J#1]}
\newcommand{\Jcof}[1][]{\Icof[\J#1]}
\newcommand{\cyli}{i}

\numberwithin{figure}{section}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\begin{document}

\title{Morita equivalences between algebraic dependent type theories}

\author{Valery Isaev}

\begin{abstract}
\end{abstract}

\maketitle

\section{Introduction}

The category of algebraic dependent type theories was defined in \cite{alg-tt}.

\section{Morita equivalences of theories}

In this section we define several notions of weak equivalence of algebraic dependent type theories.

\subsection{Algebraic dependent type theories}

Recall that an algebraic dependent type theory $T$ consists of a set $\mathcal{F}$ of function symbols, a set $\mathcal{P}$ of predicate symbols and a set of axioms.
The set of sorts $\mathcal{S}$ is defined as $\{ ctx, tm \} \times \mathbb{N}$.
We also write $(ty,n)$ for $(ctx,n+1)$.
Every function symbol $\sigma \in \mathcal{F}$ is equipped with a signature $\sigma : s_1 \times \ldots \times s_k \to s$ where $s_1, \ldots s_k, s \in \mathcal{S}$.
Every predicate symbol $R \in \mathcal{P}$ is equipped with a signature $R : s_1 \times \ldots \times s_k$ where $s_1, \ldots s_k \in \mathcal{S}$.
The set $Term_T(V)_s$ of terms of sort $s$ with variable in $V$ is defined inductively from $\mathcal{F}$ as usual.
An atomic formula with variables in $V$ is an expression either of the form $t_1 = t_2$  where $t_i \in Term_T(V)_s$ or of the form $R(t_1, \ldots t_k)$ where $t_i \in Term_T(V)_{s_i}$.
A formula with variables in $V$ is an expression of the form $\varphi_1 \land \ldots \land \varphi_n$ where $\varphi_i$ are atomic formulas.
An axiom is an expression of the form $\varphi \sststile{}{V} \psi$ where $\varphi$ and $\psi$ are formulas with variables in $V$.
We will write $\varphi \sststile{T}{V} \psi$ to denote the fact that sequent $\varphi \sststile{}{V} \psi$ is derivable in $T$ using the following inference rules:
\begin{center}
$\varphi \sststile{}{V} \varphi$ \axlabel{b1}
\qquad
\AxiomC{$\varphi \sststile{}{V} \psi$}
\AxiomC{$\psi \sststile{}{V} \chi$}
\RightLabel{\axlabel{b2}}
\BinaryInfC{$\varphi \sststile{}{V} \chi$}
\DisplayProof
\qquad
$\varphi \sststile{}{V} \top$ \axlabel{b3}
\end{center}

\medskip
\begin{center}
$\varphi \land \psi \sststile{}{V} \varphi$ \axlabel{b4}
\qquad
$\varphi \land \psi \sststile{}{V} \psi$ \axlabel{b5}
\qquad
\AxiomC{$\varphi \sststile{}{V} \psi$}
\AxiomC{$\varphi \sststile{}{V} \chi$}
\RightLabel{\axlabel{b6}}
\BinaryInfC{$\varphi \sststile{}{V} \psi \land \chi$}
\DisplayProof
\end{center}

\medskip
\begin{center}
$\sststile{}{x} x\!\downarrow$ \axlabel{a1}
\qquad
$x = y \land \varphi \sststile{}{V,x,y} \varphi[y/x]$ \axlabel{a2}
\end{center}

\medskip
\begin{center}
\AxiomC{$\varphi \sststile{}{V} \psi$}
\RightLabel{, $x \in FV(\varphi)$ \axlabel{a3}}
\UnaryInfC{$\varphi[t/x] \sststile{}{V,V'} \psi[t/x]$}
\DisplayProof
\end{center}
\medskip

We will give several proofs by induction on the derivation of a sequent.
We need to work with sequents in which the left hand side has some property, but in a derivation of a sequent in this logic the left hand side may vary arbitrary.
Thus we describe another set of rules which is equivalent to this one and in which the left hand side stays the same.
We call these rules the \emph{natural deduction system}.
In this system the right hand side of all sequents is an atomic formula.

\begin{center}
\AxiomC{}
\RightLabel{\axlabel{nv}}
\UnaryInfC{$\varphi \sststile{}{V} x\!\downarrow$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} a = b$}
\RightLabel{\axlabel{ns}}
\UnaryInfC{$\varphi \sststile{}{V} b = a$}
\DisplayProof
\end{center}

\begin{center}
\AxiomC{}
\RightLabel{\axlabel{nh}}
\UnaryInfC{$\varphi_1 \land \ldots \land \varphi_n \sststile{}{V} \varphi_i$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} a = b$}
\AxiomC{$\varphi \sststile{}{V} \psi[a/x]$}
\RightLabel{\axlabel{nl}}
\BinaryInfC{$\varphi \sststile{}{V} \psi[b/x]$}
\DisplayProof
\end{center}

\begin{center}
\AxiomC{$\varphi \sststile{}{V} R(t_1, \ldots t_n)$}
\RightLabel{\axlabel{np}}
\UnaryInfC{$\varphi \sststile{}{V} t_i\!\downarrow$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} \sigma(t_1, \ldots t_n)\!\downarrow$}
\RightLabel{\axlabel{nf}}
\UnaryInfC{$\varphi \sststile{}{V} t_i\!\downarrow$}
\DisplayProof
\end{center}
where $R$ is a predicate symbol of the theory and $\sigma$ is its function symbol.

Finally, for every axiom $\psi_1 \land \ldots \land \psi_n \sststile{}{x_1 : s_1, \ldots x_k : s_k} \chi_1 \land \ldots \land \chi_m$
and for all terms $t_1 : s_1$, \ldots $t_k : s_k$, we have the following rules for all $1 \leq j \leq m$:
\smallskip
\begin{center}
\AxiomC{$\varphi \sststile{}{V} t_i\!\downarrow$, $1 \leq i \leq k$}
\AxiomC{$\varphi \sststile{}{V} \psi_i[t_1/x_1, \ldots t_k/x_k]$, $1 \leq i \leq n$}
\RightLabel{\axlabel{na}}
\BinaryInfC{$\varphi \sststile{}{V} \chi_j[t_1/x_1, \ldots t_k/x_k]$}
\DisplayProof
\end{center}

\begin{prop}
A sequent $\varphi \sststile{}{V} \psi_1 \land \ldots \land \psi_n$ is derivable in the system of rules \axref{b1}-\axref{b6}, \axref{a1}-\axref{a3} if and only if
sequents $\varphi \sststile{}{V} \psi_1$, \ldots $\varphi \sststile{}{V} \psi_n$ are derivable in the natural deduction system.
\end{prop}
\begin{proof}
It is easy to prove the ``if'' part.
Conversely, the rules \axref{b1}, \axref{b4}, and \axref{b5} follow from \axref{nh},
the rules \axref{b3} and \axref{b6} hold trivially,
the rule \axref{a1} follows from \axref{nv},
the rule \axref{a2} follows from \axref{nl} and \axref{nh},
and every axiom is derivable from \axref{na}.

To prove the rule \axref{b2}, we just need to show that if sequents $\varphi \sststile{}{V} \psi_1$, \ldots $\varphi \sststile{}{V} \psi_n$,
and $\psi_1 \land \ldots \land \psi_n \sststile{}{V} \chi$ are derivable in the natural deduction, then $\varphi \sststile{}{V} \chi$ is also derivable.
We can construct a derivation tree for this sequent as a derivation tree for $\psi_1 \land \ldots \land \psi_n \sststile{}{V} \chi$
in which the left hand sides of all sequents are replaced with $\varphi$ and rules \axref{nh} are replaced with derivation trees for $\varphi \sststile{}{V} \psi_i$.

To prove the rule \axref{a3}, consider a derivation tree for a sequent $\varphi \sststile{}{V} \psi$.
To construct a derivation tree for $\varphi[t/x] \sststile{}{V,V'} \psi[t/x]$, we just need to apply the substitution to every sequent in this derivation tree.
The only rule that is not closed under substitution is \axref{nv}.
By assumption, $x \in FV(\varphi)$.
In this case the sequent $\varphi[t/x] \sststile{}{V,V'} t\!\downarrow$ is derivable from \axref{np}, \axref{nf} and the following rules:
\begin{center}
\AxiomC{$\varphi \sststile{}{V} t_1 = t_2$}
\RightLabel{\axlabel{ne1}}
\UnaryInfC{$\varphi \sststile{}{V} t_1\!\downarrow$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} t_1 = t_2$}
\RightLabel{\axlabel{ne2}}
\UnaryInfC{$\varphi \sststile{}{V} t_2\!\downarrow$}
\DisplayProof
\end{center}
The rule \axref{ne2} follows from \axref{nl} if we take $\psi(x) = (x = b)$.
The rule \axref{ne1} follows from \axref{ne2} and \axref{ns}.
\end{proof}

\subsection{Morita equivalences}

Let $T$ be a theory with identity types and let $X$ be a model of $T$.
A \emph{relative homotopy} between terms $a,a' \in X_{(tm,n)}$ is a term $h \in X_{(tm,n)}$ such that $ty(h) = Id(a,a')$.
A \emph{relative homotopy} between types $A,A' \in X_{(ty,n)}$ is a tuple $(f,g,p,g',p')$, where $f,g,p,g',p' \in X_{(tm,n+1)}$ such that
\begin{align*}
x : A & \vdash f : A' \\
y : A' & \vdash g : A \\
x : A & \vdash p : Id(g[y \mapsto f], x) \\
y : A' & \vdash g' : A \\
y : A' & \vdash p' : Id(f[x \mapsto g], y)
\end{align*}

Let $X$ and $Y$ be models of a theory with identity types.
A morphism of models $f : X \to Y$ is \emph{weak equivalence} if it satisfies the following conditions:
\begin{enumerate}
\item For all $A \in X_{(ty,n)}$ and $a \in Y_{(tm,n)}$ such that $ty(a) = f(A)$,
there is a term $a' \in X_{(tm,n)}$ such that $ty(a') = A$ and $f(a')$ is relatively homotopic to $a$.
In this case we will say that $f$ is \emph{essentially surjective on terms}.
\item For all $\Gamma \in X_{(ctx,n)}$ and $A \in Y_{(ty,n)}$ such that $ft(A) = f(\Gamma)$,
there is a type $A' \in X_{(ty,n)}$ such that $ft(A') = \Gamma$ and $f(A')$ is relatively homotopic to $A$.
In this case we will say that $f$ is \emph{essentially surjective on types}.
\end{enumerate}

We will say that a model of an algebraic dependent type theory is \emph{cofibrant} if it is cofibrant with respect to the set $\I$, which consists of the following maps:
\[ F(\{ A : (d_p,n) \}) \to F(\{ e_p(a) = A \}) \]
where $d_{ty} = ctx$, $d_{tm} = ty$, $e_{ty}(a) = ft(a)$, $e_{tm}(a) = ty(a)$,
and $F(S)$ is the free model generated by the specified generators and relations.

These definitions of weak equivalences and the set of generating cofibrations appear in \cite{alg-models} and \cite{kap-lum-model}.

\begin{defn}
A \emph{Morita equivalence} between theories $T_1$ and $T_2$ is a morphism $f : T_1 \to T_2$ such that for every cofibrant model $X$ of $T_1$,
the unit $\eta_X : X \to f^*(f_!(X))$ of the adjunction $f_! \dashv f^*$ is a weak equivalence.
We will say that $f$ is a \emph{strong Morita equivalence} if $\eta_X$ is a weak equivalence for every $X$.
We will say that $f$ is a \emph{syntactic equivalence} if $\eta_X$ is a weak equivalence when $X$ is the initial model.
\end{defn}

Suppose that there is a model structure (or a left semi-model structure) on the category of models of a theory $T$
with the class of weak equivalence as defined above and such that all objects are fibrant.
It was shown in \cite{alg-models} that theories under $coe_1 + \sigma + Path + wUA$ satisfy this condition.
Also, it was shown in \cite{kap-lum-model}, that the categories of models of particular theories with identity types carry left semi-model structure.
The following simple proposition characterizes Morita equivalences between such theories in terms of the model stucture.

\begin{prop}[morita-quillen]
Let $T_1$ and $T_2$ be theories with a model structure satisfying condtions described above, and let $f : T_1 \to T_2$ be a morphism.
Then $f_! \dashv f^*$ is a Quillen adjunction.
It is a Quillen equivalence if and only if $f$ is a Morita equivalence.
\end{prop}
\begin{proof}
Since $f_!$ is a left adjoint, it preserves object defined by generators and relations.
Since the set of generating cofibration $\I$ and the set of generating trivial cofibration $\J_\I$
are both defined in terms of generators and relations, this implies that $f_!$ preserves them.
Hence $f_! \dashv f^*$ is a Quillen adjunction.
The second part of the proposition follows from corollary~3.9 of \cite{f-model-structures}.
\end{proof}

We can give a useful characterization of (strong) Morita equivalences.
To do this, we need to define a notion of a relative homotopy between terms in a theory.
Let $T$ be a theory with identity types and let $\varphi$ be a formula of $T$.
A \emph{relative homotopy} between types $A,A' \in Term_T(V)_{(ty,n)}$ with respect to $\varphi$ is a tuple $f,g,p,g',p' \in Term_T(V)_{(tm,n+1)}$
such that sequent $\varphi \sststile{}{V} \psi$ is derivable in $T$, where $\psi$ is the conjunction of formulas that appear in the definition of a relative homotopy for models.
If $a,a' \in Term_T(V)_{(tm,n)}$ are terms such that $\varphi \sststile{}{V} ty(a) = ty(a')$, then a \emph{relative homotopy} between $a$ and $a'$ with respect to $\varphi$ is a term $h \in Term_T(V)_{(tm,n)}$
such that sequent $\varphi \sststile{}{V} ty(h) = Id(a,a')$ is derivable in $T$.
If $a$ and $a'$ are such that only $\varphi \sststile{}{V} ft(ty(a)) = ft(ty(a'))$ is true, then a \emph{relative (heterogeneous) homotopy} between $a$ and $a'$ with respect to $\varphi$
is a relative homotopy $f,g,p,g',p'$ between $ty(a)$ and $ty(a')$ together with a relative homotopy between $f[a]$ and $a'$.

Let $V$ be a set of variables and let $\varphi$ be a formula with free variables in $V$.
We will say that a morphism $f : T_1 \to T_2$ of theories with identity types has the weak lifting property with respect to $V,\varphi$ if
for every term $A \in Term_{T_1}(V)_{(d_p,n)}$ and every term $a \in Term_{T_2}(V)_{(p,n)}$ such that $\varphi \sststile{}{V} A\!\downarrow$ and $f(\varphi) \sststile{}{V} e_p(a) = f(A)$,
there exists a term $a' \in Term_{T_1}(V)_{(p,n)}$ such that $f(a')$ is relatively homotopic to $a$ with respect to $\varphi$.
We will say that $f$ has the lifting property with respect to $V,\varphi$ if $f(a')$ is not only homotopic to $a$, but also equals it.

If $P$ is a set of pairs of the form $V,\varphi$, then we will say that a map has the (weak) lifting property with respect to $P$ if it has this property with respect to every element of $P$.
We define $P_0$ as the singleton set $\{ \varnothing,\top \}$, $P_S$ as the set of all pairs, and $P_M$ as the set of pairs $V,\varphi$ such that $V = \{ x_1, \ldots x_k \}$
and $\varphi = \varphi_1 \land \ldots \land \varphi_k$, where $\varphi_i$ equals to $e_p(x_i) = t_i$,
where $t_i$ is a term of $T_1$ with free variables in $\{ x_1, \ldots x_{i-1} \}$ such that for every $1 \leq i \leq k$,
sequent $\varphi_1 \land \ldots \land \varphi_{i-1} \sststile{}{x_1, \ldots x_{i-1}} t_i\!\downarrow$ is derivable in $T_1$.

\begin{prop}[str-morita-char]
A morphism $f : T_1 \to T_2$ between theories with identity types is a strong Morita equivalence if and only if it has the weak lifting property with respect to $P_S$.
\end{prop}
\begin{proof}
First, we need to introduce an auxiliary construction.
Let $T$ be a theory, let $V$ be a set of variables, and let $\mathcal{A}$ be a set formulas of $T$ with variables in $V$.
Then we define $Syn(T,V,\mathcal{A})$ as $Syn(T \cup \{ O_x : s\ |\ x \in V_s \} \cup \mathrm{sp}(\mathcal{A}))$ (functors $Syn$ and $Lang$ are defined in \cite{alg-models}),
where $\mathrm{sp}(\mathcal{A})$ consists of formulas of the form $\sststile{}{} O_x\!\downarrow$ for every $x \in V$
and formulas of $\mathcal{A}$ in which every variable $x$ is replaced with $O_x$.
If $f : T_1 \to T_2$ is a morphism of theories, then it is easy to see that $f_!(Syn(T_1,V,\mathcal{A})) = Syn(T_2,V,f(\mathcal{A}))$.

Let us prove the ``only if'' direction.
Note that elements of $Syn(T_1, V, \{\,\sststile{}{}~\varphi\,\})$ correspond to terms $t$ of $T_1$ with variables in $V$ such that $\varphi \sststile{T_1}{V} t\!\downarrow$.
Moreover, two terms $t_1$ and $t_2$ map to the same element under this correspondence if and only if $\varphi \sststile{T_1}{V} t_1 = t_2$.
Analogous statement holds for $Syn(T_2, V, \{\,\sststile{}{}~f(\varphi)\,\})$.
Using this correspondence, the required conditions immediately follow from the fact that
map $Syn(T_1, V, \{\,\sststile{}{}~\varphi\,\}) \to f^*(Syn(T_2, V, \{\,\sststile{}{}~f(\varphi)\,\}))$ is a weak equivalence.

Now, let us prove the ``if'' direction.
Let $M$ be a model of $T_1$.
Note that $M$ is isomorphic to $Syn(T_1, U(M), \mathcal{A})$, where $U(M)$ is the underlying set of $M$ and $\mathcal{A}$ is the set of formulas of the form
$x = \sigma(x_1, \ldots x_k)$ and $R(x_1, \ldots x_k)$ for all $x, x_1, \ldots x_k \in M$ such that these formulas hold in $M$.
Note that $sp(\mathcal{A})$ is the set of axioms of $Lang(M)$.

Let $A \in M_{(d_p,n)}$ and $a \in f^*(f_!(M))$ be elements such that $e_p(a) = A$.
Since $f_!(M) = Syn(T_2, U(M), f(\mathcal{A}))$, $a$ is a closed term of $T_2$.
There is a finite subset $\mathcal{A}_0$ of $\mathcal{A}$ such that $\sststile{T_2 \cup \mathrm{sp}(\mathcal{A}_0)}{} e_p(a) = A$.
Let $\varphi$ be the conjunction of $\mathcal{A}_0$, and let $b$ and $B$ be $a$ and $A$, respectively, in which every constant $O_x$ is replaced with variable $x$.
Then $\varphi \sststile{T_2}{U(M)} e_p(b) = B$.
By assumption, there exist a term $b' \in Term_{T_1}(U(M))_{(p,n)}$ and a relative homotopy $h$ between $f(b)$ and $b'$.
These terms correspond under $\mathrm{sp}$ to elements of $M$ and $f^*(f_!(M))$, respectively.
These conditions imply that $b'$ is the required lifting and $h$ is the required homotopy.
\end{proof}

Analogous characterizations hold for Morita and syntacric equivalences:

\begin{prop}[morita-char]
A morphism $f : T_1 \to T_2$ between theories with identity types is a Morita equivalence if and only if it has the weak lifting property with respect to $P_M$.
\end{prop}
\begin{proof}
Suppose that $f$ is a Morita equivalence.
To prove that $f$ has the weak lifting property, we just need to show that model $M = Syn(T_1, \{ x_1, \ldots x_k \}, \{\,\sststile{}{}~\varphi\,\})$
constructed in the previous proposition is cofibrant.
Note that for every $1 \leq i \leq k$, we have the following pushout square:
\[ \xymatrix{ F(\{ A : (d_p,n) \}) \ar[d] \ar[r] &     Syn(T_1, \{ x_1, \ldots x_{i-1} \}, \{\,\sststile{}{} \varphi_1 \land \ldots \land \varphi_{i-1} \,\}) \ar[d] \\
              F(\{ e_p(a) = A \})         \ar[r] & \po Syn(T_1, \{ x_1, \ldots x_i \}, \{\,\sststile{}{} \varphi_1 \land \ldots \land \varphi_i \,\}),
            } \]
where the top arrow maps $A$ to $t_i$ and the bottome arrow maps $a$ to $x_i$.
This shows that $M$ is a relative $\I$-cell complex.

Now, let us prove the converse.
We just need to show that if $M$ is a cofibrant model of $T_1$, then we can choose formula $\varphi$
in the second part of the proof of the previous proposition so that it satisfies the conditions of this proposition.

Since every cofibrant object is a retract of a relative $\I$-cell complex and Morita equivalences are closed under retracts, we may assume that $M$ is a relative $\I$-cell complex.
Moreover, we may assume that there are subsets $\{S_i\}_{i \in \mathbb{N}}$ of elements of $M$ such that we have the following pushout diagrams:
\[ \xymatrix{ \coprod_{x \in S_i} F(\{ A_x : (d_p,n) \}) \ar[d] \ar[r] &     M_i \ar[d] \\
              \coprod_{x \in S_i} F(\{ e_p(a_x) = A_x \})       \ar[r] & \po M_{i+1},
            } \]
$M_0$ is the initial model, $M$ is the colimit of $M_i$, and map $F(\{ e_p(a_x) = A_x \}) \to M_{i+1} \to M$ sends $a_x$ to $x$.

Note that $M_i$ is isomorphic to $Syn(T_1, \bigcup_{1 \leq j \leq i} S_j, \mathcal{A}_i)$,
where $\mathcal{A}_i$ consists of formulas of the form $e_p(x) = t$, where $x \in S_i$ and $t \in Term_{T_1}(\bigcup_{1 \leq j < i} S_j)$ corresponds to the image of $A_x$ in $M_{i-1}$.
Thus, $M$ is isomorphic to $Syn(T_1, \bigcup_{i \in \mathbb{N}} S_i, \bigcup_{i \in \mathbb{N}} \mathcal{A}_i)$.
Now, if we choose a finite subset of $\bigcup_{i \in \mathbb{N}} \mathcal{A}_i$ as before, then the conjunction of this subset satisfies the required conditions.
\end{proof}

\begin{prop}[syn-equiv-char]
A morphism $f : T_1 \to T_2$ between theories with identity types is a syntactic equivalence if and only if it has the weak lifting property with respect to $P_0$.
\end{prop}
\begin{proof}
This is obvious since elements of the initial model of $T_1$ are closed terms $t$ of $T_1$ such that $\sststile{}{} t\!\downarrow$ is derivable.
\end{proof}

\begin{comment}
This proposition implies that Morita equivalences can be characterized in terms of a lifting property.
Let $\I$ be the set of the following morphisms of theories:
For every predicate symbol $P : s_1 \times \ldots \times s_k$ and every function symbols $A : s_1 \times \ldots \times s_k \to (d_p,n)$ and $a : s_1 \times \ldots \times s_k \to (p,n)$,
let $i_{P,A,a}$ be the following morphism of theories:
\[ \{ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} A(x_1, \ldots x_k)\!\downarrow \} \to \{ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} a(x_1, \ldots x_k)\!\downarrow \}, \]
where $i_{P,A,a}(A) = e_p(a)$.
We can define a relative cylinder object for $i_{P,A,a}$ as
\[ \{ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} e_p(h(x_1, \ldots x_k)) = I \times A(x_1, \ldots x_k) \}, \]
where $h : s_1 \times \ldots \times s_k \to (p,n+1)$.
Then the previous proposition immediately implies the following corollary:

\begin{cor}
A morphism of theories is a Morita equivalence if and only if it has RLP up to relative homotopy with respect to $\I$.
\end{cor}

If we want to prove that a morphism $f : T_1 \to T_2$ is a Morita equivalence, we can try to use the same idea as in the proof of \cite[Lemma~3.7]{alg-models}.
We define functions $g : Term_{T_2}(V)_{(p,n)} \to Term_{T_1}(V)_{(p,n)}$ and $h : Term_{T_2}(V)_{(p,n)} \to Term_{T_2}(V)_{(p,n+1)}$.
To show that $g(a)$ and $h(a)$ satisfy conditions of \rprop{str-morita-char}, we need to prove several properties of $g$ and $h$,
one of which is that they must preserve axioms of $T_2$.
The problem with this construction is that they might not preserve all axioms.
Often we have some axioms that express reduction rules.
If $g$ and $h$ do not preserve these axioms, then we can try to fix this problem by first applying a normalization function.
Such function usually does not preserve substitutions and thus does not define morphisms of theories.
We call such functions \emph{pseudomorphisms}:

\begin{defn}
Let $T_1$ and $T_2$ be a pair of theories and let $k$ be a natural number.
Then a \emph{pseudomorphism} $f$ between $T_1$ and $T_2$ of degree $k$ is a pair of maps $f : Term_{T_1}(V)_{(p,n)} \to RTerm_{T_2}(V)_{(p,n+k)}$ and
$f : Form_{T_1}(V) \to Form_{T_2}(V)$ such that sequents $f(\varphi \land \psi) \ssststile{}{V} f(\varphi) \land f(\psi)$,
$f(t = t') \ssststile{}{V} f(t) = f(t')$ and $\sststile{}{V} f(e_p(t)) \cong e_p(f(t))$ are derivable in $T_2$.

There is a preorder on the set of pseudomorphisms of some fixed degree $k$.
We will write $f \leq f'$ if for every term $t$ and every formula $\varphi$,
sequents $f(t)\!\downarrow\ \sststile{}{V} f(t) = f'(t)$ and $f(\varphi) \sststile{}{V} f'(\varphi)$ are derivable.
We will say that pseudomorphisms $f$ and $f'$ are equivalent if and only if $f \leq f'$ and $f' \leq f$.
\end{defn}

\begin{example}
If $f : T_1 \to T_2$ and $g : T_2 \to T_3$ are pseudomorphisms of degrees $k$ and $m$, respectively, then there is an obvious pseudomorphism $g \circ f : T_1 \to T_3$ of degree $k+m$.
\end{example}

\begin{example}
For every theory $T$ and every natural number $k$, there is a pseudomorphism $I^k : T \to T$ of degree $k$ which is defined as follows.
For every term $t$, $I^k(t) = I^k \times t$.
For every formula $\varphi$, $I^k(\varphi) = \varphi$.
In particular, there is the identity pseudomorphism $id_T = I^0$.
\end{example}

\begin{example}
Morphisms of theories are equivalence classes of pairs of functions on terms and formulas which satisfy some conditions.
We will call such pairs \emph{premorphisms} of theories.
Every premorphism determines a pseudomorphism of degree 0.
Every morphism determines an equivalence class of pseudomorphisms.
\end{example}

The following lemma describes a way to prove that a morphism of theories is a Morita equivalence using pseudomorphisms:

\begin{lem}[equiv-lem]
Let $f : T_1 \to T_2$ be a premorphism of theories under $I$.
Suppose that there are a pseudomorphism $g : T_2 \to T_1$ of degrere 0 and a pseudomorphism $h : T_2 \to T_2$ of degree 1 which satisfy the following conditions:
\begin{enumerate}
\item $g$ and $h$ preserve theorems of the form $f(\varphi) \sststile{}{V} \psi$.
\item $id_{T_1} \leq g \circ f$,
\item $I \circ f \leq h \circ f$,
\item For every term $t$, sequents
\begin{align*}
t\!\downarrow \land\ h(t)\!\downarrow\ & \sststile{}{V} left^*(h(t)) = f(g(t)) \\
t\!\downarrow \land\ h(t)\!\downarrow\ & \sststile{}{V} right^*(h(t)) = t
\end{align*}
are derivable in $T_2$.
\end{enumerate}
Then the morphism determined by $f$ is a Morita equivalence.
\end{lem}
\begin{proof}
Let $a$ and $A$ be terms of $T_2$ and let $\varphi$ be a formula of $T_1$ such that $\varphi \sststile{T_1}{V} A\!\downarrow$ and $f(\varphi) \sststile{T_2}{V} e_p(a) = f(A)$.
Let $a' = g(a)$ and $h' = h(a)$.
Then $\varphi \sststile{T_1}{V} g(f(\varphi))$ and $g(f(\varphi)) \sststile{T_1}{V} g(e_p(a)) = g(f(A))$.
It follows that $\varphi \sststile{T_1}{V} e_p(a') = A$.
Analogously, $f(\varphi) \sststile{T_2}{V} h(f(\varphi))$ and $h(f(\varphi)) \sststile{T_2}{V} h(e_p(a)) = h(f(A))$.
Hence $f(\varphi) \sststile{T_2}{V} e_p(h') = I \times f(A)$.
The last condition implies that $f(\varphi) \sststile{T_2}{V} left^*(h') = f(a')$ and $f(\varphi) \sststile{T_2}{V} right^*(h') = a$.
\end{proof}
\end{comment}

\section{Model structure}

In this section we define a model structure on the category of algebraic dependent type theories with anough structure.

\subsection{Categories of theories}

It was shown in \cite{PHL} that partial Horn theories are equivalent to essentially algebraic theories.
It follows that categories of models of these theories are locally presentable.
In this subsection we will prove that different categories of theories are also locally finitely presentable.

We will consider a prestable theory $T$ under some prestable theory $B$.
Recall that a prestable theory is a theory $T$ with a map $\alpha : L(T) \to T$, where $L$ is a functor defined in \cite{alg-tt}.
It was shown in \cite[Lemma~4.4]{alg-tt} that every such theory is isomorphic to a contextual theory,
that is a theory which has $\mathcal{F}_B \amalg (\mathcal{F}_0 \times \mathbb{N})$,
$\mathcal{P}_B \amalg (\mathcal{P}_0 \times \mathbb{N})$ and $\mathcal{A}_B \amalg \mathcal{A}_0$ as the sets of function and predicate symbols and the set of axioms, respectively,
where $\mathcal{F}_0$, $\mathcal{P}_0$, and $\mathcal{A}_0$ are some sets and $\mathcal{F}_B$, $\mathcal{P}_B$, and $\mathcal{A}_B$ are the corresponding sets of $B$.
Elements of $\mathcal{F}_0$, $\mathcal{P}_0$ and $\mathcal{A}_0$ are called basic function symbols, basic predicate symbols, and basic axioms.

Now, we give an explicit construction of coproducts and coequalizers in the category $B/\PSt_{\mathcal{S}_0}$ of prestable theories under $B$,
which is similar to the one described in \cite[Proposition~2.12]{alg-tt} for the category of theories.
If $\{ T_i \}_{i \in I}$ is a set of theories under $B$, then the basic function and predicate symbols
and axioms of $\coprod_{i \in I} T_i$ are the disjoint union of corresponding sets of $T_i$.
If $f,g : T \to T'$ is a pair of maps of theories under $B$, then their coequalizer can be defined as
$T'$ together with the following axioms for every basic function symbol $\sigma$ and every basic predicate symbol $R$ of $T$:
\begin{align*}
& \sststile{}{x_1, \ldots x_k} f(\sigma(x_1, \ldots x_k)) \cong g(\sigma(x_1, \ldots x_k)) \\
& f(R(x_1, \ldots x_k)) \ssststile{}{x_1, \ldots x_k} g(R(x_1, \ldots x_k))
\end{align*}

The colimit of a diagram $T : I \to B/\PSt_{\mathcal{S}_0}$ can be described as the coequalizer of the coproduct $\coprod_{i \in I} T_i$ as usual.
Thus we can assume that the sets of basic function and predicate symbols of $\colim_{i \in I} T_i$ are disjoint unions of the corresponding sets of $T_i$.
The axioms of $\colim_{i \in I} T_i$ are axioms of $T_i$ together with axioms of the form $\sststile{}{x_1, \ldots x_n} \sigma(x_1, \ldots x_n) \cong f(\sigma(x_1, \ldots x_n))$
and $R(x_1, \ldots x_n) \ssststile{}{x_1, \ldots x_n} f(R(x_1, \ldots x_n))$ for every morphism $f : T_i \to T_j$
in the diagram and every function symbol $\sigma$ and predicate symbol $R$ of $T_i$ which are not symbols of $B$.

Let $\lambda$ be a regular cardinal.
We will say that a theory $T = ((\mathcal{S}, \mathcal{F}_0 \amalg \mathcal{F}, \mathcal{P}_0 \amalg \mathcal{P}), \mathcal{A}_0 \amalg \mathcal{A})$
in $\Th_B$ is \emph{$\lambda$-small} if cardinalities of sets $\mathcal{F}$, $\mathcal{P}$ and $\mathcal{A}$ are less than $\lambda$.
We will say that $T$ is \emph{finite} if it is $\aleph_0$-small.

\begin{prop}[theories-presentable]
The category of prestable theories under a prestable theory $B$ is locally finitely presentable.
An object of this category is $\lambda$-presentable if and only if it is isomorphic to a $\lambda$-small object.
\end{prop}
\begin{proof}
First, let us prove that every $\lambda$-small object is $\lambda$-presentable.
Let $\colim_{i \in I} T_i$ be a directed colimit of theories in $B/\PSt_{\mathcal{S}_0}$.
Every term and every formula of a theory is constructed from a finite number of function and predicate symbols.
Thus for every formula of $\colim_{i \in I} T_i$ there exists a theory $T_i$ such that this formula belongs to $T_i$.
The same is true for terms and restricted terms.

Every derivation of a theorem $\varphi \sststile{}{V} \psi$ is constructed from a finite number of function symbols, predicate symbols and axioms.
Thus for every theorem $\varphi \sststile{}{V} \psi$ of $\colim_{i \in I} T_i$ there exists a theory $T_i$ such that $\varphi \sststile{}{V} \psi$ is a theorem of $T_i$.
Note that the additional axioms of $\colim_{i \in I} T_i$ that was added for every $f : T_i \to T_j$ are always true in $T_j$.

Let $h : T \to \colim_{i \in I} T_i$ be a morphism from a $\lambda$-small theory $T$ to a $\lambda$-directed colimit of theories $\{ T_i \}_{i \in I}$.
Since $T$ is $\lambda$-small, there exists a theory $T_i$ such that for every function symbol $\sigma$, predicate symbol $R$ and axiom $\varphi \sststile{}{V} \psi$ of $T$,
restricted terms $h(\sigma(x_1, \ldots x_n))$ and formulae $h(R(x_1, \ldots x_n))$ belong to $T_i$, and $h(\varphi) \sststile{}{V} h(\psi)$ is a theorem of $T$.
Thus $h$ factors through $T_i$.

Let $h_1,h_2 : T \to T_i$ be morphisms such that $g_i \circ h_1 = g_i \circ h_2$, where $g_i : T_i \to \colim_{i \in I} T_i$.
Then for every function symbol $\sigma$ of $T$, sequent
\[ \sststile{}{x_1, \ldots x_n} h_1(\sigma(x_1, \ldots x_n)) \cong h_2(\sigma(x_1, \ldots x_n)) \]
is a theorem of $\colim_{i \in I} T_i$.
But we already know that there exists a theory $T_j$ such that $i \leq j$ and this sequent is a theorem of $T_j$.
The same is true for every predicate symbol of $T$.
It follows that $f \circ h_1 = f \circ h_2$, where $f : T_i \to T_j$.

Now, let us prove that $B/\PSt_{\mathcal{S}_0}$ is locally finitely presentable.
We only need to show that every theory in $B/\PSt_{\mathcal{S}_0}$ is a $\lambda$-directed colimit of its $\lambda$-small subtheories.
Let $T$ be a theory, and let $\{ f_i : T_i \to T' \}_{i \in I}$ be a cocone over the diagram of $\lambda$-small subtheories of $T$.
For every basic function or predicate symbol $p$ of $T$,
there is a finite subtheory $T_p$ of $T$ which contains symbols and axioms of $B$ and one additional symbol $p$ and no other axiom.
A morphism $h$ of cocones $T$ and $T'$ must commute with morphisms from $T_p$.
Thus it must be defined as $h(p(x_1, \ldots x_n)) = f_p(p(x_1, \ldots x_n))$; hence it is unique.
To prove that this defines a morphism, we need to show that $h$ preserves axioms of $T$.
But every axiom involes only a finite number of symbols of $T$.
Hence there exists a subtheory $T_i$ of $T$ which consists of these symbols and this axiom.
Since $f_i$ is a morphism of theories, this axiom also holds in $T'$.

Finally, let us prove that every $\lambda$-presentable theory $T$ in $B/\PSt_{\mathcal{S}_0}$ is isomorphic to a $\lambda$-small theory.
Consider the identity map $id_T : T \to T$.
Since $T$ is a $\lambda$-directed colimit of its $\lambda$-small subtheories, $id_T$ factors through some $\lambda$-small subtheory $T'$ of $T$.
Thus we have maps $f : T \to T'$ and $g : T' \to T$ such that $g \circ f = id_T$.
Since $T$ is a coequalizer of $f \circ g$ and $id_{T'}$, it is isomorphic to the coequalizer of $f \circ g$ and $id_{T'}$ as constructed above, which is a $\lambda$-small theory.
\end{proof}

\begin{cor}
The categories of stable and $c$-stable theories and categories of (stable, $c$-stable) algebraic dependent type theories are all locally finitely presentable.
\end{cor}
\begin{proof}
Each of this categories is a full reflective subcategory of the category of prestable theories closed under all colimits.
It follows from the previous propostion that they are locally finitely presentable.
\end{proof}

\subsection{Model structure}

Let $T_I = coe_1 + \sigma + Path + wUA$ be the theory defined in \cite{alg-models}.
In this subsection we define a model structure on the category $T_I/\algtt$ of algebraic dependent type theories under $T_I$.

To construct this model structure, we need to recall a few definitions from \cite{f-model-structures}.
A reflexive cylinder object $C_U(V)$ for a map $i : U \to V$ is any factorization of $[id_V,id_V] : V \amalg_U V \to V$.
Maps $f,g : V \to X$ are homotopic relative to a cylinder object $[\cyli_0,\cyli_1] : V \amalg_U V \to C_U(V)$, if there exists a map $h : C_U(V) \to X$
such that $h \circ \cyli_0 = f$ and $h \circ \cyli_1 = g$.
In this case we will write $f \sim_i g$.
We say that a map $f : X \to Y$ has RLP up to $\sim_i$ with respect to $i : U \to V$ if for every commutative square of the form
\[ \xymatrix{ U \ar[r]^u \ar@{}[dr]|(.7){\sim_i} \ar[d]_i & X \ar[d]^f \\
              V \ar[r]_v \ar@{-->}[ur]^g                  & Y,
            } \]
there is a dotted arrow $g : V \to X$ such that $g \circ i = u$ and $(f \circ g) \sim_i v$.
We will say that a map has RLP up to relative homotopy with respect to a set $\I$ of maps if it has RLP up to $\sim_i$ with respecto to every $i \in \I$.

We will also need the following theorem from \cite{f-model-structures}:
\begin{thm}[model-structure]
Let $\C$ be a complete and cocomplete category, and let $\I$ be a set of maps of $\C$
such that the domains and the codomains of maps in $\I$ are small relative to $\Icell$.
For every $i : U \to V \in \I$, choose a reflexive relative cylinder object $C_U(V)$
such that $[\cyli_0,\cyli_1] : V \amalg_U V \to C_U(V) \in \Icof$.
Let $\J_\I = \{\ \cyli_0 : V \to C_U(V)\ |\ i : U \to V \in \I \ \}$, and
let $\we_\I$ be the set of maps which have RLP up to relative homotopy with respect to $\I$.

Suppose that for all composable $f \in \Jcell[_\I] \cup \we_\I$ and $g$, if $g \circ f \in \we_\I$, then $g \in \we_\I$.
Then there exists a cofibrantly generated model structure on $\C$ with $\I$ as a set of generating cofibrations,
$\J_\I$ as a set of generating trivial cofibrations, and $\we_\I$ as a class of weak equivalences.
\end{thm}

For every sequence $(p_1,n_1), \ldots (p_{k+1},n_{k+1})$ of sorts, let $T_{(p_1,n_1), \ldots (p_{k+1},n_{k+1})}$ be the theory under $T_I$
with function symbols $\sigma_i : (p_1,n_1) \times \ldots \times (p_{i-1},n_{i-1}) \to (d_{p_i},n_i)$ for every $1 \leq i \leq k$,
$\sigma_{k+1} : (p_1,n_1) \times \ldots \times (p_k,n_k) \to (p_{k+1},n_{k+1})$,
and axioms $\varphi_1 \land \ldots \land \varphi_i \sststile{}{x_1, \ldots x_i} \sigma_{i+1}(x_1, \ldots x_i)\!\downarrow$ for every $1 \leq i \leq k$,
where $\varphi_j$ equals to $e_{p_j}(x_j) = \sigma_j(x_1, \ldots x_{j-1})$.
Let $\I$ be the set of maps of the form $T_{l, (d_p,n)} \to T_{l, (p,n)}$, where $l = s_1, \ldots s_k$ is any sequence of sorts,
$\sigma_i$ maps to $\sigma_i$ for every $1 \leq i \leq k$, and $\sigma_{k+1}$ maps to $e_p(\sigma_{k+1})$.
Let $\I_0 \subseteq \I$ be the subset which consists of the maps $T_{l, (d_p,n)} \to T_{l, (p,n)}$ such that $l$ is empty.

For every map in $\I$, we need to define a relative cylinder object for it.
Let $C_{T_{l,(ty,n)}}(T_{l,(tm,n)})$ be the theory with the same symbols and axioms as $T_l$,
three additional function symbol $\sigma, \sigma', h : s_1 \times \ldots \times s_k \to (tm,n)$,
and axioms making $h$ into a relative homotopy between $\sigma$ and $\sigma'$ with respect to $\varphi_1 \land \ldots \land \varphi_k$.
Analogously, we define $C_{T_{l,(ctx,n)}}(T_{l,(ty,n)})$ to be the theory with the same symbols and axioms as $T_l$,
seven additional function symbols $\sigma,\sigma' : s_1 \times \ldots \times s_k \to (ty,n)$, $f,g,g',p,q : s_1 \times \ldots \times s_k \to (tm,n+1)$,
and axioms making $(f,g,g',p,q)$ into a relative homotopy between $\sigma$ and $\sigma'$ with respect to $\varphi_1 \land \ldots \land \varphi_k$.
Maps $\cyli_0,\cyli_1 : T_{l,(tm,n)} \to C_{T_{l,(ty,n)}}(T_{l,(tm,n)})$ and their retraction
$s : C_{T_{l,(ty,n)}}(T_{l,(tm,n)}) \to T_{l,(tm,n)}$ are defined in the obvious way.

\begin{remark}[triv-fib-lift]
By \rprop{morita-char}, a map has RLP up to relative homotopy with respect to $\I$ if and only if it is a Morita equivalence.
Similarly, \rprop{syn-equiv-char} implies that a map has RLP up to relative homotopy with respect to $\I_0$ if and only if it is a syntactic equivalence.
\end{remark}

\begin{lem}[jcell-morita]
Let $f : X \to Y$ be a pushout of $\cyli_0 : T_{l,(tm,n)} \to C_{T_{l,(ty,n)}}(T_{l,(tm,n)})$ (in the category of $I$-stable theories under $T_I$)
and let $g : Y \to X$ be the retraction of $f$ which is the pushout of $s$.
Let $\varphi$ be a formula of $X$ such that for every predicate symbol $R$ occurring in $\varphi$,
sequent $R(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} \alpha(L(R))(I, I \times x_1, \ldots I \times x_k)$ is derivable in $X$.

Then for every term $t$ of $Y$ such that $f(\varphi) \sststile{}{V} t\!\downarrow$, terms $t$ and $f(g(t))$ are relatively homotopic with respect to $f(\varphi)$.
\end{lem}
\begin{proof}
This lemma is analogous to \cite[Lemma~3.7]{alg-models}.
We defined there a function $h : Term_Y(V)_{(p,n)} \to Term_Y(L(V))_{(p,n+1)}$ such that $h$ preserves theorems in the sense that
if $\chi \sststile{}{V} \psi$ is a theorem of $Y$, then $h(\chi) \land \bigwedge_{x \in L(V)} ctx^n(x) = I \sststile{}{L(V)} h(\psi)$ is also a theorem.
Note that $h(f(\varphi)) = \alpha(L(f(\varphi)))$ since $f(\varphi)$ contains only symbols of $X$.
The condition we put on $\varphi$ implies that sequent $f(\varphi) \sststile{}{V} h(f(\varphi))[\rho]$ is derivable, where $\rho(x) = I \times x$.
Thus we have the following theorem: $f(\varphi) \sststile{}{V} h(t)[\rho]\!\downarrow$.

Moreover, we have theorems $h(t)[\rho]\!\downarrow\ \sststile{}{V} h(t)[\rho][left] = f(g(t))$ and $h(t)[\rho]\!\downarrow\ \sststile{}{V} h(t)[\rho][right] = t$
(here, $[\rho]$ is an operation of substitution on terms and $[left]$ and $[right]$ are derived function symbols in the theory; we are sorry for this clash of the notation).
Thus $h(t)[\rho]$ gives us the required homotopy between $t$ and $f(g(t))$.
\end{proof}

\begin{thm}[theories-model-structure]
There exists a model structure on the category of $I$-stable algebraic dependent type theories under $T_I$
with $\I$ as the set of generating cofibrations, Morita equivalences as weak equivalences, and in which all objects are fibrant.
We call it \emph{the Morita model structure}.
\end{thm}
\begin{proof}
Note that the set $\we_\I$ consists of Morita equivalences.
Since Quillen equivalences satisfy the 2-out-of-3 property, by \rprop{morita-quillen}, Morita equivalences between theories under $T_I$ also satisfy it.
Since the codomains of maps in $\I$ are finite, Morita equivalences are closed under transfinite compositions.
Thus by \rthm{model-structure}, we just need to prove that pushouts of maps $\cyli_0 : T_{l,(p,n)} \to C_{T_{l,(d_p,n)}}(T_{l,(p,n)})$ are Morita equivalences.
Let $f : X \to Y$ be a pushout of $\cyli_0$ and let $g : Y \to X$ be its retract.
Let $\varphi$ be a formula of $X$ which does not contain any predicate symbols and let $A$ be a term of $X$ such that $\varphi \sststile{}{V} A\!\downarrow$.
Let $a$ be a term of $Y$ such that $f(\varphi) \sststile{}{V} e_p(a) = f(A)$.
If we define $a'$ as $g(a)$, then $\varphi \sststile{}{V} e_p(a') = A$ and the fact that $f(a')$ and $a$ are relatively homotopic follows from \rlem{jcell-morita}.
\end{proof}

\Rlem{jcell-morita} implies that trivial cofibrations satisfying a mild additional condition are strong Morita equivalences:

\begin{prop}
Let $f : T_1 \to T_2$ be a trivial cofibration such that for every predicate symbol $R$ of $T_1$,
sequent $R(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} \alpha(L(R))(I, I \times x_1, \ldots I \times x_k)$ is derivable.
Then $f$ is a strong Morita equivalence.
\end{prop}
\begin{proof}
Since trivial cofibrations are retracts of maps in $\Jcell[_\I]$ and strong Morita equivalences are closed under retracts,
we just need to prove that maps in $\Jcell[_\I]$ are strong Morita equivalences.
Since strong Morita equivalences are closed under transfinite compositions, we just need to prove this for maps $f$ which are pushouts of maps in $\Jcell[_\I]$.
Moreover, since maps in $\Jcell[_\I]$ do not change the set of predicate symbols,
we may assume that the domain and the codomain of $f$ satisfy the same condition on the predicate symbols as $T_1$.
Now, \rlem{jcell-morita} implies that such maps are strong Morita equivalences.
\end{proof}

Note that the domains and the codomains of maps in $\I$ do not have any predicate symbols.
Thus cofibrant objects also do not have them (to be precise, they are isomorphic to theories without predicate symbols).
So it seems rather pointless to have predicate symbols at this point.
We can consider the full subcategory $\algtt_f$ of $\algtt$ on theories without predicate symbols
(and without function symbols of the form $\sigma : s_1 \times \ldots \times s_k \to (ctx,0)$).
\Rprop{theories-presentable} still holds for $\algtt_f$, so this category is locally finitely presentable.
There is a model structure on $T_I/\algtt_f$ in which the classes of cofibrations, fibrations, and weak equivalences
are the intersections of the corresponding classes in $T_I/\algtt$ with the class of morphisms of $\algtt_f$.
This model category has the same sets of generating cofibrations and generating trivial cofibrations as $\algtt$.

\begin{prop}
The inclusion functor $T_I/\algtt_f \to T_I/\algtt$ has a right adjoint and this adjunction is a Quillen equivalence.
\end{prop}
\begin{proof}
We will say that a theory $T$ \emph{has enough function symbols} if for every restricted term $t$ of sort $s$ with free variables $x_1 : s_1$, \ldots $x_k : s_k$,
there is a function symbol $\sigma : s_1 \times \ldots \times s_k \to s$ such that sequent $\sststile{}{x_1, \ldots x_k} t \cong \sigma(x_1, \ldots x_k)$ is derivable.
Note that every theory $T$ is isomorphic to a theory $T'$ with enough function symbols.
Indeed, function symbols of $T'$ are just terms of the original theory and
axioms of $T'$ are axioms of $T$ together with axioms that say that the new terms are equivalent to the old ones.

Thus we may restrict and corestrict the inclusion functor $i : \algtt_f \to \algtt$ to the full subcategories of $\algtt_f$ and $\algtt$ on theories with enough function symbols.
We will denote this functor by $i' : \algtt'_f \to \algtt'$.
Now, it is easy to describe a right adjoint to $i'$.
For every theory $T \in \algtt'$, let $r'(T)$ be the theory with the same function symbols as $T$, no predicate symbols,
and with the set of axioms which consists of all theorems of $T$ which do not involve predicate symbols.
Then $r'$ is a functor $\algtt' \to \algtt'_f$.
It is easy to see that $r'$ is right adjoint to $i'$.
Since $i'(r'(T))$ and $T$ have the same sets of terms and theorems (which do not involve predicate symbols), the counit $\epsilon_T : i'(r'(T)) \to T$ is a trivial fibration.

Finally, note that the inclusion functor $T_I/i : T_I/\algtt_f \to T_I/\algtt$ preserves and reflects cofibrations and weak equivalences.
Moreover, it has a right adjoint and the counit of the adjunction is a trivial fibrations.
Thus this adjunction is a Quillen equivalence.
\end{proof}

Now, let us return to the original problem of the absence of predicate symbols in cofibrant objects.
Instead of forbidding predicate symbols completely, we can enlarge the class of cofibrations to include predicate symbols.
For every sequence of sorts $s_1, \ldots s_k$, let $P^1_{s_1, \ldots s_k}$ be the theory under $T_I$ with one additional predicate symbol $P : s_1 \times \ldots \times s_k$.
Also, we define the following theories:
\begin{align*}
P^2_{s_1, \ldots s_k} & = P^1_{s_1, \ldots s_k} \cup \{ Q : s_1 \times \ldots \times s_k, P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} Q(x_1, \ldots x_k) \} \\
P^3_{s_1, \ldots s_k} & = P^2_{s_1, \ldots s_k} \cup \{ R : s_1 \times \ldots \times s_k, Q(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} R(x_1, \ldots x_k) \}
\end{align*}
Let $\I^P$ be the union of $\I$ and maps of the form $P^1_l \to P^2_l$, $P \mapsto Q$ and $P^2_l \to P^3_l$, $P \mapsto P$, $Q \mapsto R$, where $l$ is any sequence of sorts.
We define a relative cylinder object for the map $P^\alpha_l \to P^{\alpha+1}_l$ as $P^{\alpha+1}_l \amalg_{P^\alpha_l} P^{\alpha+1}_l$, where $\alpha \in \{ 1, 2\}$.
Thus any two maps $P^{\alpha+1}_l \to X$ are homotopic.
This implies that $\we_{\I^P} = \we_\I$.
To prove that there is a model structure on $T_I/\algtt$ with $\I^P$ as a set of generating cofibrations,
we just need to show that pushouts of maps $P^{\alpha+1}_l \to P^{\alpha+1}_l \amalg_{P^\alpha_l} P^{\alpha+1}_l$ are Morita equivalences.
But this is obvious since the domain and the codomain of such a pushout have the same sets of terms and axioms.
Of course, the identity functor determine a Quillen equivalence between the two model structures on $T_I/\algtt$.

Finally, let us discuss another model structure on the category of $I$-stable theories under $T_I$, which we call \emph{the syntactic model structure}.
The weak equivalences of this model structure are syntactic equivalences, $\I_0$ is a set of generating cofibrations, and every object is fibrant in this model structure.

Recall that for every theory $T$, we have a left adjoint functor $Lang_T : \Mod{T} \to T/\algtt$ with a right adjoint $Syn_T : T/\algtt \to \Mod{T}$.
Note that a map $f : T_1 \to T_2$ of theories under $T_I$ is a syntactic equivalence if and only if $Syn_{T_I}(f)$ is a weak equivalence of models.
Thus we can transfer the model structure on $\Mod{T_I}$ to a model structure on $T_I/\algtt$.
To do this, we need to prove that $Lang_{T_I}$ maps trivial cofibrations to syntactic equivalences.
But we already proved that it actually maps them to Morita equivalences.
Note that the identity functor on $T_I/\algtt$ is a left Quillen functor from the syntactic model structure to the Morita model structure
since it preserves generating cofibrations and generating trivial cofibrations.

Let $T$ be an $I$-stable theory under $T_I$.
Then the adjunction $Lang_T \dashv Syn_T$ is a Quillen equivalence between the model structure on $\Mod{T}$ and the syntactic model structure on $T/\algtt$.
To prove this, we just need to show that the unit of the adjunction is a weak equivalence.
But it is actually an isomorphism since $Lang_T$ is full and faithful.

\section{Examples of Morita equivalences}

In this section we prove several useful lemmas that characterize (strong) Morta equivalences and syntactic equivalences.
Since all of these notations are defined in terms of weak lifting properties, we will prove general results about them.
We will construct several examples of Morita equivalences using these lemmas.

\subsection{Characterization of lifting properties}

We begin with lifting properties since they are easier to handle than weak lifting properties.
If we think about a map that has the weak lifting property with respect to a pair $V,\varphi$ as a weak equivalence,
then a map having the lifting property with respect to this pair can be thought of as a trivial fibration.

\begin{lem}[eq-char]
Let $V$ be a set of variables and let $\varphi$ be a formula of a theory $T_1$ with free variables in $V$.
Let $f : T_1 \to T_2$ be a morphism of theories such that the following conditions hold:
\begin{enumerate}
\item \label{it:char-fun} For every function symbol $\sigma$ of $T_2$, there exist terms $A_1$, \ldots $A_k$, $t$ of $T_1$ such that $FV(A_i) \subseteq \{ x_1, \ldots x_{i-1} \}$ and the following sequents are derivable:
\begin{align*}
\bigwedge_{1 \leq i < j} e_{p_i}(x_i) = A_i & \sststile{T_1}{x_1, \ldots x_{j-1}} A_j\!\downarrow \text{ for every } 1 \leq j \leq k \\
\bigwedge_{1 \leq i \leq k} e_{p_i}(x_i) = A_i & \sststile{T_1}{x_1, \ldots x_k} t\!\downarrow \\
\sigma(x_1, \ldots x_k)\!\downarrow & \sststile{T_2}{x_1, \ldots x_k} f(t) = \sigma(x_1, \ldots x_k) \land \bigwedge_{1 \leq i \leq k} e_{p_i}(x_i) = f(A_i)
\end{align*}
\item \label{it:char-type} For all terms $A$, $B$, and $a$ of $T_1$ such that $\varphi \sststile{T_1}{V} e_p(a) = A$ and $f(\varphi) \sststile{T_2}{V} f(A) = f(B)$,
there exists a term $b$ such that $\varphi \sststile{T_1}{V} e_p(b) = B$ and $f(b)$ equals to $f(a)$.
\end{enumerate}
Then $f$ has the lifting property with respect to $V,\varphi$.
\end{lem}
\begin{proof}
Let $A$ and $a$ be terms such that $\varphi \sststile{}{V} A\!\downarrow$ and $f(\varphi) \sststile{}{V} e_p(a) = f(A)$.
Then we construct the required lifting by induction on $a$.
If $a = x$ is a variable, then \eqref{it:char-type} implies that that the required lifting exists.

Now, suppose that $a = \sigma(a_1, \ldots a_k)$.
Let $A_1$, \ldots $A_k$, $t$ be terms as described in \eqref{it:char-fun}.
By induction hypothesis, there exist terms $a_1'$, \ldots $a_k'$ such that $\varphi \sststile{}{V} e_{p_i}(a_i') = A_i[x_1 \repl a_1', \ldots x_{i-1} \repl a_{i-1}']$ and $f(\varphi) \sststile{}{V} f(a_i') = a_i$.
Let $a' = t[x_1 \repl a_1', \ldots x_k \repl a_k']$.
Since $\varphi \sststile{}{V} a'\!\downarrow$ and $f(\varphi) \sststile{}{V} f(a') = f(a)$, \eqref{it:char-type} implies that there exists the required lifting.
\end{proof}

\begin{remark}
If $T_2$ is a stable contextual theory, then it is enough to check the first condition of the previous lemma for basic function symbols.
It is easy to see that this implies the general case.
\end{remark}

Now, we want to simplify conditions of \rlem{eq-char}.
It is easy to do this for the second one:

\begin{lem}[char-type]
Let $V$ be a set of variables and let $\varphi$ be a formula of a theory $T_1$ with free variables in $V$.
Let $f : T_1 \to T_2$ be a morphism of theories such that the following condition holds.
For every pair of terms $A$ and $B$ of $T_1$ of sort $(ty,n)$ such that
$\varphi \sststile{T_1}{V} ft(A) = ft(B)$ and $f(\varphi) \sststile{T_2}{V} f(A) = f(B)$,
there exists a term $b$ such that $\varphi \sststile{T_1}{V} A \vdash b : B$ and $f(b)$ equals to $v_0(f(A))$.
Then the second condition of \rlem{eq-char} holds.
\end{lem}
\begin{proof}
First, note that if $\Gamma$ and $\Delta$ are context such that $\varphi \sststile{T_1}{V} \Gamma\!\!\downarrow\!\land\:\Delta\!\!\downarrow$ and $f(\varphi) \sststile{T_2}{V} f(\Gamma) = f(\Delta)$,
then there is a morphism of context $d : \Gamma \to \Delta$ such that $f(d)$ is the identity morphism.
We prove this by induction on the length of contexts.
There is a unique morphism between empty contexts.
If contexts are not empty, then we have a morphism $d : ft(\Gamma) \to ft(\Delta)$ by induction hypothesis.
Since $f(d^*(\Delta))$ equals to $f(\Gamma)$, we have a term $\Gamma \vdash b : d^*(\Delta)$ such that $f(b)$ equals to $v_0(f(\Gamma))$ by assumption.
Thus, $d,b$ is the required morphism of contexts $\Gamma$ and $\Delta$.

For all terms $A$, $B$, and $a$ of $T_1$ such that $\varphi \sststile{T_1}{V} e_p(a) = A$ and $f(\varphi) \sststile{T_2}{V} f(A) = f(B)$,
there exists a term $b$ such that $\varphi \sststile{T_1}{V} e_p(b) = B$ and $f(\varphi) \sststile{T_2}{V} f(a) = f(b)$.
We have a morphism $d : A \to B$ such that $f(d)$ equals to the identity morphism.
if $p = ty$, then we can define $b$ as $d^*(a)$.
if $p = tm$, then let $B = d^*(ty(a))$.
Since $f(B) = f(ty(a))$, we have a term $ty(a) \vdash b' : B$ such that $f(b')$ equals to $v_0(f(B))$ by assumption.
Then we can define $b$ as $b'[d^*(a)]$.
\end{proof}

If we want to simplify the first condition of \rlem{eq-char}, then we need certain assumptions on the theory $T_2$.
We will say that a theory \emph{has well-defined function symbols} if (it is isomorphic to a theory such that) there exists a well-founded relation on the set of function symbols such that,
for every function symbol $\sigma$, either $\sigma$ equals to one of the function symbols $ty_n$, $ft_n$ or there exist terms $A_1$, \ldots $A_k$ satisfying the following conditions:
\begin{enumerate}
\item All function symbols that occur in $A_1$, \ldots $A_k$ are less than $\sigma$.
\item $FV(A_i) \subseteq \{ x_1, \ldots x_{i-1} \}$ for every $1 \leq i \leq k$.
\item The following sequents are derivable:
\begin{align*}
\bigwedge_{1 \leq i < j} e_{p_i}(x_i) = A_i & \sststile{}{x_1, \ldots x_{j-1}} A_j\!\downarrow \text{ for every } 1 \leq j \leq k \\
\bigwedge_{1 \leq i \leq k} e_{p_i}(x_i) = A_i & \ssststile{}{x_1, \ldots x_k} \sigma(x_1, \ldots x_k)\!\downarrow
\end{align*}
\end{enumerate}
We will say that terms $A_1$, \ldots $A_k$ \emph{define} the function symbol $\sigma$.

This condition is easy to check and most of the theories that occur in practice satisfy it.
An example of a theory that does not satisfy it appeared in \cite{alg-models}: it is the theory of filler operations.
The rest of the theories that appear in \cite{alg-models} and also all of the theories in this paper and in \cite{alg-tt} have well-defined function symbols.

\begin{lem}[char-fun]
Let $V$ be a set of variables and let $\varphi$ be a formula of a theory $T_1$ with free variables in $V$.
Let $f : T_1 \to T_2$ be a morphism of theories such that $T_2$ has well-defined function symbols.
Suppose that the second condition of \rlem{eq-char} holds and, for every function symbol $\sigma$ of $T_2$, either the first condition of \rlem{eq-char} holds for $\sigma$ or,
for every pair $\{ x_1, \ldots x_k \},\psi$ in $P_M$, if $f(\psi) \sststile{T_2}{x_1, \ldots x_k} \sigma(x_1, \ldots x_k)\!\downarrow$ is derivable, then there exists a term $t$ of $T_1$ such that the following sequents are derivable:
\begin{align*}
\psi & \sststile{T_1}{x_1, \ldots x_k} t\!\downarrow \\
f(\psi) & \sststile{T_1}{x_1, \ldots x_k} \sigma(x_1, \ldots x_k) = f(t)
\end{align*}
Then the first condition of \rlem{eq-char} holds.
\end{lem}
\begin{proof}
First, note that if the first condition of \rlem{eq-char} holds for some subset of function symbols of $T_2$, then we still can lift terms constructed from function symbols from this subset.
The proof of this fact is the same as the proof of \rlem{eq-char}.
We also note that symbols $ty_n$ and $ft_n$ satisfy the first condition of \rlem{eq-char}, so we may assume that they are less than every other symbol.

Now, we can proceed by well-founded induction on $\sigma$.
If the first condition of \rlem{eq-char} holds for $\sigma$, then we are done.
Otherwise, let $A_1$, \ldots $A_k$ be terms that define $\sigma$.
By induction hypothesis, there exist lifts $A_1'$, \ldots $A_k'$ of these terms (we first lift $ft^{n_i}(e_{p_i}(A_i))$, then $ft^{n_i-1}(e_{p_i}(A_i))$, and so on; finally, we can lift $A_i$).
If we let $\psi = (\bigwedge_{1 \leq i \leq k} e_{p_i}(x_i) = A_i')$, then $f(\psi) \sststile{T_2}{x_1, \ldots x_k} \sigma(x_1, \ldots x_k)\!\downarrow$.
Thus, by assumption, we have a term $t$ such that $\psi \sststile{T_1}{x_1, \ldots x_k} t\!\downarrow$ and $f(\psi) \sststile{T_2}{x_1, \ldots x_k} f(t) = \sigma(x_1, \ldots x_k)$.
Since $\sigma(x_1, \ldots x_k)\!\downarrow\ \sststile{T_2}{x_1, \ldots x_k} f(\psi)$, we are done.
\end{proof}

\begin{prop}
Let $P$ be a set such that $P_M \subseteq P \subseteq P_S$.
If $f : T_1 \to T_2$ is a morphism of theories such that $T_2$ has well-defined function symbols, then the following conditions are equivalent:
\begin{enumerate}
\item \label{it:eq-fib} $f$ has the lifting property with respect to $P$.
\item \label{it:cond-fib} Conditions of \rlem{char-type} and \rlem{char-fun} hold for all pairs in $P$.
\item \label{it:lem-fib} Both conditions of \rlem{eq-char} hold for all pairs in $P$.
\end{enumerate}
\end{prop}
\begin{proof}
This follows from \rlem{eq-char}, \rlem{char-type}, and \rlem{char-fun}.
\end{proof}

\subsection{Characterization of weak lifting properties}

\subsection{Applications}

\section{Structure of a cofibration category}

The model structure that we secribe in the previous section has a problem:
naturally occurring examples of algebraic dependent type theories are not cofibrant in this model structure.
In this section we define a full subcategory of theories which are cofibrant in some sense.
This class of cofibrant theories is not related to cofibrant theories in the model structure of the previous section.
Thus we define the structure of a cofibration category on such cofibrant theories and
prove that this cofibration category is equivalent to the cofibration category of cofibrant objects of the model structure.
Most of algebraic dependent type theories that occur in practice are cofibrant in our new sense.

Let $S_{s_1, \ldots s_k, s}$ be the theory with one predicate symbol $P : s_1 \times \ldots \times s_k$, one function symbol $\sigma : s_1 \times \ldots \times s_k \to s$,
and one axiom $P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} \sigma(x_1, \ldots x_k)\!\downarrow$.
Let $\I^S$ be the set of maps of the form $S_{l,(d_p,n)} \to S_{l,(p,n)}$, where $l = s_1, \ldots s_k$ is any sequence of sorts and $\sigma$ maps to $e_p(\sigma)$.
Let $\I^{SP}$ be the union of $\I^S$ and maps of the form $P^\alpha_l \to P^{\alpha+1}_l$ as defined at the end of the previous section.
Note that $\Icof \subseteq \Icof[I^S]$ and $\Icof[I^P] \subseteq \Icof[I^{SP}]$.
Also note that a map has RLP up to relative homotopy with respect to $\I^S$ (or, equivalently, $\I^{SP}$) if and only if it is a strong Morita equivalence.

A map is a relative $\I^{SP}$-cell complex if and only if it is isomorphic to an inclusion of a subtheory $(\mathcal{F},\mathcal{P},\mathcal{A}) \to (\mathcal{F} \amalg \mathcal{F}', \mathcal{P} \amalg \mathcal{P}', \mathcal{A} \amalg \mathcal{A}')$
such that there is a well-ordering on the set $\mathcal{F}'$ and $\mathcal{A}' = \{ S(\sigma)\ |\ \sigma \in \mathcal{F}' \}$,
where $S(\sigma)$ is a sequent of the form $\varphi \sststile{}{x_1, \ldots x_k} e_p(\sigma(x_1, \ldots x_k)) = A$
such that the sequent $\varphi \sststile{}{x_1, \ldots x_k} A$ is derivable in the subtheory of $(\mathcal{F} \amalg \mathcal{F}', \mathcal{P} \amalg \mathcal{P}', \mathcal{A} \amalg \mathcal{A}')$ which consists of function symbols less than $\sigma$.
In particular, $\varphi$ and $A$ contain only such function symbols.
We call such an inclusion a \emph{presented relative $\I^{SP}$-cell complex}.

We will say that a map $f : T \to T'$ is a \emph{conservative extension} if a sequent $S$ of $T$ is derivable whenever $f(S)$ is derivable.

\begin{prop}
Let $f : T \to T'$ be a conservative extension such that $T'$ is a quotient of a relative $\I^P$-cell complex.
Then $f$ is a Morita equivalence if and only if, for every function symbol $\sigma$ of $T'$, there is a term $t$ of $T$ such that $f(t)$
\end{prop}

\begin{lem}
Let $f : T \to T'$ be a presented relative $\I^{SP}$-cell complex, where $T = (\mathcal{F},\mathcal{P},\mathcal{A})$ and $T' = (\mathcal{F} \amalg \mathcal{F}', \mathcal{P} \amalg \mathcal{P}', \mathcal{A} \amalg \mathcal{A}')$.
Let $\varphi$ be a formula of $T$, and let $\psi$ be a formula of $T'$.
If a sequent $f(\varphi) \sststile{}{V} \psi$ is derivable, then there exists a derivation of this sequent in the natural deduction system
in which the rule \axref{nf} is applied only to function symbols in $\mathcal{F}$.
\end{lem}
\begin{proof}
First, let us prove the following fact.
If $t = \sigma(t_1, \ldots t_k)$ is a subterm of $\psi$, $\sigma \in \mathcal{F}'$, and there is a derivation of $f(\varphi) \sststile{}{V} \psi$ in which the rule \axref{nf} is applied only to function symbols in $\mathcal{F}$,
then there is a derivation satisfying the same property for the sequent $f(\varphi) \sststile{}{V} t_i\!\downarrow$ for every $1 \leq i \leq k$.
Note that we may assume that axioms in $\mathcal{A}'$ are of the form $\varphi \land A\!\downarrow \sststile{}{x_1, \ldots x_k} e_p(\sigma(x_1, \ldots x_k)) = A$
since this axiom is equivalent to the one we described before.
We prove this fact by induction on a derivation of $f(\varphi) \sststile{}{V} \psi$.
The only nontrivial cases are \axref{nl} and \axref{na}.
Let us first consider \axref{nl}:
\begin{center}
\AxiomC{$f(\varphi) \sststile{}{V} a = b$}
\AxiomC{$f(\varphi) \sststile{}{V} \chi[a/x]$}
\BinaryInfC{$f(\varphi) \sststile{}{V} \chi[b/x]$}
\DisplayProof
\end{center}
If $t$ is a subterm of $b$, then the conclusion follows immediately from induction hypothesis.
Otherwise, there is a term $t' = \sigma(t_1', \ldots t_k')$ such that $t = t'[b/x]$.
Induction hypothesis implies that $f(\varphi) \sststile{}{V} t_i'[a/x]\!\downarrow$ is derivable.
By \axref{nl}, the sequent $f(\varphi) \sststile{}{V} t_i'[b/x]\!\downarrow$ is also derivable.

Now, let us consider the rule \axref{na}.
If the corresponding axiom belongs to $\mathcal{A}$,
then $t$ is a subterm of $r_i$ for some $i$.
Hence, the conclusion holds by induction hypothesis.
If the axiom belongs to $\mathcal{A}'$, then the conclusion of the rule looks like this: $e_p(\tau(r_1, \ldots r_m)) = A$.
Note that terms $r_1$, \ldots $r_m$, $A$ appear in the premises of the rule.
Thus, if $t$ is a subterm of one of these terms, then we are done.
Otherwise, $t = \tau(r_1, \ldots r_m)$.
Then $t_i = r_i$ and the sequent $f(\varphi) \sststile{}{V} t_i\!\downarrow$ is one of the premises of the rule.

Finally, we can finish the proof of the lemma by induction on a derivation of the sequent $f(\varphi) \sststile{}{V} \psi$.
The only nontrivial case is \axref{nf}.
In this case, we can apply the fact that we just proved.
\end{proof}

If $\mathcal{F}$ is a set of function symbols, then we will say that a term $t$ is an $\mathcal{F}$-term if $t = \sigma(t_1, \ldots t_k)$ for some terms $t_1$, \ldots $t_k$
and some function symbol $\sigma$ which belongs to $\mathcal{F}$.

\begin{lem}
Let $f : T \to T'$ be a presented relative $\I^{SP}$-cell complex, where $T = (\mathcal{F},\mathcal{P},\mathcal{A})$ and $T' = (\mathcal{F} \amalg \mathcal{F}', \mathcal{P} \amalg \mathcal{P}', \mathcal{A} \amalg \mathcal{A}')$.
Let $\varphi$ and $\psi$ be formulas of $T$, and let $t_1$, \ldots $t_n$ be $\mathcal{F}'$-terms.
If the sequent $f(\varphi)[t/x] \sststile{}{V} f(\psi)[t_1/x_1, \ldots t_n/x_n]$ is derivable,
then the sequent $f(\varphi)[t_1'/x_1, \ldots t_n'/x_n] \sststile{}{V} f(\psi)[t'/x]$ is also derivable
for every terms $t_1'$, \ldots $t_n'$ such that the sequents $f(\varphi) \sststile{}{V} e_p(t_i) = e_p(t_i')$ are derivable for every $1 \leq i \leq n$.
\end{lem}
\begin{proof}
We prove this by induction on $\sigma$.
For a fixed $t$, we proceed by induction on a derivation of $f(\varphi) \sststile{}{V} f(\psi)[t/x]$ in the natural deduction system.
Let us consider the rules \axref{nf}, \axref{nl}, and \axref{na} since the rest are easy to prove.
First, consider an instance of \axref{nf} rule:
\begin{center}
\AxiomC{$\varphi \sststile{}{V} \sigma(r_1, \ldots r_k)\!\downarrow$}
\UnaryInfC{$\varphi \sststile{}{V} r_i\!\downarrow$}
\DisplayProof
\end{center}
By the previous lemma, we may assume that $\sigma \in \mathcal{F}$.
In this case, we can apply induction hypothesis to $\sigma(r_1, \ldots r_k)$.

Now, consider the rule \axref{nl}:
\AxiomC{$f(\varphi) \sststile{}{V} a = b$}
\AxiomC{$f(\varphi) \sststile{}{V} \chi[a/x]$}
\BinaryInfC{$f(\varphi) \sststile{}{V} \chi[b/x]$}
\DisplayProof
Note that we may assume that $x$ occurs in $\chi$ exactly once since the general form of the rule follows from this special case.
Then either some $t_i$ contains $b$ as a subterm, or $b$ contains some 

\AxiomC{$f(\varphi) \sststile{}{V} \psi_1[t_1/x_1, \ldots t_k/x_k]$ \qquad \ldots \qquad $\Gamma \sststile{}{V} \psi_n[t_1/x_1, \ldots t_k/x_k]$}
\UnaryInfC{$f(\varphi) \sststile{}{V} \chi_j[t_1/x_1, \ldots t_k/x_k]$}
\DisplayProof
\end{proof}

Let $T'_{s_1, \ldots s_{k+1}}$ be equal to $T_{s_1, \ldots s_{k+1}}$ together with axiom
$\sigma_{k+1}(x_1, \ldots x_k)\!\downarrow\ \sststile{}{x_1, \ldots x_k} \varphi_1 \land \ldots \land \varphi_k$.
Let $\I^D$ be the set of maps of the form $T_{l, (d_p,n)} \to T_{l, (p,n)} \to T'_{l, (p,n)}$, where the first map belongs to $\I$ and the second map is the obvious inclusion.
Then $\I^D \subseteq \Icof$.
Indeed, $T_{l,s} \to T'_{l,s}$ has a section, which maps $\sigma_{k+1}(x_1, \ldots x_k)$ to $\sigma_{k+1}(x_1, \ldots x_k)|_{\varphi_1 \land \ldots \land \varphi_k}$.
Thus maps in $\I^D$ are retracts of maps in $\I$.
Let $\cof_0 = \Icell[I^D]$.

Let $\I^{DP}$ be the union of $\I^D$ and the set of maps of the form $0 \to P_{s_1, \ldots s_k}$.
Let $\cof_1$ be the class of maps of the form $T \to T' \to T''$, where $T \to T'$ belongs to $\Icell[I^{DP}]$ and
$T' \to T''$ is a regular epimorphism (equivalently, $T' \to T''$ is isomorphic to a map of the form $T' \to T' \cup \mathcal{A}$ for some set of axioms $\mathcal{A}$).
A map $f : T_0 \to T$ belongs to $\cof_1$ if and only if there is a theory $T'$ which extends $T_0$ such that $f$ is isomorphic to the inclusion $T_0 \to T'$
and there is a well-ordering on the set of new function symbols of $T'$ such that for every such function symbol $\sigma : (p_1,n_1) \times \ldots \times (p_k,n_k) \to (p,n)$
there exist terms $t_1, \ldots t_{k+1}$ such that $FV(t_i) \subseteq \{ x_1, \ldots x_{i-1} \}$, all function symbols that appear in $t_1, \ldots t_{k+1}$ are less than $\sigma$,
and the following sequents are derivable:
\begin{align*}
\bigwedge_{1 \leq j < i} e_{p_j}(x_j) = t_j & \sststile{}{x_1, \ldots x_{i-1}} t_i\!\downarrow \text{ for every } 1 \leq i \leq k+1 \\
\sigma(x_1, \ldots x_k)\!\downarrow\ & \ssststile{}{x_1, \ldots x_k} \bigwedge_{1 \leq j \leq k} e_{p_j}(x_j) = t_j \\
\sigma(x_1, \ldots x_k)\!\downarrow\ & \sststile{}{x_1, \ldots x_k} e_p(\sigma(x_1, \ldots x_k)) = t_{k+1}
\end{align*}
The terms $t_1, \ldots t_{k+1}$ will be denoted by $d_1(\sigma), \ldots d_{k+1}(\sigma)$.
If we work in the category of theories under $T_0$, then we call an object of this category $\cof_1$-\emph{cofibrant} if it belongs to $\cof_1$.

Let $T$ be a $\cof_1$-cofibrant theory with a well-ordering on the set of function symbols as described above.
Then we define a well-founded relation on the set of terms of $T$.
A term $t$ is less than $t'$ if $t'$ is not a variable and the greatest function symbol of $t'$ is greater than all function symbols of $t$.

\begin{lem}
Let $T$ be a $\cof_1$-cofibrant theory such that $T_I$ is a subtheory of $T$.
Then there exists a well-founded relation $\prec$ on the set of terms of $T$ such that
for every term $t$ which is not a variable, there exist variables $x_1, \ldots x_n \in FV(t)$ and terms $d_1(t), \ldots d_{n+1}(t)$ such that for every $1 \leq i \leq n+1$,
we have $FV(d_i) \subseteq \{ x_1, \ldots x_{i-1} \}$ and $d_i \prec t$ and the following sequents are derivable:
\begin{align*}
\bigwedge_{1 \leq j < i} e_{p_j}(x_j) = d_j(t) & \sststile{}{x_1, \ldots x_{i-1}} d_i(t)\!\downarrow \text{ for every } 1 \leq i \leq n+1 \\
t\!\downarrow\ & \ssststile{}{x_1, \ldots x_n} \bigwedge_{1 \leq j \leq n} e_{p_j}(x_j) = d_j(t) \\
t\!\downarrow\ & \sststile{}{x_1, \ldots x_n} e_p(t) = d_{n+1}(t)
\end{align*}
\end{lem}
\begin{proof}
If $t$ is not a variable, then let $m(t)$ be the greatest function symbol that appears in $t$ and
let $n(t)$ be the maximal number of $m(t)$ that appears on the path from the root of $t$ to some leaf.
That is, $n(x) = 0$ and
\[ n(\sigma(t_1, \ldots t_k)) = \left\{
  \begin{array}{lr}
    max_{1 \leq i \leq k}(n(t_i)) + 1 & \text{ if } \sigma = m(t) \\
    max_{1 \leq i \leq k}(n(t_i))     & \text{ if } \sigma \neq m(t)
  \end{array}
\right. \]
Now, we can define relation $\prec$.
For any terms $t$ and $s$, $s \prec t$ if and only if $t$ is not a variable and either $s$ is a variable or $(m(s),n(s))$ is less than $(m(t),n(t))$ in the lexicographical order.

We now proceed by well-founded induction on a term $t$.
If $t = \sigma(t_1, \ldots t_k)$, then we have the following theorems:
\begin{align*}
\bigwedge_{1 \leq j < i} e_{p_j}(t_j) & = d_j(\sigma)[t_1/x_1, \ldots t_{j-1}/x_{j-1}] \sststile{}{V} d_i(\sigma)[t_1/x_1, \ldots t_{i-1}/x_{i-1}]\!\downarrow \\
t\!\downarrow\ & \ssststile{}{V} \bigwedge_{1 \leq j \leq k} e_{p_j}(t_j) = d_j(\sigma)[t_1/x_1, \ldots t_{j-1}/x_{j-1}] \\
t\!\downarrow\ & \sststile{}{V} e_p(t) = d_{k+1}(\sigma)[t_1/x_1, \ldots t_k/x_k]
\end{align*}
\end{proof}

\begin{lem}
Let $f : T \to T'$ be a map between $\cof_1$-cofibrant theories.
Then $f \in \Iinj[\I^D]$ if and only if $f \in \Iinj$.
\end{lem}
\begin{proof}
Since maps in $\I^D$ are retracts of maps in $\I$, every maps in $\Iinj$ belongs to $\Iinj[\I^D]$.
Conversely, suppose $f \in \Iinj[\I^D]$.
\end{proof}

\section{Properties of Morita equivalences}

In this section we prove several closure properties of Morita equivalences.
If $f : T_1 \to T_2$ is a Morita equivalence and $T$ is a theory, then $f \amalg T : T_1 \amalg T \to T_2 \amalg T$ might not be a Morita equivalence.
Our first objective is to give sufficient conditions on $f$ and $T$ for this to be true.
If $T_1$, $T_2$, and $T_3$ are cofibrant, then this is true, but theories that occur in practice are not cofibrant.
We describe a class of objects which we call confluent so that every cofibrant object is confluent and theories occurring in practice are confluent.

We will say that a map $f : T_1 \to T_2$ is a \emph{confluent extension} if it factors as a relative $\I$-cell complex $g : T_1 \to T$
followed by a map $h : T \to T_2$ satisfying the following properties:

Let $T_1 = (\mathcal{F}_1, \mathcal{P}_1, \mathcal{A}_1)$ be a theory and
let $T_2 = (\mathcal{F}_1 \amalg \mathcal{F}_2, \mathcal{P}_1 \amalg \mathcal{P}_2, \mathcal{A}_1 \amalg \mathcal{A}_2)$ be an extension of $T_1$.
We will say that this extension is \emph{confluent} if the following conditions hold:
\begin{itemize}
\item There is a subtheory $T$ of $T_2$, which contains $T_1$ and all function symbols of $T_2$, and such that the inclusion $T_1 \to T$ is a relative $\I$-cell complex.
\item 
\end{itemize}
We will say that an arbitrary morphism of theories has well-defined function symbols if it is isomorphic to an inclusion $B \to T$ which has this property.

Let $T = (\mathcal{F}_B \amalg (\mathcal{F}_0 \times \mathbb{N}), \mathcal{P}_B \amalg (\mathcal{P}_0 \times \mathbb{N}), \mathcal{A}_B \amalg \mathcal{A}_0)$
be a contextual theory under $B$.
We will say that map $B \to T$ \emph{has well-defined function symbols} if there is a well-founded relation $\prec$ on $\mathcal{F}_0$
such that for every $\sigma : (p_1,n_1) \times \ldots \times (p_k,n_k) \to (p,n)$ in $\mathcal{F}_0$,
there are terms $t_1, \ldots t_k$ of $T_2$ such that the following sequent is derivable:
\[ \sigma(x_1, \ldots x_k)\!\downarrow\ \ssststile{}{x_1, \ldots x_k} \bigwedge_{1 \leq i \leq k} e_{p_i}(x_i) = t_i \]
and every function symbol from $\mathcal{F}_0$ that appears in some $t_i$ is less than $\sigma$.

We will say that a map of theories \emph{has well-defined function symbols} if it is isomorphic to a map $f : T_1 \to T_2$
such that there is a well-founded relation on the set of function symbols of $T_2$ such that for every function symbol
$\sigma : (p_1,n_1) \times \ldots \times (p_k,n_k) \to (p,n)$ of $T_2$,
either there is a term $t$ of $T_1$ such that $\sststile{}{x_1, \ldots x_k} f(t) \cong \sigma(x_1, \ldots x_k)$ or
there are terms $t_1, \ldots t_k$ of $T_2$ such that every function symbol in every $t_i$ is less than $\sigma$ and the following sequent is derivable:
\[ \sigma(x_1, \ldots x_k)\!\downarrow\ \ssststile{}{x_1, \ldots x_k} \bigwedge_{1 \leq i \leq k} e_{p_i}(x_i) = t_i. \]
We will say that an object of $T_0/\algtt$ has well-defined function symbols if it has this property considered as a map $T_0 \to T$.

Every cofibration has well-defined function symbols.
If $g \circ f$ has well-defined function symbols, then so does $g$.
In particular, if the codomain of a map has well-defined function symbols, then so does the map itself.
Objects of $T_0/\algtt$ with well-defined function symbols are closed under quotients.
This implies that most of the theories that are used in practice have well-defined symbols.

\begin{prop}
Let $f : T_1 \to T_2$ be a morphism with well-defined function symbols.
Then $f$ has the weak lifting property with respect to $V,\varphi$ if and only if
for every term $A \in Term_{T_1}(V)_{(d_p,n)}$ and every function symbol $\sigma$ of $T_2$ such that $\varphi \sststile{}{V} A\!\downarrow$ and $f(\varphi) \sststile{}{V} e_p(a) = f(A)$,
there exists a term $a' \in Term_{T_1}(V)_{(p,n)}$ such that $f(a')$ is relatively homotopic to $a$ with respect to $\varphi$.
\end{prop}

\section{Examples of Morita equivalences}

In this section we will describe a few examples of Morita equivalences.
In general, it might be difficult to prove that a morphism $f : T_1 \to T_2$ is a Morita equivalence since it might not have an inverse.
In this case we will use \rlem{equiv-lem}.
Even then it might be difficult to construct required pseudomorphisms directly.
In this case we can construct another theory which is a combination of $T_1$ and $T_2$, construct several Morita equivalences between them,
and then prove that $f$ is a Morita equivalence using 2-out-of-3 property.

Often theories $T_1$ and $T_2$ are parts of other theories $T_1'$ and $T_2'$.
Sometimes a Morita equivalence $f : T_1 \to T_2$ induces a Morita equivalence $T_1' \to T_2'$.
We cannot prove this in general, but often instead of proving that $f$ is a Morita equivalence we can prove that for every map $T \to T'$,
the induced map $T_1 \amalg_T T' \to T_2 \amalg_T T'$ is a Morita equivalence.
All examples of Morita equivalences in this section will be given in this general form.

\subsection{Normalization}

To be able to apply \rlem{equiv-lem}, we need to construct a normalization function on terms.

\subsection{Strict associativity}

Consider theory $T_0 = Id_-$.
Let $T_a$ be a theory under $T_0$ with the following additional function symbol:
\[ conc : (tm,n) \times (tm,n) \times (tm,n) \times (tm,n) \times (tm,n) \to (tm,n) \]
We will usually left implicit the first three arguments of $conc$.
Theory $T_a$ has the following axiom:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash p : Id(a_1,a_2)$}
\AxiomC{$\Gamma \vdash q : Id(a_2,a_3)$}
\BinaryInfC{$\Gamma \vdash conc(p,q) : Id(a_1,a_3)$}
\DisplayProof
\end{center}
where $a_1$, $a_2$ and $a_3$ have the same type $A$.
That is, this rule has additional premises $\Gamma \vdash a_i : A$, but we left them implicit.
We will often left implicit some premises if they can be derived from other premises.

The rest of the axioms of $T_a$ is listed below.
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash p : Id(a_1,a_2)$}
\UnaryInfC{$\Gamma \vdash conc(p,refl(a_2)) \equiv p : Id(a_1,a_2))$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash p : Id(a_1,a_2)$}
\UnaryInfC{$\Gamma \vdash conc(refl(a_1),p) \equiv p : Id(a_1,a_2)$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash p : Id(a_1,a_2)$}
\AxiomC{$\Gamma \vdash q : Id(a_2,a_3)$}
\AxiomC{$\Gamma \vdash r : Id(a_3,a_4)$}
\TrinaryInfC{$\Gamma \vdash cong(conc(p,q),r) \equiv conc(p,cong(q,r)) : Id(a_1,a_4)$}
\DisplayProof
\end{center}

Thus $T_a$ is a theory with a strictly associative concatination function for paths.
Moreover, $refl$ is a strict identity for $conc$.
We are going to prove that $f : T_0 \amalg_T T' \to T_a \amalg_T T'$ is a Morita equivalence.
We can define a pseudomorphism $g' : T_a \amalg_T T' \to T_0 \amalg_T T'$ so that $g'$ preserves substitutions and variables,
for every term $t$ of $T_0 \amalg_T T'$, $g'(f(t)) = t$, and $g'(conc)$ is any concatination function.
This pseudomorphism does not preserves the last three axioms of $T_a$, and thus it is not a morphism.
To fix this problem, we need to apply a normalization function first.

First, we define a reduction relation $\red$ on terms as the minimal reflexive and transitive relation
which is closed under substitution and contains a set of rules which are listed below.
These rules are simply (some of) the axioms of $T_a$ in which we choose a direction of reduction.
\begin{align*}
ctx(\sigma(\Gamma, a_1, \ldots a_k)) & \red \Gamma \\
ty(subst(\Gamma, a, a_1, \ldots a_k)) & \red subst(\Gamma, ty(a), a_1, \ldots a_k) \\
ty(v_{n,i}(\Gamma)) & \red subst(\Gamma, ft^i_{n-i}(\Gamma), c_{n-1}, \ldots c_{i+1}) \\
subst(\Gamma, v_i(A), a_1, \ldots a_k) & \red a_{k-i} \\
subst(\Gamma, a, v_{n-1}(A_n), \ldots v_0(A_0)) & \red a \\
subst(\Gamma, subst(\Delta, a, a_1, \ldots a_m), b_1, \ldots b_k) & \red subst(\Gamma, a, a_1' \ldots a_k') \\
conc(p,refl(a_2)) & \red p \\
conc(refl(a_1),p) & \red p \\
conc(conc(p,q),r) & \red conc(p,conc(q,r))
\end{align*}
where the first rule is defined for every function symbol $\sigma$,
in the third rule, $c_i$ is $v_{n,i}(\Gamma)$,
and in the sixth rule, $a_i'$ is $subst(\Gamma, a_i, b_1, \ldots b_k)$.

It is easy to show that these reduction rules define a confluent and terminating rewriting system using standard techniques as described, for example, in \cite{Terese}.
We define a pseudomorphism $\nf : T_a \to T_a$ as follows:

\subsection{$\Sigma$ types}

\subsection{Unit types}

\subsection{$Id$ types and $coe$}

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
