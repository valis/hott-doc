\documentclass[reqno]{amsart}

\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{verbatim}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{turnstile}
\usepackage{etex}
\usepackage{todonotes}

\hypersetup{colorlinks=true,linkcolor=blue}

\renewcommand{\turnstile}[6][s]
    {\ifthenelse{\equal{#1}{d}}
        {\sbox{\first}{$\displaystyle{#4}$}
        \sbox{\second}{$\displaystyle{#5}$}}{}
    \ifthenelse{\equal{#1}{t}}
        {\sbox{\first}{$\textstyle{#4}$}
        \sbox{\second}{$\textstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{s}}
        {\sbox{\first}{$\scriptstyle{#4}$}
        \sbox{\second}{$\scriptstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{ss}}
        {\sbox{\first}{$\scriptscriptstyle{#4}$}
        \sbox{\second}{$\scriptscriptstyle{#5}$}}{}
    \setlength{\dashthickness}{0.111ex}
    \setlength{\ddashthickness}{0.35ex}
    \setlength{\leasturnstilewidth}{2em}
    \setlength{\extrawidth}{0.2em}
    \ifthenelse{%
      \equal{#3}{n}}{\setlength{\tinyverdistance}{0ex}}{}
    \ifthenelse{%
      \equal{#3}{s}}{\setlength{\tinyverdistance}{0.5\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{d}}{\setlength{\tinyverdistance}{0.5\ddashthickness}
        \addtolength{\tinyverdistance}{\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{t}}{\setlength{\tinyverdistance}{1.5\dashthickness}
        \addtolength{\tinyverdistance}{\ddashthickness}}{}
        \setlength{\verdistance}{0.4ex}
        \settoheight{\lengthvar}{\usebox{\first}}
        \setlength{\raisedown}{-\lengthvar}
        \addtolength{\raisedown}{-\tinyverdistance}
        \addtolength{\raisedown}{-\verdistance}
        \settodepth{\raiseup}{\usebox{\second}}
        \addtolength{\raiseup}{\tinyverdistance}
        \addtolength{\raiseup}{\verdistance}
        \setlength{\lift}{0.8ex}
        \settowidth{\firstwidth}{\usebox{\first}}
        \settowidth{\secondwidth}{\usebox{\second}}
        \ifthenelse{\lengthtest{\firstwidth = 0ex}
            \and
            \lengthtest{\secondwidth = 0ex}}
                {\setlength{\turnstilewidth}{\leasturnstilewidth}}
                {\setlength{\turnstilewidth}{2\extrawidth}
        \ifthenelse{\lengthtest{\firstwidth < \secondwidth}}
            {\addtolength{\turnstilewidth}{\secondwidth}}
            {\addtolength{\turnstilewidth}{\firstwidth}}}
        \ifthenelse{\lengthtest{\turnstilewidth < \leasturnstilewidth}}{\setlength{\turnstilewidth}{\leasturnstilewidth}}{}
    \setlength{\turnstileheight}{1.5ex}
    \sbox{\turnstilebox}
    {\raisebox{\lift}{\ensuremath{
        \makever{#2}{\dashthickness}{\turnstileheight}{\ddashthickness}
        \makehor{#3}{\dashthickness}{\turnstilewidth}{\ddashthickness}
        \hspace{-\turnstilewidth}
        \raisebox{\raisedown}
        {\makebox[\turnstilewidth]{\usebox{\first}}}
            \hspace{-\turnstilewidth}
            \raisebox{\raiseup}
            {\makebox[\turnstilewidth]{\usebox{\second}}}
        \makever{#6}{\dashthickness}{\turnstileheight}{\ddashthickness}}}}
        \mathrel{\usebox{\turnstilebox}}}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{#3~\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\expandafter\newcommand\csname n#2\endcsname[1]{\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{theorem}{Theorem}
\newref{lem}{lemma}{Lemma}
\newref{prop}{proposition}{Proposition}
\newref{cor}{corollary}{Corollary}
\newref{cond}{condition}{Condition}

\theoremstyle{definition}
\newref{defn}{definition}{Definition}
\newref{example}{example}{Example}

\theoremstyle{remark}
\newref{remark}{remark}{Remark}

\newcommand{\deq}{\equiv}
\newcommand{\repl}{:=}
\newcommand{\idtype}{\rightsquigarrow}

\newcommand{\cat}[1]{\mathbf{#1}}
\newcommand{\C}{\cat{C}}
\newcommand{\PAlg}[1]{#1\text{-}\cat{PAlg}}
\newcommand{\Mod}[1]{#1\text{-}\cat{Mod}}
\newcommand{\Th}{\cat{Th}}
\newcommand{\algtt}{\cat{TT}}
\newcommand{\ThC}{\Th_{\mathcal{C}}}
\newcommand{\emptyCtx}{\mathbf{1}}
\newcommand{\nf}{\mathrm{nf}}
\newcommand{\red}{\Rightarrow}

\newcommand{\we}{\mathcal{W}}
\newcommand{\fib}{\mathcal{Fib}}
\newcommand{\cof}{\mathcal{Cof}}
\newcommand{\I}{\mathrm{I}}
\newcommand{\J}{\mathrm{J}}
\newcommand{\class}[2]{#1\text{-}\mathrm{#2}}
\newcommand{\Iinj}[1][\I]{\class{#1}{inj}}
\newcommand{\Icell}[1][\I]{\class{#1}{cell}}
\newcommand{\Icof}[1][\I]{\class{#1}{cof}}
\newcommand{\Jinj}[1][]{\Iinj[\J#1]}
\newcommand{\Jcell}[1][]{\Icell[\J#1]}
\newcommand{\Jcof}[1][]{\Icof[\J#1]}
\newcommand{\cyli}{i}

\numberwithin{figure}{section}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\begin{document}

\title{Morita equivalences between algebraic dependent type theories}

\author{Valery Isaev}

\begin{abstract}
\end{abstract}

\maketitle

 \makeatletter
    \providecommand\@dotsep{5}
  \makeatother
  \listoftodos\relax

\section{Introduction}

\section{Morita equivalences of theories}

In this section we define a Morita equivalence of algebraic dependent type theories as defined in \cite{alg-tt}.
We also give several equivalent descriptions of Morita equivalences.

Recall that an algebraic dependent type theory $T$ consists of a set $\mathcal{F}$ of function symbols, a set $\mathcal{P}$ of predicate symbols and a set of axioms.
The set of sorts $\mathcal{S}$ is defined as $\{ ctx, tm \} \times \mathbb{N}$.
We also write $(ty,n)$ for $(ctx,n+1)$.
Every function symbol $\sigma \in \mathcal{F}$ is equipped with a signature $\sigma : s_1 \times \ldots \times s_k \to s$ where $s_1, \ldots s_k, s \in \mathcal{S}$.
Every predicate symbol $R \in \mathcal{P}$ is equipped with a signature $R : s_1 \times \ldots \times s_k$ where $s_1, \ldots s_k \in \mathcal{S}$.
The set $Term_T(V)_s$ of terms of sort $s$ with variable in $V$ is defined inductively from $\mathcal{F}$ as usual.
An atomic formula with variables in $V$ is an expression either of the form $t_1 = t_2$  where $t_i \in Term_T(V)_s$ or of the form $R(t_1, \ldots t_k)$ where $t_i \in Term_T(V)_{s_i}$.
A formula with variables in $V$ is an expression of the form $\varphi_1 \land \ldots \land \varphi_n$ where $\varphi_i$ are atomic formulas.
An axiom is an expression of the form $\varphi \sststile{}{V} \psi$ where $\varphi$ and $\psi$ are formulas with variables in $V$.
We will write $\varphi \sststile{T}{V} \psi$ to denote the fact that sequent $\varphi \sststile{}{V} \psi$ is derivable in $T$.
The set of derivation rules is described in \cite{PHL} and \cite{alg-tt}.

Let $T$ be a theory with the interval type (that is, $T$ is equipped with a morphism from theory $I$, which was defined in \cite{alg-models}).
Let $X$ be a model of $T$.
A \emph{homotopy} between elements $a,a' \in X_{(p,n)}$ is an element $h \in X_{(p,n+1)}$ such that $ctx^n(h) = I$, $left^*(h) = a$, and $right^*(h) = a'$.
We will say that $h$ is a \emph{relative homotopy} if $e_p(h) = I \times e_p(a)$, where $e_p : (p,n) \to (d_p,n)$, $d_{tm} = ty$, $e_{tm} = ty$, $d_{ty} = ctx$ and $e_{ty} = ft$.
We will say that a morphism of models $f : X \to Y$ is \emph{weak equivalence} if it satisfies the following conditions:
\begin{enumerate}
\item For every $A \in X_{(ty,n)}$ and $a \in Y_{(tm,n)}$ such that $ty(a) = f(A)$,
there is a term $a' \in X_{(tm,n)}$ such that $ty(a') = A$ and $f(a')$ is relatively homotopic to $a$.
In this case we will say that $f$ is \emph{essentially surjective on terms}.
\item For every $\Gamma \in X_{(ctx,n)}$ and $A \in Y_{(ty,n)}$ such that $ft(A) = f(\Gamma)$,
there is a type $A' \in X_{(ty,n)}$ such that $ft(A') = \Gamma$ and $f(A')$ is relatively homotopic to $A$.
In this case we will say that $f$ is \emph{essentially surjective on types}.
\end{enumerate}

\begin{defn}
A \emph{Morita equivalence} between theories $T_1$ and $T_2$ under $I$ is a morphism $f : T_1 \to T_2$ under $I$ such that for every model $X$ of $T_1$,
the unit $\eta_X : X \to f^*(f_!(X))$ of the adjunction $f_! \dashv f^*$ is a weak equivalence.
\end{defn}

Let $B$ be the regular theory that can be described as $coe_1 + \sigma + Path + wUA$.
This theory was defined in \cite{alg-models}, and it was proved there that if $T$ is a regular theory under $B$,
then there is a model structure on $\Mod{T}$ in which the class of weak equivalences agrees with the one defined above.
The following simple proposition characterizes Morita equivalences between such theories in terms of this model stucture.

\begin{prop}
Let $T_1$ and $T_2$ be regular theories under $B$, and let $f : T_1 \to T_2$ be a morphism under $B$.
Then $f_! \dashv f^*$ is a Quillen adjunction.
It is a Quillen equivalence if and only if $f$ is a Morita equivalence.
\end{prop}
\begin{proof}
Since $f_!$ is a left adjoint, it preserves object defined by generators and relations.
Since the set of generating cofibration $\I$ and the set of generating trivial cofibration $\J_\I$
are both defined in terms of generators and relations, this implies that $f_!$ preserves them.
Hence $f_! \dashv f^*$ is a Quillen adjunction.
Moreover, this implies that $U$ reflects weak equivalences.
Hence a Quillen adjunction is a Quillen equivalence if and only if the unit of the adjunction is a weak equivalence.
\end{proof}

The following propositions gives a useful characterization of Morita equivalences:

\begin{prop}[mor-eq]
Let $f : T_1 \to T_2$ be a morphism of theories under $I$.
Then $f$ is a Morita equivalence if and only if for every set $V$, every formula $\varphi \in Form_{T_1}(V)$,
every term $A \in Term_{T_1}(V)_{(d_p,n)}$, and every term $a \in Term_{T_2}(V)_{(p,n)}$ such that $\varphi \sststile{}{V} A\!\downarrow$ and $f(\varphi) \sststile{}{V} e_p(a) = f(A)$,
there exist terms $a' \in Term_{T_1}(V)_{(p,n)}$ and $h \in Term_{T_2}(V)_{(p,n+1)}$, which satisfy the following conditions:
\begin{enumerate}
\item \label{it:mcf} $\varphi \sststile{}{V} e_p(a') = A$,
\item \label{it:mcs} $f(\varphi) \sststile{}{V} e_p(h) = I \times f(A)$,
\item \label{it:mct} $f(\varphi) \sststile{}{V} left^*(h) = f(a')$,
\item \label{it:mcl} $f(\varphi) \sststile{}{V} right^*(h) = a$.
\end{enumerate}
\end{prop}
\begin{proof}
First, we need to introduce an auxiliary construction.
Let $T$ be a theory, let $V$ be a set of variables, and let $\mathcal{A}$ be a set formulas of $T$ with variables in $V$.
Then we define $Syn(T,V,\mathcal{A})$ as $Syn(T \cup \{ O_x : s\ |\ s \in V_s \} \cup \mathrm{sp}(\mathcal{A}))$,
where $\mathrm{sp}(\mathcal{A})$ consists of formulas of the form $\sststile{}{} O_x\!\downarrow$ for every $x \in V$
and formulas of $\mathcal{A}$ in which every variable $x$ is replaced with $O_x$.
If $f : T_1 \to T_2$ is a morphism of theories, then it is easy to see that $f_!(Syn(T_1,V,\mathcal{A})) = Syn(T_2,V,f(\mathcal{A}))$.

Let us prove the ``only if'' direction.
Note that elements of $Syn(T_1, V, \{\,\sststile{}{}~\varphi\,\})$ correspond to terms $t$ of $T_1$ with variables in $V$ such that $\varphi \sststile{T_1}{V} t\!\downarrow$.
Moreover, two terms $t_1$ and $t_2$ map to the same element under this correspondence if and only if $\varphi \sststile{T_1}{V} t_1 = t_2$.
Analogous statement holds for $Syn(T_2, V, \{\,\sststile{}{}~f(\varphi)\,\})$.
Using this correspondence, the required conditions immediately follow from the fact that
map $Syn(T_1, V, \{\,\sststile{}{}~\varphi\,\}) \to f^*(Syn(T_2, V, \{\,\sststile{}{}~f(\varphi)\,\}))$ is a weak equivalence.

Now, let us prove the ``if'' direction.
Let $M$ be a model of $T_1$.
Note that $M = Syn(T_1, U(M), \mathcal{A})$, where $\mathcal{A}$ is the set of axioms of $Lang(M)$.
Let $A \in M_{(d_p,n)}$ and $a \in f^*(f_!(M))$ be elements such that $e_p(a) = A$.
Since $f_!(M) = Syn(T_2, U(M), f(\mathcal{A}))$, $a$ is a closed term of $T_2$.
There is a finite subset $\mathcal{A}_0$ of $\mathcal{A}$ such that $\sststile{T_2 \cup \mathrm{sp}(\mathcal{A}_0)}{} e_p(a) = A$.
Let $\varphi$ be the conjunction of $\mathcal{A}_0$, and let $b$ and $B$ be $a$ and $A$ respectively in which every constant $O_x$ is replaced with variable $x$.
Then $\varphi \sststile{T_2}{U(M)} e_p(b) = B$.
By assumption, there exist terms $b' \in Term_{T_1}(U(M))_{(p,n)}$ and $h \in Term_{T_2}(U(M))_{(p,n+1)}$ which satisfy conditions \eqref{it:mcf} -- \eqref{it:mcl}.
These terms correspond under $\mathrm{sp}$ to elements of $M$ and $f^*(f_!(M))$ respectively.
These conditions imply that $b'$ is the required lifting and $h$ is the required homotopy.
\end{proof}

This proposition implies that Morita equivalences can be characterized in terms of a lifting property.
Let $\I$ be the set of the following morphisms of theories:
For every predicate symbol $P : s_1 \times \ldots \times s_k$ and every function symbols $A : s_1 \times \ldots \times s_k \to (d_p,n)$ and $a : s_1 \times \ldots \times s_k \to (p,n)$,
let $i_{P,A,a}$ be the following morphism of theories:
\[ \{ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} A(x_1, \ldots x_k)\!\downarrow \} \to \{ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} a(x_1, \ldots x_k)\!\downarrow \}, \]
where $i_{P,A,a}(A) = e_p(a)$.
We can define a relative cylinder object for $i_{P,A,a}$ as
\[ \{ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} e_p(h(x_1, \ldots x_k)) = I \times A(x_1, \ldots x_k) \}, \]
where $h : s_1 \times \ldots \times s_k \to (p,n+1)$.
Then the previous proposition immediately implies the following corollary:

\begin{cor}
A morphism of theories is a Morita equivalence if and only if it has RLP up to $\sim_i$ with respect to every $i \in \I$.
\end{cor}

If we want to prove that a morphism $f : T_1 \to T_2$ is a Morita equivalence, we can try to use the same idea as in the proof of \cite[Lemma~3.7]{alg-models}.
We define functions $g : Term_{T_2}(V)_{(p,n)} \to Term_{T_1}(V)_{(p,n)}$ and $h : Term_{T_2}(V)_{(p,n)} \to Term_{T_2}(V)_{(p,n+1)}$.
To show that $g(a)$ and $h(a)$ satisfy conditions of \rprop{mor-eq}, we need to prove several properties of $g$ and $h$,
one of which is that they must preserve axioms of $T_2$.
The problem with this construction is that they might not preserve all axioms.
Often we have some axioms that express reduction rules.
If $g$ and $h$ do not preserve these axioms, then we can try to fix this problem by first applying a normalization function.
Such function usually does not preserve substitutions and thus does not define morphisms of theories.
We call such functions \emph{pseudomorphisms}:

\begin{defn}
Let $T_1$ and $T_2$ be a pair of theories and let $k$ be a natural number.
Then a \emph{pseudomorphism} $f$ between $T_1$ and $T_2$ of degree $k$ is a pair of maps $f : Term_{T_1}(V)_{(p,n)} \to PTerm_{T_2}(V)_{(p,n+k)}$ and
$f : Form_{T_1}(V) \to Form_{T_2}(V)$ such that sequents $f(\varphi \land \psi) \ssststile{}{V} f(\varphi) \land f(\psi)$,
$f(t = t') \ssststile{}{V} f(t) = f(t')$ and $\sststile{}{V} f(e_p(t)) \simeq e_p(f(t))$ are derivable in $T_2$.

There is a preorder on the set of pseudomorphisms of some fixed degree $k$.
We will write $f \leq f'$ if for every term $t$ and every formula $\varphi$,
sequents $f(t)\!\downarrow\ \sststile{}{V} f(t) = f'(t)$ and $f(\varphi) \sststile{}{V} f'(\varphi)$ are derivable.
We will say that pseudomorphisms $f$ and $f'$ are equivalent if and only if $f \leq f'$ and $f' \leq f$.
\end{defn}

\begin{example}
If $f : T_1 \to T_2$ and $g : T_2 \to T_3$ are pseudomorphisms of degrees $k$ and $m$ respectively, then there is an obvious pseudomorphism $g \circ f : T_1 \to T_3$ of degree $k+m$.
\end{example}

\begin{example}
For every theory $T$ and every natural number $k$, there is a pseudomorphism $I^k : T \to T$ of degree $k$ which is defined as follows.
For every term $t$, $I^k(t) = I^k \times t$.
For every formula $\varphi$, $I^k(\varphi) = \varphi$.
In particular, there is the identity pseudomorphism $id_T = I^0$.
\end{example}

\begin{example}
Morphisms of theories are equivalence classes of pairs of functions on terms and formulas which satisfy some conditions.
We will call such pairs \emph{premorphisms} of theories.
Every premorphism determines a pseudomorphism of degree 0.
Every morphism determines an equivalence class of pseudomorphisms.
\end{example}

The following lemma describes a way to prove that a morphism of theories is a Morita equivalence using pseudomorphisms:

\begin{lem}[equiv-lem]
Let $f : T_1 \to T_2$ be a premorphism of theories under $I$.
Suppose that there are a pseudomorphism $g : T_2 \to T_1$ of degrere 0 and a pseudomorphism $h : T_2 \to T_2$ of degree 1 which satisfy the following conditions:
\begin{enumerate}
\item $g$ and $h$ preserve theorems of the form $f(\varphi) \sststile{}{V} \psi$.
\item $id_{T_1} \leq g \circ f$,
\item $I \circ f \leq h \circ f$,
\item For every term $t$, sequents
\begin{align*}
t\!\downarrow \land\ h(t)\!\downarrow\ & \sststile{}{V} left^*(h(t)) = f(g(t)) \\
t\!\downarrow \land\ h(t)\!\downarrow\ & \sststile{}{V} right^*(h(t)) = t
\end{align*}
are derivable in $T_2$.
\end{enumerate}
Then the morphism determined by $f$ is a Morita equivalence.
\end{lem}
\begin{proof}
Let $a$ and $A$ be terms of $T_2$ and let $\varphi$ be a formula of $T_1$ such that $\varphi \sststile{T_1}{V} A\!\downarrow$ and $f(\varphi) \sststile{T_2}{V} e_p(a) = f(A)$.
Let $a' = g(a)$ and $h' = h(a)$.
Then $\varphi \sststile{T_1}{V} g(f(\varphi))$ and $g(f(\varphi)) \sststile{T_1}{V} g(e_p(a)) = g(f(A))$.
It follows that $\varphi \sststile{T_1}{V} e_p(a') = A$.
Analogously, $f(\varphi) \sststile{T_2}{V} h(f(\varphi))$ and $h(f(\varphi)) \sststile{T_2}{V} h(e_p(a)) = h(f(A))$.
Hence $f(\varphi) \sststile{T_2}{V} e_p(h') = I \times f(A)$.
The last condition implies that $f(\varphi) \sststile{T_2}{V} left^*(h') = f(a')$ and $f(\varphi) \sststile{T_2}{V} right^*(h') = a$.
\end{proof}

\section{Examples of Morita equivalences}

In this section we will describe a few examples of Morita equivalences.
In general, it might be difficult to prove that a morphism $f : T_1 \to T_2$ is a Morita equivalence since it might not have an inverse.
In this case we will use \rlem{equiv-lem}.
Even then it might be difficult to construct required pseudomorphisms directly.
In this case we can construct another theory which is a combination of $T_1$ and $T_2$, construct several Morita equivalences between them,
and then prove that $f$ is a Morita equivalence using 2-out-of-3 property.

Often theories $T_1$ and $T_2$ are parts of other theories $T_1'$ and $T_2'$.
Sometimes a Morita equivalence $f : T_1 \to T_2$ induces a Morita equivalence $T_1' \to T_2'$.
We cannot prove this in general, but often instead of proving that $f$ is a Morita equivalence we can prove that for every map $T \to T'$,
the induced map $T_1 \amalg_T T' \to T_2 \amalg_T T'$ is a Morita equivalence.
All examples of Morita equivalences in this section will be given in this general form.

\subsection{Normalization}

To be able to apply \rlem{equiv-lem}, we need to construct a normalization function on terms.

\subsection{Strict associativity}

Consider theory $T_0 = Id_-$.
Let $T_a$ be a theory under $T_0$ with the following additional function symbol:
\[ conc : (tm,n) \times (tm,n) \times (tm,n) \times (tm,n) \times (tm,n) \to (tm,n) \]
We will usually left implicit the first three arguments of $conc$.
Theory $T_a$ has the following axiom:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash p : a_1 \idtype a_2$}
\AxiomC{$\Gamma \vdash q : a_2 \idtype a_3$}
\BinaryInfC{$\Gamma \vdash conc(p,q) : a_1 \idtype a_3$}
\DisplayProof
\end{center}
where $a_1$, $a_2$ and $a_3$ have the same type $A$.
That is, this rule has additional premises $\Gamma \vdash a_i : A$, but we left them implicit.
We will often left implicit some premises if they can be derived from other premises.

The rest of the axioms of $T_a$ is listed below.
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash p : a_1 \idtype a_2$}
\UnaryInfC{$\Gamma \vdash conc(p,refl(a_2)) \equiv p : a_1 \idtype a_2$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash p : a_1 \idtype a_2$}
\UnaryInfC{$\Gamma \vdash conc(refl(a_1),p) \equiv p : a_1 \idtype a_2$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash p : a_1 \idtype a_2$}
\AxiomC{$\Gamma \vdash q : a_2 \idtype a_3$}
\AxiomC{$\Gamma \vdash r : a_3 \idtype a_4$}
\TrinaryInfC{$\Gamma \vdash cong(conc(p,q),r) \equiv conc(p,cong(q,r)) : a_1 \idtype a_4$}
\DisplayProof
\end{center}

Thus $T_a$ is a theory with a strictly associative concatination function for paths.
Moreover, $refl$ is a strict identity for $conc$.
We are going to prove that $f : T_0 \amalg_T T' \to T_a \amalg_T T'$ is a Morita equivalence.
We can define a pseudomorphism $g' : T_a \amalg_T T' \to T_0 \amalg_T T'$ so that $g'$ preserves substitutions and variables,
for every term $t$ of $T_0 \amalg_T T'$, $g'(f(t)) = t$, and $g'(conc)$ is any concatination function.
This pseudomorphism does not preserves the last three axioms of $T_a$, and thus it is not a morphism.
To fix this problem, we need to apply a normalization function first.

First, we define a reduction relation $\red$ on terms as the minimal reflexive and transitive relation
which is closed under substitution and contains a set of rules which are listed below.
These rules are simply (some of) the axioms of $T_a$ in which we choose a direction of reduction.
\begin{align*}
ctx(\sigma(\Gamma, a_1, \ldots a_k)) & \red \Gamma \\
ty(subst(\Gamma, a, a_1, \ldots a_k)) & \red subst(\Gamma, ty(a), a_1, \ldots a_k) \\
ty(v_{n,i}(\Gamma)) & \red subst(\Gamma, ft^i_{n-i}(\Gamma), c_{n-1}, \ldots c_{i+1}) \\
subst(\Gamma, v_i(A), a_1, \ldots a_k) & \red a_{k-i} \\
subst(\Gamma, a, v_{n-1}(A_n), \ldots v_0(A_0)) & \red a \\
subst(\Gamma, subst(\Delta, a, a_1, \ldots a_m), b_1, \ldots b_k) & \red subst(\Gamma, a, a_1' \ldots a_k') \\
conc(p,refl(a_2)) & \red p \\
conc(refl(a_1),p) & \red p \\
conc(conc(p,q),r) & \red conc(p,conc(q,r))
\end{align*}
where the first rule is defined for every function symbol $\sigma$,
in the third rule, $c_i$ is $v_{n,i}(\Gamma)$,
and in the sixth rule, $a_i'$ is $subst(\Gamma, a_i, b_1, \ldots b_k)$.

It is easy to show that these reduction rules define a confluent and terminating rewriting system using standard techniques as described, for example, in \cite{Terese}.
We define a pseudomorphism $\nf : T_a \to T_a$ as follows:

\subsection{$\Sigma$ types}

\subsection{Unit types}

\subsection{$Id$ types and $coe$}

\section{Categories of theories}

It was shown in \cite{PHL} that partial Horn theories are equivalent to essentially algebraic theories.
It follows that categories of models of these theories are locally presentable.
In this section we will prove that different categories of theories are also locally finitely presentable.

We will consider the category $B/\Th_\mathcal{S}$ of theories under some theory $B$.
Every object of this category is isomorphic to an object of the form
$((\mathcal{S}, \mathcal{F}_0 \amalg \mathcal{F}, \mathcal{P}_0 \amalg \mathcal{P}), \mathcal{A}_0 \amalg \mathcal{A})$,
where $\mathcal{F}_0$, $\mathcal{P}_0$ and $\mathcal{A}_0$ are the sets of function and predicate symbols and axioms of $B$ respectively,
and a map from $B$ is defined in the obvious way.
Indeed, if $f : B \to T$ is a theory under $B$, then we can just add function and predicate symbols and axioms of $B$
together with the following axioms for every function symbol $\sigma$ and every predicate symbol $R$ of $B$:
\begin{align*}
& \sststile{}{x_1, \ldots x_k} \sigma(x_1, \ldots x_k) \cong f(\sigma(x_1, \ldots x_k)) \\
& R(x_1, \ldots x_k) \ssststile{}{x_1, \ldots x_k} f(R(x_1, \ldots x_k))
\end{align*}
Clearly, this theory under $B$ is isomorphic to $T$.
We will denote the full subcategory of $B/\Th_\mathcal{S}$ on theories of this form by $\Th_B$.
Since inclusion $\Th_B \to B/\Th_\mathcal{S}$ is an equivalence of categories, we will often use $\Th_B$ instead of $B/\Th_\mathcal{S}$.

Now, we give an explicit construction of coproducts and coequalizers in the category $\Th_B$,
which is similar to the one described in \cite{alg-tt} for the category $\Th_\mathcal{S}$ of theories.
If $\{ T_i = ((\mathcal{S}, \mathcal{F}_0 \amalg \mathcal{F}_i, \mathcal{P}_0 \amalg \mathcal{P}_i), \mathcal{A}_0 \amalg \mathcal{A}_i) \}_{i \in I}$
is a set of theories in $\Th_B$, then we can define their coproduct as
$((\mathcal{S}, \mathcal{F}_0 \amalg \coprod_{i \in I} \mathcal{F}_i, \mathcal{P}_0 \amalg \coprod_{i \in I} \mathcal{P}_i), \mathcal{A}_0 \amalg \coprod_{i \in I} \mathcal{A}_i)$.
If $T = ((\mathcal{S}, \mathcal{F}_0 \amalg \mathcal{F}, \mathcal{P}_0 \amalg \mathcal{P}), \mathcal{A}_0 \amalg \mathcal{A})$
and $f,g : T \to T'$ is a pair of maps of theories in $\Th_B$, then their coequalizer can be defined as $T'$ together with the following axioms for every $\sigma \in \mathcal{F}$ and $R \in \mathcal{P}$:
\begin{align*}
& \sststile{}{x_1, \ldots x_k} f(\sigma(x_1, \ldots x_k)) \cong g(\sigma(x_1, \ldots x_k)) \\
& f(R(x_1, \ldots x_k)) \ssststile{}{x_1, \ldots x_k} g(R(x_1, \ldots x_k))
\end{align*}

If $T : I \to \Th_B$ is a diagram of theoriesm then $colim_{i \in I} T_i$ can be constructed as a coequalizer of the coproduct $\coprod_{i \in I} T_i$ as usual.
Thus we can assume that the sets of function and predicate symbols of $colim_{i \in I} T_i$ (that are not symbols of $B$) are disjoint unions of the corresponding sets of $T_i$.
The axioms of $colim_{i \in I} T_i$ are axioms of $T_i$ together with axioms of the form $\sststile{}{x_1, \ldots x_n} \sigma(x_1, \ldots x_n) \cong f(\sigma(x_1, \ldots x_n))$
and $R(x_1, \ldots x_n) \ssststile{}{x_1, \ldots x_n} f(R(x_1, \ldots x_n))$ for every morphism $f : T_i \to T_j$
in the diagram and every function symbol $\sigma$ and predicate symbol $R$ of $T_i$ which are not symbols of $B$.

Let $\lambda$ be a regular cardinal.
We will say that a theory $T = ((\mathcal{S}, \mathcal{F}_0 \amalg \mathcal{F}, \mathcal{P}_0 \amalg \mathcal{P}), \mathcal{A}_0 \amalg \mathcal{A})$
in $\Th_B$ is \emph{$\lambda$-small} if cardinalities of sets $\mathcal{F}$, $\mathcal{P}$ and $\mathcal{A}$ are less than $\lambda$.
We will say that $T$ is \emph{finite} if it is $\aleph_0$-small.

\begin{prop}
Category $\Th_B$ is locally finitely presentable.
An object of this category is $\lambda$-presentable if and only if it is isomorphic to a $\lambda$-small object.
\end{prop}
\begin{proof}
First, let us prove that every $\lambda$-small object is $\lambda$-presentable.
Let $colim_{i \in I} T_i$ be a directed colimit of theories in $\Th_B$.
Every term and every formula of a theory is constructed from a finite number of function and predicate symbols.
Thus for every formula of $colim_{i \in I} T_i$ there exists a theory $T_i$ such that this formula belongs to $T_i$.
The same is true for terms and partial terms.

Every derivation of a theorem $\varphi \sststile{}{V} \psi$ is constructed from a finite number of function symbols, predicate symbols and axioms.
Thus for every theorem $\varphi \sststile{}{V} \psi$ of $colim_{i \in I} T_i$ there exists a theory $T_i$ such that $\varphi \sststile{}{V} \psi$ is a theorem of $T_i$.
Note that the additional axioms of $colim_{i \in I} T_i$ that was added for every $f : T_i \to T_j$ are always true in $T_j$.

Let $h : T \to colim_{i \in I} T_i$ be a morphism from a $\lambda$-small theory $T$ to a directed colimit of theories $\{ T_i \}_{i \in I}$.
Since $T$ is $\lambda$-small, there exists a theory $T_i$ such that for every function symbol $\sigma$, predicate symbol $R$ and axiom $\varphi \sststile{}{V} \psi$ of $T$,
partial terms $h(\sigma(x_1, \ldots x_n))$ and formulae $h(R(x_1, \ldots x_n))$ belong to $T_i$, and $h(\varphi) \sststile{}{V} h(\psi)$ is a theorem of $T$.
Thus $h$ factors through $T_i$.

Let $h_1,h_2 : T \to T_i$ be morphisms such that $g_i \circ h_1 = g_i \circ h_2$, where $g_i : T_i \to colim_{i \in I} T_i$.
Then for every function symbol $\sigma$ of $T$, $\sststile{}{x_1, \ldots x_n} h_1(\sigma(x_1, \ldots x_n)) \cong h_2(\sigma(x_1, \ldots x_n))$ is a theorem of $colim_{i \in I} T_i$.
But we already know that there exists a theory $T_j$ such that $i \leq j$ and this sequent is a theorem of $T_j$.
The same is true for every predicate symbol of $T$.
It follows that $f \circ h_1 = f \circ h_2$, where $f : T_i \to T_j$.

Now, let us prove that $\Th_B$ is locally finitely presentable.
We only need to show that every theory in $\Th_B$ is a colimit of its finite subtheories.
Let $T$ be a theory, and let $\{ f_i : T_i \to T' \}_{i \in I}$ be a cocone over the diagram of finite subtheories of $T$.
For every function or predicate symbol $p$ of $T$ which is not a symbol of $B$, there is a finite subtheory $T_p$ of $T$ which contains symbols and axioms of $B$ and one additional symbol $p$ and no other axiom.
A morphism $h$ of cocones $T$ and $T'$ must commute with morphisms from $T_p$.
Thus it must be defined as $h(p(x_1, \ldots x_n)) = f_p(p(x_1, \ldots x_n))$; hence it is unique.
To prove that this defines a morphism, we need to show that $h$ preserves axioms of $T$.
But every axiom involes only a finite number of symbols of $T$.
Hence there exists a subtheory $T_i$ of $T$ which consists of these symbols and this axiom.
Since $f_i$ is a morphism of theories, this axiom also holds in $T'$.

Finally, let us prove that every $\lambda$-presentable theory $T$ in $\Th_B$ is isomorphic to a $\lambda$-small theory.
Consider the identity map $id_T : T \to T$.
Since $T$ is a colimit of its finite subtheories, $id_T$ factors through some finite subtheory $T'$ of $T$.
Thus we have maps $f : T \to T'$ and $g : T' \to T$ such that $g \circ f = id_T$.
Since $T$ is a coequalizer of $f \circ g$ and $id_{T'}$, it is isomorphic to the coequalizer of $f \circ g$ and $id_{T'}$ as constructed above, which is a finite theory.
\end{proof}

Since categories $\algtt^0$ and $\algtt^1$ are of the form $T/\Th_\mathcal{S}$, this proposition applies to them.
We can prove that the same facts hold for contextual theories:

\begin{cor}
Category $B/\algtt^0_{con}$ is locally finitely presentable.
An object of this category is $\lambda$-presentable if and only if it is isomorphic to a $\lambda$-small object.
\end{cor}
\begin{proof}
Now, we will prove that category $B/\algtt^0_{con}$ is also locally finitely presentable for every $B$.
Note that $B/\algtt^0_{con}$ is a full subcategory of $\Th_B$ and is closed under colimits.
It follows that if an object of $B/\algtt^0_{con}$ is $\lambda$-presentable in $\Th_B$, then it is also $\lambda$-presentable in $B/\algtt^0_{con}$.
It is easy to see that every contextual theory under $B$ is a colimit of its finite contextual subtheories under $B$.
Thus $B/\algtt^0_{con}$ is locally finitely presentable and an object of this category is $\lambda$-presentable if and only if it is isomorphic to a $\lambda$-small theory.
The last statement is proved by the same argument as in the case of $\Th_B$.
In particular, this implies that $\algtt^0_{con}$ and $\algtt^1_{con}$ are locally finitely presentable.
\end{proof}

Since categories $\algtt^0_{con}$ and $\algtt^1_{con}$ are of the form $B/\algtt^0_{con}$, this corollary applies to them.
Now we consider categories of stable and regular theories.
Category $\algtt^0_{st}$ of stable algebraic dependent type theories was defined in \cite{alg-tt} as the category of algebras for a functor $L : \algtt^0_{con} \to \algtt^0_{con}$.
Here we will use slightly different (but equivalent) definition.

\begin{cor}
Categories $\algtt^0_{st}$, $\algtt^1_{st}$ and $\algtt^1_{reg}$ are locally finitely presentable.
\end{cor}
\begin{proof}
Category $\algtt^1_{reg}$ is a reflective subcategory of $\algtt^1_{st}$ and is closed under colimits.
Hence it is also locally finitely presentable.
\todo{Finish the proof}
\end{proof}

\begin{comment}
\subsection{The category of models}

Let $\mathbb{T} = ((\mathcal{S},\mathcal{F},\mathcal{P}),\mathcal{A})$ be a standard partial Horn theory and let $M = (A,\alpha,\beta)$ be its model.
If $\sigma \in \mathcal{F}$, $\sigma : s_1 \times \ldots \times s_k \to s$, then we will write $M(\sigma) : A_{s_1} \times \ldots A_{s_k} \to A_s$
    for the partial function defined as $M(\sigma)(a_1, \ldots a_k) = \alpha(x_i \mapsto a_i)(\sigma(x_1, \ldots x_k))$.
If $R \in \mathcal{P}$, $R : s_1 \times \ldots \times s_k$ then we will write $M(R)$ for the subset of $A_{s_1} \times \ldots A_{s_k}$,
    which consists of tuples $(a_1, \ldots a_k)$ such that $\beta(x_i \mapsto a_i)(R(x_1, \ldots x_k)) = \top$.

Let $\mathbb{T}$ be an algebraic dependent type theory.
Then categories $\mathbb{T}/\algtt^0$ and $\mathbb{T}/\ThC$ are isomorphic.
Thus we still have adjoint functors $Lang^0 \dashv Syn^0 : \mathbb{T}/\algtt^0 \to \Mod{\mathbb{T}}$.
If $\mathbb{T}$ is a contextual theory, then category $\mathbb{T}/\algtt^0_{con}$ is a full subcategory of $\mathbb{T}/\algtt^0$.
We have functor $Syn^0_{con} : \mathbb{T}/\algtt^0_{con} \to \Mod{\mathbb{T}}$ which is defined as the composition of the inclusion $\mathbb{T}/\algtt^0_{con} \to \mathbb{T}/\algtt^0$ and $Syn$.
Let us construct its left adjoint $Lang^0_{con} : \Mod{\mathbb{T}} \to \mathbb{T}/\algtt^0_{con}$.

Theory $Lang^0_{con}(M)$ has has function and predicate symbols of $\mathbb{T}$ together with function symbol $O_a : (ctx,n) \to (p,n)$ for every $a \in A_{(p,n)}$, $p \in \{ ty, tm \}$.
For every $a \in A_{(p,n)}$, we define term $C_a$ of sort $(p,n)$ by induction on $n$.
If $n = 0$, then let $C_a = O_a(\emptyCtx)$.
If $n > 0$, then let $C_a = O_a(C_{M(ctx_{p,n})(a)})$.

Axioms of $Lang^0_{con}(M)$ are axioms of $\mathbb{T}$ together with the following sequents:
\begin{align*}
O_a(\Gamma) \downarrow & \sststile{}{\Gamma} \Gamma = C_{M(ctx_{p,n})(a)}\\
& \sststile{}{} \sigma(C_{a_1}, \ldots C_{a_k}) = C_{M(\sigma)(a_1, \ldots a_k)} \\
& \sststile{}{} R(C_{a_1}, \ldots C_{a_k})
\end{align*}
for every $a \in A_s$, every $a_i \in A_{s_i}$,
every $\sigma \in \mathcal{F}$ such that $M(\sigma)(a_1, \ldots a_k)$ is defined,
and every $R \in \mathcal{P}$ such that $(a_1, \ldots a_k) \in M(R)$.

For every morphism $h : M \to N$ of models of $\mathbb{T}$, we can define a morphism $Lang^0_{con}(h) : Lang^0_{con}(M) \to Lang^0_{con}(N)$ of theories under $\mathbb{T}$ as $Lang(h)(O_a(\Gamma)) = O_{h(a)}(\Gamma)$.
Thus $Lang^0_{con}$ is a functor $\Mod{\mathbb{T}} \to \mathbb{T}/\algtt^0_{con}$.

\begin{prop}
$Lang^0_{con}$ is left adjoint to $Syn^0_{con}$.
\end{prop}
\begin{proof}
To prove this, it is enough to show that the composition of $Lang^0_{con}$ and the inclusion $\mathbb{T}/\algtt^0_{con} \to \mathbb{T}/\algtt^0$ is isomorphic to $Lang^0$.
Let $\alpha_M : Lang^0(M) \to Lang^0_{con}(M)$ be defined as $\alpha_M(O_a) = C_a$.
Let $\beta_M : Lang^0_{con}(M) \to Lang^0(M)$ be defined as $\beta_M(O_a(\Gamma)) = O_a|_{\Gamma = C_{M(ctx_{p,n})(a)}}$.
To prove that $\alpha$ and $\beta$ are inverses of each other, we need to show that $\sststile{}{\Gamma} O_a(\Gamma) \cong C_a|_{\Gamma = C_{M(ctx_{p,n})(a)}}$ is a theorem of $Lang^0_{con}(M)$.
But this follows from the first axiom of $Lang^0_{con}(M)$.
\end{proof}

For every algebraic dependent type theory with substitutions $\mathbb{T}$, there are adjoint functors $Lang^1 \dashv Syn^1 : \mathbb{T}/\algtt^1 \to \Mod{\mathbb{T}}$.
For every contextual algebraic dependent type theory with substitutions $\mathbb{T}$, there are adjoint functors $Lang^1_{con} \dashv Syn^1_{con} : \mathbb{T}/\algtt^1_{con} \to \Mod{\mathbb{T}}$.
These functors are defined in the same way as $Lang^0 \dashv Syn^0$ and $Lang^0_{con} \dashv Syn^0_{con}$.
\end{comment}

\section{Model structure on category of theories}

Let $T_I = coe_1 + \sigma + Path + wUA$.
In this section we define a model structure on category $T_I/\algtt^1_{reg}$.
To construct this model structure, we need to recall a few definitions from \cite{f-model-structures}.
A reflexive cylinder object $C_U(V)$ for a map $i : U \to V$ is any factorization of $[id_V,id_V] : V \amalg_U V \to V$.
Maps $f,g : V \to X$ are homotopic relative to a cylinder object $[\cyli_0,\cyli_1] : V \amalg_U V \to C_U(V)$, if there exists a map $h : C_U(V) \to X$
such that $h \circ \cyli_0 = f$ and $h \circ \cyli_1 = g$.
In this case we will write $f \sim_i g$.
We say that a map $f : X \to Y$ has RLP up to $\sim_i$ with respect to $i : U \to V$ if for every commutative square of the form
\[ \xymatrix{ U \ar[r]^u \ar@{}[dr]|(.7){\sim_i} \ar[d]_i & X \ar[d]^f \\
              V \ar[r]_v \ar@{-->}[ur]^g                  & Y,
            } \]
there is a dotted arrow $g : V \to X$ such that $g \circ i = u$ and $(f \circ g) \sim_i v$.

We will also need the following theorem from \cite{f-model-structures}:
\begin{thm}[model-structures]
Let $\C$ be a complete and cocomplete category, and let $\I$ be a set of maps of $\C$
such that the domains and the codomains of maps in $\I$ are cofibrant and small relative to $\Icell$.
For every $i : U \to V \in \I$, choose a reflexive relative cylinder object $C_U(V)$
such that $[\cyli_0,\cyli_1] : V \amalg_U V \to C_U(V) \in \Icof$.
Let $\J_\I = \{\ \cyli_0 : V \to C_U(V)\ |\ i : U \to V \in \I \ \}$, and
let $\we_\I$ be the set of maps which have RLP up to $\sim_i$ with respect to every $i \in \I$.

Suppose that for every object $X$ which either domain or codomain of a map in $\I$,
there exists a cylinder object $C(X)$ such that the following conditions hold:
\begin{enumerate}
\item For every $i : U \to V \in \I$, there exists a morphism of cylinder objects $(i,C(i)) : C(U) \to C(V)$.
\item There exists a map $s : C(X) \to C(X)$ such that $s \circ i_0 = i_1$, $s \circ i_1 = i_0$, and $C(i) \circ s = s \circ C(i)$.
\item These cylinder objects satisfy homotopy extension property. That is,
if $i : U \to V \in \cof$, $u : U \to X$ and $v : V \to X$ are maps, and $h : C(U) \to X$ is a homotopy between $v \circ i$ and $u$,
then there exists a map $v' : V \to X$ and a homotopy $h' : C(V) \to X$ between $v$ and $v'$ such that $h = h' \circ C(i)$.
\item Maps in $\Jcell[_\I]$ have RLP up to $\sim^*$ (reflexive transitive closure of $\sim$) with respect to domains of maps in $\I$.
\item For every $i : U \to V \in \I$, we have a lift $p$ in the following diagram:
\[ \xymatrix{ V \amalg_U V \ar[r]^-f \ar[d]_{[\cyli_0,\cyli_1]} & T \\
              C_U(V) \ar@{-->}[ur]_p
            } \]
where $T = C_U(V) \amalg_{(V \amalg_U V)} (C(V) \amalg_{C(U)} C(V))$ is the pushout of maps $[\cyli_0,\cyli_1] : V \amalg_U V \to C_U(V)$
and $\cyli_0 \amalg_{\cyli_0} \cyli_0 : V \amalg_U V \to C(V) \amalg_{C(U)} C(V)$,
and $f : V \amalg_U V \to T$ is the composite $V \amalg_U V \xrightarrow{\cyli_1 \amalg_{\cyli_1} \cyli_1} C(V) \amalg_{C(U)} C(V) \to T$.
\end{enumerate}
Then there exists a cofibrantly generated model structure on $\C$ with $\I$ as a set of generating cofibrations,
$\J_\I$ as a set of generating trivial cofibrations, and $\we_\I$ as a class of weak equivalences.
\end{thm}
Here $\sim^*$ denotes the reflexive transitive closure of the relation of left homotopy with respect to $C(X)$.

Let $e : \{ ctx, ty, tm \} \to \{ ctx, ty \}$ be the function defined as $e(ctx) = ctx$, $e(ty) = ctx$, $e(tm) = ty$.
Also we define $d_p : (p,n) \to (e(p),n)$ as $d_{ctx}(\Gamma) = \Gamma$ $d_{ty}(A) = ft(A)$, $d_{tm}(a) = ty(a)$.
For every sequence $s_1, \ldots s_k, s$ of sorts such that $s = (p,n)$ for some $p \in \{ ty, tm \}$ and $n \in \mathbb{N}$,
let $U_{s_1, \ldots s_k, s}$ be the theory under $T_I$ with one predicate symbol $P : s_1 \times \ldots \times s_k$
and one function symbol $A : s_1 \times \ldots \times s_k \to (e(p),n)$ and one axiom:
\[ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} A(x_1, \ldots x_k)\!\downarrow \]
Let $V_{s_1, \ldots s_k, s}$ be the theory under $U_{s_1, \ldots s_k, s}$ with one additional function symbol $a : s_1 \times \ldots \times s_k \to s$ and two axioms:
\begin{align*}
P(x_1, \ldots x_k) & \sststile{}{x_1, \ldots x_k} a(x_1, \ldots x_k)\!\downarrow \\
a(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} d_p(a(x_1, \ldots x_k)) = A(x_1, \ldots x_k)
\end{align*}
Let $i_{s_1, \ldots s_k, s} : U_{s_1, \ldots s_k} \to V_{s_1, \ldots s_k, s}$ be the inclusion of the subtheory.
Let $\I$ be the set of morphisms of the form $i_{s_1, \ldots s_k, s}$.

For every $i : U \to V \in \I$, we need to define a relative cylinder object $C_U(V)$.
Let $C_{U_{s_1, \ldots s_k, (tm,n)}}(V_{s_1, \ldots s_k, s})$ be the theory with one predicate symbol $P : s_1 \times \ldots \times s_k$,
four function symbols:
\begin{align*}
A & : s_1 \times \ldots \times s_k \to (ty,n) \\
a & : s_1 \times \ldots \times s_k \to (tm,n) \\
a' & : s_1 \times \ldots \times s_k \to (tm,n) \\
h & : s_1 \times \ldots \times s_k \to (tm,n+1)
\end{align*}
and the following axioms:
\begin{align*}
P(x_1, \ldots x_k) & \sststile{}{x_1, \ldots x_k} a(x_1, \ldots x_k)\!\downarrow \land\ a'(x_1, \ldots x_k)\!\downarrow \\
a(x_1, \ldots x_k)\!\downarrow \land\ a'(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} ctx^n(h(x_1, \ldots x_k)) = I \\
a(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} ty(a(x_1, \ldots x_k)) = A(x_1, \ldots x_k) \\
a'(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} ty(a'(x_1, \ldots x_k)) = A(x_1, \ldots x_k) \\
h(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} ty(h(x_1, \ldots x_k)) = A(x_1, \ldots x_k)\!\uparrow \\
h(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} left^*(h(x_1, \ldots x_k)) = a(x_1, \ldots x_k) \\
h(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} right^*(h(x_1, \ldots x_k)) = a'(x_1, \ldots x_k)
\end{align*}
Maps $\cyli_0,\cyli_1 : V_{s_1, \ldots s_k, (tm,n)} \to C_{U_{s_1, \ldots s_k, (p,n)}}(V_{s_1, \ldots s_k, (p,n)})$ are defined as follows:
$\cyli_0(a) = a$, $\cyli_1(a) = a'$, and $\cyli_0(x) = \cyli_1(x) = x$ for every other symbol $x$.

We also define theory $V'_{s_1, \ldots s_k, s}$ as $V_{s_1, \ldots s_k, s}$ together with the following axiom:
\[ a(x_1, \ldots x_k)\!\downarrow\ \sststile{}{x_1, \ldots x_k} P(x_1, \ldots x_k) \]

There are obvious morphisms $U_{s_1, \ldots s_k, s} \to V_{s_1, \ldots s_k, s}$.
Let $\I$ be the set of these morphisms for every sequence $s_1, \ldots s_k, s$.
Let $\I'$ be the set of morphisms of the form $j \circ i$, where $i \in \I$ and $j$ is the inclusion $V_{s_1, \ldots s_k, s} \to V'_{s_1, \ldots s_k, s}$.
Note that every map in $\I'$ is a pushout of a map in $\I$:
\[ \xymatrix{ U_{s_1, \ldots s_k, s} \ar[r]^f \ar[d] & U_{s_1, \ldots s_k, s} \ar[d] \\
              V_{s_1, \ldots s_k, s} \ar[r]_g & \po V'_{s_1, \ldots s_k, s}
            } \]
where $f(P) = P$, $f(A) = A|_P$, $g(P) = P$, $g(A) = A|_P$ and $g(a) = a$.
It follows that $\Icof[\I'] \subseteq \Icof$.

\begin{comment}
A cylinder object for a theory $T$ is a theory $C(T)$ together with three maps $i_0,i_1 : \mathbb{T} \to C$ and $w : C \to \mathbb{T}$
such that $w \circ i_0 = w \circ i_1 = id_{\mathbb{T}}$.
If $\mathbb{T}$ is an algebraic dependent type theory, then let $F(\mathbb{T})$ be a free theory under $UA$, that is $\mathbb{T} \amalg_{\mathbb{T}_0} UA$.
For every theory of the form $F(\mathbb{U}_{s_1, \ldots s_k, (p,n)})$ we define a cylinder object $C(\mathbb{U}_{s_1, \ldots s_k, (p,n)})$.
Apart from symbols and axioms of $UA$, it has two predicate symbols $P,Q : s_1 \times \ldots \times s_k$,
one function symbol $H : s_1 \times \ldots \times s_k \to (e(p),n+1)$ and one axiom:
\[ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} ft^n(d_{e(p)}(H(x_1, \ldots x_k))) = I(\emptyCtx) \land Q(x_1, \ldots x_k) \]

If $A_1, \ldots A_n \vdash a$, then let $I \times a = (I, A_1[], \ldots A_n[v_{n-2}, \ldots v_0] \vdash a[v_{n-1}, \ldots v_0])$.
Morphism $w : C(\mathbb{U}_{s_1, \ldots s_k, (p,n)}) \to F(\mathbb{U}_{s_1, \ldots s_k, (p,n)})$ is defined as follows:
$w(P) = P$, $w(Q) = Q$, $w(H(x_1, \ldots x_k)) = I \times A(x_1, \ldots x_k)$.
If $I, A_1, \ldots A_n \vdash h$, then for every $c \in \{ left, right \}$, let $c^*(h) = (A_1[c], \ldots A_n[c, v_{n-2}, \ldots v_0] \vdash h[c, v_{n-1}, \ldots v_0])$.
Morphisms $i_0,i_1 : F(\mathbb{U}_{s_1, \ldots s_k, (p,n)}) \to C(\mathbb{U}_{s_1, \ldots s_k, (p,n)})$ are defined as follows:
$i_j(P) = P$, $i_j(Q) = Q$ and $i_j(A(x_1, \ldots x_k)) = c_j^*(H(x_1, \ldots x_k))$ for every $j \in \{ 0, 1 \}$, where $c_0 = left$ and $c_1 = right$.
Note that $c_j^*(I \times A) = A$; hence $w \circ i_0 = w \circ i_1 = id_{F(\mathbb{U}_{s_1, \ldots s_k, (p,n)})}$.

For every theory $F(\mathbb{V}_{s_1, \ldots s_k, (p,n)})$ we define a cylinder object $C(\mathbb{V}_{s_1, \ldots s_k, (p,n)})$.
Apart from symbols and axioms of $UA$, it has two predicate symbols $P,Q : s_1 \times \ldots \times s_k$,
two function symbols $H : s_1 \times \ldots \times s_k \to (e(p),n+1)$, $h : s_1 \times \ldots \times s_k \to (p,n+1)$, and the following axioms:
\begin{align*}
P(x_1, \ldots x_k) & \sststile{}{x_1, \ldots x_k} h(x_1, \ldots x_k)\!\downarrow \\
h(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} ft^n(d_{e(p)}(H(x_1, \ldots x_k))) = I(\emptyCtx) \\
h(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} d_p(h(x_1, \ldots x_k)) = H(x_1, \ldots x_k) \land Q(x_1, \ldots x_k)
\end{align*}
Morphism $w : C(\mathbb{V}_{s_1, \ldots s_k, (p,n)}) \to F(\mathbb{V}_{s_1, \ldots s_k, (p,n)})$ is defined as follows:
$w(P) = P$, $w(Q) = Q$, $w(H(x_1, \ldots x_k)) = I \times A(x_1, \ldots x_k)$, $w(h(x_1, \ldots x_k)) = I \times a(x_1, \ldots x_k)$.
Morphisms $i_0,i_1 : F(\mathbb{U}_{s_1, \ldots s_k, (p,n)}) \to C(\mathbb{U}_{s_1, \ldots s_k, (p,n)})$ are defined as follows:
$i_j(P) = P$, $i_j(Q) = Q$, $i_j(A(x_1, \ldots x_k)) = c_j^*(H(x_1, \ldots x_k))$ and \todo{Fix margins} $i_j(a(x_1, \ldots x_k)) = c_j^*(h(x_1, \ldots x_k))$.
\end{comment}

% If $p \in \{ ty, tm \}$, then let $\I^1_p$ be the set of morphisms of theories of the form
% $\{ P(x_1, \ldots x_n) \sststile{}{x_1, \ldots x_n} A(x_1, \ldots x_n)\!\downarrow \land Q(x_1, \ldots x_n) \} \to \{ P(x_1, \ldots x_n) \sststile{}{x_1, \ldots x_n} a(x_1, \ldots x_n)\!\downarrow, a(x_1, \ldots x_n)\!\downarrow\ \sststile{}{x_1 : s_1, \ldots x_n : s_n} d_p(a(x_1, \ldots x_n)) = A(x_1, \ldots x_n) \land Q(x_1, \ldots x_n) \}$
% for every sequence of sorts $s_1$, \ldots $s_n$, $s$, where $s = (p,n)$ for some $n$, and $a : s_1 \times \ldots \times s_n \to s$.
% We define the set $\I$ of generating cofibrations to be the union $\I_{ty} \cup \I_{tm}$.
% Let $\J_p$ be the set of arrows of the form $i^0_{(p,n)}$.
% We define the set $\J$ of generating trivial cofibrations to be the union $\J_{ty} \cup \J_{tm}$.

\begin{comment}
\section{Model structure on models of theories with an interval type}

As we explained in the introduction, there are two classes of model structures on categories of models of type theories: global and local.
First, we describe how to construct both of these model structures on models of theories with fillers.
Then we show how to construct the global model structure on models of theories with heterogeneous path types and univalence.
Finally, using the first construction we define model structures on models of theories under $I$;
this is the most general class of theories that we will consider in this paper.

Now, let us consider the category of models of some theory under $I$.
We can define two sets of generating cofibrations: for global and local model structures.
\[ i^k_{(tm,n)} : F(\{\,I^k, \Gamma \vdash A\ type\,\} \cup S^k_{(tm,n)}) \to F(\{\,I^k, \Gamma \vdash a : A\,\}), \]
where $S^k_{(tm,n)} = \{\,I^{k-1}, [i = c]^*(\Gamma) \vdash a_{[i = c]} : [i = c]^*(A)\ |\ 0 \leq i < k,\ c \in \{ left, right \}\,\}$.
\[ i^k_{(ty,n)} : F(\{\,I^k, \Gamma \vdash A\,\} \cup S^k_{(ty,n)}) \to F(\{\,I^k, \Gamma \vdash A\ type\,\}), \]
where $S^k_{(ty,n)} = \{\,I^{k-1}, [i = c]^*(\Gamma) \vdash A_{[i = c]}\ type\ |\ 0 \leq i < k,\ c \in \{ left, right \}\,\}$.

Now, we need to define relative cylinder objects for maps in $\I$.
First, let us define them for maps in $\I^0$.
Let $C^0_{(tm,n)} = F(\{\,h : (tm,n+1), A : (ty,n)\,\}, \{\,ty(h) = (I(ft(A)) \vdash A\!\!\uparrow)\,\})$.
Maps $\cyli_0, \cyli_1 : F(\{\,a : (tm,n)\,\}) \to C^0_{(tm,n)}$ are defined as $\cyli_0(a) = h[left]$ and $\cyli_1(a) = h[right]$,
and map $s : C^0_{(tm,n)} \to F(\{\,a : (tm,n)\,\})$ is defined as $s(h) = a\!\!\uparrow$, $s(A) = ty(a)$.

Let $C^0_{(ty,n)} = F(\{\,H : (ty,n+1)\,\}, \{\,ft(H) = I(ft^2(H))\,\})$.
Then $C^0_{(ty,n)}$ is a reflexive relative cylinder object for $F(\{\,A : (ty,n)\,\})$.
Maps $\cyli_0, \cyli_1 : F(\{\,A : (ty,n)\,\}) \to C^0_{(ty,n)}$ are defined as $\cyli_0(A) = H[left]$ and $\cyli_1(A) = H[right]$,
and map $s : C^0_{(ty,n)} \to F(\{\,A : (ty,n)\,\})$ is defined as $s(H) = A\!\!\uparrow$.

Note that two terms $a,a' \in Y_{(tm,n)}$ of the same type $A \in Y_{(ty,n)}$ are homotopic relative to $A$
if and only if there exists a term of type $a = a'$.
Two types $A,B \in Y_{(ty,n)}$ in the same context $\Gamma \in Y_{(ctx,n)}$ are homotopic relative to $\Gamma$
if and only if there exist terms $\Gamma, A \vdash b : B\!\!\uparrow$ and $\Gamma, B \vdash a : A\!\!\uparrow$
such that $a \circ b$ is homotopic to $v_0$ and $b \circ a$ is homotopic to $v_0$.

We can use $V^{k+2}_{p,n,m}$ as a cylinder object for $V^{k+1}_{p,n,m}$.
But since we need a relative cylinder object, we add new relations to $V^{k+2}_{p,n,m}$.
Note that $V^{k+1}_{p,n,m} \amalg_{U^{k+1}_{p,n,m}} V^{k+1}_{p,n,m}$ can be described as an object
generated by $\Gamma : (ctx,n)$, $a : (p,n+k+1+m)$, $a' : (p,n+k+1+m)$
and $a_{[i = c]} : (p,n+k+m)$ for every $0 \leq i \leq k$ and $c \in \{ left, right \}$,
with relations $ctx^m(a) = ctx^m(a') = (\Gamma, I^{k+1} \vdash)$ and $[i = c]^*(a) = [i = c]^*(a') = a_{[i = c]}$.
To define $C^{k+1}_{p,n,m}$, we add to these generators and relations one more generator $h : (p,n+k+2+m)$ and the following relations:
$ctx^m(h) = (\Gamma, I^{k+2} \vdash)$, $[k + 1 = left]^*(h) = a$, $[k + 1 = right]^*(h) = a'$ and $[i = c]^*(h) = \delta_k(a_{[i = c]})$.
Map $[\cyli_0,\cyli_1] : V^{k+1}_{p,n,m} \amalg_{U^{k+1}_{p,n,m}} V^{k+1}_{p,n,m} \to C^{k+1}_{p,n,m}$ is the obvious inclusion.
Map $s : C^{k+1}_{p,n,m} \to V^{k+1}_{p,n,m}$ is defined as follows:
$s(\Gamma) = \Gamma$, $s(a) = s(a') = a$, $s(a_{[i = c]}) = [i = c]^*(a)$ and $s(h) = \delta_{k+1}(a)$.

Cylinders for $i^{k+1}_{tm,n,-1}$ are defined similarly.
First, $V^{k+1}_{tm,n,-1} \amalg_{U^{k+1}_{tm,n,-1}} V^{k+1}_{tm,n,-1}$ can be described as an object
generated by $A : (ty,n)$, $a : (p,n+k+1)$, $a' : (p,n+k+1)$
and $a_{[i = c]} : (p,n+k)$ for every $0 \leq i \leq k$ and $c \in \{ left, right \}$,
with relations $ty(a) = ty(a') = (ft(A), I^{k+1} \vdash A\!\!\uparrow^{k+1})$ and $[i = c]^*(a) = [i = c]^*(a') = a_{[i = c]}$.
To define $C^{k+1}_{p,n,m}$, we add to these generators and relations one more generator $h : (p,n+k+2)$ and the following relations:
$ty(h) = (ft(A), I^{k+2} \vdash A\!\!\uparrow^{}k+2)$, $[k + 1 = left]^*(h) = a$, $[k + 1 = right]^*(h) = a'$ and $[i = c]^*(h) = \delta_k(a_{[i = c]})$.
Map $[\cyli_0,\cyli_1] : V^{k+1}_{tm,n,-1} \amalg_{U^{k+1}_{tm,n,-1}} V^{k+1}_{tm,n,-1} \to C^{k+1}_{tm,n,-1}$ is the obvious inclusion.
Map $s : C^{k+1}_{tm,n,-1} \to V^{k+1}_{tm,n,-1}$ is defined as follows:
$s(A) = A$, $s(a) = s(a') = a$, $s(a_{[i = c]}) = [i = c]^*(a)$ and $s(h) = \delta_{k+1}(a)$.

Let us show that for every $i \in \I$, map $[\cyli_0,\cyli_1] : V \amalg_U V \to C_U(V)$ belongs to $\Icof$.
Map $[\cyli_0,\cyli_1] : V^0_{(tm,n)} \amalg_{U^0_{(tm,n)}} V^0_{(tm,n)} \to C^0_{(tm,n)}$ is (isomorphic to) $i^1_{tm,n,-1}$.
Also, note that it is a pushout of $i^0_{(tm,n)}$:
\[ \xymatrix{ U^0_{(tm,n)} \ar[rr]^-{A \mapsto a = a'} \ar[d]_{i^0_{(tm,n)}} & & V^0_{(tm,n)} \amalg_{U^0_{(tm,n)}} V^0_{(tm,n)} \ar[d]^{[\cyli_0,\cyli_1]} \\
              V^0_{(tm,n)} \ar[rr]_-{a \mapsto path(h)}                      & & \po C^0_{(tm,n)}
            } \]
where $V^0_{(p,n)} \amalg_{U^0_{(p,n)}} V^0_{(p,n)}$ is defined as $F(\{\,a : (p,n), a' : (p,n)\,\}, \{\,d_p(a) = d_p(a')\,\})$.
Map $[\cyli_0,\cyli_1] : V^0_{(ty,n)} \amalg_{U^0_{(ty,n)}} V^0_{(ty,n)} \to C^0_{(ty,n)}$ is (isomorphic to) $i^1_{ty,n,0}$.

Maps of the form $i^{k+1}_{p,n,m}$ (including $i^{k+1}_{tm,n,-1}$) can be described as following pushouts:
\[ \xymatrix{ U^{k+2}_{p,n,m} \ar[r]^-g \ar[d]_{i^{k+2}_{p,n,m}} & V^{k+1}_{p,n,m} \amalg_{U^{k+1}_{p,n,m}} V^{k+1}_{p,n,m} \ar[d]^{[\cyli_0,\cyli_1]} \\
              V^{k+2}_{p,n,m} \ar[r]_-{a \mapsto h}              & \po C^{k+1}_{p,n,m}
            } \]
where $g(a_{[k + 1 = left]}) = a$, $g(a_{[k + 1 = right]}) = a'$, $g(a_{[i = c]}) = \delta_k(a_{[i = c]})$.
\end{comment}

\begin{comment}
We will define several sets of maps that can be used as generating cofibrations.
Some of these sets work in a more general theories,
but if we assume that the theory we are working with has some additional constructions,
then we can use smaller sets of generating cofibrations.
These sets define several model structures, but in most cases the classes of weak equivalences are equal.

Let $i^0_{(ctx,n)}$ be the unique map $0 \to F(\{\,\Gamma : (ctx,n)\,\})$.
Let $\I^k_p$ be the set of maps of the form $i^k_{(p,n)}$.
Let $\I^k_p = \{\,i^k_{(p,n)}\ |\ n \in \mathbb{N}\,\}$ and $\I_{(p,n)} = \{\,i^k_{(p,n)}\ |\ k \in \mathbb{N}\,\}$.

Now, we need to define more generating cofibrations.
There are at least two natural ways in which we can try to define them: using either globular or cubical shapes.
First, let us describe the cubical generating cofibrations.
Define objects $V^{\square^k}_{(p,n)}$ as follows:
\begin{align*}
V^{\square^k}_{(tm,n)} & = F(\{\,a : (tm,n+k)\,\}, \{\,ctx(a) = (ctx^k(a), I^k \vdash)\,\}) \\
V^{\square^k}_{(ty,n)} & = F(\{\,A : (ty,n+k)\,\}, \{\,ctx(A) = (ctx^k(A), I^k \vdash)\,\}) \\
V^{\square^k}_{(ctx,n)} & = F(\{\,\Gamma : (ctx,n+k)\,\}, \{\,ctx^n(\Gamma) = (I^k \vdash)\,\})
\end{align*}
where $\Gamma, I^k \vdash$ is defined as $\Gamma, I, \ldots I$, where $I$ is repeated $k$ times.

\begin{prop}
The classes of cofibrations generated by $\I$ and $\I_{tm} \cup \I_{ty}$ are equal.
\end{prop}
\begin{proof}
Every map $0 \to F(\{\,\Gamma : (ctx,n)\,\})$ in $\I_{ctx}$ is a finite composition $0 = F(\{\,\Gamma : (ctx,0)\,\}) \to F(\{\,\Gamma : (ctx,1)\,\}) \to \ldots \to F(\{\,\Gamma : (ctx,n)\,\})$ of maps in $\I_{ty}$.
\todo{Prove the converse}
\end{proof}

Let $C_{(ctx,n)} = F(\{\,H : (ctx,n+1)\,\}, \{\,ctx^n(H) = I\,\})$.
Then $C_{(ctx,n)}$ is a reflexive relative cylinder object for $F(\{\,\Gamma : (ctx,n)\,\})$.
Maps $\cyli_0, \cyli_1 : F(\{\,\Gamma : (ctx,n)\,\}) \to C_{(ctx,n)}$ are defined as $\cyli_0(\Gamma) = left^*(\Gamma)$ and $\cyli_1(A) = right^*(\Gamma)$,
and map $s : C_{(ty,n)} \to F(\{\,A : (ty,n)\,\})$ is defined as $s(H) = I \times \Gamma$.

We can rephrase the definition of weak equivalences in more concrete terms.
\begin{enumerate}
\item We will say that $f : X \to Y$ is \emph{essentially surjective on terms} if
for every type $A \in X_{(ty,n)}$ and every term $a \in Y_{(tm,n)}$ of type $f(A)$,
there exists a term $a' \in X_{(tm,n)}$ of type $A$ such that $f(a')$ and $a$ are homotopic relative to $f(A)$.
\item We will say that $f : X \to Y$ is \emph{essentially surjective on types} if
for every context $\Gamma \in X_{(ctx,n)}$ and every type $A \in Y_{(ty,n)}$ in context $f(\Gamma)$,
there exists a type $A' \in X_{(ty,n)}$ in context $\Gamma$ such that $f(A')$ and $A$ are homotopic relative to $f(\Gamma)$.
\item We will say that $f : X \to Y$ is \emph{essentially surjective on contexts} if
for every context $\Gamma \in Y_{(ctx,n)}$, there exists a context $\Gamma' \in X_{(ty,n)}$ such that $f(\Gamma')$ and $\Gamma$ are homotopic.
\end{enumerate}
A map is a weak equivalence if and only if it is essentially surjective on terms and contexts.
Propositions \todo{Which propositions?} imply that this is equivalent to the condition that it is essentially surjective on terms and types.

If $H = (I, A_1, \ldots A_n \vdash) \in X_{(ctx,n+1)}$, then for every $c \in \{ left, right \}$, let $c^*(H) = (A_1[c], \ldots A_n[c] \vdash) \in X_{(ctx,n)}$.
A \emph{homotopy between} contexts $\Gamma,\Delta \in X_{(ctx,n)}$ is a context $H \in X_{(ctx,n+1)}$ such that $\vdash ft^n(H) \equiv I$, $left^*(H) = \Gamma$ and $right^*(H) = \Delta$.
Contexts $\Gamma$ and $\Delta$ are \emph{homotopic} if there is a homotopy between them.
In this case we will write $\Gamma \sim \Delta$.

A \emph{relative homotopy between} types $(\Gamma \vdash A), (\Gamma \vdash B) \in X_{(ty,n)}$ is a type $(\Gamma, I \vdash H) \in X_{(ty,n+1)}$ such that $H[left] = A$ and $H[right] = B$.
Types $A$ and $B$ are \emph{homotopic relative to $(ctx,n)$} if there is a relative homotopy between them.
In this case we will write $A \sim_r B$.

A \emph{relative homotopy between} terms $(\Gamma \vdash a : A), (\Gamma \vdash b : A) \in X_{(tm,n)}$ is a term $(\Gamma, I \vdash h : A\!\uparrow) \in X_{(tm,n+1)}$ such that $h[left] = a$ and $h[right] = b$.
Terms $a$ and $b$ are \emph{homotopic relative to $(ty,n)$} if there is a relative homotopy between them.
In this case we will write $a \sim_r b$.

\begin{rem}[types-hom-ua]
To define a relative homotopy between types $(\Gamma \vdash A), (\Gamma \vdash B) \in X_{(ty,n)}$,
    it is enought to specify terms $(\Gamma, A \vdash f : B\!\uparrow), (\Gamma, B \vdash g : A\!\uparrow) \in X_{(tm,n+1)}$
    such that $g \circ f \sim_r v_0(A)$ and $f \circ g \sim_r v_0(B)$.
Then we can define a relative homotopy $\Gamma, I \vdash iso(A\!\uparrow, B\!\uparrow, f\!\uparrow_1, g\!\uparrow_1, path(h_1\!\!\uparrow_2), path(h_2\!\!\uparrow_2), v_0)$ between $A$ and $B$,
    where $h_1$ is a relative homotopy between $g \circ f$ and $v_0(A)$, and $h_2$ is a relative homotopy between $f \circ g$ and $v_0(B)$.
\end{rem}

There is a bijection between morphisms $F(\{\,A : (p,n)\,\}) \to X$ and elements of $X_{(p,n)}$.
We can directly describe homotopies between morphisms $f,g : F(\{\,A : (p,n)\,\}) \to X$.
For this, we define (relative) cylinder objects $C$ together with maps $i^0,i^1 : F(\{\,A : (p,n)\,\}) \to C$.
Then a homotopy between $f$ and $g$ can be described as a map $h : C \to X$ such that $h \circ i^0 = f$ and $h \circ i^1 = g$.

A \emph{cylinder object} of sort $(ctx,n)$ is $F(\{\,H : (ctx,n+1)\,\}, \{\,ft^n(H) = I(\emptyCtx)\,\})$.
We will denote this object by $Cyl_{(ctx,n)}$.
Inclusions $i^0_{(ctx,n)}, i^1_{(ctx,n)} : F(\{\,\Gamma : (ctx,n)\,\}) \to Cyl_{(ctx,n)}$ are defined as $i^k_{(ctx,n)}(\Gamma) = c_k^*(H)$, where $c_0 = left$ and $c_1 = right$.

\begin{rem}
A relative homotopy between $f,g : F(\{\,A : (p,n)\,\}) \to X$ exists only if $f \circ \delta_{(p,n)} = g \circ \delta_{(p,n)}$, and in this case a homotopy $h$ is a map such that the following triangle commutes:
\[ \xymatrix{ F(\{\,a : (p,n)\,\}) \amalg_{F(\{\,A : (e(p),n)\,\})} F(\{\,a : (p,n)\,\}) \ar[d]_{[i^0,i^1]} \ar[r]^-{[f,g]} & X \\
              RCyl_{(p,n)} \ar@{-->}[ur]_h
            } \]
\end{rem}

Given two morphisms $f \in \I$ and $g : X \to Y$, we say that $f$ \emph{has the left lifting property (LLP) up to $\sim_r$} with respect to $g$,
and $g$ \emph{has the right lifting property (RLP) up to $\sim_r$} with respect to $f$ if for every commutative square of the form
\[ \xymatrix{ F(\{\,A : (e(p),n)\,\}) \ar[r]^-u \ar@{}[dr]|(.7){\sim_r} \ar[d]_f & X \ar[d]^g \\
              F(\{\,a : (p,n)\,\}) \ar[r]_-v \ar@{-->}[ur]^h                     & Y,
            } \]
there is a dotted arrow $h : F(\{\,a : (p,n)\,\}) \to X$ such that $h \circ f = u$ and $(g \circ h) \sim_r v$.
We define the set $\we$ of weak equivalences as the set of maps that have RLP up to $\sim_r$ with respect to every map in $\I$.
Thus a map $g : X \to Y$ is a weak equivalence if and only if the following conditions are satisfied:
\begin{enumerate}
\item For every context $\Gamma \in X_{(ctx,n)}$ and every type $A \in Y_{(ty,n)}$ in context $g(\Gamma)$, there exists a type $A' \in X_{(ty,n)}$ in context $\Gamma$ such that $g(A')$ and $A$ are homotopic relative to $(ctx,n)$.
    This is true if and only if $g$ has RLP up to $\sim_r$ with respect to every map in $\I_{ty}$.
    In this case we will say that $g$ is \emph{essentially surjective on types}.
\item For every type $A \in X_{(ty,n)}$ and every term $a \in Y_{(tm,n)}$ of type $g(A)$, there exists a term $a' \in X_{(tm,n)}$ of type $A$ such that $g(a')$ and $a$ are homotopic relative to $(ty,n)$.
    This is true if and only if $g$ has RLP up to $\sim_r$ with respect to every map in $\I_{tm}$.
    In this case we will say that $g$ is \emph{essentially surjective on terms}.
\end{enumerate}

\begin{prop}[hom-eq]
Relation $\sim_r$ is reflexive, symmetric, transitive and preserved by morphisms.
\end{prop}
\begin{proof}
If $h$ is a homotopy between $a$ and $b$, then $k(h)$ is a homotopy between $k(a)$ and $k(b)$.

If $(\Gamma \vdash A) \in X_{(p,n)}$, then $\Gamma, I \vdash A\!\uparrow$ is a homotopy between $A$ and $A$.

Let $h_1, h_2 : RCyl_{(tm,n)}(h) \to X$ be relative homotopies such that $h_1 \circ i^1 = h_2 \circ i^0$.
Then we define a relative homotopy $h_3$ between $h_1 \circ i^0$ and $h_2 \circ i^1$.
Let $h_3(h) = (ctx(h_1(h)) \vdash at(h_1[left]\!\uparrow, h_2[right]\!\uparrow, coe(Path(ty(h_1), h_1[left]\!\uparrow, h_2), path(h_1), right)\!\uparrow, v_0))$.

Let $H_1, H_2 : RCyl_{(ty,n)}(H) \to X$ be relative homotopies such that $H_1 \circ i^1 = H_2 \circ i^0$.
Then we define a relative homotopy $H_3$ between $H_1 \circ i^0$ and $H_2 \circ i^1$.
Let $H_3(H) = $.
\todo{Finish the proof}
\end{proof}

\begin{lem}
Let $k : X \to Y$ be a weak equivalence.
If $a,b \in X_{(p,n)}$ are such that $k(f) \sim_r k(g)$, then $a \sim_r b$.
\end{lem}
\begin{proof}
\todo{Write the proof}
\end{proof}

\begin{lem}[hom-ext][Homotopy extension property]
Let $f : F(\{\,\Gamma : (e(p),n)\,\}) \to F(\{\,A : (p,n)\,\}) \in \I$, $u : U \to X$, and $v : V \to X$ be maps such that $u \sim^r v \circ i$.
Then there exists a map $v' : V \to X$ such that $u = v' \circ i$ and $v' \sim v$.
\end{lem}

\begin{lem}
If $f : X \to Y$ is essentially surjective on types, then it is essentially surjective on context.
That is, for every $\Gamma \in Y_{(ctx,n)}$, there is a context $\Gamma' \in X_{(ctx,n)}$ such that $f(\Gamma') \sim \Gamma$.
\end{lem}
\begin{proof}
If $n = 0$, then $\Gamma = \emptyCtx$, and we can take $\Gamma' = \emptyCtx$.
If $n > 0$, then let $\Delta = ft(\Gamma)$.
There exists a context $\Delta' \in X_{(ctx,n-1)}$ such that $f(\Delta') \sim \Delta$.
By \rlem{hom-ext}, there exists
\end{proof}
\end{comment}

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
