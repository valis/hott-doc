\documentclass[reqno]{amsart}

\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{verbatim}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{turnstile}
\usepackage{etex}

\hypersetup{colorlinks=true,linkcolor=blue}

\renewcommand{\turnstile}[6][s]
    {\ifthenelse{\equal{#1}{d}}
        {\sbox{\first}{$\displaystyle{#4}$}
        \sbox{\second}{$\displaystyle{#5}$}}{}
    \ifthenelse{\equal{#1}{t}}
        {\sbox{\first}{$\textstyle{#4}$}
        \sbox{\second}{$\textstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{s}}
        {\sbox{\first}{$\scriptstyle{#4}$}
        \sbox{\second}{$\scriptstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{ss}}
        {\sbox{\first}{$\scriptscriptstyle{#4}$}
        \sbox{\second}{$\scriptscriptstyle{#5}$}}{}
    \setlength{\dashthickness}{0.111ex}
    \setlength{\ddashthickness}{0.35ex}
    \setlength{\leasturnstilewidth}{2em}
    \setlength{\extrawidth}{0.2em}
    \ifthenelse{%
      \equal{#3}{n}}{\setlength{\tinyverdistance}{0ex}}{}
    \ifthenelse{%
      \equal{#3}{s}}{\setlength{\tinyverdistance}{0.5\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{d}}{\setlength{\tinyverdistance}{0.5\ddashthickness}
        \addtolength{\tinyverdistance}{\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{t}}{\setlength{\tinyverdistance}{1.5\dashthickness}
        \addtolength{\tinyverdistance}{\ddashthickness}}{}
        \setlength{\verdistance}{0.4ex}
        \settoheight{\lengthvar}{\usebox{\first}}
        \setlength{\raisedown}{-\lengthvar}
        \addtolength{\raisedown}{-\tinyverdistance}
        \addtolength{\raisedown}{-\verdistance}
        \settodepth{\raiseup}{\usebox{\second}}
        \addtolength{\raiseup}{\tinyverdistance}
        \addtolength{\raiseup}{\verdistance}
        \setlength{\lift}{0.8ex}
        \settowidth{\firstwidth}{\usebox{\first}}
        \settowidth{\secondwidth}{\usebox{\second}}
        \ifthenelse{\lengthtest{\firstwidth = 0ex}
            \and
            \lengthtest{\secondwidth = 0ex}}
                {\setlength{\turnstilewidth}{\leasturnstilewidth}}
                {\setlength{\turnstilewidth}{2\extrawidth}
        \ifthenelse{\lengthtest{\firstwidth < \secondwidth}}
            {\addtolength{\turnstilewidth}{\secondwidth}}
            {\addtolength{\turnstilewidth}{\firstwidth}}}
        \ifthenelse{\lengthtest{\turnstilewidth < \leasturnstilewidth}}{\setlength{\turnstilewidth}{\leasturnstilewidth}}{}
    \setlength{\turnstileheight}{1.5ex}
    \sbox{\turnstilebox}
    {\raisebox{\lift}{\ensuremath{
        \makever{#2}{\dashthickness}{\turnstileheight}{\ddashthickness}
        \makehor{#3}{\dashthickness}{\turnstilewidth}{\ddashthickness}
        \hspace{-\turnstilewidth}
        \raisebox{\raisedown}
        {\makebox[\turnstilewidth]{\usebox{\first}}}
            \hspace{-\turnstilewidth}
            \raisebox{\raiseup}
            {\makebox[\turnstilewidth]{\usebox{\second}}}
        \makever{#6}{\dashthickness}{\turnstileheight}{\ddashthickness}}}}
        \mathrel{\usebox{\turnstilebox}}}

\newcommand{\axlabel}[1]{(#1) \phantomsection \label{ax:#1}}
\newcommand{\axtag}[1]{\label{ax:#1} \tag{#1}}
\newcommand{\axref}[1]{(\hyperref[ax:#1]{#1})}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{#3~\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\expandafter\newcommand\csname n#2\endcsname[1]{\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{Theorem}{Theorem}
\newref{lem}{Lemma}{Lemma}
\newref{prop}{Proposition}{Proposition}
\newref{cor}{Corollary}{Corollary}
\newref{cond}{Condition}{Condition}

\theoremstyle{definition}
\newref{defn}{Definition}{Definition}
\newref{example}{Example}{Example}

\theoremstyle{remark}
\newref{remark}{Remark}{Remark}

\newcommand{\cat}[1]{\mathbf{#1}}
\newcommand{\colim}{\mathrm{colim}}
\newcommand{\C}{\cat{C}}
\newcommand{\PAlg}[1]{#1\text{-}\cat{PAlg}}
\newcommand{\Mod}[1]{#1\text{-}\cat{Mod}}
\newcommand{\Th}{\cat{Th}}
\newcommand{\St}{\cat{St}}
\newcommand{\PSt}{\cat{PSt}}
\newcommand{\algtt}{\cat{TT}}
\newcommand{\ThC}{\Th_{\mathcal{C}}}
\newcommand{\emptyCtx}{\mathbf{1}}
\newcommand{\nf}{\mathrm{nf}}
\newcommand{\red}{\Rightarrow}
\newcommand{\deq}{\equiv}
\newcommand{\repl}{:=}
\newcommand{\ctx}{\mathrm{ctx}}
\newcommand{\type}{\mathrm{type}}
\newcommand{\Syn}{\mathrm{Syn}}
\newcommand{\Lang}{\mathrm{Lang}}
\newcommand{\Ho}{\mathrm{Ho}}
\newcommand{\Term}{\mathrm{Term}}

\newcommand{\IdT}{\mathrm{Id}}
\newcommand{\wUA}{\mathrm{wUA}}
\newcommand{\coeT}{\mathrm{coe}}
\newcommand{\PathT}{\mathrm{Path}}
\newcommand{\transportT}{\mathrm{transport}}

\newcommand{\Id}{\mathit{Id}}
\newcommand{\coe}{\mathit{coe}}
\newcommand{\conc}{\mathit{conc}}
\newcommand{\congI}{\mathit{cong}}
\newcommand{\refl}{\mathit{refl}}
\newcommand{\subst}{\mathit{subst}}
\newcommand{\transport}{\mathit{transport}}

\newcommand{\we}{\mathcal{W}}
\newcommand{\fib}{\mathcal{F}}
\newcommand{\cof}{\mathcal{C}}
\newcommand{\I}{\mathrm{I}}
\newcommand{\J}{\mathrm{J}}
\newcommand{\class}[2]{#1\text{-}\mathrm{#2}}
\newcommand{\Iinj}[1][\I]{\class{#1}{inj}}
\newcommand{\Icell}[1][\I]{\class{#1}{cell}}
\newcommand{\Icof}[1][\I]{\class{#1}{cof}}
\newcommand{\Jinj}[1][]{\Iinj[\J#1]}
\newcommand{\Jcell}[1][]{\Icell[\J#1]}
\newcommand{\Jcof}[1][]{\Icof[\J#1]}
\newcommand{\cyli}{i}

\numberwithin{figure}{section}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\begin{document}

\title{Morita equivalences between algebraic dependent type theories}

\author{Valery Isaev}

\begin{abstract}
\end{abstract}

\maketitle

\section{Introduction}

The category of algebraic dependent type theories was defined in \cite{alg-tt}.

\section{Morita equivalences of theories}

In this section we define several notions of weak equivalence of algebraic dependent type theories.

\subsection{Algebraic dependent type theories}

Recall that an algebraic dependent type theory $T$ consists of a set $\mathcal{F}$ of function symbols, a set $\mathcal{P}$ of predicate symbols and a set of axioms.
The set of sorts $\mathcal{S}$ is defined as $\{ ctx, tm \} \times \mathbb{N}$.
We also write $(ty,n)$ for $(ctx,n+1)$.
Every function symbol $\sigma \in \mathcal{F}$ is equipped with a signature $\sigma : s_1 \times \ldots \times s_k \to s$ where $s_1, \ldots s_k, s \in \mathcal{S}$.
Every predicate symbol $R \in \mathcal{P}$ is equipped with a signature $R : s_1 \times \ldots \times s_k$ where $s_1, \ldots s_k \in \mathcal{S}$.
The set $\Term_T(V)_s$ of terms of sort $s$ with variable in $V$ is defined inductively from $\mathcal{F}$ as usual.
An atomic formula with variables in $V$ is an expression either of the form $t_1 = t_2$  where $t_i \in \Term_T(V)_s$ or of the form $R(t_1, \ldots t_k)$ where $t_i \in \Term_T(V)_{s_i}$.
A formula with variables in $V$ is an expression of the form $\varphi_1 \land \ldots \land \varphi_n$ where $\varphi_i$ are atomic formulas.
An axiom is an expression of the form $\varphi \sststile{}{V} \psi$ where $\varphi$ and $\psi$ are formulas with variables in $V$.
We will write $\varphi \sststile{T}{V} \psi$ to denote the fact that sequent $\varphi \sststile{}{V} \psi$ is derivable in $T$ using the following inference rules:
\begin{center}
$\varphi \sststile{}{V} \varphi$ \axlabel{b1}
\qquad
\AxiomC{$\varphi \sststile{}{V} \psi$}
\AxiomC{$\psi \sststile{}{V} \chi$}
\RightLabel{\axlabel{b2}}
\BinaryInfC{$\varphi \sststile{}{V} \chi$}
\DisplayProof
\qquad
$\varphi \sststile{}{V} \top$ \axlabel{b3}
\end{center}

\medskip
\begin{center}
$\varphi \land \psi \sststile{}{V} \varphi$ \axlabel{b4}
\qquad
$\varphi \land \psi \sststile{}{V} \psi$ \axlabel{b5}
\qquad
\AxiomC{$\varphi \sststile{}{V} \psi$}
\AxiomC{$\varphi \sststile{}{V} \chi$}
\RightLabel{\axlabel{b6}}
\BinaryInfC{$\varphi \sststile{}{V} \psi \land \chi$}
\DisplayProof
\end{center}

\medskip
\begin{center}
$\sststile{}{x} x\!\downarrow$ \axlabel{a1}
\qquad
$x = y \land \varphi \sststile{}{V,x,y} \varphi[y/x]$ \axlabel{a2}
\end{center}

\medskip
\begin{center}
\AxiomC{$\varphi \sststile{}{V} \psi$}
\RightLabel{, $x \in FV(\varphi)$ \axlabel{a3}}
\UnaryInfC{$\varphi[t/x] \sststile{}{V,V'} \psi[t/x]$}
\DisplayProof
\end{center}
\medskip

We will give several proofs by induction on the derivation of a sequent.
We need to work with sequents in which the left hand side has some property, but in a derivation of a sequent in this logic the left hand side may vary arbitrary.
Thus we describe another set of rules which is equivalent to this one and in which the left hand side stays the same.
We call these rules the \emph{natural deduction system}.
In this system the right hand side of all sequents is an atomic formula.

\begin{center}
\AxiomC{}
\RightLabel{\axlabel{nv}}
\UnaryInfC{$\varphi \sststile{}{V} x\!\downarrow$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} a = b$}
\RightLabel{\axlabel{ns}}
\UnaryInfC{$\varphi \sststile{}{V} b = a$}
\DisplayProof
\end{center}

\begin{center}
\AxiomC{}
\RightLabel{\axlabel{nh}}
\UnaryInfC{$\varphi_1 \land \ldots \land \varphi_n \sststile{}{V} \varphi_i$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} a = b$}
\AxiomC{$\varphi \sststile{}{V} \psi[a/x]$}
\RightLabel{\axlabel{nl}}
\BinaryInfC{$\varphi \sststile{}{V} \psi[b/x]$}
\DisplayProof
\end{center}

\begin{center}
\AxiomC{$\varphi \sststile{}{V} R(t_1, \ldots t_n)$}
\RightLabel{\axlabel{np}}
\UnaryInfC{$\varphi \sststile{}{V} t_i\!\downarrow$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} \sigma(t_1, \ldots t_n)\!\downarrow$}
\RightLabel{\axlabel{nf}}
\UnaryInfC{$\varphi \sststile{}{V} t_i\!\downarrow$}
\DisplayProof
\end{center}
where $R$ is a predicate symbol of the theory and $\sigma$ is its function symbol.

Finally, for every axiom $\psi_1 \land \ldots \land \psi_n \sststile{}{x_1 : s_1, \ldots x_k : s_k} \chi_1 \land \ldots \land \chi_m$
and for all terms $t_1 : s_1$, \ldots $t_k : s_k$, we have the following rules for all $1 \leq j \leq m$:
\smallskip
\begin{center}
\AxiomC{$\varphi \sststile{}{V} t_i\!\downarrow$, $1 \leq i \leq k$}
\AxiomC{$\varphi \sststile{}{V} \psi_i[t_1/x_1, \ldots t_k/x_k]$, $1 \leq i \leq n$}
\RightLabel{\axlabel{na}}
\BinaryInfC{$\varphi \sststile{}{V} \chi_j[t_1/x_1, \ldots t_k/x_k]$}
\DisplayProof
\end{center}

\begin{prop}
A sequent $\varphi \sststile{}{V} \psi_1 \land \ldots \land \psi_n$ is derivable in the system of rules \axref{b1}-\axref{b6}, \axref{a1}-\axref{a3} if and only if
sequents $\varphi \sststile{}{V} \psi_1$, \ldots $\varphi \sststile{}{V} \psi_n$ are derivable in the natural deduction system.
\end{prop}
\begin{proof}
It is easy to prove the ``if'' part.
Conversely, the rules \axref{b1}, \axref{b4}, and \axref{b5} follow from \axref{nh},
the rules \axref{b3} and \axref{b6} hold trivially,
the rule \axref{a1} follows from \axref{nv},
the rule \axref{a2} follows from \axref{nl} and \axref{nh},
and every axiom is derivable from \axref{na}.

To prove the rule \axref{b2}, we just need to show that if sequents $\varphi \sststile{}{V} \psi_1$, \ldots $\varphi \sststile{}{V} \psi_n$,
and $\psi_1 \land \ldots \land \psi_n \sststile{}{V} \chi$ are derivable in the natural deduction, then $\varphi \sststile{}{V} \chi$ is also derivable.
We can construct a derivation tree for this sequent as a derivation tree for $\psi_1 \land \ldots \land \psi_n \sststile{}{V} \chi$
in which the left hand sides of all sequents are replaced with $\varphi$ and rules \axref{nh} are replaced with derivation trees for $\varphi \sststile{}{V} \psi_i$.

To prove the rule \axref{a3}, consider a derivation tree for a sequent $\varphi \sststile{}{V} \psi$.
To construct a derivation tree for $\varphi[t/x] \sststile{}{V,V'} \psi[t/x]$, we just need to apply the substitution to every sequent in this derivation tree.
The only rule that is not closed under substitution is \axref{nv}.
By assumption, $x \in FV(\varphi)$.
In this case the sequent $\varphi[t/x] \sststile{}{V,V'} t\!\downarrow$ is derivable from \axref{np}, \axref{nf} and the following rules:
\begin{center}
\AxiomC{$\varphi \sststile{}{V} t_1 = t_2$}
\RightLabel{\axlabel{ne1}}
\UnaryInfC{$\varphi \sststile{}{V} t_1\!\downarrow$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} t_1 = t_2$}
\RightLabel{\axlabel{ne2}}
\UnaryInfC{$\varphi \sststile{}{V} t_2\!\downarrow$}
\DisplayProof
\end{center}
The rule \axref{ne2} follows from \axref{nl} if we take $\psi(x) = (x = b)$.
The rule \axref{ne1} follows from \axref{ne2} and \axref{ns}.
\end{proof}

We will need the following lemma later:

\begin{lem}[mcf]
A sequent $\varphi \sststile{}{x_1, \ldots x_n} \psi$ is provable in a theory $T$ if and only if
the sequent $\sststile{}{} \psi[c_1/x_1, \ldots c_n/x_n]$ is provable in the theory $T \cup \{ \sststile{}{} c_i\!\downarrow\ |\ 1 \leq i \leq n \} \cup \{ \varphi[c_1/x_1, \ldots c_n/x_n] \}$,
where $c_1$, \ldots $c_n$ are fresh constants.
\end{lem}
\begin{proof}
This follows from \cite[Theorem~10, Theorem~11]{PHL}.
\end{proof}

\subsection{Model categories of models of type theories}

To define Morita equivalences between two theories $T_1$ and $T_2$, they must have some additional structure.
We assume that all of the theories are equipped with a morphism from the theory that has one function symbol
$\Id : (tm,0) \times (tm,0) \to (ty,0)$ and the only axiom $\Id(x,y)\!\downarrow\ \sststile{}{x,y} ty(x) = ty(y)$.
We will denote this theory by $\IdT_0$.
We often need to assume even more structure, but we will always state additional assumptions explicitly.

Let $T$ be a theory under $\IdT_0$ and let $X$ be a model of $T$.
A \emph{relative homotopy} between terms $a,a' \in X_{(tm,n)}$ is a term $h \in X_{(tm,n)}$ such that $ty(h) = \Id(a,a')$.
A \emph{relative homotopy} between types $A,A' \in X_{(ty,n)}$ is a tuple $(f,g,p,g',p')$, where $f,g,p,g',p' \in X_{(tm,n+1)}$ such that
\begin{align*}
x : A & \vdash f : A' \\
y : A' & \vdash g : A \\
x : A & \vdash p : \Id(g[y \mapsto f], x) \\
y : A' & \vdash g' : A \\
y : A' & \vdash p' : \Id(f[x \mapsto g], y)
\end{align*}

In general the homotopy relation is not an equivalence relation, but it is if $T$ also has the reflexivity and transport operations:
\begin{center}
\AxiomC{}
\UnaryInfC{$\vdash \refl(x) : \Id(x,x)$}
\DisplayProof
\qquad
\AxiomC{$\vdash p : \Id(a,a')$}
\AxiomC{$\vdash b : B[a]$}
\BinaryInfC{$\vdash \transport(B,a,a',p,b) : B[a']$}
\DisplayProof
\end{center}

Let $X$ and $Y$ be models of a theory with identity types.
A morphism of models $f : X \to Y$ is \emph{weak equivalence} if it satisfies the following conditions:
\begin{enumerate}
\item For all $A \in X_{(ty,n)}$ and $a \in Y_{(tm,n)}$ such that $ty(a) = f(A)$,
there is a term $a' \in X_{(tm,n)}$ such that $ty(a') = A$ and $f(a')$ is relatively homotopic to $a$.
In this case we will say that $f$ is \emph{essentially surjective on terms}.
\item For all $\Gamma \in X_{(ctx,n)}$ and $A \in Y_{(ty,n)}$ such that $ft(A) = f(\Gamma)$,
there is a type $A' \in X_{(ty,n)}$ such that $ft(A') = \Gamma$ and $f(A')$ is relatively homotopic to $A$.
In this case we will say that $f$ is \emph{essentially surjective on types}.
\end{enumerate}

For every theory $T$ under $\IdT_0$, we define a set $\I$ of maps in the category of models of $T$ as the set consisting of maps of the form
\[ F(\{ A : (d_p,n) \}) \to F(\{ e_p(a) = A \}) \]
where $d_{ty} = ctx$, $d_{tm} = ty$, $e_{ty}(a) = ft(a)$, $e_{tm}(a) = ty(a)$,
and $F(S)$ is the free model generated by the specified generators and relations.
The class of \emph{cofibrations} of $\Mod{T}$ is generated by $\I$.

Let $\J$ be the set consisting of maps of the following forms:
\begin{align*}
F(\{ a : (tm,n) \}) & \to F(\{ a, a' : (tm,n), p : \Id(a,a') \}) \\
F(\{ A : (ty,n) \}) & \to F(\{ A, A' : (ty,n), f,g,p,g',p' : (tm,n+1), S \}),
\end{align*}
where $S$ is the set of formulas asserting that $(f,g,p,g',p')$ is a relative homotopy between $A$ and $A'$.
The class of \emph{anodyne extensions} is generated by $\J$.

We are interested in question when the classes of cofibrations and weak equivalences as defined above determine a model structure or a left semi-model structure.
We will use the definition of left semi-model structures given in \cite[Lemma~6.7]{kap-lum-model}.
We will say that a theory is \emph{good} (resp., \emph{semi-good}) if this model structure (resp., left semi-model structure) exists on the category of its models.
We proved several results about model structures in \cite{f-model-structures} which are useful when working with this model structure and they also apply to left semi-model structure.

\begin{prop}[good-theories]
A theory is good if and only if the weak equivalences satisfy the 2-out-of-3 property and pushouts of maps in $\J$ are weak equivalences.
A theory is semi-good if and only if the weak equivalences satisfy the 2-out-of-6 property and a pushout of a map in $\J$ is a weak equivalence if it has a cofibrant domain.
\end{prop}
\begin{proof}
This follows from \cite[Proposition~3.1]{f-model-structures} and the fact that weak equivalences are closed under transfinite compositions.
\end{proof}

It was shown in \cite{kap-lum-model} that a certain theory with identity types, $\Sigma$-types, and $\Pi$-types is semi-good.
We proved in \cite{alg-models} that all theories under $\coeT_1 + \sigma + \PathT + \wUA$ are good.

\subsection{Morita equivalences}

Now, we can give the main definition of this paper.

\begin{defn}
A \emph{Morita equivalence} between theories $T_1$ and $T_2$ is a morphism $f : T_1 \to T_2$ such that for every cofibrant model $X$ of $T_1$,
the unit $\eta_X : X \to f^*(f_!(X))$ of the adjunction $f_! \dashv f^*$ is a weak equivalence.
We will say that $f$ is a \emph{strong Morita equivalence} if $\eta_X$ is a weak equivalence for every $X$.
We will say that $f$ is a \emph{syntactic equivalence} if $\eta_X$ is a weak equivalence when $X$ is the initial model.
\end{defn}

If the theories are semi-good, then we can give a characterization of Morita equivalences in terms of the semi-model structures on the categories of their models.

\begin{prop}[morita-quillen]
Let $T_1$ and $T_2$ be semi-good theories.
Then, for every morphism $f : T_1 \to T_2$, the adjunction $f_! \dashv f^*$ is a Quillen adjunction.
It is a Quillen equivalence if and only if $f$ is a Morita equivalence.
\end{prop}
\begin{proof}
Since $f_!$ is a left adjoint, it preserves object defined by generators and relations.
Since the set of generating cofibration $\I$ and the set of generating trivial cofibration $\J_\I$
are both defined in terms of generators and relations, this implies that $f_!$ preserves them.
Hence $f_! \dashv f^*$ is a Quillen adjunction.
The second part of the proposition follows from \cite[Corollary~3.9]{f-model-structures}.
\end{proof}

We can give a useful characterization of (strong) Morita equivalences.
To do this, we need to define a notion of a relative homotopy between terms in a theory.
Let $T$ be a theory with identity types and let $\varphi$ be a formula of $T$.
A \emph{relative homotopy} between types $A,A' \in \Term_T(V)_{(ty,n)}$ with respect to $\varphi$ is a tuple $f,g,p,g',p' \in \Term_T(V)_{(tm,n+1)}$
such that sequent $\varphi \sststile{}{V} \psi$ is derivable in $T$, where $\psi$ is the conjunction of formulas that appear in the definition of a relative homotopy for models.
If $a,a' \in \Term_T(V)_{(tm,n)}$ are terms such that $\varphi \sststile{}{V} ty(a) = ty(a')$, then a \emph{relative homotopy} between $a$ and $a'$ with respect to $\varphi$ is a term $h \in \Term_T(V)_{(tm,n)}$
such that sequent $\varphi \sststile{}{V} ty(h) = \Id(a,a')$ is derivable in $T$.
If $a$ and $a'$ are such that only $\varphi \sststile{}{V} ft(ty(a)) = ft(ty(a'))$ is true, then a \emph{relative (heterogeneous) homotopy} between $a$ and $a'$ with respect to $\varphi$
is a relative homotopy $f,g,p,g',p'$ between $ty(a)$ and $ty(a')$ together with a relative homotopy between $f[a]$ and $a'$.

Let $V$ be a set of variables and let $\varphi$ be a formula with free variables in $V$.
We will say that a morphism $f : T_1 \to T_2$ of theories with identity types has the weak lifting property with respect to $V,\varphi$ if
for every term $A \in \Term_{T_1}(V)_{(d_p,n)}$ and every term $a \in \Term_{T_2}(V)_{(p,n)}$ such that $\varphi \sststile{}{V} A\!\downarrow$ and $f(\varphi) \sststile{}{V} e_p(a) = f(A)$,
there exists a term $a' \in \Term_{T_1}(V)_{(p,n)}$ such that $f(a')$ is relatively homotopic to $a$ with respect to $\varphi$.
We will say that $f$ has the lifting property with respect to $V,\varphi$ if $f(a')$ is not only homotopic to $a$, but also equals it.

If $P$ is a set of pairs of the form $V,\varphi$, then we will say that a map has the (weak) lifting property with respect to $P$ if it has this property with respect to every element of $P$.
We define $P_0$ as the singleton set $\{ \varnothing,\top \}$, $P_S$ as the set of all pairs, and $P_M$ as the set of pairs $V,\varphi$ such that $V = \{ x_1, \ldots x_k \}$
and $\varphi = \varphi_1 \land \ldots \land \varphi_k$, where $\varphi_i$ equals to $e_p(x_i) = t_i$,
where $t_i$ is a term of $T_1$ with free variables in $\{ x_1, \ldots x_{i-1} \}$ such that for every $1 \leq i \leq k$,
sequent $\varphi_1 \land \ldots \land \varphi_{i-1} \sststile{}{x_1, \ldots x_{i-1}} t_i\!\downarrow$ is derivable in $T_1$.

\begin{prop}[str-morita-char]
A morphism $f : T_1 \to T_2$ between theories with identity types is a strong Morita equivalence if and only if it has the weak lifting property with respect to $P_S$.
\end{prop}
\begin{proof}
First, we need to introduce an auxiliary construction.
Let $T$ be a theory, let $V$ be a set of variables, and let $\mathcal{A}$ be a set formulas of $T$ with variables in $V$.
Then we define $\Syn(T,V,\mathcal{A})$ as $\Syn(T \cup \{ O_x : s\ |\ x \in V_s \} \cup \mathrm{sp}(\mathcal{A}))$ (functors $\Syn$ and $\Lang$ are defined in \cite{alg-models}),
where $\mathrm{sp}(\mathcal{A})$ consists of formulas of the form $\sststile{}{} O_x\!\downarrow$ for every $x \in V$
and formulas of $\mathcal{A}$ in which every variable $x$ is replaced with $O_x$.
If $f : T_1 \to T_2$ is a morphism of theories, then it is easy to see that $f_!(\Syn(T_1,V,\mathcal{A})) = \Syn(T_2,V,f(\mathcal{A}))$.

Let us prove the ``only if'' direction.
Note that elements of $\Syn(T_1, V, \{\,\sststile{}{}~\varphi\,\})$ correspond to terms $t$ of $T_1$ with variables in $V$ such that $\varphi \sststile{T_1}{V} t\!\downarrow$.
Moreover, two terms $t_1$ and $t_2$ map to the same element under this correspondence if and only if $\varphi \sststile{T_1}{V} t_1 = t_2$.
Analogous statement holds for $\Syn(T_2, V, \{\,\sststile{}{}~f(\varphi)\,\})$.
Using this correspondence, the required conditions immediately follow from the fact that
map $\Syn(T_1, V, \{\,\sststile{}{}~\varphi\,\}) \to f^*(\Syn(T_2, V, \{\,\sststile{}{}~f(\varphi)\,\}))$ is a weak equivalence.

Now, let us prove the ``if'' direction.
Let $M$ be a model of $T_1$.
Note that $M$ is isomorphic to $\Syn(T_1, U(M), \mathcal{A})$, where $U(M)$ is the underlying set of $M$ and $\mathcal{A}$ is the set of formulas of the form
$x = \sigma(x_1, \ldots x_k)$ and $R(x_1, \ldots x_k)$ for all $x, x_1, \ldots x_k \in M$ such that these formulas hold in $M$.
Note that $sp(\mathcal{A})$ is the set of axioms of $\Lang(M)$.

Let $A \in M_{(d_p,n)}$ and $a \in f^*(f_!(M))$ be elements such that $e_p(a) = A$.
Since $f_!(M) = \Syn(T_2, U(M), f(\mathcal{A}))$, $a$ is a closed term of $T_2$.
There is a finite subset $\mathcal{A}_0$ of $\mathcal{A}$ such that $\sststile{T_2 \cup \mathrm{sp}(\mathcal{A}_0)}{} e_p(a) = A$.
Let $\varphi$ be the conjunction of $\mathcal{A}_0$, and let $b$ and $B$ be $a$ and $A$, respectively, in which every constant $O_x$ is replaced with variable $x$.
Then $\varphi \sststile{T_2}{U(M)} e_p(b) = B$.
By assumption, there exist a term $b' \in \Term_{T_1}(U(M))_{(p,n)}$ and a relative homotopy $h$ between $f(b)$ and $b'$.
These terms correspond under $\mathrm{sp}$ to elements of $M$ and $f^*(f_!(M))$, respectively.
These conditions imply that $b'$ is the required lifting and $h$ is the required homotopy.
\end{proof}

Analogous characterizations hold for Morita and syntacric equivalences:

\begin{prop}[morita-char]
A morphism $f : T_1 \to T_2$ between theories with identity types is a Morita equivalence if and only if it has the weak lifting property with respect to $P_M$.
\end{prop}
\begin{proof}
Suppose that $f$ is a Morita equivalence.
To prove that $f$ has the weak lifting property, we just need to show that model $M = \Syn(T_1, \{ x_1, \ldots x_k \}, \{\,\sststile{}{}~\varphi\,\})$
constructed in the previous proposition is cofibrant.
Note that for every $1 \leq i \leq k$, we have the following pushout square:
\[ \xymatrix{ F(\{ A : (d_p,n) \}) \ar[d] \ar[r] &     \Syn(T_1, \{ x_1, \ldots x_{i-1} \}, \{\,\sststile{}{} \varphi_1 \land \ldots \land \varphi_{i-1} \,\}) \ar[d] \\
              F(\{ e_p(a) = A \})         \ar[r] & \po \Syn(T_1, \{ x_1, \ldots x_i \}, \{\,\sststile{}{} \varphi_1 \land \ldots \land \varphi_i \,\}),
            } \]
where the top arrow maps $A$ to $t_i$ and the bottome arrow maps $a$ to $x_i$.
This shows that $M$ is a relative $\I$-cell complex.

Now, let us prove the converse.
We just need to show that if $M$ is a cofibrant model of $T_1$, then we can choose formula $\varphi$
in the second part of the proof of the previous proposition so that it satisfies the conditions of this proposition.

Since every cofibrant object is a retract of a relative $\I$-cell complex and Morita equivalences are closed under retracts, we may assume that $M$ is a relative $\I$-cell complex.
Moreover, we may assume that there are subsets $\{S_i\}_{i \in \mathbb{N}}$ of elements of $M$ such that we have the following pushout diagrams:
\[ \xymatrix{ \coprod_{x \in S_i} F(\{ A_x : (d_p,n) \}) \ar[d] \ar[r] &     M_i \ar[d] \\
              \coprod_{x \in S_i} F(\{ e_p(a_x) = A_x \})       \ar[r] & \po M_{i+1},
            } \]
$M_0$ is the initial model, $M$ is the colimit of $M_i$, and map $F(\{ e_p(a_x) = A_x \}) \to M_{i+1} \to M$ sends $a_x$ to $x$.

Note that $M_i$ is isomorphic to $\Syn(T_1, \bigcup_{1 \leq j \leq i} S_j, \mathcal{A}_i)$,
where $\mathcal{A}_i$ consists of formulas of the form $e_p(x) = t$, where $x \in S_i$ and $t \in \Term_{T_1}(\bigcup_{1 \leq j < i} S_j)$ corresponds to the image of $A_x$ in $M_{i-1}$.
Thus, $M$ is isomorphic to $\Syn(T_1, \bigcup_{i \in \mathbb{N}} S_i, \bigcup_{i \in \mathbb{N}} \mathcal{A}_i)$.
Now, if we choose a finite subset of $\bigcup_{i \in \mathbb{N}} \mathcal{A}_i$ as before, then the conjunction of this subset satisfies the required conditions.
\end{proof}

\begin{prop}[syn-equiv-char]
A morphism $f : T_1 \to T_2$ between theories with identity types is a syntactic equivalence if and only if it has the weak lifting property with respect to $P_0$.
\end{prop}
\begin{proof}
This is obvious since elements of the initial model of $T_1$ are closed terms $t$ of $T_1$ such that $\sststile{}{} t\!\downarrow$ is derivable.
\end{proof}

We will show that there is a model structure on the category of theories with the interval type, path types and the weak univalence axiom as described in \cite{alg-models}.
Note that if we assume only usual identity types with the J rule since, then no such model structure (or left semi-model structure, or structure of a cofibration category) can exist since trivial cofibrations are not closed under pushouts.
Indeed, consider theories $T_1 = \IdT \amalg \{ A : (ty,0), A\!\downarrow \}$ and $T_2 = \IdT \amalg \{ A, A' : (ty,0), a : (tm,1), A\!\downarrow, A'\!\downarrow, A \vdash a : A' \}$, where $\IdT$ is some version of the theory of identity types.
\Rprop{str-morita-char} implies that the obvious morphism $T_1 \to T_2$ is a strong Morita equivalence.
Now, consider the theory $T_3 = \{ \sigma : (ty,0) \to (ty,0), \sigma(x)\!\downarrow \}$.
Then the map $T_1 \amalg T_3 \to T_2 \amalg T_3$ is not even a syntactic equivalence since types $\sigma(A)$ and $\sigma(A')$ are equal in $T_2 \amalg T_3$, but there is no term between them in $T_1 \amalg T_3$.

It was shown in \cite{alg-models} that the category of models of a theory under $\coeT_1 + \sigma + \PathT + \wUA$ carries a model structure.
If the theory has only identity types, then there is only a left semi-model structure as shown in \cite{kap-lum-model}.
We can generalize this theorem using the following lemma:

\begin{lem}
Let $T_1$ be a theory such that the weak equivalences in $\Mod{T_1}$ satisfy the 2-out-of-6 property.
If $T_2$ is a semi-good theory and $F : T_1 \to T_2$ is a Morita equivalence, then $T_1$ is also semi-good and $F_! \dashv F^*$ is a Quillen equivalence between $\Mod{T_1}$ and $\Mod{T_2}$.
\end{lem}
\begin{proof}
By \rprop{good-theories}, we just need to prove that pushouts of maps in $\J$ with cofibrant codomains are weak equivalences in $\Mod{T_1}$.
Let $f : X \to Y$ be a pushout of a map in $\J$ such that $X$ is cofibrant.
Since $F_!$ preserves pushouts and maps in $\J$, the map $F_!(f)$ is a weak equivalence.
The functor $F^*$ always preserves weak equivalences.
Thus, $F^*(F_!(f))$ is a weak equivalence.
Since $X$ and $Y$ are cofibrant, the maps $\eta_X : X \to F^*(F_!(X))$ and $\eta_Y : Y \to F^*(F_!(Y))$ are weak equivalences.
Hence, $f$ is also a weak equivalence.
\end{proof}

Note that \cite[Proposition~3.3]{kap-lum-model} implies that, for all theories with identity types, $\Sigma$-types, and the unit type, the weak equivalences satisfy the 2-out-of-6 property.
Thus, the first condition of the previous lemma is often true.
We believe that this might be true more generally for all theories with only identity types, but the proofs become much harder without $\Sigma$-types.

Finally, let us prove an analogous lemma for strong Morita equivalences:

\begin{lem}
Let $T_1$ be a theory under $\IdT_0 + \transportT$.
If $T_2$ is a good theory and $F : T_1 \to T_2$ is a strong Morita equivalence, then $T_1$ is also good and $F_! \dashv F^*$ is a Quillen equivalence between $\Mod{T_1}$ and $\Mod{T_2}$.
\end{lem}
\begin{proof}
Since we have the transport operation, the homotopy relation is transitive.
This implies that weak equivalences are closed under composition.
It is also easy to see that if $f : X \to Y$ and $g : Y \to Z$ are maps such that $g$ and $g \circ f$ are weak equivalences, then $f$ is also a weak equivalence.
Now, the same proof as in the previous lemma shows that $F_!$ reflects weak equivalences.

By Theorem~4.2, Proposition~4.3, and Proposition~4.4 from \cite{f-model-structures}, the model structure on $\Mod{T_1}$ exists if there is a path object functor $P : \Mod{T_1} \to \Mod{T_1}$
such that $p : P(X) \to X \times X$ belongs to $\Jinj$ and $\pi_1 \circ p$ belongs to $\Iinj$.
We can define $P(X)$ as usual factorization of the diagonal $X \to X \times X$ into a map $t : X \to P(X)$ in $\Jcell$ followed by a map $p : P(X) \to X \times X$ in $\Jinj$.
Since $F_!$ preserves maps in $\Jcell$, the map $F_!(t)$ is a weak equivalence.
By the 2-out-of-3 property, the map $F_!(\pi_1 \circ p)$ is also a weak equivalence.
Since $F_!$ reflects weak equivalences, this implies that $\pi_1 \circ p$ is a weak equivalence.
Now, since $\pi_1 \circ p$ belongs to $\Jinj$, \cite[Proposition~3.1]{f-model-structures} implies that it also belongs to $\Iinj$.
\end{proof}

\section{Model structure on theories}

In this section we define a model structure on the category of algebraic dependent type theories with anough structure.

\subsection{Categories of theories}

It was shown in \cite{PHL} that partial Horn theories are equivalent to essentially algebraic theories.
It follows that categories of models of these theories are locally presentable.
In this subsection we will prove that different categories of theories are also locally finitely presentable.

We will consider a prestable theory $T$ under some prestable theory $B$.
Recall that a prestable theory is a theory $T$ with a map $\alpha : L(T) \to T$, where $L$ is a functor defined in \cite{alg-tt}.
It was shown in \cite[Lemma~4.4]{alg-tt} that every such theory is isomorphic to a contextual theory,
that is a theory which has $\mathcal{F}_B \amalg (\mathcal{F}_0 \times \mathbb{N})$,
$\mathcal{P}_B \amalg (\mathcal{P}_0 \times \mathbb{N})$ and $\mathcal{A}_B \amalg \mathcal{A}_0$ as the sets of function and predicate symbols and the set of axioms, respectively,
where $\mathcal{F}_0$, $\mathcal{P}_0$, and $\mathcal{A}_0$ are some sets and $\mathcal{F}_B$, $\mathcal{P}_B$, and $\mathcal{A}_B$ are the corresponding sets of $B$.
Elements of $\mathcal{F}_0$, $\mathcal{P}_0$ and $\mathcal{A}_0$ are called basic function symbols, basic predicate symbols, and basic axioms.

Now, we give an explicit construction of coproducts and coequalizers in the category $B/\PSt_{\mathcal{S}_0}$ of prestable theories under $B$,
which is similar to the one described in \cite[Proposition~2.12]{alg-tt} for the category of theories.
If $\{ T_i \}_{i \in I}$ is a set of theories under $B$, then the basic function and predicate symbols
and axioms of $\coprod_{i \in I} T_i$ are the disjoint union of corresponding sets of $T_i$.
If $f,g : T \to T'$ is a pair of maps of theories under $B$, then their coequalizer can be defined as
$T'$ together with the following axioms for every basic function symbol $\sigma$ and every basic predicate symbol $R$ of $T$:
\begin{align*}
& \sststile{}{x_1, \ldots x_k} f(\sigma(x_1, \ldots x_k)) \cong g(\sigma(x_1, \ldots x_k)) \\
& f(R(x_1, \ldots x_k)) \ssststile{}{x_1, \ldots x_k} g(R(x_1, \ldots x_k))
\end{align*}

The colimit of a diagram $T : I \to B/\PSt_{\mathcal{S}_0}$ can be described as the coequalizer of the coproduct $\coprod_{i \in I} T_i$ as usual.
Thus we can assume that the sets of basic function and predicate symbols of $\colim_{i \in I} T_i$ are disjoint unions of the corresponding sets of $T_i$.
The axioms of $\colim_{i \in I} T_i$ are axioms of $T_i$ together with axioms of the form $\sststile{}{x_1, \ldots x_n} \sigma(x_1, \ldots x_n) \cong f(\sigma(x_1, \ldots x_n))$
and $R(x_1, \ldots x_n) \ssststile{}{x_1, \ldots x_n} f(R(x_1, \ldots x_n))$ for every morphism $f : T_i \to T_j$
in the diagram and every function symbol $\sigma$ and predicate symbol $R$ of $T_i$ which are not symbols of $B$.

Let $\lambda$ be a regular cardinal.
We will say that a theory $T = ((\mathcal{S}, \mathcal{F}_0 \amalg \mathcal{F}, \mathcal{P}_0 \amalg \mathcal{P}), \mathcal{A}_0 \amalg \mathcal{A})$
in $\Th_B$ is \emph{$\lambda$-small} if cardinalities of sets $\mathcal{F}$, $\mathcal{P}$ and $\mathcal{A}$ are less than $\lambda$.
We will say that $T$ is \emph{finite} if it is $\aleph_0$-small.

\begin{prop}[theories-presentable]
The category of prestable theories under a prestable theory $B$ is locally finitely presentable.
An object of this category is $\lambda$-presentable if and only if it is isomorphic to a $\lambda$-small object.
\end{prop}
\begin{proof}
First, let us prove that every $\lambda$-small object is $\lambda$-presentable.
Let $\colim_{i \in I} T_i$ be a directed colimit of theories in $B/\PSt_{\mathcal{S}_0}$.
Every term and every formula of a theory is constructed from a finite number of function and predicate symbols.
Thus for every formula of $\colim_{i \in I} T_i$ there exists a theory $T_i$ such that this formula belongs to $T_i$.
The same is true for terms and restricted terms.

Every derivation of a theorem $\varphi \sststile{}{V} \psi$ is constructed from a finite number of function symbols, predicate symbols and axioms.
Thus for every theorem $\varphi \sststile{}{V} \psi$ of $\colim_{i \in I} T_i$ there exists a theory $T_i$ such that $\varphi \sststile{}{V} \psi$ is a theorem of $T_i$.
Note that the additional axioms of $\colim_{i \in I} T_i$ that was added for every $f : T_i \to T_j$ are always true in $T_j$.

Let $h : T \to \colim_{i \in I} T_i$ be a morphism from a $\lambda$-small theory $T$ to a $\lambda$-directed colimit of theories $\{ T_i \}_{i \in I}$.
Since $T$ is $\lambda$-small, there exists a theory $T_i$ such that for every function symbol $\sigma$, predicate symbol $R$ and axiom $\varphi \sststile{}{V} \psi$ of $T$,
restricted terms $h(\sigma(x_1, \ldots x_n))$ and formulae $h(R(x_1, \ldots x_n))$ belong to $T_i$, and $h(\varphi) \sststile{}{V} h(\psi)$ is a theorem of $T$.
Thus $h$ factors through $T_i$.

Let $h_1,h_2 : T \to T_i$ be morphisms such that $g_i \circ h_1 = g_i \circ h_2$, where $g_i : T_i \to \colim_{i \in I} T_i$.
Then for every function symbol $\sigma$ of $T$, sequent
\[ \sststile{}{x_1, \ldots x_n} h_1(\sigma(x_1, \ldots x_n)) \cong h_2(\sigma(x_1, \ldots x_n)) \]
is a theorem of $\colim_{i \in I} T_i$.
But we already know that there exists a theory $T_j$ such that $i \leq j$ and this sequent is a theorem of $T_j$.
The same is true for every predicate symbol of $T$.
It follows that $f \circ h_1 = f \circ h_2$, where $f : T_i \to T_j$.

Now, let us prove that $B/\PSt_{\mathcal{S}_0}$ is locally finitely presentable.
We only need to show that every theory in $B/\PSt_{\mathcal{S}_0}$ is a $\lambda$-directed colimit of its $\lambda$-small subtheories.
Let $T$ be a theory, and let $\{ f_i : T_i \to T' \}_{i \in I}$ be a cocone over the diagram of $\lambda$-small subtheories of $T$.
For every basic function or predicate symbol $p$ of $T$,
there is a finite subtheory $T_p$ of $T$ which contains symbols and axioms of $B$ and one additional symbol $p$ and no other axiom.
A morphism $h$ of cocones $T$ and $T'$ must commute with morphisms from $T_p$.
Thus it must be defined as $h(p(x_1, \ldots x_n)) = f_p(p(x_1, \ldots x_n))$; hence it is unique.
To prove that this defines a morphism, we need to show that $h$ preserves axioms of $T$.
But every axiom involes only a finite number of symbols of $T$.
Hence there exists a subtheory $T_i$ of $T$ which consists of these symbols and this axiom.
Since $f_i$ is a morphism of theories, this axiom also holds in $T'$.

Finally, let us prove that every $\lambda$-presentable theory $T$ in $B/\PSt_{\mathcal{S}_0}$ is isomorphic to a $\lambda$-small theory.
Consider the identity map $id_T : T \to T$.
Since $T$ is a $\lambda$-directed colimit of its $\lambda$-small subtheories, $id_T$ factors through some $\lambda$-small subtheory $T'$ of $T$.
Thus we have maps $f : T \to T'$ and $g : T' \to T$ such that $g \circ f = id_T$.
Since $T$ is a coequalizer of $f \circ g$ and $id_{T'}$, it is isomorphic to the coequalizer of $f \circ g$ and $id_{T'}$ as constructed above, which is a $\lambda$-small theory.
\end{proof}

\begin{cor}
The categories of stable and $c$-stable theories and categories of (stable, $c$-stable) algebraic dependent type theories are all locally finitely presentable.
\end{cor}
\begin{proof}
Each of this categories is a full reflective subcategory of the category of prestable theories closed under all colimits.
It follows from the previous propostion that they are locally finitely presentable.
\end{proof}

\subsection{Model structure}

Let $T_I = coe_1 + \sigma + Path + wUA$ be the theory defined in \cite{alg-models}.
In this subsection we define a model structure on the category $T_I/\algtt$ of algebraic dependent type theories under $T_I$.

To construct this model structure, we need to recall a few definitions from \cite{f-model-structures}.
A reflexive cylinder object $C_U(V)$ for a map $i : U \to V$ is any factorization of $[id_V,id_V] : V \amalg_U V \to V$.
Maps $f,g : V \to X$ are homotopic relative to a cylinder object $[\cyli_0,\cyli_1] : V \amalg_U V \to C_U(V)$, if there exists a map $h : C_U(V) \to X$
such that $h \circ \cyli_0 = f$ and $h \circ \cyli_1 = g$.
In this case we will write $f \sim_i g$.
We say that a map $f : X \to Y$ has RLP up to $\sim_i$ with respect to $i : U \to V$ if for every commutative square of the form
\[ \xymatrix{ U \ar[r]^u \ar@{}[dr]|(.7){\sim_i} \ar[d]_i & X \ar[d]^f \\
              V \ar[r]_v \ar@{-->}[ur]^g                  & Y,
            } \]
there is a dotted arrow $g : V \to X$ such that $g \circ i = u$ and $(f \circ g) \sim_i v$.
We will say that a map has RLP up to relative homotopy with respect to a set $\I$ of maps if it has RLP up to $\sim_i$ with respecto to every $i \in \I$.

We will also need the following theorem from \cite{f-model-structures}:
\begin{thm}[model-structure]
Let $\C$ be a complete and cocomplete category, and let $\I$ be a set of maps of $\C$
such that the domains and the codomains of maps in $\I$ are small relative to $\Icell$.
For every $i : U \to V \in \I$, choose a reflexive relative cylinder object $C_U(V)$
such that $[\cyli_0,\cyli_1] : V \amalg_U V \to C_U(V) \in \Icof$.
Let $\J_\I = \{\ \cyli_0 : V \to C_U(V)\ |\ i : U \to V \in \I \ \}$, and
let $\we_\I$ be the set of maps which have RLP up to relative homotopy with respect to $\I$.

Suppose that for all composable $f \in \Jcell[_\I] \cup \we_\I$ and $g$, if $g \circ f \in \we_\I$, then $g \in \we_\I$.
Then there exists a cofibrantly generated model structure on $\C$ with $\I$ as a set of generating cofibrations,
$\J_\I$ as a set of generating trivial cofibrations, and $\we_\I$ as a class of weak equivalences.
\end{thm}

For every sequence $(p_1,n_1), \ldots (p_{k+1},n_{k+1})$ of sorts, let $T_{(p_1,n_1), \ldots (p_{k+1},n_{k+1})}$ be the theory
with function symbols $\sigma_i : (p_1,n_1) \times \ldots \times (p_{i-1},n_{i-1}) \to (d_{p_i},n_i)$ for every $1 \leq i \leq k$,
$\sigma_{k+1} : (p_1,n_1) \times \ldots \times (p_k,n_k) \to (p_{k+1},n_{k+1})$,
and axioms $\varphi_1 \land \ldots \land \varphi_i \sststile{}{x_1, \ldots x_i} \sigma_{i+1}(x_1, \ldots x_i)\!\downarrow$ for every $1 \leq i \leq k$,
where $\varphi_j$ equals to $e_{p_j}(x_j) = \sigma_j(x_1, \ldots x_{j-1})$.
Let $\I$ be the set of maps of the form $T_{l, (d_p,n)} \to T_{l, (p,n)}$, where $l = s_1, \ldots s_k$ is any sequence of sorts,
$\sigma_i$ maps to $\sigma_i$ for every $1 \leq i \leq k$, and $\sigma_{k+1}$ maps to $e_p(\sigma_{k+1})$.
Let $\I_0 \subseteq \I$ be the subset which consists of the maps $T_{l, (d_p,n)} \to T_{l, (p,n)}$ such that $l$ is empty.

For every map in $\I$, we need to define a relative cylinder object for it.
Let $C_{T_{l,(ty,n)}}(T_{l,(tm,n)})$ be the theory with the same symbols and axioms as $T_l$,
three additional function symbol $\sigma, \sigma', h : s_1 \times \ldots \times s_k \to (tm,n)$,
and axioms making $h$ into a relative homotopy between $\sigma$ and $\sigma'$ with respect to $\varphi_1 \land \ldots \land \varphi_k$.
Analogously, we define $C_{T_{l,(ctx,n)}}(T_{l,(ty,n)})$ to be the theory with the same symbols and axioms as $T_l$,
seven additional function symbols $\sigma,\sigma' : s_1 \times \ldots \times s_k \to (ty,n)$, $f,g,g',p,q : s_1 \times \ldots \times s_k \to (tm,n+1)$,
and axioms making $(f,g,g',p,q)$ into a relative homotopy between $\sigma$ and $\sigma'$ with respect to $\varphi_1 \land \ldots \land \varphi_k$.
Maps $\cyli_0,\cyli_1 : T_{l,(tm,n)} \to C_{T_{l,(ty,n)}}(T_{l,(tm,n)})$ and their retraction
$s : C_{T_{l,(ty,n)}}(T_{l,(tm,n)}) \to T_{l,(tm,n)}$ are defined in the obvious way.

\begin{remark}[triv-fib-lift]
By \rprop{morita-char}, a map has RLP up to relative homotopy with respect to $\I$ if and only if it is a Morita equivalence.
Similarly, \rprop{syn-equiv-char} implies that a map has RLP up to relative homotopy with respect to $\I_0$ if and only if it is a syntactic equivalence.
\end{remark}

\begin{lem}[jcell-morita]
Let $f : X \to Y$ be a pushout of $\cyli_0 : T_{l,(tm,n)} \to C_{T_{l,(ty,n)}}(T_{l,(tm,n)})$ (in the category of $I$-stable theories under $T_I$)
and let $g : Y \to X$ be the retraction of $f$ which is the pushout of $s$.
Let $\varphi$ be a formula of $X$ such that for every predicate symbol $R$ occurring in $\varphi$,
sequent $R(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} \alpha(L(R))(I, I \times x_1, \ldots I \times x_k)$ is derivable in $X$.

Then for every term $t$ of $Y$ such that $f(\varphi) \sststile{}{V} t\!\downarrow$, terms $t$ and $f(g(t))$ are relatively homotopic with respect to $f(\varphi)$.
\end{lem}
\begin{proof}
This lemma is analogous to \cite[Lemma~3.7]{alg-models}.
We defined there a function $h : \Term_Y(V)_{(p,n)} \to \Term_Y(L(V))_{(p,n+1)}$ such that $h$ preserves theorems in the sense that
if $\chi \sststile{}{V} \psi$ is a theorem of $Y$, then $h(\chi) \land \bigwedge_{x \in L(V)} ctx^n(x) = I \sststile{}{L(V)} h(\psi)$ is also a theorem.
Note that $h(f(\varphi)) = \alpha(L(f(\varphi)))$ since $f(\varphi)$ contains only symbols of $X$.
The condition we put on $\varphi$ implies that sequent $f(\varphi) \sststile{}{V} h(f(\varphi))[\rho]$ is derivable, where $\rho(x) = I \times x$.
Thus we have the following theorem: $f(\varphi) \sststile{}{V} h(t)[\rho]\!\downarrow$.

Moreover, we have theorems $h(t)[\rho]\!\downarrow\ \sststile{}{V} h(t)[\rho][left] = f(g(t))$ and $h(t)[\rho]\!\downarrow\ \sststile{}{V} h(t)[\rho][right] = t$
(here, $[\rho]$ is an operation of substitution on terms and $[left]$ and $[right]$ are derived function symbols in the theory; we are sorry for this clash of the notation).
Thus $h(t)[\rho]$ gives us the required homotopy between $t$ and $f(g(t))$.
\end{proof}

\begin{thm}[theories-model-structure]
There exists a model structure on the category of $I$-stable algebraic dependent type theories under $T_I$
with $\I$ as the set of generating cofibrations, Morita equivalences as weak equivalences, and in which all objects are fibrant.
We call it \emph{the Morita model structure}.
\end{thm}
\begin{proof}
Note that the set $\we_\I$ consists of Morita equivalences.
Since Quillen equivalences satisfy the 2-out-of-3 property, by \rprop{morita-quillen}, Morita equivalences between theories under $T_I$ also satisfy it.
Since the codomains of maps in $\I$ are finite, Morita equivalences are closed under transfinite compositions.
Thus by \rthm{model-structure}, we just need to prove that pushouts of maps $\cyli_0 : T_{l,(p,n)} \to C_{T_{l,(d_p,n)}}(T_{l,(p,n)})$ are Morita equivalences.
Let $f : X \to Y$ be a pushout of $\cyli_0$ and let $g : Y \to X$ be its retract.
Let $\varphi$ be a formula of $X$ which does not contain any predicate symbols and let $A$ be a term of $X$ such that $\varphi \sststile{}{V} A\!\downarrow$.
Let $a$ be a term of $Y$ such that $f(\varphi) \sststile{}{V} e_p(a) = f(A)$.
If we define $a'$ as $g(a)$, then $\varphi \sststile{}{V} e_p(a') = A$ and the fact that $f(a')$ and $a$ are relatively homotopic follows from \rlem{jcell-morita}.
\end{proof}

\Rlem{jcell-morita} implies that trivial cofibrations satisfying a mild additional condition are strong Morita equivalences:

\begin{prop}
Let $f : T_1 \to T_2$ be a trivial cofibration such that for every predicate symbol $R$ of $T_1$,
sequent $R(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} \alpha(L(R))(I, I \times x_1, \ldots I \times x_k)$ is derivable.
Then $f$ is a strong Morita equivalence.
\end{prop}
\begin{proof}
Since trivial cofibrations are retracts of maps in $\Jcell[_\I]$ and strong Morita equivalences are closed under retracts,
we just need to prove that maps in $\Jcell[_\I]$ are strong Morita equivalences.
Since strong Morita equivalences are closed under transfinite compositions, we just need to prove this for maps $f$ which are pushouts of maps in $\Jcell[_\I]$.
Moreover, since maps in $\Jcell[_\I]$ do not change the set of predicate symbols,
we may assume that the domain and the codomain of $f$ satisfy the same condition on the predicate symbols as $T_1$.
Now, \rlem{jcell-morita} implies that such maps are strong Morita equivalences.
\end{proof}

Note that the domains and the codomains of maps in $\I$ do not have any predicate symbols.
Thus cofibrant objects also do not have them (to be precise, they are isomorphic to theories without predicate symbols).
So it seems rather pointless to have predicate symbols at this point.
We can consider the full subcategory $\algtt_f$ of $\algtt$ on theories without predicate symbols
(and without function symbols of the form $\sigma : s_1 \times \ldots \times s_k \to (ctx,0)$).
\Rprop{theories-presentable} still holds for $\algtt_f$, so this category is locally finitely presentable.
There is a model structure on $T_I/\algtt_f$ in which the classes of cofibrations, fibrations, and weak equivalences
are the intersections of the corresponding classes in $T_I/\algtt$ with the class of morphisms of $\algtt_f$.
This model category has the same sets of generating cofibrations and generating trivial cofibrations as $\algtt$.

\begin{prop}
The inclusion functor $T_I/\algtt_f \to T_I/\algtt$ has a right adjoint and this adjunction is a Quillen equivalence.
\end{prop}
\begin{proof}
We will say that a theory $T$ \emph{has enough function symbols} if for every restricted term $t$ of sort $s$ with free variables $x_1 : s_1$, \ldots $x_k : s_k$,
there is a function symbol $\sigma : s_1 \times \ldots \times s_k \to s$ such that sequent $\sststile{}{x_1, \ldots x_k} t \cong \sigma(x_1, \ldots x_k)$ is derivable.
Note that every theory $T$ is isomorphic to a theory $T'$ with enough function symbols.
Indeed, function symbols of $T'$ are just terms of the original theory and
axioms of $T'$ are axioms of $T$ together with axioms that say that the new terms are equivalent to the old ones.

Thus we may restrict and corestrict the inclusion functor $i : \algtt_f \to \algtt$ to the full subcategories of $\algtt_f$ and $\algtt$ on theories with enough function symbols.
We will denote this functor by $i' : \algtt'_f \to \algtt'$.
Now, it is easy to describe a right adjoint to $i'$.
For every theory $T \in \algtt'$, let $r'(T)$ be the theory with the same function symbols as $T$, no predicate symbols,
and with the set of axioms which consists of all theorems of $T$ which do not involve predicate symbols.
Then $r'$ is a functor $\algtt' \to \algtt'_f$.
It is easy to see that $r'$ is right adjoint to $i'$.
Since $i'(r'(T))$ and $T$ have the same sets of terms and theorems (which do not involve predicate symbols), the counit $\epsilon_T : i'(r'(T)) \to T$ is a trivial fibration.

Finally, note that the inclusion functor $T_I/i : T_I/\algtt_f \to T_I/\algtt$ preserves and reflects cofibrations and weak equivalences.
Moreover, it has a right adjoint and the counit of the adjunction is a trivial fibrations.
Thus this adjunction is a Quillen equivalence.
\end{proof}

Now, let us return to the original problem of the absence of predicate symbols in cofibrant objects.
Instead of forbidding predicate symbols completely, we can enlarge the class of cofibrations to include predicate symbols.
For every sequence of sorts $s_1, \ldots s_k$, let $P^1_{s_1, \ldots s_k}$ be the theory under $T_I$ with one additional predicate symbol $P : s_1 \times \ldots \times s_k$.
Also, we define the following theories:
\begin{align*}
P^2_{s_1, \ldots s_k} & = P^1_{s_1, \ldots s_k} \cup \{ Q : s_1 \times \ldots \times s_k, P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} Q(x_1, \ldots x_k) \} \\
P^3_{s_1, \ldots s_k} & = P^2_{s_1, \ldots s_k} \cup \{ R : s_1 \times \ldots \times s_k, Q(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} R(x_1, \ldots x_k) \}
\end{align*}
Let $\I^P$ be the union of $\I$ and maps of the form $P^1_l \to P^2_l$, $P \mapsto Q$ and $P^2_l \to P^3_l$, $P \mapsto P$, $Q \mapsto R$, where $l$ is any sequence of sorts.
We define a relative cylinder object for the map $P^\alpha_l \to P^{\alpha+1}_l$ as $P^{\alpha+1}_l \amalg_{P^\alpha_l} P^{\alpha+1}_l$, where $\alpha \in \{ 1, 2\}$.
Thus any two maps $P^{\alpha+1}_l \to X$ are homotopic.
This implies that $\we_{\I^P} = \we_\I$.
To prove that there is a model structure on $T_I/\algtt$ with $\I^P$ as a set of generating cofibrations,
we just need to show that pushouts of maps $P^{\alpha+1}_l \to P^{\alpha+1}_l \amalg_{P^\alpha_l} P^{\alpha+1}_l$ are Morita equivalences.
But this is obvious since the domain and the codomain of such a pushout have the same sets of terms and axioms.
Of course, the identity functor determine a Quillen equivalence between the two model structures on $T_I/\algtt$.

Finally, let us discuss another model structure on the category of $I$-stable theories under $T_I$, which we call \emph{the syntactic model structure}.
The weak equivalences of this model structure are syntactic equivalences, $\I_0$ is a set of generating cofibrations, and every object is fibrant in this model structure.

Recall that for every theory $T$, we have a left adjoint functor $\Lang_T : \Mod{T} \to T/\algtt$ with a right adjoint $\Syn_T : T/\algtt \to \Mod{T}$.
Note that a map $f : T_1 \to T_2$ of theories under $T_I$ is a syntactic equivalence if and only if $\Syn_{T_I}(f)$ is a weak equivalence of models.
Thus we can transfer the model structure on $\Mod{T_I}$ to a model structure on $T_I/\algtt$.
To do this, we need to prove that $\Lang_{T_I}$ maps trivial cofibrations to syntactic equivalences.
But we already proved that it actually maps them to Morita equivalences.
Note that the identity functor on $T_I/\algtt$ is a left Quillen functor from the syntactic model structure to the Morita model structure
since it preserves generating cofibrations and generating trivial cofibrations.

Let $T$ be an $I$-stable theory under $T_I$.
Then the adjunction $\Lang_T \dashv \Syn_T$ is a Quillen equivalence between the model structure on $\Mod{T}$ and the syntactic model structure on $T/\algtt$.
To prove this, we just need to show that the unit of the adjunction is a weak equivalence.
But it is actually an isomorphism since $\Lang_T$ is full and faithful.

\section{Confluent theories}

The axioms of type theories that occur in practice often can be divided in two parts: the first part determines when function symbols are defined and the second part is defined in terms of some reduction relation,
which often satisfies some additional properties such as confluence.
In this section we define confluent theories as theories in this form.
We also prove that Morita equivalences between them are easier to construct.

\subsection{Theories with simple axioms}

We will say that a theory is a \emph{maximal} theory with simple axioms if it is isomorphic to a theory in which the set of axioms consists of three disjoint parts $\mathcal{A}_d$, $\mathcal{A}'_d$, and $\mathcal{A}_e$ such that the following conditions hold:
\begin{enumerate}
\item The set $\mathcal{A}_d$ consists of axioms of the form $\varphi \sststile{}{x_1, \ldots x_k} \sigma(x_1, \ldots x_k)\!\downarrow$ and, for every $\sigma$, there is exactly one axiom of this form.
We will denote the left hand side of this axiom by $\varphi_\sigma$.
\item The set $\mathcal{A}'_d$ consists of sequents of the form $\sigma(x_1, \ldots x_k)\!\downarrow\ \sststile{}{x_1, \ldots x_k} \varphi_\sigma$.
\item For every axiom $\varphi \sststile{}{V} \psi$ in $\mathcal{A}_e$ and every subterm $\sigma(t_1, \ldots t_k)$ of the formula $\psi$,
the sequent $\varphi \sststile{}{V} \varphi_\sigma[t_1/x_1, \ldots t_k/x_k]$ is derivable from $\mathcal{A}_d \cup \mathcal{A}_e$.
\end{enumerate}
The \emph{minimal} theory with simple axioms corresponding to such theory is its subtheory with axioms $\mathcal{A}_d \cup \mathcal{A}_e$.
Finally, we will say that a theory \emph{has simple axioms} if it is (isomorphic to) a subtheory of a maximal theory containing the minimal subtheory.

\begin{lem}[der-simple-closed]
Let $T$ be a theory with simple axioms.
If a sequent $\sststile{}{} \psi$ is derivable in $T$, then it is derivable from $\mathcal{A}_d \cup \mathcal{A}_e$.
\end{lem}
\begin{proof}
First, let us prove the following fact.
If a sequent $\sststile{}{} \psi$ is derivable from $\mathcal{A}_d \cup \mathcal{A}_e$ and a term $\sigma(t_1, \ldots t_k)$ is a subterm of $\psi$,
then the sequent $\sststile{}{} \varphi_\sigma[t_1/x_1, \ldots t_k/x_k]$ is derivable from $\mathcal{A}_d \cup \mathcal{A}_e$.
We prove this by induction on the derivation of $\sststile{}{} \psi$ in the natural deduction system.
Let us consider the case \axref{nl}:
\begin{center}
\AxiomC{$\sststile{}{} a = b$}
\AxiomC{$\sststile{}{} \psi[a/x]$}
\RightLabel{\axref{nl}}
\BinaryInfC{$\sststile{}{} \psi[b/x]$}
\DisplayProof
\end{center}
If $\sigma(t_1, \ldots t_k)$ is a subterm of $b$, then the required property follows from the induction hypothesis for $\sststile{}{} a = b$.
Otherwise, $\sigma$ belongs to $\psi$ and there exist terms $t_1'$, \ldots $t_k'$ and a formula $\psi'$ such that $t_i = t_i'[b/x]$, $\psi = \psi'[\sigma(t_1', \ldots t_k')/x]$, and $x \notin FV(\psi')$.
Induction hypothesis implies that the sequent \[ \sststile{}{} \varphi_\sigma[t_1'[a/x]/x_1, \ldots t_k'[a/x]/x_k] \] is derivable.
Since the sequent $\sststile{}{} a = b$ is derivable, this implies that the required sequent $\sststile{}{} \varphi_\sigma[t_1/x_1, \ldots t_k/x_k]$ is also derivable.

Let us consider the inference rule for axioms from $\mathcal{A}_d$:
\smallskip
\begin{center}
\AxiomC{$\sststile{}{} s_i\!\downarrow$, $1 \leq i \leq n$}
\AxiomC{$\sststile{}{} \varphi_\tau[s_1/y_1, \ldots s_n/y_n]$}
\RightLabel{\axref{na}}
\BinaryInfC{$\sststile{}{} \tau(s_1, \ldots s_n)\!\downarrow$}
\DisplayProof
\end{center}
If $\sigma(t_1, \ldots t_k)$ is a subterm of $s_i$ for some $i$, then the required property follows from the induction hypothesis for $\sststile{}{} s_i\!\downarrow$.
Otherwise, $\tau(s_1, \ldots s_n) = \sigma(t_1, \ldots t_k)$ and the required property is obvious.
This inference rule for axioms from $\mathcal{A}_e$ follows from the assumption that we put on these axioms.
The rest of the inference rules are trivial.

Now, we can prove the lemma.
We proceed by induction on the inference of $\sststile{}{} \psi$.
The most cases follows immediately from the induction hypothesis.
The only nontrivial case is the inference rule for axioms from $\mathcal{A}'_d$:
\smallskip
\begin{center}
\AxiomC{$\sststile{}{} t_i\!\downarrow$, $1 \leq i \leq k$}
\AxiomC{$\sststile{}{} \sigma(t_1, \ldots t_k)\!\downarrow$}
\RightLabel{\axlabel{na}}
\BinaryInfC{$\sststile{}{} \varphi_\sigma[t_1/x_1, \ldots t_k/x_k]$}
\DisplayProof
\end{center}
By the induction hypothesis, the sequent $\sststile{}{} \sigma(t_1, \ldots t_k)\!\downarrow$ is derivable from $\mathcal{A}_d \cup \mathcal{A}_e$
and the fact that we just proved implies that $\sststile{}{} \varphi_\sigma[t_1/x_1, \ldots t_k/x_k]$ is also derivable from these axioms.
\end{proof}

\begin{lem}[morita-simple]
Let $T$ be a theory with simple axioms and let $(\varphi_1 \land \ldots \land \varphi_n, V)$ be a pair in $P_M$.
Then the theory $T_0 \cup \{ \sststile{}{} c_i\!\downarrow |\ 1 \leq i \leq n \} \cup \{ \varphi_i[c_1/x_1, \ldots c_i/x_i]\ |\ 1 \leq i \leq n \}$ also has simple axioms.
\end{lem}
\begin{proof}
If $\varphi_i$ equals to $e_{p_i}(x_i) = A_i$, then, for each $0 \leq i \leq n$, we define a theory $T_i$ as $T \cup \{ \sststile{}{} c_j\!\downarrow |\ 1 \leq j \leq i \} \cup \{ \varphi_j[c_1/x_1, \ldots c_j/x_j]\ |\ 1 \leq j \leq i \}$.
Since $T_n = T$, we just need to prove that all theories $T_i$ have simple axioms.
We proceed by induction on $i$.
Since $T_0 = T$, the case $i = 0$ holds by assumptions on $T$.
Assume that $T_i$ has simple axioms.
To prove that $T_{i+1}$ also has simples axioms, we need to show that, for every subterm $\sigma(t_1, \ldots t_k)$ of $A_{i+1}[c_1/x_1, \ldots c_i/x_i]$,
the sequent $\sststile{}{} \varphi_\sigma[t_1/x_1, \ldots t_k/x_k]$ is derivable from $\mathcal{A}_d \cup \mathcal{A}_e$.
Since the sequent $\sststile{}{} A_{i+1}[c_1/x_1, \ldots c_i/x_i]$ is derivable in $T_i$, the sequents $\sststile{}{} \sigma(t_1, \ldots t_k)\!\downarrow$ and $\sststile{}{} \varphi_\sigma[t_1/x_1, \ldots t_k/x_k]$ are also derivable in it.
Since $T_i$ has simple axioms, \rlem{der-simple-closed} implies that $\sststile{}{} \varphi_\sigma[t_1/x_1, \ldots t_k/x_k]$ is derivable from $\mathcal{A}_d \cup \mathcal{A}_e$ in $T_i$ and hence in $T_{i+1}$.
\end{proof}

\begin{prop}[der-simple]
Let $T$ be a theory with simple axioms and let $(\varphi,V)$ be a pair in $P_M$.
If a sequent $\varphi \sststile{}{V} \psi$ is derivable in $T$, then it is derivable from $\mathcal{A}_d \cup \mathcal{A}_e$.
\end{prop}
\begin{proof}
\Rlem{mcf} implies that $\sststile{}{} \psi[c_1/x_1, \ldots c_n/x_n]$ is derivable in $T \cup \mathcal{A}'$, where $\mathcal{A}' = \{ \sststile{}{} c_i\!\downarrow |\ 1 \leq i \leq n \} \cup \{ \varphi_i[c_1/x_1, \ldots c_i/x_i]\ |\ 1 \leq i \leq n \}$.
By \rlem{morita-simple} and \rlem{der-simple-closed}, this sequent is derivable from $\mathcal{A}_d \cup \mathcal{A}_e \cup \mathcal{A}'$.
\Rlem{mcf} implies that $\varphi \sststile{}{V} \psi$ is derivable from $\mathcal{A}_d \cup \mathcal{A}_e$.
\end{proof}

The previous proposition implies that the maps between theories with simple axioms corresponding to inclusions of subtheories are Morita equivalences.
This shows that if we are interested in a theory with simple axioms, then we can work with either minimal or maximal theory corresponding to it instead.
In general, we prefer to work with the latter, but sometimes it is convenient to switch to the former.

Note that relative $\I$-cell complexes are minimal theories with simples axioms.
We can define another set $\I'$ of generating cofibrations such that relative $\I'$-cell complexes are maximal theories with simples axioms.
Recall that $T_{(p_1,n_1), \ldots (p_{k+1},n_{k+1})}$ is the theory with function symbols $\sigma_i : (p_1,n_1) \times \ldots \times (p_{i-1},n_{i-1}) \to (d_{p_i},n_i)$ for every $1 \leq i \leq k$,
$\sigma_{k+1} : (p_1,n_1) \times \ldots \times (p_k,n_k) \to (p_{k+1},n_{k+1})$, and axioms $\varphi_1 \land \ldots \land \varphi_i \sststile{}{x_1, \ldots x_i} \sigma_{i+1}(x_1, \ldots x_i)\!\downarrow$ for every $1 \leq i \leq k$,
where $\varphi_j$ equals to $e_{p_j}(x_j) = \sigma_j(x_1, \ldots x_{j-1})$.
The set $\I$ consists of maps of the form $T_{l, (d_p,n)} \to T_{l, (p,n)}$.
We define $T'_{s_1, \ldots s_{k+1}}$ as $T_{s_1, \ldots s_{k+1}}$ together with the axiom $\sigma_{k+1}(x_1, \ldots x_k)\!\downarrow\ \sststile{}{x_1, \ldots x_k} \varphi_1 \land \ldots \land \varphi_k$.
Let $\I'$ be the set of maps of the form $T_{l, (d_p,n)} \to T'_{l, (p,n)}$.

Note that $\I'$ is a retract of $\I$.
Indeed, we can define a map $T'_{s_1, \ldots s_{k+1}} \to T_{s_1, \ldots s_{k+1}}$ as $\sigma_{k+1}(x_1, \ldots x_k) \mapsto \sigma_{k+1}(x_1, \ldots x_k)|_{\varphi_1 \land \ldots \land \varphi_k}$
and a map $T_{s_1, \ldots s_{k+1}} \to T'_{s_1, \ldots s_{k+1}}$ as the obvious inclusion.
Then the composite $T'_{s_1, \ldots s_{k+1}} \to T_{s_1, \ldots s_{k+1}} \to T'_{s_1, \ldots s_{k+1}}$ is the identity morphism.
Thus, the class of $\I'$-cofibrations is a subclass of $\I$-cofibrations.
Moreover, the composite $T_{s_1, \ldots s_{k+1}} \to T'_{s_1, \ldots s_{k+1}} \to T_{s_1, \ldots s_{k+1}}$ is homotopic to the identity morphism.
Hence a map has the weak lifting property with respect to $\I$ if and only if it has this property with respect to $\I'$.

It follows that there is another model structure on the category $T_I/\algtt$ in which all objects are fibrant, weak equivalences are Morita equivalences, and cofibrations are $\I'$-cofibrations.
The identity functor is a Quillen equivalence between this model structure and the model structure that we constructed in the previous section.

\subsection{Confluent theories}

In this subsection we define confluent theories and prove their properties.
First, we need to prove a simple lemma about general theories:

\begin{lem}[der-eq]
If a sequent $\varphi \sststile{}{V} t = s$ is derivable in a theory $T$, then there exist terms $t_1, \ldots t_n$ such that $t = t_1$, $s = t_n$, and, for every $1 \leq i < n$, $t_i = c[a/x]$ and $t_{i+1} = c[b/x]$
for some terms $a$, $b$, and $c$ such that there is a unique occurrence of the variable $x$ in $c$ and one of the following conditions hold:
\begin{enumerate}
\item There exists an application of \axref{na} in which the premise is derivable and the conclusion is either $\varphi \sststile{}{V} a = b$ or $\varphi \sststile{}{V} b = a$.
\item $\varphi = \varphi_1 \land \ldots \land \varphi_k$ and there exists $j$ such that $\varphi_j$ equals to either $a = b$ or $b = a$.
\end{enumerate}
\end{lem}
\begin{proof}
We prove this by induction on the derivation of $\varphi \sststile{}{V} t = s$.
The rules \axref{nv}, \axref{np}, and \axref{nf} are obvious.
The rules \axref{nh} and \axref{na} follow immediately from assumptions.
We can take $t_1 = a = t$, $t_2 = b = s$, and $c = x$.
Let us consider the rule \axref{ns}.
If $t_1$, \ldots $t_n$ is a sequence for $\varphi \sststile{}{V} s = t$, then we can take the sequence $t_n$, \ldots $t_1$ for $\varphi \sststile{}{V} t = s$.

Finally, let us consider the rule \axref{nl}:
\begin{center}
\AxiomC{$\varphi \sststile{}{V} p = q$}
\AxiomC{$\varphi \sststile{}{V} t'[p/y] = s'[q/y]$}
\RightLabel{\axref{nl}}
\BinaryInfC{$\varphi \sststile{}{V} t'[q/y] = s'[q/y]$}
\DisplayProof
\end{center}
Note that we may assume that there is a unique occurrence of the variable $y$ in $\psi$ since the general rule follows from this special case.
Let $t_1$, \ldots $t_n$ be a sequence for $\varphi \sststile{}{V} p = q$ and let $s_1$, \ldots $s_m$ be a sequence for $\varphi \sststile{}{V} t'[p/y] = s'[p/y]$.
Then $t'[t_n/y]$, \ldots $t'[t_1/y] = s_1$, \ldots $s_m = s'[t_1/y]$, \ldots $s'[t_n/y]$ is a sequence for $\varphi \sststile{}{V} t'[q/y] = s'[q/y]$.
\end{proof}

A \emph{term rewriting system} is a binary relation $R$ on the set of terms of some theory such that the following conditions hold:
\begin{enumerate}
\item If $R(t,s)$, then $FV(s) \subseteq FV(t)$.
\item If $R(t,s)$, then $t$ is not a variable.
\end{enumerate}
For a general introduction to term rewriting systems we refer the reader to \cite{Terese,klop-trs}.
If $R$ is a term rewriting system, then we define the relation $\Rightarrow_R$ on the set of terms as follows:
if $R(t,s)$, then $c[x \repl t[x_1 \repl t_1, \ldots x_k \repl t_k]] \Rightarrow_R c[x \repl s[x_1 \repl t_1, \ldots x_k \repl t_k]]$ for all $c$, $x_1$, \ldots $x_k$, and $t_1$, \ldots $t_k$.

A term rewriting system $R$ is \emph{confluent} if $t \Rightarrow_R^* s_1$ and $t \Rightarrow_R^* s_2$ implies that there exists $s$ such that
$s_1 \Rightarrow_R^* s$ and $s_2 \Rightarrow_R^* s$, where $\Rightarrow_R^*$ is the reflexive transitive closure of $\Rightarrow_R$.
If $\Rightarrow_1$ and $\Rightarrow_2$ are some relations, then we will write $\Rightarrow_1 \Rightarrow_2$ for the following relation:
$t \Rightarrow_1 \Rightarrow_2 t'$ if and only if there is a term $s$ such that $t \Rightarrow_1 s$ and $s \Rightarrow_2 t'$.
Now, we can define confluent theories:

\begin{defn}
A \emph{confluent} type theory is a type theory $T_0$ with simple axioms together a term rewriting system $R_0$ such that $\mathcal{A}_e = \{ t\!\downarrow\ \sststile{}{FV(t)} t = s\ |\ R_0(t,s) \}$
and, for every pair $(\varphi_1 \land \ldots \land \varphi_n, V)$ in $P_M$, the term rewriting system $R_1$ defined below is confluent.
The underlying theory of $R_1$ is $T_1 = T_0 \cup \{ \sststile{}{} c_i\!\downarrow |\ 1 \leq i \leq n \} \cup \{ \varphi_i[c_1/x_1, \ldots c_i/x_i]\ |\ 1 \leq i \leq n \}$.
If $\varphi_i$ equals to $e_{p_i}(x_i) = A_i$, then we define $R_1$ as $R_0 \cup \{ (e_{p_i}(c_i), A_i[c_1/x_1, \ldots c_{i-1}/x_{i-1}])\ |\ 1 \leq i \leq n \}$.
\end{defn}

Since many type theories are constructed as coproducts of simple basic theories, it is natural to ask whether coproducts preserve the confluence property.
If the confluence property is stable under the union in some class of theories, then we say that it is \emph{modular} for this class.
It was shown by Toyama in \cite{toyama} (see also \cite{klop-confluence,oostrom-confluence}) that the confluence is modular for disjoint theories.
There are many generalizations of this results for theories that may share particular kind of function symbols (see for instance \cite{ohlebusch-confluence,ohlebusch-composable,middeldorp-completeness}).
None of these results apply in our context since type theories can share arbitrary function symbols (actually, they always share $ft$, $ty$, $v_i$, and $\subst$, which already violates the assumptions of these results).
But we still can prove some simple general results about modularity of confluence for type theories.
For example, the following lemma shows that to prove that $(T_0,R_0)$ is confluent, it is often enough to show that $R_0$ is confluent.

\begin{lem}[morita-conf]
Let $(T_0,R_0)$ be a theory with a confluent term rewriting system on.
Suppose that the following conditions hold:
\begin{enumerate}
\item \label{it:lhs-cond} For every $t$ and $s$ such that $R_0(t,s)$, if $t$ contains a subterm of the form $e_p(t')$, then $t'$ is not a variable.
\item Either $R_0$ is left-linear or, for every $t$ and $s$ such that $R_0(t,s)$, if $s$ contains a subterm of the form $e_p(s')$, then $s'$ is not a variable.
\end{enumerate}
Then $(T_0,R_0)$ is confluent.
\end{lem}
\begin{proof}
First, let us assume that $R_0$ is left-linear (that is, if $R_0(t,s)$, then there is at most one occurrence of each variable in $t$).
Then we can show that $t \Rightarrow_{R_0} t_1$ and $t \Rightarrow_{R_1} t_2$ implies that there exists $t'$ such that $t_1 \Rightarrow_{R_1}^* t'$ and $t_2 \Rightarrow_{R_0} t'$, which implies that $R_0 \cup R_1$ is confluent.
If the redexes of these reductions are independent, then the claim is obvious.
The redex of $t \Rightarrow_{R_0} t_1$ cannot be inside the redex of $t \Rightarrow_{R_1} t_2$.
This means that the redex of $t \Rightarrow_{R_1} t_2$ must be inside of $t \Rightarrow_{R_0} t_1$.
Moreover, \eqref{it:lhs-cond} implies that these redexes do not intersect.
This means that $t_2$ contains the same $R_0$-redex, so it $\Rightarrow_{R_0}$-reduces to some term $t'$.
The term $t_1$ may contain several copies of the $R_1$-redex, so it $\Rightarrow_{R_1}^*$-reduces to $t'$.

Now, let us assume that if $R_0(t,s)$ and $s$ contains a subterm of the form $e_p(s')$, then $s'$ is not a variable.
This condition implies that $R_0$-reductions preserve $R_1$-normal forms (a term $t$ is in the $R_1$-normal form if there is no term $t'$ such that $t \Rightarrow_{R_1} t'$).
We will write $t \Rightarrow_{R_1}^{nf} t'$ if $t \Rightarrow_{R_1}^* t'$ and $t'$ is in the normal form.
Let us prove that $t \Rightarrow_{R_0} t_1$ and $t \Rightarrow_{R_1}^{nf} t_2$ implies that there exists $t'$ such that $t_1 \Rightarrow_{R_1}^{nf} t'$ and $t_2 \Rightarrow_{R_0} t'$.
Since $t \Rightarrow_{R_1}^{nf} t_2$ reduces all $R_1$-redexes to normal forms, if $t$ contains some equal subterms, then they will also be equal in $t_2$.
So $t_2$ contains the same $R_0$-redex as $t$ and $\Rightarrow_{R_0}$-reduces to a term $t'$.
Since $\Rightarrow_{R_0}$-reductions preserve $R_1$-normal forms, $t'$ is in the normal form, so $t_1 \Rightarrow_{R_1}^{nf} t'$.

The term rewriting system $R_1$ is not only confluent, but also strongly normalizable, that is, for every $t$, there is a unique $t'$ such that $t \Rightarrow_{R_1}^{nf} t'$.
We already proved that $t \Rightarrow_{R_0} t_1$ and $t \Rightarrow_{R_1}^{nf} t_2$ implies that there exists $t'$ such that $t_1 \Rightarrow_{R_1}^{nf} t'$ and $t_2 \Rightarrow_{R_0} t'$.
This implies that the same property holds if we replace $\Rightarrow_{R_0}$ with $\Rightarrow_{R_0}^*$.
Finally, note that the strong normalization property implies that if $t \Rightarrow_{R_0} t_1$ and $t \Rightarrow_{R_1}^* t_2$, then there exists $t'$ such that $t_1 \Rightarrow_{R_1}^{nf} t'$ and $t_2 \Rightarrow_{R_1}^{nf} \Rightarrow_{R_0} t'$.
It is easy to see that this implies that $R_0 \cup R_1$ is confluent.
\end{proof}

\begin{remark}
The first condition of the previous lemma is necessary, but we do not know whether this is true for the second condition.
\end{remark}

The main property of confluent theories is proved in the following proposition:

\begin{prop}[conf-main]
Let $(T_0,R_0)$ be a confluent theory and let $(\varphi,V)$ be a pair in $P_M$.
If a sequent $\varphi \sststile{}{V} t = s$ is derivable in $T_0$, then there exists a term $r$ of $T_1$ such that $t[c_1/x_1, \ldots c_n/x_n] \Rightarrow_{R_1}^* r$ and $s[c_1/x_1, \ldots c_n/x_n] \Rightarrow_{R_1}^* r$.
\end{prop}
\begin{proof}
By \rlem{mcf}, the sequent $\sststile{}{} t' = s'$ is derivable in $T_1$, where $t' = t[c_1/x_1, \ldots c_n/x_n]$ and $s' = s[c_1/x_1, \ldots c_n/x_n]$.
By \rlem{der-eq} and \rprop{der-simple}, there exists a sequence $t_1$, \ldots $t_n$ such that $t' = t_1$, $s' = t_n$, and, for every $1 \leq i < n$, either $t_i \Rightarrow_{R_1} t_{i+1}$ or $t_{i+1} \Rightarrow_{R_1} t_i$.
Since $R_1$ is confluent, this implies that $t' \Rightarrow_{R_1}^* r$ and $s' \Rightarrow_{R_1}^* r$.
\end{proof}

We can define a relative version of confluent theories:

\begin{defn}
A \emph{confluent extension} of a theory $T$ is a confluent theory $(T',R')$ such that $T \subseteq T'$ and, for every term $t$ of $T$ and every term $s$ of $T'$ such that $R'(t,s)$,
the term $s$ also belongs to $T$ and $t\!\downarrow\ \sststile{}{FV(t)} t = s$ is derivable in $T$.
A \emph{confluent morphism} is a morphism of theories that isomorphic to the inclusion of some theory into its confluent extension.
\end{defn}

The following proposition shows that confluent maps are conservative in a certain sense:

\begin{prop}
Let $f : T \to T'$ be a confluent map and let $(\varphi,V)$ be a pair in $P_M$.
If $f(\varphi) \sststile{T'}{V} f(t) = f(s)$, then $\varphi \sststile{T}{V} t = s$.
\end{prop}
\begin{proof}
By \rlem{mcf}, we may assume that $\varphi = \top$ and $V = \varnothing$.
By \rprop{conf-main}, there exists a term $r$ such that $f(t) \Rightarrow_{R_1}^* r$ and $f(s) \Rightarrow_{R_1}^* r$.
Since both terms $f(t)$ and $f(s)$ belong to $T$, all of the reduction rules used in these sequences are derivable in $T$ by the definition of a confluent extension.
\end{proof}

\section{Characterization of lifting properties}

In this section we prove several useful lemmas that characterize trivial fibrations in various model structures that we considered in previous section.
Since all of these notations are defined in terms of lifting properties, we will prove general results about them.
Indeed, if we think about a map that has the weak lifting property with respect to a pair $V,\varphi$ as a weak equivalence,
then a map having the lifting property with respect to this pair can be thought of as a trivial fibration.
We begin with a simple lemma:

\begin{lem}[eq-char-fib]
Let $V$ be a set of variables and let $\varphi$ be a formula of a theory $T_1$ with free variables in $V$.
Let $f : T_1 \to T_2$ be a morphism of theories such that the following conditions hold:
\begin{enumerate}
\item \label{it:char-fun-fib} For every function symbol $\sigma$ of $T_2$, there exist terms $A_1$, \ldots $A_k$, $t$ of $T_1$ such that $FV(A_i) \subseteq \{ x_1, \ldots x_{i-1} \}$ and the following sequents are derivable:
\begin{align*}
\bigwedge_{1 \leq i < j} e_{p_i}(x_i) = A_i & \sststile{T_1}{x_1, \ldots x_{j-1}} A_j\!\downarrow \text{ for every } 1 \leq j \leq k \\
\bigwedge_{1 \leq i \leq k} e_{p_i}(x_i) = A_i & \sststile{T_1}{x_1, \ldots x_k} t\!\downarrow \\
\sigma(x_1, \ldots x_k)\!\downarrow & \sststile{T_2}{x_1, \ldots x_k} f(t) = \sigma(x_1, \ldots x_k) \land \bigwedge_{1 \leq i \leq k} e_{p_i}(x_i) = f(A_i)
\end{align*}
\item \label{it:char-type-fib} For all terms $A$, $B$, and $a$ of $T_1$ such that $\varphi \sststile{T_1}{V} e_p(a) = A$ and $f(\varphi) \sststile{T_2}{V} f(A) = f(B)$,
there exists a term $b$ such that $\varphi \sststile{T_1}{V} e_p(b) = B$ and $f(b)$ equals to $f(a)$.
\end{enumerate}
Then $f$ has the lifting property with respect to $V,\varphi$.
\end{lem}
\begin{proof}
Let $A$ and $a$ be terms such that $\varphi \sststile{}{V} A\!\downarrow$ and $f(\varphi) \sststile{}{V} e_p(a) = f(A)$.
Then we construct the required lifting by induction on $a$.
If $a = x$ is a variable, then \eqref{it:char-type-fib} implies that that the required lifting exists.

Now, suppose that $a = \sigma(a_1, \ldots a_k)$.
Let $A_1$, \ldots $A_k$, $t$ be terms as described in \eqref{it:char-fun-fib}.
By induction hypothesis, there exist terms $a_1'$, \ldots $a_k'$ such that $\varphi \sststile{}{V} e_{p_i}(a_i') = A_i[x_1 \repl a_1', \ldots x_{i-1} \repl a_{i-1}']$ and $f(\varphi) \sststile{}{V} f(a_i') = a_i$.
Let $a' = t[x_1 \repl a_1', \ldots x_k \repl a_k']$.
Since $\varphi \sststile{}{V} a'\!\downarrow$ and $f(\varphi) \sststile{}{V} f(a') = f(a)$, \eqref{it:char-type-fib} implies that there exists the required lifting.
\end{proof}

\begin{remark}[stable-eq-char-fib]
If $T_2$ is a stable contextual theory, then it is enough to check the first condition of the previous lemma for basic function symbols.
It is easy to see that this implies the general case.
\end{remark}

Now, we want to simplify conditions of \rlem{eq-char-fib}.
It is easy to do this for the second one:

\begin{lem}[char-type-fib]
Let $V$ be a set of variables and let $\varphi$ be a formula of a theory $T_1$ with free variables in $V$.
Let $f : T_1 \to T_2$ be a morphism of theories such that the following condition holds.
For every pair of terms $A$ and $B$ of $T_1$ of sort $(ty,n)$ such that
$\varphi \sststile{T_1}{V} ft(A) = ft(B)$ and $f(\varphi) \sststile{T_2}{V} f(A) = f(B)$,
there exists a term $b$ such that $\varphi \sststile{T_1}{V} A \vdash b : B$ and $f(b)$ equals to $v_0(f(A))$.
Then the second condition of \rlem{eq-char-fib} holds.
\end{lem}
\begin{proof}
First, note that if $\Gamma$ and $\Delta$ are context such that $\varphi \sststile{T_1}{V} \Gamma\!\!\downarrow\!\land\:\Delta\!\!\downarrow$ and $f(\varphi) \sststile{T_2}{V} f(\Gamma) = f(\Delta)$,
then there is a morphism of context $d : \Gamma \to \Delta$ such that $f(d)$ is the identity morphism.
We prove this by induction on the length of contexts.
There is a unique morphism between empty contexts.
If contexts are not empty, then we have a morphism $d : ft(\Gamma) \to ft(\Delta)$ by induction hypothesis.
Since $f(d^*(\Delta))$ equals to $f(\Gamma)$, we have a term $\Gamma \vdash b : d^*(\Delta)$ such that $f(b)$ equals to $v_0(f(\Gamma))$ by assumption.
Thus, $d,b$ is the required morphism of contexts $\Gamma$ and $\Delta$.

For all terms $A$, $B$, and $a$ of $T_1$ such that $\varphi \sststile{T_1}{V} e_p(a) = A$ and $f(\varphi) \sststile{T_2}{V} f(A) = f(B)$,
there exists a term $b$ such that $\varphi \sststile{T_1}{V} e_p(b) = B$ and $f(\varphi) \sststile{T_2}{V} f(a) = f(b)$.
We have a morphism $d : A \to B$ such that $f(d)$ equals to the identity morphism.
if $p = ty$, then we can define $b$ as $d^*(a)$.
if $p = tm$, then let $B = d^*(ty(a))$.
Since $f(B) = f(ty(a))$, we have a term $ty(a) \vdash b' : B$ such that $f(b')$ equals to $v_0(f(B))$ by assumption.
Then we can define $b$ as $b'[d^*(a)]$.
\end{proof}

If we want to simplify the first condition of \rlem{eq-char-fib}, then we need certain assumptions on the theory $T_2$.
We will say that a theory \emph{has well-defined function symbols} if (it is isomorphic to a theory such that) there exists a well-founded relation on the set of function symbols such that,
for every function symbol $\sigma$, either $\sigma$ equals to one of the function symbols $ty_n$, $ft_n$ or there exist terms $A_1$, \ldots $A_k$ satisfying the following conditions:
\begin{enumerate}
\item All function symbols that occur in $A_1$, \ldots $A_k$ are less than $\sigma$.
\item $FV(A_i) \subseteq \{ x_1, \ldots x_{i-1} \}$ for every $1 \leq i \leq k$.
\item The following sequents are derivable:
\begin{align*}
\bigwedge_{1 \leq i < j} e_{p_i}(x_i) = A_i & \sststile{}{x_1, \ldots x_{j-1}} A_j\!\downarrow \text{ for every } 1 \leq j \leq k \\
\bigwedge_{1 \leq i \leq k} e_{p_i}(x_i) = A_i & \ssststile{}{x_1, \ldots x_k} \sigma(x_1, \ldots x_k)\!\downarrow
\end{align*}
\end{enumerate}
We will say that terms $A_1$, \ldots $A_k$ \emph{define} the function symbol $\sigma$.

This condition is easy to check and most of the theories that occur in practice satisfy it.
An example of a theory that does not satisfy it appeared in \cite{alg-models}: it is the theory of filler operations.
The rest of the theories that appear in \cite{alg-models} and also all of the theories in this paper and in \cite{alg-tt} have well-defined function symbols.

\begin{lem}[eq-comp-char-fib]
Let $V$ be a set of variables and let $\varphi$ be a formula of a theory $T_1$ with free variables in $V$.
Let $f : T_1 \to T_2$ be a morphism of theories such that $T_2$ has well-defined function symbols.
Suppose that the second condition of \rlem{eq-char-fib} holds.
Moreover, suppose that, for every function symbol $\sigma$ of $T_2$, either the first condition of \rlem{eq-char-fib} holds for $\sigma$ or,
for every pair $\{ x_1, \ldots x_k \},\psi$ in $P_M$, if $f(\psi) \sststile{T_2}{x_1, \ldots x_k} \sigma(x_1, \ldots x_k)\!\downarrow$ is derivable, then there exists a term $t$ of $T_1$ such that the following sequents are derivable:
\begin{align*}
\psi & \sststile{T_1}{x_1, \ldots x_k} t\!\downarrow \\
f(\psi) & \sststile{T_2}{x_1, \ldots x_k} \sigma(x_1, \ldots x_k) = f(t)
\end{align*}
Then the first condition of \rlem{eq-char-fib} holds.
\end{lem}
\begin{proof}
First, note that if the first condition of \rlem{eq-char-fib} holds for some subset of function symbols of $T_2$, then we still can lift terms constructed from function symbols from this subset.
The proof of this fact is the same as the proof of \rlem{eq-char-fib}.
We also note that symbols $ty_n$ and $ft_n$ satisfy the first condition of \rlem{eq-char-fib}, so we may assume that they are less than every other symbol.

Now, we can prove by well-founded induction on $\sigma$ that the first condition of \rlem{eq-char-fib} holds.
If it holds for $\sigma$, then we are done.
Otherwise, let $A_1$, \ldots $A_k$ be terms that define $\sigma$.
By induction hypothesis, there exist lifts $A_1'$, \ldots $A_k'$ of these terms (we first lift $ft^{n_i}(e_{p_i}(A_i))$, then $ft^{n_i-1}(e_{p_i}(A_i))$, and so on; finally, we can lift $A_i$).
If we let $\psi = (\bigwedge_{1 \leq i \leq k} e_{p_i}(x_i) = A_i')$, then $f(\psi) \sststile{T_2}{x_1, \ldots x_k} \sigma(x_1, \ldots x_k)\!\downarrow$.
Thus, by assumption, we have a term $t$ such that $\psi \sststile{T_1}{x_1, \ldots x_k} t\!\downarrow$ and $f(\psi) \sststile{T_2}{x_1, \ldots x_k} f(t) = \sigma(x_1, \ldots x_k)$.
Since $\sigma(x_1, \ldots x_k)\!\downarrow\ \sststile{T_2}{x_1, \ldots x_k} f(\psi)$, we are done.
\end{proof}

Finally, we can show that the conditions of the previous lemmas are often not only sufficient, but also necessary:

\begin{prop}[eq-comp-char-fib]
Let $P$ be a set such that $P_M \subseteq P \subseteq P_S$.
If $f : T_1 \to T_2$ is a morphism of theories such that $T_2$ has well-defined function symbols, then the following conditions are equivalent:
\begin{enumerate}
\item \label{it:lem-fib-sec} The first condition of \rlem{eq-char-fib} and conditions of \rlem{char-type-fib} hold for all pairs in $P$.
\item \label{it:lem-fib} Both conditions of \rlem{eq-char-fib} hold for all pairs in $P$.
\item \label{it:eq-fib} $f$ has the lifting property with respect to $P$.
\item \label{it:cond-fib} Conditions of \rlem{eq-comp-char-fib} hold for all pairs in $P$.
\end{enumerate}
\end{prop}
\begin{proof}
The implication \eqref{it:lem-fib-sec} $\implies$ \eqref{it:lem-fib} follows from \rlem{char-type-fib}.
The implication \eqref{it:lem-fib} $\implies$ \eqref{it:eq-fib} follows from \rlem{eq-char-fib}.
The implication \eqref{it:eq-fib} $\implies$ \eqref{it:cond-fib} is obvious since conditions in \eqref{it:cond-fib} are just special cases of the lifting property.
Finally, \eqref{it:cond-fib} implies \eqref{it:lem-fib} by \rlem{eq-comp-char-fib}, and conditions of \rlem{char-type-fib} are a special case of the lifting property, hence they follow from \eqref{it:eq-fib}.
\end{proof}

Let us also prove an analog of \rlem{eq-char-fib} for weak lifting properties:

\begin{lem}[eq-char-eq]
Let $V$ be a set of variables and let $\varphi$ be a formula of a theory $T_1$ with free variables in $V$.
Let $f : T_1 \to T_2$ be a morphism of theories such that the following conditions hold:
\begin{enumerate}
\item \label{it:char-fun-eq} For every function symbol $\sigma$ of $T_2$, there exist terms $A_1$, \ldots $A_k$, $t$ of $T_1$ such that $FV(A_i) \subseteq \{ x_1, \ldots x_{i-1} \}$ and the following sequents are derivable:
\begin{align*}
\bigwedge_{1 \leq i < j} e_{p_i}(x_i) = A_i & \sststile{T_1}{x_1, \ldots x_{j-1}} A_j\!\downarrow \text{ for every } 1 \leq j \leq k \\
\bigwedge_{1 \leq i \leq k} e_{p_i}(x_i) = A_i & \sststile{T_1}{x_1, \ldots x_k} t\!\downarrow \\
\sigma(x_1, \ldots x_k)\!\downarrow & \sststile{T_2}{x_1, \ldots x_k} e_p(f(t)) = e_p(\sigma(x_1, \ldots x_k)) \land \bigwedge_{1 \leq i \leq k} e_{p_i}(x_i) = f(A_i)
\end{align*}
Moreover, $f(t)$ is homotopic to $\sigma(x_1, \ldots x_k)$ with respect to $\sigma(x_1, \ldots x_k)\!\downarrow$.
\item \label{it:char-type-eq} For all terms $A$, $B$, and $a$ of $T_1$ such that $\varphi \sststile{T_1}{V} e_p(a) = A$ and $f(\varphi) \sststile{T_2}{V} f(A) = f(B)$,
there exists a term $b$ such that $\varphi \sststile{T_1}{V} e_p(b) = B$ and $f(b)$ is relatively homotopic to $f(a)$ with respect to $f(\varphi)$.
\end{enumerate}
Then $f$ has the weak lifting property with respect to $V,\varphi$.
\end{lem}
\begin{proof}
The proof of this lemma is essentially the same as the proof of \rlem{eq-char-fib}.
\end{proof}

We do not have an analog of \rprop{eq-comp-char-fib}, so this lemma is not always applicable, but it is still useful for constructing particular examples of Morita equivalences.

\section{Examples of Morita equivalences}

In this section we construct several examples of Morita equivalences.

\subsection{Properness of the model categories of models}

Let us show that the model category of models of a confluent theory is proper:

\begin{prop}
Let $T$ be a confluent theory under $\coeT_1 + \sigma + \PathT + \wUA$ with well-defined function symbols.
Then the category of models of $T$ is proper model category
\end{prop}
\begin{proof}
Since all objects of $\Mod{T}$ are fibrant, this category is right proper.
To prove that it is left proper, we just need to prove that trivial fibrations are closed under the operation of attaching a single term or type.
To be more precise, we need to prove that for every trivial fibration $f : X \to Y$ in $\Mod{T}$ and every map $F(\{ A : (d_p,n) \}) \to X$,
the following pushout of $f$ is also a trivial fibration:
\[ \xymatrix{ X \ar[r] \ar[d]_f &     X \amalg_{F(\{ A : (d_p,n) \})} F(\{ e_p(a) = A \}) \ar[d] \\
              Y \ar[r]          & \po Y \amalg_{F(\{ A : (d_p,n) \})} F(\{ e_p(a) = A \})
            } \]

Since $\Lang$ is a left adjoint, we have the following pushout square:
\[ \xymatrix{ \Lang(X) \ar[r] \ar[d]_\Lang(f) &     \Lang(X) \amalg_{\{ A : (d_p,n) \}} \{ e_p(a) = A \} \ar[d] \\
              \Lang(Y) \ar[r]                 & \po \Lang(Y) \amalg_{\{ A : (d_p,n) \}} \{ e_p(a) = A \}
            } \]
A map $g$ of models is a trivial fibration if and only if $\Lang(g)$ has the lifting property with respect to $P_0$.
Thus it is enough to show that conditions of \rlem{eq-char-fib} hold for this pushout of $\Lang(f)$.
The first condition is easy to prove.
If $\sigma$ is a function symbol of $T$ or $\sigma = a$, then we can lift it to itself.
If $\sigma = O_y$ for some $y \in Y$, then we can lift it to $O_x$, where $x \in X$ is a lift of $y$

TODO
\end{proof}

% confluent maps are closed under transfinite compositions.

% to construct the structure of a cofibration category, it is enough to prove that trivial fibrations between confluent theories are preserved by pushouts along confluent maps. The first condition is easy since we can forget about additional axioms of the confluent map. The second condition follows from the general construction of lifting equivalences.

% trivial fibrations are closed under pushouts along weak cofibrations, in particular weak equivalences are closed under coproducts
% a structure of a cofibrations category on a large class of theories
% the universe functor preserves trivial fibrations and hence weak equivalences
% equivalence between the model structure and the structure of a cofibration category.

% adding terms of contractible types (maybe with some judgemental rules) is a Morita equivalence (in particular, squeeze)
% strictly associative concatenation of paths is a Morita equivalence
% strictly commutative concatenation of 2-paths is not a Morita equivalence
% three different versions of Sigma are Morita equivalent
% arrows and pi types are Morita equivalent
% cofibrant replacement of theories (in particular, Id_- for Id, also Sigma and other simple theories)
% equivalence between theories in which function symbols are well-defined and in which they are not

% Coproducts of theories
% The universe functor preserves Morita equivalences

% T -> T + coe_1 + \sigma + Path + wUA is a Morita equivalence

\subsection{Strict associativity}

Consider theory $T_0 = Id_-$.
Let $T_a$ be a theory under $T_0$ with the following additional function symbol:
\[ \conc : (tm,n) \times (tm,n) \times (tm,n) \times (tm,n) \times (tm,n) \to (tm,n) \]
We will usually left implicit the first three arguments of $\conc$.
Theory $T_a$ has the following axiom:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash p : \Id(a_1,a_2)$}
\AxiomC{$\Gamma \vdash q : \Id(a_2,a_3)$}
\BinaryInfC{$\Gamma \vdash \conc(p,q) : \Id(a_1,a_3)$}
\DisplayProof
\end{center}
where $a_1$, $a_2$ and $a_3$ have the same type $A$.
That is, this rule has additional premises $\Gamma \vdash a_i : A$, but we left them implicit.
We will often left implicit some premises if they can be derived from other premises.

The rest of the axioms of $T_a$ is listed below.
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash p : \Id(a_1,a_2)$}
\UnaryInfC{$\Gamma \vdash \conc(p,\refl(a_2)) \equiv p : \Id(a_1,a_2))$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash p : \Id(a_1,a_2)$}
\UnaryInfC{$\Gamma \vdash \conc(\refl(a_1),p) \equiv p : \Id(a_1,a_2)$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash p : \Id(a_1,a_2)$}
\AxiomC{$\Gamma \vdash q : \Id(a_2,a_3)$}
\AxiomC{$\Gamma \vdash r : \Id(a_3,a_4)$}
\TrinaryInfC{$\Gamma \vdash \congI(\conc(p,q),r) \equiv \conc(p,\congI(q,r)) : \Id(a_1,a_4)$}
\DisplayProof
\end{center}

Thus $T_a$ is a theory with a strictly associative concatination function for paths.
Moreover, $\refl$ is a strict identity for $\conc$.
We are going to prove that $f : T_0 \amalg_T T' \to T_a \amalg_T T'$ is a Morita equivalence.
We can define a pseudomorphism $g' : T_a \amalg_T T' \to T_0 \amalg_T T'$ so that $g'$ preserves substitutions and variables,
for every term $t$ of $T_0 \amalg_T T'$, $g'(f(t)) = t$, and $g'(\conc)$ is any concatination function.
This pseudomorphism does not preserves the last three axioms of $T_a$, and thus it is not a morphism.
To fix this problem, we need to apply a normalization function first.

First, we define a reduction relation $\red$ on terms as the minimal reflexive and transitive relation
which is closed under substitution and contains a set of rules which are listed below.
These rules are simply (some of) the axioms of $T_a$ in which we choose a direction of reduction.
\begin{align*}
ctx(\sigma(\Gamma, a_1, \ldots a_k)) & \red \Gamma \\
ty(\subst(\Gamma, a, a_1, \ldots a_k)) & \red \subst(\Gamma, ty(a), a_1, \ldots a_k) \\
ty(v_{n,i}(\Gamma)) & \red \subst(\Gamma, ft^i_{n-i}(\Gamma), c_{n-1}, \ldots c_{i+1}) \\
\subst(\Gamma, v_i(A), a_1, \ldots a_k) & \red a_{k-i} \\
\subst(\Gamma, a, v_{n-1}(A_n), \ldots v_0(A_0)) & \red a \\
\subst(\Gamma, \subst(\Delta, a, a_1, \ldots a_m), b_1, \ldots b_k) & \red \subst(\Gamma, a, a_1' \ldots a_k') \\
\conc(p,\refl(a_2)) & \red p \\
\conc(\refl(a_1),p) & \red p \\
\conc(\conc(p,q),r) & \red \conc(p,\conc(q,r))
\end{align*}
where the first rule is defined for every function symbol $\sigma$,
in the third rule, $c_i$ is $v_{n,i}(\Gamma)$,
and in the sixth rule, $a_i'$ is $\subst(\Gamma, a_i, b_1, \ldots b_k)$.

It is easy to show that these reduction rules define a confluent and terminating rewriting system using standard techniques as described, for example, in \cite{Terese}.
We define a pseudomorphism $\nf : T_a \to T_a$ as follows:

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
