\documentclass{amsart}

\usepackage{amssymb}
\usepackage[all]{xy}
\usepackage{verbatim}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{turnstile}

\renewcommand{\turnstile}[6][s]
    {\ifthenelse{\equal{#1}{d}}
        {\sbox{\first}{$\displaystyle{#4}$}
        \sbox{\second}{$\displaystyle{#5}$}}{}
    \ifthenelse{\equal{#1}{t}}
        {\sbox{\first}{$\textstyle{#4}$}
        \sbox{\second}{$\textstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{s}}
        {\sbox{\first}{$\scriptstyle{#4}$}
        \sbox{\second}{$\scriptstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{ss}}
        {\sbox{\first}{$\scriptscriptstyle{#4}$}
        \sbox{\second}{$\scriptscriptstyle{#5}$}}{}
    \setlength{\dashthickness}{0.111ex}
    \setlength{\ddashthickness}{0.35ex}
    \setlength{\leasturnstilewidth}{2em}
    \setlength{\extrawidth}{0.2em}
    \ifthenelse{%
      \equal{#3}{n}}{\setlength{\tinyverdistance}{0ex}}{}
    \ifthenelse{%
      \equal{#3}{s}}{\setlength{\tinyverdistance}{0.5\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{d}}{\setlength{\tinyverdistance}{0.5\ddashthickness}
        \addtolength{\tinyverdistance}{\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{t}}{\setlength{\tinyverdistance}{1.5\dashthickness}
        \addtolength{\tinyverdistance}{\ddashthickness}}{}
        \setlength{\verdistance}{0.4ex}
        \settoheight{\lengthvar}{\usebox{\first}}
        \setlength{\raisedown}{-\lengthvar}
        \addtolength{\raisedown}{-\tinyverdistance}
        \addtolength{\raisedown}{-\verdistance}
        \settodepth{\raiseup}{\usebox{\second}}
        \addtolength{\raiseup}{\tinyverdistance}
        \addtolength{\raiseup}{\verdistance}
        \setlength{\lift}{0.8ex}
        \settowidth{\firstwidth}{\usebox{\first}}
        \settowidth{\secondwidth}{\usebox{\second}}
        \ifthenelse{\lengthtest{\firstwidth = 0ex}
            \and
            \lengthtest{\secondwidth = 0ex}}
                {\setlength{\turnstilewidth}{\leasturnstilewidth}}
                {\setlength{\turnstilewidth}{2\extrawidth}
        \ifthenelse{\lengthtest{\firstwidth < \secondwidth}}
            {\addtolength{\turnstilewidth}{\secondwidth}}
            {\addtolength{\turnstilewidth}{\firstwidth}}}
        \ifthenelse{\lengthtest{\turnstilewidth < \leasturnstilewidth}}{\setlength{\turnstilewidth}{\leasturnstilewidth}}{}
    \setlength{\turnstileheight}{1.5ex}
    \sbox{\turnstilebox}
    {\raisebox{\lift}{\ensuremath{
        \makever{#2}{\dashthickness}{\turnstileheight}{\ddashthickness}
        \makehor{#3}{\dashthickness}{\turnstilewidth}{\ddashthickness}
        \hspace{-\turnstilewidth}
        \raisebox{\raisedown}
        {\makebox[\turnstilewidth]{\usebox{\first}}}
            \hspace{-\turnstilewidth}
            \raisebox{\raiseup}
            {\makebox[\turnstilewidth]{\usebox{\second}}}
        \makever{#6}{\dashthickness}{\turnstileheight}{\ddashthickness}}}}
        \mathrel{\usebox{\turnstilebox}}}

% \providecommand\WarningsAreErrors{false}
% \ifthenelse{\equal{\WarningsAreErrors}{true}}{\renewcommand{\GenericWarning}[2]{\GenericError{#1}{#2}{}{This warning has been turned into a fatal error.}}}{}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{theorem}{Theorem}
\newref{lem}{lemma}{Lemma}
\newref{prop}{proposition}{Proposition}
\newref{cor}{corollary}{Corollary}

\theoremstyle{definition}
\newref{defn}{definition}{Definition}
\newref{example}{example}{Example}

\theoremstyle{remark}
\newref{remark}{remark}{Remark}

\newcommand{\red}{\Rightarrow}
\newcommand{\deq}{\Leftrightarrow}
\renewcommand{\ll}{\llbracket}
\newcommand{\rr}{\rrbracket}
\newcommand{\cat}[1]{\mathbf{#1}}
\newcommand{\C}{\cat{C}}
\newcommand{\Set}{\cat{Set}}
\newcommand{\ccat}{\cat{CCat}}
\newcommand{\syntt}{\cat{SynTT}}
\newcommand{\algtt}{\cat{AlgTT}}
\newcommand{\Mod}{\text{-}\cat{Mod}}
\newcommand{\ttvdash}{\vartriangleright}

\numberwithin{figure}{section}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\begin{document}

\title{Algebraic and Syntactic Presentations of Type Theories}

\author{Valery Isaev}

% \begin{abstract}
% Abstract
% \end{abstract}

\maketitle

\section{Introduction}

\begin{comment}
\section{Contextual categories}

Contextual categories were defined by Cartmell \cite{GAT}.
An equivalent definition was given by Voevodsky in \cite{c-systems}.
In this section we will give another equivalent definition which is just a description of models of the initial algebraic type theory as we will see later.
\end{comment}

\section{Theory $T_1$}

In this section we will describe a quasi-equational theory $T_1$ and prove that the category of models of $T_1$ is equivalent to the category of contextual categories.
We will use this theory to define algebraic type theories.

We will consider quasi-equational theories in signature $\Sigma_C$ with the set of sorts $\{ Ctx_n\ |\ n \in \mathbb{N} \} \cup \{ Tm_n\ |\ n \in \mathbb{N} \}$.
Let $T_0$ be the theory with the set of function symbols $\{ * \} \cup \{ ft_n : Ctx_{n+1} \to Ctx_n\ |\ n \in \mathbb{N} \} \cup \{ ty_n : Tm_n \to Ctx_{n+1}\ |\ n \in \mathbb{N} \}$ and the following axioms:
\begin{align*}
& \top \sststile{}{A} ft_n(A) \downarrow \\
& \top \sststile{}{a} ty_n(a) \downarrow \\
& \top \sststile{}{} * \downarrow \\
& \top \sststile{}{A} A = *
\end{align*}
Let $ft^i_n : Ctx_{n+i} \to Ctx_n$ be the following derived operation:
\begin{align*}
& ft^0_n(A) = A \\
& ft^{i+1}_n(A) = ft^i_n(ft_{n+i}(A))
\end{align*}

Now we describe theory $T_1$ which contains.
The set of function symbols of $T_1$ consists of the symbols of $T_0$ and the following symbols:
\begin{align*}
v_{n,i}     & : Ctx_n \to Tm_n \text{, } 0 \leq i < n \\
Subst_{n,k} & : Ctx_n \times Ctx_{k+1} \times Tm_n^k \to Ctx_{n+1} \\
subst_{n,k} & : Ctx_n \times Tm_k \times Tm_n^k \to Tm_n
\end{align*}

Auxiliary predicates $Hom_{n,k} : Ctx_n \times Ctx_k \times Tm_n^k$ are defined as follows: $Hom_{n,k}(B, A, a_1, \ldots a_k)$ holds if and only if
\[ ty_n(a_i) = Subst_{n,i-1}(B, ft^{k-i}_i(A), a_1, \ldots a_{i-1}) \text{ for each } 1 \leq i \leq k \]
The idea is that a tuple of terms should represent a morphism in a contextual category.
So $Hom_{n,k}(B, A, a_1, \ldots a_k)$ holds if and only if $(a_1, \ldots a_k)$ is a morphism with domain $A$ and codomain $B$.
Note that if $Hom_{n,k}(B, A, a_1, \ldots a_k)$, then $ft_n(ty_n(a_i)) = B$.

The set of axioms of $T_1$ consists of the axioms of $T_0$ and the axioms we list below.
The following axioms describe when functions are defined:
\begin{align}
\label{ax:def-var}
                                             & \sststile{}{A}           v_{n,i}(A) \downarrow \\
\label{ax:def-Subst}
Hom_{n,k}(B, ft_k(A), a_1, \ldots a_k)       & \ssststile{}{B, A, a_i}  Subst_{n,k}(B, A, a_1, \ldots a_k) \downarrow \\
\label{ax:def-subst}
Hom_{n,k}(B, ft_k(ty_k(a)), a_1, \ldots a_k) & \ssststile{}{B, a, a_i}  subst_{n,k}(B, a, a_1, \ldots a_k) \downarrow
\end{align}

The following axioms describe the ``typization'' of the constructions we have:
\begin{align}
\label{ax:type-var}
& \sststile{}{A}         ty_n(v_{n,i}(A)) = Subst_{n,n-i-1}(A, ft^i_{n-i}(A), v_{n,n-1}(A), \ldots v_{n,i+1}(A)) \\
\label{ax:type-Subst}
& \sststile{}{B, A, a_i} ft_n(Subst_{n,k}(B, A, a_1, \ldots a_k)) \leftrightharpoons B \\
\label{ax:type-subst}
& \sststile{}{B, a, a_i} ty_n(subst_{n,k}(B, a, a_1, \ldots a_k)) \leftrightharpoons Subst_{n,k}(B, ty_k(a), a_1, \ldots a_k)
\end{align}

The following axioms prescribe how substitution ($Subst_{n,k}$ and $subst_{n,k}$) must be defined on indices ($v_{n,i}$):
\begin{align}
\label{ax:Subst-var}
& \sststile{}{A}         Subst_{n,n}(ft_n(A), A, v_{n,n-1}(ft_n(A)), \ldots v_{n,0}(ft_n(A))) = A \\
\label{ax:subst-var}
& \sststile{}{a}         subst_{n,n}(ft_n(ty_n(a)), a, v_{n,n-1}(ft_n(ty_n(a))), \ldots v_{n,0}(ft_n(ty_n(a)))) = a \\
\label{ax:var-subst}
& Hom_{n,k}(B, A, a_1, \ldots a_k) \sststile{}{B, a_i, A} subst_{n,k}(B, v_{k,i}(A), a_1, \ldots a_k) = a_{k-i}
\end{align}

The following axioms say that substitution must be ``associative'':
\begin{align}
\label{ax:Subst-Subst}
& Hom_{n,k}(C, B, b_1, \ldots b_k) \land Hom_{k,m}(B, ft_m(A), a_1, \ldots a_m) \sststile{}{C, b_i, B, a_i, A} \\ \notag
& Subst_{n,k}(C, Subst_{k,m}(B, A, a_1, \ldots a_m), b_1, \ldots b_k) = \\ \notag
& Subst_{n,m}(C, A, subst_{n,k}(C, a_1, b_1, \ldots b_k), \ldots subst_{n,k}(C, a_m, b_1, \ldots b_k)) \\
\label{ax:subst-subst}
& Hom_{n,k}(C, B, b_1, \ldots b_k) \land Hom_{k,m}(B, ft_m(ty_m(a)), a_1, \ldots a_m) \sststile{}{C, b_i, B, a_i, a} \\ \notag
& subst_{n,k}(C, subst_{k,m}(B, a, a_1, \ldots a_m), b_1, \ldots b_k) = \\ \notag
& subst_{n,m}(C, a, subst_{n,k}(C, a_1, b_1, \ldots b_k), \ldots subst_{n,k}(C, a_m, b_1, \ldots b_k))
\end{align}

Now, we want to show that the category of models of $T_1$ is equivalent to the category of contextual categories.
First, we construct a functor $F : T_1\Mod \to \ccat$.
Let $M$ be a model of $T_1$.
Then the set of objects of level $n$ of $F(M)$ is $M(Ctx_n)$.
For each $A \in M(Ctx_n)$, $B \in M(Ctx_k)$ morphisms from $A$ to $B$ are tuples $(a_1, \ldots a_k)$ such that $a_i \in M(Tm_n)$ and $Hom_{n,k}(A, B, a_1, \ldots a_k)$.

For each $0 \leq i \leq n$ axiom~\eqref{ax:type-var} implies
\[ \sststile{}{A} Hom_{n,n-i}(A, ft^i_{n-i}(A), v_{n,n-1}(A), \ldots v_{n,i}(A)). \]
For each $A \in M(Ctx_n)$ we define $id_A : A \to A$ as tuple
\[ (v_{n,n-1}(A), \ldots v_{n,0}(A)) \]
and $p_A : A \to ft(A)$ as tuple
\[ (v_{n,n-1}(A), \ldots v_{n,1}(A)). \]

Now, we introduce some notation.
If $B \in M(Ctx_n)$, $A \in M(Ctx_{k+1})$, and $f = (a_1, \ldots a_k) : B \to ft_k(A)$ is a morphism, then we define $A[f] \in M(Ctx_{n+1})$ as $Subst_{n,k}(B, A, a_1, \ldots a_k)$.
If $a \in M(Tm_k)$ and $ty_k(a) = A$, then we define $a[f] \in M(Tm_n)$ as $subst_{n,k}(B, a, a_1, \ldots a_k)$.
By axioms \eqref{ax:def-Subst} and \eqref{ax:def-subst} these constructions are total.

If $A \in M(Ctx_n)$, $B \in M(Ctx_k)$, $C \in M(Ctx_m)$, $f : A \to B$, and $(c_1, \ldots c_m) : B \to C$, then we define composition $(c_1, \ldots c_m) \circ f$ as $(c_1[f], \ldots c_m[f])$.
The following sequence of equations shows that $(c_1, \ldots c_m) \circ f : A \to C$.
\begin{align*}
ty_n(c_i[f]) & = \text{(by axiom~\eqref{ax:type-subst})} \\
ty_k(c_i)[f] & = \text{(since $Hom_{k,m}(c_1, \ldots c_m)$)} \\
ft^{m-i}_i(C)[c_1, \ldots c_{i-1}][f] & = \text{(by axiom~\eqref{ax:Subst-Subst})} \\
ft^{m-i}_i(C)[c_1[f], \ldots c_{i-1}[f]] &
\end{align*}

With these notations we can rewrite axioms \eqref{ax:type-subst}, \eqref{ax:Subst-var}, \eqref{ax:subst-var}, \eqref{ax:Subst-Subst}, \eqref{ax:subst-subst} as follows:
\begin{align}
\setcounter{equation}{\ref{ax:type-subst}}
\addtocounter{equation}{-1}
ty_n(a[f]) & = A[f] \\ \notag
\text{ for each } f : B \to ft_k(A) & \text{ where } A = ty_k(a) \\
A[id_{ft_n(A)}] & = A \\
a[id_{ft_n(ty_n(a))}] & = a \\
\setcounter{equation}{\ref{ax:Subst-Subst}}
\addtocounter{equation}{-1}
A[g][f] & = A[g \circ f] \\ \notag
\text{ for each } f : C \to B \text{ and } & g : B \to ft_m(A) \\
a[g][f] & = a[g \circ f] \\ \notag
\text{ for each } f : C \to B \text{ and } & g : B \to ft_m(ty_m(a))
\end{align}

Associativity of the composition follows from axiom~\eqref{ax:subst-subst}, and the fact that $id$ is identity for it follows from axioms \eqref{ax:subst-var} and \eqref{ax:var-subst}.

For every $A \in M(Ctx_{k+1})$ there is a bijection $\varphi$ between the set of $a \in M(Tm_k)$ such that $ty_k(a) = A$ and the set of morphisms $f : ft_k(A) \to A$ such that $p_A \circ f = id_{ft_k(A)}$.
For every such $a \in M(Tm_k)$ we define $\varphi(a)$ as
\[ (v_{k,k-1}(ft_k(A)), \ldots v_{k,0}(ft_k(A)), a). \]
Note that if $(a_1, \ldots a_{k+1}) : B \to A$ is a morphism, then axiom~\eqref{ax:var-subst} implies that $p_A \circ (a_1, \ldots a_{k+1})$ equals to $(a_1, \ldots a_k)$.
Thus $\varphi(a)$ is a section of $p_A$.
Clearly, $\varphi$ is injective.
Let $f : ft_k(A) \to A$ be a section of $p_A$; then first $k$ components of $f$ must be identity on $ft_k(A)$.
So if $a$ is the last component of $f$, then $\varphi(a)$ equals to $f$.
Hence $\varphi$ is bijective.

If $A \in M(Ctx_{k+1})$, $B \in M(Ctx_n)$, and $f = (a_1, \ldots a_k) : B \to ft_k(A)$, then we define $f^*(A)$ as $A[f] = Subst_{n,k}(B, A, a_1, \ldots a_k)$.
Map $q(f,B)$ defined as the tuple with $i$-th component equals to
\[ \left\{
  \begin{array}{lr}
    a_i[v_{n+1,n}(A[f]), \ldots v_{n+1,1}(A[f])] & \text{ if } 1 \leq i \leq k \\
    v_{n+1,0}(A[f])                              & \text{ if } i = k+1
  \end{array}
\right. \]
Now we have the following commutative square:
\[ \xymatrix{ A[f] \ar[r]^-{q(f,A)} \ar[d]_{p_{A[f]}} & A \ar[d]^{p_A} \\
              B \ar[r]_-f                             & ft_k(A)
            } \]
We need to prove that this square is cartesian.
By proposition~2.3 of \cite{c-systems} it is enough to construct a section $s_{f'} : B \to A[f]$ of $p_{A[f]}$ for each $f' = (a_1, \ldots a_k, a_{k+1}) : B \to A$ and prove a few properties of $s_{f'}$.
We define $s_{f'}$ to be equal to $\varphi(a_{k+1})$.
Axioms \eqref{ax:var-subst} and \eqref{ax:subst-subst} implies that $q(f, B) \circ s_{f'} = f$.
To complete the proof that the square above is cartesian we need for every $g : ft_k(A) \to ft_m(C)$ and $A = C[g]$ prove that $s_{f'} = s_{q(g,C) \circ f'}$.
The last component of $q(g,C) \circ f'$ equals to $v_{n+1,0}(C[g])[f'] = a_{k+1}$.
Thus the last components of $q(g,C) \circ f'$ and $f'$ coincide, hence $s_{f'} = s_{q(g,C) \circ f'}$.

We are left to prove that operations $A[f]$ and $q(f,A)$ are functorial.
Equations $A[id_{ft_k(A)}] = A$ and $A[f \circ g] = A[f][g]$ are precisely axioms \eqref{ax:Subst-var} and \eqref{ax:Subst-Subst}.
The fact that $q(id_{ft_k(A)}, A) = id_A$ follows from axiom~\ref{ax:var-subst}.
Now let $g : C \to B$ and $f : B \to ft_k(A)$ be morphisms; we need to show that $q(f \circ g, A) = q(f,A) \circ q(g,A[f])$.
The last component of $q(f,A) \circ q(g,A[f])$ equals to $v_{n+1,0}(A[f])[q(g,A[f])] = v_{m+1,0}(A[f][g])$ which equals to the last component of $q(f \circ g, A)$, namely $v_{m+1,0}(A[f \circ g])$.
If $1 \leq i \leq k$, then $i$-th component of $q(f,A) \circ q(g,A[f])$ equals to
\[ a_i[v_{n+1,n}(A[f]), \ldots v_{n+1,1}(A[f])][q(g,A[f])] = \]
\[ a_i[b_1[v_{m+1,m}(A[f][g]), \ldots v_{m+1,1}(A[f][g])], \ldots b_n[v_{m+1,m}(A[f][g]), \ldots v_{m+1,1}(A[f][g])]] \]
where $a_i$ is $i$-th component of $f$ and $b_i$ is $i$-th component of $g$.
$i$-th component of $q(f \circ g, A)$ equals to
\[ a_i[g][v_{m+1,m}(A[f \circ g]), \ldots v_{m+1,1}(A[f \circ g])] = \]
\[ a_i[b_1[v_{m+1,m}(A[f \circ g]), \ldots v_{m+1,1}(A[f \circ g])], \ldots b_n[v_{m+1,m}(A[f \circ g]), \ldots v_{m+1,1}(A[f \circ g])]]. \]
Thus $q(f \circ g, A) = q(f,A) \circ q(g,A[f])$.
This completes the construction of contextual category $F(M)$.

\begin{prop}
Mapping $F$ is functorial, and functor $F : T_1\Mod \to \ccat$ is an equivalence of categories.
\end{prop}
\begin{proof}
Given a map of $T_1$ models $\alpha : M \to N$, we define a map of contextual categories $F(\alpha) : F(M) \to F(N)$.
$F(\alpha)$ is already defined on objects.
Let $f = (a_1, \ldots a_k) \in Hom_{n,k}(B,A)$.
We define $F(\alpha)(f)$ as $(\alpha(a_1), \ldots \alpha(a_k)) \in Hom_{n,k}(\alpha(B), \alpha(A))$.
$F(\alpha)$ preserves identity morphisms, compositions, $f^*(A)$, and $q(f,A)$ since all of these operations are defined in terms of $T_1$ operations.
Clearly, $F$ preserves identity maps and compositions of maps of $T_1$ models.
Thus $F$ is a functor.

First, note that if $a \in M(Tm_k)$ and $\alpha : M \to N$, then $F(\alpha)(\varphi(a)) = \varphi(\alpha(a))$.
Indeed, consider the following sequence of equations:
\begin{align*}
F(\alpha)(\varphi(a)) & = \\
F(\alpha)(v_{k,k-1}(ft_k(ty_k(a))), \ldots v_{k,0}(ft_k(ty_k(a))), a) & = \\
(v_{k,k-1}(ft_k(ty_k(\alpha(a)))), \ldots v_{k,0}(ft_k(ty_k(\alpha(a)))), \alpha(a)) & = \\
\varphi(\alpha(a)) & .
\end{align*}

Now, we prove that $F$ is faithful.
Let $\alpha,\beta : M \to N$ be a pair of maps of $T_1$ models such that $F(\alpha) = F(\beta)$.
Then $\alpha$ and $\beta$ coincide on contexts.
Given $a \in M(Tm_n)$ we have the following equation: $\alpha(a) = \varphi^{-1}(F(\alpha)(\varphi(a))) = \varphi^{-1}(F(\beta)(\varphi(a))) = \beta(a)$.

Now, we prove that $F$ is full.
Let $\alpha : F(M) \to F(N)$ be a map of contextual categories.
Then we need to define $\beta : M \to N$ such that $F(\beta) = \alpha$.
If $A \in M(Ctx_n)$, then we let $\beta(A) = \alpha(A)$.
Note that if $f : ft_n(A) \to A$ is a section of $p_A$, then $\alpha(f)$ is a section of $\alpha(A)$.
If $a \in M(Tm_n)$, then we let $\beta(a) = \varphi^{-1}(\alpha(\varphi(a)))$.

Maps $F(\beta)$ and $\alpha$ agree on contexts.
We prove by induction on $k$ that they coincide on morphisms $f = (a_1, \ldots a_k) \in M(Hom_{n,k})(B,A)$.
If $k = 0$, then $F(A)$ is terminal objects, hence $F(\beta) = \alpha$.
Suppose $k > 0$ and consider the following equation: $f = q((a_1, \ldots a_{k-1}), A) \circ \varphi(a_k)$.
By induction hypothesis we know that $F(\beta)(q((a_1, \ldots a_{k-1}), A)) = \alpha(q((a_1, \ldots a_{k-1}), A))$.
Thus we only need to prove that $F(\beta)(\varphi(a_k)) = \alpha(\varphi(a_k))$.
But $F(\beta)(\varphi(a_k)) = \varphi(\beta(a_k)) = \varphi(\varphi^{-1}(\alpha(\varphi(a_k)))) = \alpha(\varphi(a_k))$.

Finally, we prove that $F$ is essentially surjective on objects.
Given contextual category $C$ we define $T_1$ model $M$.
Let $M(Ctx_n)$ be equal to $Ob_n(C)$ and $M(Tm_n)$ be the set of pairs of objects $A \in Ob_{n+1}(C)$ and sections of $p_A : A \to ft_n(A)$.
Let $ty_n$ be the obvious projection.
We will usually identify $a \in M(Tm_n)$ with the section $ft_n(ty_n(a)) \to ty_n(a)$.

For each $n,k \in \mathbb{N}$ we define partial function
\[ Subst_{n,k} : M(Ctx_n) \times M(Ctx_{k+1}) \times M(Tm_n)^k \to M(Ctx_{n+1}) \]
such that $ft_n(Subst_{n,k}(B, A, a_1, \ldots a_k)) = B$.
We also define morphism
\[ q_{n,k} \in Hom_{n+1,k}(Subst_{n,k}(B, A, a_1, \ldots a_k), A) \]
whenever $Subst_{n,k}(B, A, a_1, \ldots a_k)$ is defined.
We define $Subst_{n,k}$ and $q_{n,k}$ by induction on $k$.
Let $Subst_{n,0}(B,A) = !_B^*(A)$ and $q_{n,0} = q(!_B,A)$ where $!_B : B \to Ob_0(C)$ is the unique morphism.
\[ \xymatrix{ Subst_{n,0}(B,A) \ar[r]^-{q_{n,0}} \ar[d] \pb & A \ar[d]^{p_A} \\
              B \ar[r]_{!_B} & 1
            } \]
Let $Subst_{n,k+1}(B, A, a_1, \ldots a_{k+1})$ be defined whenever $Subst_{n,k}(B, ft_k(A), a_1, \ldots a_k)$ is defined and $ty_n(a_{k+1}) = Subst_{n,k}(B, ft_k(A), a_1, \ldots a_k)$.
In this case we let $Subst_{n,k+1}(B, A, a_1, \ldots a_{k+1}) = f^*(A)$ and $q_{n,k+1} = q(f,A)$ where $f$ is the composition of $a_{k+1}$ and $q_{n,k}$.
\[ \xymatrix{ Subst_{n,k+1}(B, A, a_1, \ldots a_{k+1}) \ar[rr]^-{q_{n,k+1}} \ar[d] \pb & & A \ar[d]^{p_A} \\
              B \ar[r]_-{a_{k+1}} & Subst_{n,k}(B, ft_k(A), a_1, \ldots a_k) \ar[r]_-{q_{n,k}} & ft_k(A)
            } \]
It is easy to see by induction on $k$ that axiom~\eqref{ax:def-Subst} holds.
Axiom~\eqref{ax:type-Subst} holds by definition of $Subst_{n,k}$.

The definition of predicates $Hom_{n,k}$ makes sense in $M$ now.
Thus we can define as before the set $Hom^M_{n,k}(B,A)$ of morphisms in $M$ as the set of tuples $(a_1, \ldots a_k)$ such that $Hom_{n,k}(B, A, a_1, \ldots a_k)$.
There is a bijection $\alpha : Hom^M_{n,k}(B,A) \to Hom_{n,k}(B,A)$ such that $Subst_{n,k}(B, A, a_1, \ldots a_k) = \alpha(a_1, \ldots a_k)^*(A)$ and $q_{n,k} = q(\alpha(a_1, \ldots a_k), A)$.
We define $\alpha$ by induction on $k$.
Both $Hom^M_{n,0}(B,A)$ and $Hom_{n,0}(B,A)$ are singletons, so there is a unique bijection between them.
If $(a_1, \ldots a_k) \in Hom^M_{n,k}(B,ft_k(A))$, then there is a bijection between $f \in Hom_{n,k+1}(B,A)$ such that $p_A \circ f = \alpha(a_1, \ldots a_k)$ and sections of $p_{\alpha(a_1, \ldots a_k)^*(A)}$.
By induction hypothesis these sections are just sections of $p_{Subst_{n,k}(B, A, a_1, \ldots a_k)}$.
This gives us a bijection between $Hom^M_{n,k+1}(B,A)$ and $Hom_{n,k+1}(B,A)$, namely $\alpha(a_1, \ldots a_{k+1}) = q(\alpha(a_1, \ldots a_k), A) \circ a_{k+1}$.
Then equations $Subst_{n,k+1}(B, A, a_1, \ldots a_{k+1}) = \alpha(a_1, \ldots a_{k+1})^*(A)$ and $q_{n,k+1} = q(\alpha(a_1, \ldots a_k), A)$ hold by definition.

Now we define total functions $v_{n,i} : M(Ctx_n) \to M(Tm_n)$.
Let $v_{n,i}(A) = (p^{i+1}(A)^*(ft^i_{n-i}(A)), s_{p^i_A})$.
\[ \xymatrix{ p^{i+1}(A)^*(ft^i_{n-i}(A)) \ar[r] \ar[d] \pb & ft^i_{n-i}(A) \ar[d]^{p_{ft^i_{n-i}(A)}} \\
              A \ar[r]_{p^{i+1}(A)} \ar@/^1pc/[u]^{s_{p^i_A}} \ar[ur]_{p^i_A} & ft^{i+1}_{n-i-1}(A)
            } \]
Axiom~\eqref{ax:def-var} holds by definition.
By induction on $n - i$ it is easy to see that $\alpha(v_{n,n-1}(A), \ldots v_{n,i}(A))$ equals to $p_A^i : A \to ft^i_{n-i}(A)$.
Axiom~\eqref{ax:type-var} follows from the following sequence of equations:
\begin{align*}
Subst_{n,n-i-1}(A, ft^i_{n-i}(A), v_{n,n-1}(A), \ldots v_{n,i+1}(A)) & = \\
\alpha(v_{n,n-1}(A), \ldots v_{n,i+1}(A))^*(ft^i_{n-i}(A)) & = \\
p^{i+1}(A)^*(ft^i_{n-i}(A)) & = \\
ty_n(v_{n,i}(A)) & .
\end{align*}
Axiom~\eqref{ax:Subst-var} follows from the facts that $\alpha(v_{n,n-1}(ft_n(A)), \ldots v_{n,0}(ft_n(A))) = id_{ft_n(A)}$ and $id_{ft_n(A)}^*(A) = A$.

Now we define partial functions $subst_{n,k} : M(Ctx_n) \times M(Tm_k) \times M(Tm_n)^k \to M(Tm_n)$.
$subst_{n,k}(B, a, a_1, \ldots a_k)$ is defined whenever $Hom_{n,k}(B, ft_k(ty_k(a)), a_1, \ldots a_k)$ holds.
In this case we let $subst_{n,k}(B, a, a_1, \ldots a_k) = a[\alpha(a_1, \ldots a_k)]$ where $a[f] = s_{a \circ f}$.
Axioms \eqref{ax:def-subst} and \eqref{ax:type-subst} hold by definition.
Axiom~\eqref{ax:subst-var} follows from the fact that $id_{ft_n(ty_n(a))}^*(a) = a$.

To prove axiom~\eqref{ax:var-subst} note that $p_A \circ \alpha(a_1, \ldots a_{k+1}) = \alpha(a_1, \ldots a_k)$ by definition of $\alpha$.
Hence $p^i(A) \circ \alpha(a_1, \ldots a_k) = \alpha(a_1, \ldots a_{k-i})$.
Also note that $s_{\alpha(a_1, \ldots a_k)} = a_k$.
Now the axiom follows from the following equations:
\begin{align*}
subst_{n,k}(B, v_{k,i}(A), a_1, \ldots a_k) & = \\
s_{v_{k,i}(A) \circ \alpha(a_1, \ldots a_k)} & = \\
s_{q(p^{i+1}(A), ft^i_{n-i}(A)) \circ v_{k,i}(A) \circ \alpha(a_1, \ldots a_k)} & = \\
s_{p^i(A) \circ \alpha(a_1, \ldots a_k)} & = \\
s_{\alpha(a_1, \ldots a_{k-i})} & = \\
a_{k-i} & .
\end{align*}

Now we prove that $\alpha$ preserves compositions.
To do this we need to show that $\alpha(a_1, \ldots a_k) \circ f = \alpha(a_1[f], \ldots a_k[f])$.
We do this by induction on $k$.
For $k = 0$ it is trivial and for $k > 0$ we have the following sequence of equations:
\begin{align*}
\alpha(a_1, \ldots a_k) \circ f & = \\
q(\alpha(a_1, \ldots a_{k-1}), A) \circ a_k \circ f & = \\
q(\alpha(a_1, \ldots a_{k-1}), A) \circ q(f, B[\alpha(a_1, \ldots a_k)]) \circ a_k[f] & = \\
q(\alpha(a_1, \ldots a_{k-1}) \circ f, A) \circ a_k[f] & = \\
q(\alpha(a_1[f], \ldots a_{k-1}[f]), A) \circ a_k[f] & = \\
\alpha(a_1[f], \ldots a_k[f]) & .
\end{align*}

Now axioms \eqref{ax:Subst-Subst} and \eqref{ax:subst-subst} follow from the facts that $\alpha$ preserves compositions and $(f \circ g)^*(A) = f^*(g^*(A))$.
This completes the construction of $T_1$ model $M$ from a contextual category $C$.
To finish the proof we need to show that $F(M)$ is isomorphic to $C$.
The isomorphism is given by bijection $\alpha$.
We already saw that $\alpha$ preserves the structure of contextual categories.
Thus $\alpha$ is a morphism of contextual categories, and it is easy to see that $\alpha^{-1}$ also preserves the structure.
Hence $\alpha$ is isomorphism and $F$ is an equivalence.
\end{proof}

\section{Syntactic presentations of type theories}

In this section we will describe a syntactic approach to defining type theories.
We will define category $\syntt$ of syntactically presented type theories.
Finally, we will give a few examples of such theories.

Let $\mathcal{K} = \{ tm, ty \}$ and let $\mathcal{S} = \mathcal{K} \times \mathbb{N}$ be the set of sorts.
Let $l : \mathcal{S} \to \mathbb{N}$ be the function $l(k,n) = n$.
Let $\Sigma$ be a set of function symbols together with a signature, that is expressions of the form
\[ f : s_1 \times \ldots \times s_n \to s \]
where $s_1, \ldots s_n, s \in \mathcal{S}$.
Then let $\overline{\Sigma}$ be the following set of function symbols:
\[ \{ f_k\ |\ f \in \Sigma, k \in \mathbb{N} \} \cup \{ v_{n,i}\ |\ n,i \in \mathbb{N}, 0 \leq i < n \} \cup \{ subst_{p,n,k}\ |\ p \in \mathcal{K}, n,k \in \mathbb{N} \}. \]
Signatures of these symbols are defined as follows:
\begin{align*}
v_{n,i} & : (tm,n) \\
subst_{p,n,k} & : (p,k) \times (tm,n)^k \to (p,n) \\
f_k\ & : (p_1,q_1+k) \times \ldots \times (p_n,q_n+k) \to (p,q+k)
\end{align*}
where $f : (p_1,q_1) \times \ldots \times (p_n,q_n) \to (p,q)$.
We will omit subscripts $k$ in $f_k$ and $n$ in $v_{n,i}$ if it is clear from the context.
If $V$ is a set, then let $Term_\Sigma(V)$ be the set of terms in signature $\overline{\Sigma}$.

Let $T_\Sigma$ be the algebraic theory in signature $\overline{\Sigma}$ with the following set of axioms:
\begin{align*}
subst_{p,n,n}(a, v_{n,n-1}, \ldots v_{n,0}) & = a \\
subst_{tm,n,k}(v_{k,i}, a_1, \ldots a_k) & = a_{k-i} \\
subst_{p,m,n}(subst_{p,n,k}(a, b_1, \ldots b_k), c_1, \ldots c_n) & = subst_{p,m,k}(a, b_1', \ldots b_k')
\end{align*}
where $b_i' = subst_{tm,m,n}(b_i, c_1, \ldots c_n)$, and
\[ subst_{p,n+q,k+q}(f_k(a_1, \ldots a_m), b_1'', \ldots b_k'', v_{n+q,q-1}, \ldots v_{n+1,0}) = f_n(a_1', \ldots a_m') \]
for each $f : (p_1,q_1) \times \ldots \times (p_n,q_n) \to (p,q)$ and $b_j : (tm,n)$ where
\[ b_j'' = subst_{tm,n+q,n} (b_j, v_{n+q,n+q-1}, \ldots v_{n+q,q}), \]
\[ a_i' = subst_{p_i,n+q_i,k+q_i}(a_i, b_{i,1}', \ldots b_{i,k}', v_{n+q_i,q_i-1}, \ldots v_{n+q_i,0}) \text{, and} \]
\[ b_{i,j}' = subst_{tm,n+q_i,n}(b_j, v_{n+q_i,n+q_i-1}, \ldots v_{n+q_i,q_i}). \]
Let $T_\Sigma : \Set^\mathcal{S} \to \Set^\mathcal{S}$ be a monad corresponding to the theory $T_\Sigma$.
Explicitly, $T_{\Sigma}(V)_s = Term_{\Sigma}(V)_s/\sim$ where $\sim$ is the congruence generated by the axioms above.
Elements of $T_{\Sigma}(V)_s$ we will call terms of sort $s$ with free variables in $V$.
A morphism of signatures $\Sigma$ and $\Sigma'$ is a function that to each $(f : s_1 \times \ldots s_k \to s) \in \Sigma$ assigns
a term of sort $s$ in signature $\Sigma'$ with free variables $x_1$, \ldots $x_k$ of sorts $s_1$, \ldots $s_k$ respectively.
Such a function $F$ extends to functions $\overline{F} : T_\Sigma(V)_s \to T_{\Sigma'}(V)_s$ in the obvious way.
Compositions of morphisms $F : \Sigma \to \Sigma'$ and $G : \Sigma' \to \Sigma''$ is defined as follows: $(G \circ F)(f) = \overline{G}(F(f))$.
An identity morphism assigns to each $f$ the term $f(x_1, \ldots x_k)$.

If $V \in \Set^{\mathcal{S}}$, then a \emph{context} of length $n$ with free varibles in $V$ is a sequence $A_0$, \ldots $A_{n-1}$ where $A_i \in Term_\Sigma(V)_(ty,i)$.
A \emph{judgement} with free variables in $V$ is simply a predicate of a certain form.
We will consider judgements of the forms $\Gamma \vdash$, $\Gamma \vdash A$, $A \deq A'$, $\Gamma \vdash a : A$, and $a \deq a'$
where $\Gamma$ is context of length $n$ (for some $n \in \mathbb{N}$), $A, A' \in Term_\Sigma(V)_{(ty,n)}$, and $a, a' \in Term_\Sigma(V)_{(tm,n)}$.
An inference rule with free variables in $V$ consists of a finite set of judgements $J_1$, \ldots $J_n$ (with free variables in $V$) called premises and a judgement $J$ (with free variables in $V$) called conclusion.
An inference rule is usually written as
\begin{center}
\AxiomC{$J_1 \quad \ldots \quad J_n$}
\UnaryInfC{$J$}
\DisplayProof
\end{center}
If $\mathcal{I}$ is a set of inference rules, then the set $D(\mathcal{I})$ of derived rules is defined in the usual way.

\begin{defn}
A \emph{syntactic type theory} consists of a set $\Sigma$ of function symbols and a set $\mathcal{I}$ of inference rules.
\end{defn}
Let $F$ be a morphisms of signatures $\Sigma$ and $\Sigma'$.
If $J$ is a judgement of $\Sigma$, then we can define a judgement $\overline{F}(J)$ of $\Sigma'$ by applying $\overline{F}$ to every term in $J$.
If $R$ is an inference rule of $\Sigma$, then we can define an inference rule $\overline{F}(R)$ of $\Sigma'$ by applying $\overline{F}$ to every judgement in $R$.
A morphism of theories $T = (\Sigma_T, \mathcal{I}_T)$ and $S = (\Sigma_S, \mathcal{I}_S)$ is a morphism $F$ of signatures $\Sigma$ and $\Sigma'$
such that $\overline{F}(R)$ is a derived inference rules of $S$ for every $R \in \mathcal{I}_T$.
This defines a cateogry $\syntt$ of syntactic type theories.

Now we introduce a few auxiliary constructions.
If $b$ is a term of sort $(p,n+k)$ and $a_1$, \ldots $a_k$ are terms of sort $(tm,n)$, then we write $b[a_1, \ldots a_k]$ for
\[ subst_{p,n,n+k}(b, v_{n,n-1}, \ldots v_{n,0}, a_1, \ldots a_k). \]
If $b$ is a term of sort $(p,n)$, then we write $b\!\uparrow$ for
\[ subst_{p,n+1,n}(b, v_{n+1,n}, \ldots v_{n+1,1}). \]

\begin{example}
The theory of unit types with eta rules has function symbols $\top : (ty,0)$ and $unit : (tm,0)$ and the following inference rules:
\medskip
\begin{center}
\AxiomC{}
\UnaryInfC{$\vdash \top$}
\DisplayProof
\quad
\AxiomC{}
\UnaryInfC{$\vdash unit : \top$}
\DisplayProof
\quad
\AxiomC{$\vdash t : \top$}
\UnaryInfC{$t \deq unit$}
\DisplayProof
\end{center}
\end{example}

\begin{example}
The theory of unit types without eta rules has function symbols $\top : (ty,0)$, $unit : (tm,0)$ and $\top\text{-}elim : (ty,1) \times (tm,0) \times (tm,0) \to (tm,0)$
and the following inference rules:
\medskip
\begin{center}
\AxiomC{}
\UnaryInfC{$\vdash \top$}
\DisplayProof
\quad
\AxiomC{}
\UnaryInfC{$\vdash unit : \top$}
\DisplayProof
\quad
\AxiomC{$\top \vdash D$}
\AxiomC{$\vdash d : D[unit]$}
\AxiomC{$\vdash t : \top$}
\TrinaryInfC{$\vdash \top\text{-}elim(D, d, t) : D[t]$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\top \vdash D$}
\AxiomC{$\vdash d : D[unit]$}
\BinaryInfC{$\top\text{-}elim(D, d, unit) \deq d$}
\DisplayProof
\end{center}
\end{example}

\begin{example}
The theory of $\Sigma$ types with eta rules has function symbols
$\Sigma : (ty,0) \times (ty,1) \to (ty,0)$, $pair : (ty,0) \times (ty,1) \times (tm,0) \times (tm,0) \to (tm,0)$,
$proj_1 : (ty,0) \times (ty,1) \times (tm,0) \to (tm,0)$ and $proj_2 : (ty,0) \times (ty,1) \times (tm,0) \to (tm,0)$
and the following inference rules:
\medskip
\begin{center}
\AxiomC{$A \vdash B$}
\UnaryInfC{$\vdash \Sigma(A, B)$}
\DisplayProof
\quad
\AxiomC{$A \vdash B$}
\AxiomC{$\vdash a : A$}
\AxiomC{$\vdash b : B[a]$}
\TrinaryInfC{$\vdash pair(A, B, a, b)$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\vdash p : \Sigma(A, B)$}
\UnaryInfC{$\vdash proj_1(A, B, p) : A$}
\DisplayProof
\quad
\AxiomC{$\vdash p : \Sigma(A, B)$}
\UnaryInfC{$\vdash proj_2(A, B, p) : B[proj_1(A, B, p)]$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$A \vdash B$}
\AxiomC{$\vdash a : A$}
\AxiomC{$\vdash b : B[a]$}
\TrinaryInfC{$proj_1(A, B, pair(A, B, a, b)) \deq a$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$A \vdash B$}
\AxiomC{$\vdash a : A$}
\AxiomC{$\vdash b : B[a]$}
\TrinaryInfC{$proj_2(A, B, pair(A, B, a, b)) \deq b$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\vdash p : \Sigma(A, B)$}
\UnaryInfC{$pair(A, B, proj_1(A, B, p), proj_2(A, B, p)) \deq p$}
\DisplayProof
\end{center}
\end{example}

\begin{example}
The theory of $\Sigma$ types without eta rules.
\end{example}

\begin{example}
The theory of $\Pi$ types with eta rules.
\end{example}

\begin{example}
The theory of $\Pi$ types without eta rules.
\end{example}

\begin{example}
The theory of identity types has function symbols $Id : (ty,0) \times (tm,0) \times (tm,0) \to (ty,0)$,
$refl : (ty,0) \times (tm,0) \to (tm,0)$ and $J : (ty,0) \times (ty,3) \times (tm,1) \times (tm,0) \times (tm,0) \times (tm,0) \to (tm,0)$
and the following inference rules:
\medskip
\begin{center}
\AxiomC{$\vdash a : A$}
\AxiomC{$\vdash a' : A$}
\BinaryInfC{$\vdash Id(A, a, a')$}
\DisplayProof
\quad
\AxiomC{$\vdash a : A$}
\UnaryInfC{$\vdash refl(A, a) : Id(A, a, a)$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$A, A\!\uparrow, Id(A\!\uparrow\uparrow, v_1, v_0) \vdash D$}
\AxiomC{$A \vdash d : D[v_0, v_0, refl(A\!\uparrow, v_0)]$}
\AxiomC{$\vdash p : Id(A, a, a')$}
\TrinaryInfC{$\vdash J(A, D, d, a, a', p) : D[a, a', p]$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$A, A\!\uparrow, Id(A\!\uparrow\uparrow, v_1, v_0) \vdash D$}
\AxiomC{$A \vdash d : D[v_0, v_0, refl(A\!\uparrow, v_0)]$}
\AxiomC{$\vdash a : A$}
\TrinaryInfC{$J(A, D, d, a, a, refl(A, a)) \deq d[a]$}
\DisplayProof
\end{center}
\end{example}

\begin{example}
The theory a universe has function symbols $Type : (ty,0)$ and $El : (tm,0) \to (ty,0)$ and the following inference rules:
\medskip
\begin{center}
\AxiomC{}
\UnaryInfC{$\vdash Type$}
\DisplayProof
\quad
\AxiomC{$\vdash A : Type$}
\UnaryInfC{$\vdash El(A)$}
\DisplayProof
\end{center}
\end{example}

% Now, usually universes are assumed to be closed under different type constructions.

\section{Algebraic presentations of type theories}

In this section we will describe an algebraic approach to defining type theories.
We will define category $\algtt$ of algebraic type theories.
We will also describe a fully faithful functor $E : \syntt_{reg} \to \algtt$ from a full subcategory of $\syntt$ to $\algtt$.

\begin{defn}
An \emph{algebraic type theory} is a theory in signature $\Sigma_C$ with a map from $T_1$.
Category $\algtt$ of algebraic type theory is the under category $T_1 / \Sigma_C \text{-} \cat{Th}$.
\end{defn}

In general, we cannot construct an algebraic type theory from a syntactic one.
So we consider a full subcategory of syntactic type theories for which we can do that.
We call such theories \emph{regular}.

We say that a judgement defines variable $x$ if it is either of the form $\Gamma \vdash x$ or of the form $\Gamma \vdash x : A$.
We say that a judgement defines symbol $(f : s_1 \times \ldots s_n \to (p,q)) \in \Sigma$ if it is either
of the form $\Gamma \vdash f(x_1, \ldots x_n)$ or of the form $\Gamma \vdash f(x_1, \ldots x_n) : A$ where $x_i$ are variables.
We say that an inference rule defines symbol $f$ if its conclusion defines it.
We say that such inference rule is \emph{regular} if the length of $\Gamma$ is $q$ and
if all variables in the list $x_1$, \ldots $x_n$ are distinct, this list contains all free variables of the rule,
and every $x_i$ defined by a single premise with free variables in $x_1$, \ldots $x_{i-1}$.
A syntactic type theory $(\Sigma, \mathcal{I})$ is \emph{regular} if the following conditions hold:
\begin{itemize}
\item Every function symbol in $\Sigma$ is defined by a single regular inference rule in $\mathcal{I}$,
\item There is a well-ordering on $\Sigma$ such that the rule that defines $f$ uses in premises only symbols that are less then $f$.
\item Every inference rule in $\mathcal{I}$ is either defines some function symbol or has conclusion of the form $a \deq b$.
\end{itemize}

Now for each regular syntactic type theory $T = (\Sigma, \mathcal{I})$ we define an algebraic type theory $E(T)$.
There is a function from the set of sorts of syntactic theories to the set of sorts of algebraic theories.
Sort $(tm,n)$ is mapped to $Tm_n$ and $(ty,n)$ is mapped to $Ctx_{n+1}$.
We will usually omit this function and use sorts $(tm,n)$ and $(ty,n)$ directly.
The signature $E(\Sigma)$ of $E(T)$ consists of symbols $v_{n,i}$, $subst_{n,k}$, $Subst_{n,k}$ (with the signatures as in $T_1$), and
$f_k : Ctx_k \times (p_1,q_1+k) \times \ldots \times (p_n,q_n+k) \to (p,q+k)$
for each $k \in \mathbb{N}$ and $(f : (p_1,q_1) \times \ldots \times (p_n,q_n) \to (p,q)) \in \Sigma$.

Let $n \in \mathbb{N}$.
Then we define functions
\[ \alpha_{U,V,p,k} : Term_{E(\Sigma)}(V)_{Ctx_{n+k}} \times Term_{\Sigma}(U)_{(p,k)} \times Env_{U,V,p} \to Term_{E(\Sigma)}(V)_{(p,n+k)} \]
and
\[ \beta_{U,V,k} : Term_{E(\Sigma)}(V)_{Ctx_n} \times Ctx_\Sigma(U)_k \times Env_{U,V,ty} \to Term_{E(\Sigma)}(V)_{Ctx_{n+k}} \]
where $Ctx_\Sigma(U)_k$ is the set of contexts of length $k$ and $Env_{U,V,p}$ is the set of functions $U_{(p,m)} \to Term_{E(\Sigma)}(V)_{(p,n+m)}$ for all $m \in \mathbb{N}$.
\begin{itemize}
\item $\beta_{U,V,0}(\Gamma, (), \rho) = \Gamma$.
\item $\beta_{U,V,k+1}(\Gamma, (\Delta,A), \rho) = \alpha_{U,V,ty,k}(\beta_{U,V,k}(\Gamma, \Delta, \rho), A, \rho)$.
\item $\alpha_{U,V,p,k}(\Gamma, v_{k,i}, \rho) = v_{n+k,i}(\Gamma)$.
\item $\alpha_{U,V,p,k}(\Gamma, x, \rho) = \rho(x)$ where $x$ is a variable.
\item $\alpha_{U,V,p,k}(\Gamma, subst_{ty,k,m}(x, a_1, \ldots a_m)) = Subst_{n+k,n+m}(\Gamma, \rho(x), a_1', \ldots a_{n+m}')$
    where $a_i' = v_{n+k,n+k-i}(\Gamma)$ if $i \leq n$ and $a_i' = \alpha_{U,V,tm,k}(\Gamma, a_{i-n}, \rho)$ if $i > n$.
\item $\alpha_{U,V,p,k}(\Gamma, subst_{tm,k,m}(x, a_1, \ldots a_m)) = subst_{n+k,n+m}(\Gamma, \rho(x), a_1', \ldots a_{n+m}')$
    where $a_i' = v_{n+k,n+k-i}(\Gamma)$ if $i \leq n$ and $a_i' = \alpha_{U,V,tm,k}(\Gamma, a_{i-n}, \rho)$ if $i > n$.
\item $\alpha_{U,V,p,k+q}(\Gamma, f_k(a_1, \ldots a_m)) = f_{n+k}(\Gamma, a_1', \ldots a_m'))$
    where $f : (p_1,q_1) \times \ldots \times (p_m,q_m) \to (p,q)$,
    $f(x_1, \ldots x_m)$ is defined by a rule $R$ in which $x_i$ is defined by a judgement with context $\Delta_i$, and
    \[ a_i' = \alpha_{U,V,p_i,k+q_i}(\beta_{\{ x_1, \ldots x_{i-1} \},V,k}(\Gamma, \Delta_i, [x_j \mapsto a_j']), a_i, \rho). \]
\end{itemize}
Conditions in the definition of regularity guarantee that these functions are well-defined.

Axioms of $E(T)$ are the axioms of $T_1$ and the following axioms:
\begin{align*}
\\
\end{align*}

\section{Models of algebraic type theories}

In this section we show how to construct a model of the theories we described in previous sections from a category $\C$ (with some additional data).
For our constructions we will use ideas from \cite{local-universes}.

Let $\C$ be a category with finite limits and $F$ a class of maps of $\C$.
Suppose $\C$ is equipped with chosen terminal object $1$ and pullbacks $g^*(E)$ for each $g : X \to B$ and $f : E \to B \in F$.
Then we can define a $T_1$ model $M = M(\C,F)$.
Class $Ctx_n$ consists of sequences $(C_1, \ldots C_n)$ where each $C_i$ is a diagram of the form
\[ \xymatrix{                  & E_i \ar[d]^{f_i} \\
              X_i \ar[r]_{g_i} & B_i
            } \]
where $f_i \in F$, $X_1 = 1$, and $X_{i+1} = g_i^*(E_i)$.
Class $Tm_n$ consists of pairs $(C,s)$ where $C = (C_1, \ldots C_{n+1}) \in Ctx_{n+1}$ and $s : X_{n+1} \to E_{n+1}$ is a map such that the following diagram commutes:
\[ \xymatrix{                                    & E_{n+1} \ar[d]^{f_{n+1}} \\
              X_{n+1} \ar[r]_{g_{n+1}} \ar[ur]^s & B_{n+1}
            } \]
Functions $ft$ and $ty$ are defined in the obvious way.
This construction gives us a $T_0$ model.
Note that, in general, we need to work with large models, but if $\C$ is locally small and $F$ is small, then classes $Ctx_n$ and $Tm_n$ are small too.

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
