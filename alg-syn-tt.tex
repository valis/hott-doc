\documentclass{amsart}

\usepackage{amssymb}
\usepackage[all]{xy}
\usepackage{verbatim}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{turnstile}

\renewcommand{\turnstile}[6][s]
    {\ifthenelse{\equal{#1}{d}}
        {\sbox{\first}{$\displaystyle{#4}$}
        \sbox{\second}{$\displaystyle{#5}$}}{}
    \ifthenelse{\equal{#1}{t}}
        {\sbox{\first}{$\textstyle{#4}$}
        \sbox{\second}{$\textstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{s}}
        {\sbox{\first}{$\scriptstyle{#4}$}
        \sbox{\second}{$\scriptstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{ss}}
        {\sbox{\first}{$\scriptscriptstyle{#4}$}
        \sbox{\second}{$\scriptscriptstyle{#5}$}}{}
    \setlength{\dashthickness}{0.111ex}
    \setlength{\ddashthickness}{0.35ex}
    \setlength{\leasturnstilewidth}{2em}
    \setlength{\extrawidth}{0.2em}
    \ifthenelse{%
      \equal{#3}{n}}{\setlength{\tinyverdistance}{0ex}}{}
    \ifthenelse{%
      \equal{#3}{s}}{\setlength{\tinyverdistance}{0.5\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{d}}{\setlength{\tinyverdistance}{0.5\ddashthickness}
        \addtolength{\tinyverdistance}{\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{t}}{\setlength{\tinyverdistance}{1.5\dashthickness}
        \addtolength{\tinyverdistance}{\ddashthickness}}{}
        \setlength{\verdistance}{0.4ex}
        \settoheight{\lengthvar}{\usebox{\first}}
        \setlength{\raisedown}{-\lengthvar}
        \addtolength{\raisedown}{-\tinyverdistance}
        \addtolength{\raisedown}{-\verdistance}
        \settodepth{\raiseup}{\usebox{\second}}
        \addtolength{\raiseup}{\tinyverdistance}
        \addtolength{\raiseup}{\verdistance}
        \setlength{\lift}{0.8ex}
        \settowidth{\firstwidth}{\usebox{\first}}
        \settowidth{\secondwidth}{\usebox{\second}}
        \ifthenelse{\lengthtest{\firstwidth = 0ex}
            \and
            \lengthtest{\secondwidth = 0ex}}
                {\setlength{\turnstilewidth}{\leasturnstilewidth}}
                {\setlength{\turnstilewidth}{2\extrawidth}
        \ifthenelse{\lengthtest{\firstwidth < \secondwidth}}
            {\addtolength{\turnstilewidth}{\secondwidth}}
            {\addtolength{\turnstilewidth}{\firstwidth}}}
        \ifthenelse{\lengthtest{\turnstilewidth < \leasturnstilewidth}}{\setlength{\turnstilewidth}{\leasturnstilewidth}}{}
    \setlength{\turnstileheight}{1.5ex}
    \sbox{\turnstilebox}
    {\raisebox{\lift}{\ensuremath{
        \makever{#2}{\dashthickness}{\turnstileheight}{\ddashthickness}
        \makehor{#3}{\dashthickness}{\turnstilewidth}{\ddashthickness}
        \hspace{-\turnstilewidth}
        \raisebox{\raisedown}
        {\makebox[\turnstilewidth]{\usebox{\first}}}
            \hspace{-\turnstilewidth}
            \raisebox{\raiseup}
            {\makebox[\turnstilewidth]{\usebox{\second}}}
        \makever{#6}{\dashthickness}{\turnstileheight}{\ddashthickness}}}}
        \mathrel{\usebox{\turnstilebox}}}

% \providecommand\WarningsAreErrors{false}
% \ifthenelse{\equal{\WarningsAreErrors}{true}}{\renewcommand{\GenericWarning}[2]{\GenericError{#1}{#2}{}{This warning has been turned into a fatal error.}}}{}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{theorem}{Theorem}
\newref{lem}{lemma}{Lemma}
\newref{prop}{proposition}{Proposition}
\newref{cor}{corollary}{Corollary}

\theoremstyle{definition}
\newref{defn}{definition}{Definition}
\newref{example}{example}{Example}

\theoremstyle{remark}
\newref{remark}{remark}{Remark}

\newcommand{\red}{\Rightarrow}
\newcommand{\deq}{\equiv}
\renewcommand{\ll}{\llbracket}
\newcommand{\rr}{\rrbracket}
\newcommand{\cat}[1]{\mathbf{#1}}
\newcommand{\C}{\cat{C}}
\newcommand{\D}{\cat{D}}
\newcommand{\Set}{\cat{Set}}
\newcommand{\ccat}{\cat{CCat}}
\newcommand{\syntt}{\cat{SynTT}}
\newcommand{\algtt}{\cat{AlgTT}}
\newcommand{\Mod}{\text{-}\cat{Mod}}
\newcommand{\Sig}{\cat{Sig}}
\newcommand{\Th}{\cat{Th}}
\newcommand{\ThC}{\Th_{\mathcal{C},\varnothing}}
\newcommand{\ThT}{\Th_{\mathcal{T},\varnothing}}
\newcommand{\ThP}{\Th_{\mathcal{T},\mathcal{P}_0}}
\newcommand{\ttvdash}{\vartriangleright}

\numberwithin{figure}{section}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\begin{document}

\title{Algebraic and Syntactic Presentations of Type Theories}

\author{Valery Isaev}

% \begin{abstract}
% Abstract
% \end{abstract}

\maketitle

\section{Introduction}

\begin{comment}
\section{Contextual categories}

Contextual categories were defined by Cartmell \cite{GAT}.
An equivalent definition was given by Voevodsky in \cite{c-systems}.
In this section we will give another equivalent definition which is just a description of models of the initial algebraic type theory as we will see later.
\end{comment}

\section{Essentially algebraic theories}

There are several equivalent ways of defining essentially algebraic theories (\cite{LPC}, \cite{GAT}, \cite{PHT}, \cite[D 1.3.4]{elephant}).
We will use approach introduced in \cite{PHT} under the name of partial horn theories since it seems to be the most general.
In this section we will review necessary for our development parts of the theory of partial horn theories and define a notion of morphisms between them suitable for our purposes.

\subsection{The monad of partial terms}

Given a monad $T : \Set^\mathcal{S} \to \Set^\mathcal{S}$ and a left $T$-module $F : \Set^\mathcal{S} \to \Set$, we define a monad $P : \Set^\mathcal{S} \to \Set^\mathcal{S}$.
The idea is that we think of $T(V)_s$ as a set of terms with free variables in $V$, of $F(V)$ as a set of formulae with free variables in $V$, and of $P(V)_s$ as a set of ``partial terms''.
If an ordinary term represents a function, then a partial term represents a function with its domain restricted to a subset.

Now, we recall definitions of monads and left modules over a monad.
For our purposes the following definitions will be more convenient than the ordinary ones.
\begin{defn}
A \emph{monad} $(T,\eta,(-)^*)$ on a category $\C$ consists of a function $T : Ob(\C) \to Ob(\C)$,
a function $\eta$ that to each $A \in Ob(\C)$ assign a morphism $\eta_A : Hom_\C(A,T(A))$,
and a function that to each $A,B \in Ob(\C)$ assigns a function $(-)^* : Hom_\C(A,T(B)) \to Hom_\C(T(A),T(B))$, satisfying the following conditions:
\begin{itemize}
\item $\eta_A^* = id_{T(A)}$.
\item For every $\rho : A \to T(B)$, $\rho^* \circ \eta_A = \rho$.
\item For every $\rho : A \to T(B)$, $\sigma : B \to T(C)$, $\sigma^* \circ \rho^* = (\sigma^* \circ \rho)^*$.
\end{itemize}

A \emph{left module} $(M,(-)^\circ)$ over a monad $(T,\eta,(-)^*)$ consists of a function $M : Ob(\C) \to Ob(\D)$
and a function that to each $A,B \in Ob(\C)$ assigns a function $(-)^\circ : Hom_\C(A,T(B)) \to Hom_\D(M(A),M(B))$, satisfying the following conditions:
\begin{itemize}
\item $\eta_A^\circ = id_{M(A)}$.
\item For every $\rho : A \to T(B)$, $\sigma : B \to T(C)$, $\sigma^\circ \circ \rho^\circ = (\sigma^* \circ \rho)^\circ$.
\end{itemize}
\end{defn}
These data and axioms imply that $T$ and $M$ are functorial: if $f : A \to B$, then we can define $T(f)$ as $(\eta_B \circ f)^*$ and $M(f)$ as $(\eta_B \circ f)^\circ$.
Moreover, $\eta$, $(-)^*$ and $(-)^\circ$ are natural.

Given a monad $T : \Set^\mathcal{S} \to \Set^\mathcal{S}$ and a left module $F : \Set^\mathcal{S} \to \Set$ over it,
we define a monad $P : \Set^\mathcal{S} \to \Set^\mathcal{S}$ as follows:
\[ P(V)_s = \{\ t|_\varphi\ |\ t \in T(V)_s \text{, $\varphi$ is a finite set of elements of $F(V$})\ \} \]

\subsection{The category of algebraic theories}

A signature $\Sigma = (\mathcal{S}, \mathcal{F}, \mathcal{P})$ consists of a set $\mathcal{S}$ of sorts, a set $\mathcal{F}$ of function symbols, and a set $\mathcal{P}$ of predicate symbols.
Also $\Sigma$ assigns a signature to each $\sigma \in \mathcal{F}$ which is written as $\sigma : s_1 \times \ldots \times s_n \to s$ where $s_1$, \ldots $s_n$, $s$ are sorts.
Finally $\Sigma$ assigns a signature to each $R \in \mathcal{P}$ which is written as $R : s_1 \times \ldots \times s_n$ where $s_1$, \ldots $s_n$ are sorts.
For each $V \in \Set^\mathcal{S}$ we can define a set $Term_\mathcal{F}(V)_s$ of terms of sort $s$ inductively:
\begin{itemize}
\item If $x \in V_s$, then $x \in Term_\mathcal{F}(V)_s$.
\item If $\sigma : s_1 \times \ldots \times s_n \to s$ and $t_i \in Term_\mathcal{F}(V)_{s_i}$, then $\sigma(t_1, \ldots t_n) \in Term_\mathcal{F}(V)_s$.
\end{itemize}
Then $Term_\mathcal{F}(V)$ is actually a functor $Term_\mathcal{F} : \Set^\mathcal{S} \to \Set^\mathcal{S}$.

An \emph{atomic formula} over $\Sigma$ with free variables in $V$ is an expression either of the form $t_1 = t_2$ where $t_1, t_2 \in Term_\Sigma(V)_s$ for some sort $s$ or of the form $R(t_1, \ldots t_n)$ where $R \in \mathcal{P}$, $R : s_1 \times \ldots \times s_n$ and $t_i \in Term_\Sigma(V)_{s_i}$.
A \emph{Horn formula} over $\Sigma$ with free variables in $V$ is an expression of the form $\varphi_1 \land \ldots \land \varphi_n$ where $\varphi_i$ are atomic formulae.
If $n = 0$, then we write such a formula as $\top$.
A \emph{Horn sequent} over $\Sigma$ is an expression of the form $\varphi \sststile{}{V} \psi$ where $\varphi$ and $\psi$ are Horn formulae over $\Sigma$ with free variables in $V$.
We will often write $\varphi_1, \ldots \varphi_n \sststile{}{V} \psi_1, \ldots \psi_k$ insted of $\varphi_1 \land \ldots \land \varphi_n \sststile{}{V} \psi_1 \land \ldots \land \psi_k$.
We will use the following abbreviations:
\begin{align*}
t\!\downarrow & \text{ means } t = t \\
\sststile{}{V} t \leftrightharpoons s & \text{ means } t\!\downarrow, s\!\downarrow\,\sststile{}{V} t = s \\
\sststile{}{V} t \cong s & \text{ means } t\!\downarrow\,\sststile{}{V} t = s \text{ and } s\!\downarrow\,\sststile{}{V} t = s \\
\varphi \ssststile{}{V} \psi & \text{ means } \varphi \sststile{}{V} \psi \text{ and } \psi \sststile{}{V} \varphi
\end{align*}

A \emph{Horn theory} in a signature $\Sigma$ is a set of Horn sequents over $\Sigma$.
The rules of \emph{Partial Horn logic} are listed below.
In these rules for every sequent $\varphi \sststile{}{V} \psi$ the set of variables $V$ is such that $FV(\varphi) \cup FV(\psi) \subseteq V$.
Note that this set of rules is equivalent to the one described in \cite{PHT}.
\begin{center}
$\varphi \sststile{}{V} \varphi$ (b1)
\qquad
\AxiomC{$\varphi \sststile{}{V} \psi$}
\AxiomC{$\psi \sststile{}{V} \chi$}
\RightLabel{(b2)}
\BinaryInfC{$\varphi \sststile{}{V} \chi$}
\DisplayProof
\qquad
$\varphi \sststile{}{V} \top$ (b3)
\end{center}

\medskip
\begin{center}
$\varphi \land \psi \sststile{}{V} \varphi$ (b4)
\qquad
$\varphi \land \psi \sststile{}{V} \psi$ (b5)
\qquad
\AxiomC{$\varphi \sststile{}{V} \psi$}
\AxiomC{$\varphi \sststile{}{V} \chi$}
\RightLabel{(b6)}
\BinaryInfC{$\varphi \sststile{}{V} \psi \land \chi$}
\DisplayProof
\end{center}

\medskip
\begin{center}
$\sststile{}{x} x\!\downarrow$ (a1)
\qquad
$x = y \land \varphi \sststile{}{V} \varphi[y/x]$ (a2)
\end{center}

\medskip
\begin{center}
\AxiomC{$\varphi \sststile{}{V} \psi$}
\RightLabel{if $x \in FV(\varphi)$ (a3)}
\UnaryInfC{$\varphi[t/x] \sststile{}{V'} \psi[t/x]$}
\DisplayProof
\end{center}
\medskip

If $\mathbb{T}$ is a Horn theory, then a \emph{theorem} of $\mathbb{T}$ is a sequent derivable from $\mathbb{T}$ in this logic.
We say that a theory $\mathbb{T}$ is \emph{total} if for every function symbols $\sigma : s_1 \times \ldots \times s_n \to s$ sequent $\sststile{}{x_1, \ldots x_n} \sigma(x_1, \ldots x_n)\!\downarrow$ is a theorem of $\mathbb{T}$.

Now we introduce a functor $PTerm_\Sigma : \Set^\mathcal{S} \to \Set^\mathcal{S}$ of ``partial terms''.
If an ordinary term represents a function, then a partial term represents a function with its domain restricted to a subset.
We define $PTerm_\Sigma(V)_s$ as the set of expressions $t|_\varphi$ where $t \in Term_\mathcal{F}(V)_s$ and $\varphi$ is a Horn formula over $\Sigma$ with free variables in $V$.
If $\varphi = \top$, then we will write $t|_\varphi$ simply as $t$.
We will use the following notations:
\begin{align*}
R(t_1|_{\varphi_1}, \ldots t_n|_{\varphi_n}) & \text{ means } R(t_1, \ldots t_n) \land \varphi_1 \land \ldots \land \varphi_n \\
t|_\varphi = s|_\psi & \text{ means } t = s \land \varphi \land \psi \\
t|_\varphi\!\downarrow & \text{ means } t\!\downarrow\!\land \varphi \\
\sststile{}{V} t|_\varphi \leftrightharpoons s|_\psi & \text{ means } t|_\varphi\!\downarrow, s|_\psi\!\downarrow\,\sststile{}{V} t = s \\
\sststile{}{V} t|_\varphi \cong s|_\psi & \text{ means } t|_\varphi\!\downarrow\,\sststile{}{V} t = s \land \psi \text{ and } s|_\psi\!\downarrow\,\sststile{}{V} t = s \land \varphi
\end{align*}

Let $\Sigma = (\mathcal{S}, \mathcal{F}, \mathcal{P})$ and $\Sigma' = (\mathcal{S}, \mathcal{F}', \mathcal{P}')$ be a pair of signatures with the same set of sorts.
Let $F$ be a function that to each $R \in \mathcal{P}$, $R : s_1 \times \ldots \times s_n$ assigns a Horn formula over $\Sigma'$ with free variables in $\{ x_1 : s_1, \ldots x_n : s_n \}$
and to each $\sigma \in \mathcal{F}$, $\sigma : s_1 \times \ldots \times s_n \to s$ assigns a partial term in $PTerm_{\Sigma'}(\{ x_1 : s_1, \ldots x_n : s_n \})_s$.
Given such a function $F$ we can extend it to a morphism $Term_\mathcal{F}(V) \to PTerm_\mathcal{F}(V)$:
\begin{itemize}
\item $F(x) = x$ if $x \in V$.
\item $F(\sigma(a_1, \ldots a_n)) = t[a_1'/x_1, \ldots a_n'/x_n]|_{\varphi[a_1'/x_1, \ldots a_n'/x_n] \land \varphi_1 \land \ldots \land \varphi_n}$ \\
    where $F(\sigma(x_1, \ldots x_n)) = t|_\varphi$ and $F(a_i) = a_i'|_{\varphi_i}$.
\end{itemize}
For each Horn formula $\varphi$ over $\Sigma$ we can define a formula $F(\varphi)$ over $\Sigma'$ as follows:
\begin{itemize}
\item If $\varphi$ is of the form $t_1 = t_2$, then let $F(\varphi)$ be equal to $F(t_1) = F(t_2)$.
\item If $\varphi$ is of the form $R(t_1, \ldots t_n)$, then $F(\varphi) = R(F(t_1), \ldots F(t_n))$.
\item $F(\varphi_1 \land \ldots \land \varphi_n) = F(\varphi_1) \land \ldots \land F(\varphi_n)$.
\end{itemize}

If $\varphi \sststile{}{V} \psi$ is a sequent over $\Sigma$, then $F(\varphi) \sststile{}{V} F(\psi)$ is a sequent over $\Sigma'$.
Let $\mathbb{T}$ and $\mathbb{T}'$ be Horn theories in signatures $\Sigma$ and $\Sigma'$ respectively.
Then we will say that $F$ \emph{respects} a sequent $\varphi \sststile{}{V} \psi$ if $F(\varphi) \sststile{}{V} F(\psi)$ is a theorem of $\mathbb{T}'$.
Note that if $F$ respects all axioms of $\mathbb{T}$, then it respects all of its theorems too.
We will say that morphisms $F$ and $G$ are \emph{equivalent} if the following conditions hold:
\begin{itemize}
\item For every $R \in \mathcal{P}$, $R : s_1 \times \ldots \times s_n$ sequent $F(R(x_1, \ldots x_n)) \ssststile{}{x_1, \ldots x_n} G(R(x_1, \ldots x_n))$ is a theorem of $\mathbb{T}'$.
\item For every $\sigma \in \mathcal{F}_\Sigma$, $\sigma : s_1 \times \ldots \times s_n \to s$ sequents
    $\sststile{}{x_1, \ldots x_n} F(\sigma(x_1, \ldots x_n)) \cong G(\sigma(x_1, \ldots x_n))$ are theorems of $\mathbb{T}'$
\end{itemize}
Note that if $F$ and $G$ are equivalent then $\sststile{}{V} F(t) \cong G(t)$ are theorems of $\mathbb{T}'$ for each $t \in Term_\Sigma(V)_s$.

Let $\mathcal{S}$ be a set of sorts.
Then we define a category $\Th_\mathcal{S}$ of theories.
Its objects are triples $(\mathcal{F},\mathcal{P},\mathbb{T})$ where $\mathbb{T}$ is a theory in $(\mathcal{S},\mathcal{F},\mathcal{P})$.
Morphisms of theories $(\mathcal{F},\mathcal{P},\mathbb{T})$ and $(\mathcal{F}',\mathcal{P}',\mathbb{T}')$
are equivalence classes of functions as described above which respect all axioms of $\mathbb{T}$.
The composition of morphisms of signatures respects the equivalence relation; hence this defines a category of theories.

\begin{prop}
Category $\Th_{\mathcal{S},\mathcal{P}}$ is locally finitely presentable.
\end{prop}
\begin{proof}
First, let $\{ (\mathcal{F}_i,\mathcal{P}_i,\mathbb{T}_i) \}_{i \in S}$ be a set of theories.
Then we can define its coproduct $\coprod\limits_{i \in S} \mathbb{T}_i$ as the theory with $\coprod\limits_{i \in S} \mathcal{F}_i$ as the set of function symbols and $\coprod\limits_{i \in S} \mathbb{T}_i$ as the set of axioms.
Let $F,G : T \to S$ be a pair of morphisms of theories.
Then we can define their coequalizer as the theory with the same set of function symbols as $S$ and the set of axioms which consists of the axioms of $S$
together with $\sststile{}{x_1, \ldots x_n} F(\sigma(x_1, \ldots x_n)) \cong G(\sigma(x_1, \ldots x_n))$ for each function symbols $\sigma$ of $T$.
It is easy to see that these constructions indeed define colimits of theories.

Now, if a theory consists of a finite number of function symbols and axioms, then it is finitely presentable.
Indeed, let $\mathbb{T}$ be such theory, let $D : J \to \Th_{\mathcal{S},\mathcal{P}}$ be a directed set, and let $f : \mathbb{T} \to colim\,D$ be a morphism.
\end{proof}

\label{sec:T0}
\section{Theory $\mathbb{T}_0$}

Let $\mathcal{T} = \{ ty, tm \} \times \mathbb{N}$ be a set of sorts.
We will write $(ctx,n)$ for $(ty,n-1)$ if $n > 0$.
Sort $(tm,n)$ represents terms in contexts of length $n$, sort $(ty,n)$ represents types in contexts of length $n$, and sort $(ctx,n)$ represents contexts of length $n$.
Sometimes it is convinient to have a sort for contexts of length 0.
So we define $\mathcal{C} = \mathcal{T} \cup \{ (ctx,0) \}$.
Let $\mathbb{T}_{-1} \in \ThC$ be the theory with one function symbol $* : (ctx,0)$ and the following axioms:
\begin{align*}
& \sststile{}{} * \downarrow \\
& \sststile{}{A} A = *
\end{align*}

\begin{prop}
Categories $\ThT$ and $\mathbb{T}_{-1}/\ThC$ are equivalent.
\end{prop}
\begin{proof}
Every theory in $\ThT$ is a theory in $\ThC$ in the obvious way.
We define $F : \ThT \to \mathbb{T}_{-1}/\ThC$ as $F(X) = \mathbb{T}_{-1} \amalg X$.
Every morphism of theories $\mathbb{T}$ and $\mathbb{T}'$ corresponds to exactly one morphism of theories $F(\mathbb{T})$ and $F(\mathbb{T}')$
since terms in $i(\mathbb{T}')$ cannot have sort $(ctx,0)$.
Thus $F$ is fully faithful.

We need to prove that $F$ is essentially surjective.
Given a theory $\mathbb{T} \in \ThC$ and a morphism $c : \mathbb{T}_{-1} \to \mathbb{T}$ we define a theory $\mathbb{T}' \in \ThT$.
This theory contains one function symbol $\sigma$ for every function symbols $\sigma$ of $\mathbb{T}$ such that $\sigma : s_1 \times \ldots \times s_n \to s$ and $s \in \mathcal{T}$.
We let $\sigma : s_{i_1} \times \ldots \times s_{i_k} \to s$ where $\{ i_1, \ldots i_k \} \subset \{ 1, \ldots n \}$ consists of those $i$ for which $s_i \in \mathcal{T}$.
For every $V$ and $s \in \mathcal{T}$ we define function $\alpha : Term_\mathbb{T}(V)_s \to Term_{\mathbb{T}'}(V)_s$ as follows:
\begin{align*}
\alpha(x) & = x \text{ if } x \in V \\
\alpha(\sigma(a_1, \ldots a_n)) & = \sigma(\alpha(a_{i_1}), \ldots \alpha(a_{i_k}))
\end{align*}
If $\varphi$ is a formula $t = s$ of $\mathbb{T}$, then we define formula $\alpha(\varphi)$ of $\mathbb{T}'$ as $\alpha(t) = \alpha(s)$
if terms $t$ and $s$ have a sort in $\mathcal{T}$ and as $\top$ otherwise.
Axioms of $\mathbb{T}'$ are sequents $\alpha(\varphi_1) \land \ldots \land \alpha(\varphi_n) \sststile{}{V} \alpha(\psi_1) \land \ldots \land \alpha(\psi_k)$
for every axiom $\varphi_1 \land \ldots \land \varphi_n \sststile{}{V} \psi_1 \land \ldots \land \psi_k$ of $\mathbb{T}$.

Now, $F(\mathbb{T}')$ and $\mathbb{T}$ are isomorphic.
Indeed, we can extend $\alpha$ to a morphism $\alpha : \mathbb{T} \to \mathbb{T}_{-1} \amalg \mathbb{T}'$
by defining $\alpha(\sigma(a_1, \ldots a_n)) = *$ if $\sigma : s_1 \times \ldots \times s_n \to (ctx,0)$.
Let $\beta : \mathbb{T}' \to \mathbb{T}$ be the following morphism:
\[ \beta(\sigma(x_{i_1}, \ldots x_{i_k})) = \sigma(b_1, \ldots b_n) \]
where $b_j = x_{i_t}$ if $j = i_t$ and $b_j = *$ otherwise.
Then $[c,\beta] : \mathbb{T}_{-1} \amalg \mathbb{T}' \to \mathbb{T}$ is the inverse of $\alpha$.
Thus $F$ is essentially surjective.
\end{proof}

We define $\mathbb{T}_0 \in \ThT$ as the theory with the set of function symbols $\{ ft_n : (ctx,n+1) \to (ctx,n)\ |\ n > 0 \} \cup \{ ty_n : (tm,n) \to (ty,n)\ |\ n \in \mathbb{N} \}$ and the following axioms:
\begin{align*}
& \sststile{}{A} ft_n(A) \downarrow \\
& \sststile{}{a} ty_n(a) \downarrow
\end{align*}
Let $ft^i_n : (ctx,n+i) \to (ctx,n)$ be the following derived operation:
\begin{align*}
& ft^0_n(A) = A \\
& ft^{i+1}_n(A) = ft^i_n(ft_{n+i}(A))
\end{align*}

Let $\mathcal{P}_0 = \{ D^n_p\ |\ n \in \mathbb{N}, p \in \{ ty, tm \} \}$ be a set of predicate symbols with the following signatures:
\begin{align*}
D^n_{ty} & : (ty,0) \times \ldots \times (ty,n-1) \times (ty,n) \\
D^n_{tm} & : (ty,0) \times \ldots \times (ty,n-1) \times (tm,n) \times (ty,n)
\end{align*}
We define derived predicates $D^n_{ctx} : (ty,0) \times \ldots \times (ty,n)$ as follows:
\begin{align*}
D^0_{ctx} & = \top \\
D^{n+1}_{ctx}(A_1, \ldots A_{n+1}) & = D^n_{ty}(A_1, \ldots A_{n+1})
\end{align*}
We will use the following standard notations:
\begin{align*}
A_1, \ldots A_n & \vdash \text{ means } D^n_{ctx}(A_1, \ldots A_n), \\
A_1, \ldots A_n & \vdash A \text{ means } D^n_{ty}(A_1, \ldots A_n, A), \\
A_1, \ldots A_n & \vdash a : A \text{ means } D^n_{tm}(A_1, \ldots A_n, a, A).
\end{align*}

Let $\mathbb{T}'_0 \in \Th_{\mathcal{T},\mathcal{P}_0}$ be the theory with no function symbols and with the following axioms:
\begin{align*}
D^n_{ty}(A_1, \ldots A_n, A) & \sststile{}{A_1, \ldots A_n, A} D^n_{ctx}(A_1, \ldots A_n) \\
D^n_{tm}(A_1, \ldots A_n, a, A) & \sststile{}{A_1, \ldots A_n, a, A} D^n_{ty}(A_1, \ldots A_n, A) \\
D^{n+1}_{ty}(A_1, \ldots A_{n+1}, A) \land D^{n+1}_{ty}(A_1', \ldots A_{n+1}', A) & \sststile{}{A_1, \ldots A_{n+1}, A_1', \ldots A_{n+1}', A} A_{n+1} = A_{n+1}' \\
D^n_{tm}(A_1, \ldots A_n, a, A) \land D^n_{tm}(A_1', \ldots A_n', a, A') & \sststile{}{A_1, \ldots A_n, A_1', \ldots A_n', a, A, A'} A = A'
\end{align*}
Category $\mathbb{T}'_0/\Th_{\mathcal{T},\mathcal{P}_0}$ is the full subcategory of $\Th_{\mathcal{T},\mathcal{P}_0}$ on those theories in which axioms of $\mathbb{T}'_0$ are provable.

\begin{prop}
Categories $\mathbb{T}_0/\Th_{\mathcal{T},\varnothing}$ and $\mathbb{T}'_0/\Th_{\mathcal{T},\mathcal{P}_0}$ are equivalent.
\end{prop}
\begin{proof}
Every theory in $\ThT$ is a theory in $\ThP$ in the obvious way.
We define $F : \mathbb{T}_0/\ThT \to \mathbb{T}'_0/\ThP$ as $F(X) = X \cup \mathbb{T}'_0 \cup \mathbb{T}''_0$ where $\mathbb{T}''_0$ consists of the following axioms:
\[ \{\ \sststile{}{A} D^n_{ty}(ft^n(A), \ldots ft^1(A), A)\ |\ n \in \mathbb{N}\ \} \]
\[ \{\ \sststile{}{a} D^n_{tm}(ft^n(ty(a)), \ldots ft^1(ty(a)), a, ty(a))\ |\ n \in \mathbb{N}\ \} \]
% Every morphism of theories $\mathbb{T}$ and $\mathbb{T}'$ corresponds to exactly one morphism of theories $F(\mathbb{T})$ and $F(\mathbb{T}')$
% since terms in $i(\mathbb{T}')$ cannot have sort $(ctx,0)$.
% Thus $F$ is fully faithful.
\end{proof}

\section{Theories under $\mathbb{T}_0$}

In this section we give an alternative description of theories under $\mathbb{T}_0$.

Let $\mathcal{F}$ be a set of function symbols with $\mathcal{T}$ as the set of sorts.
A \emph{context} of length $n$ is a sequence of terms of sorts $(ty,0)$, \ldots $(ty,n-1)$.
Contexts are usually denoted by greek letters $\Gamma$ and $\Delta$.
In order to define syntactic theories over $\mathcal{F}$, we need to introduce an additional structure on this set.
For each $\sigma \in \mathcal{F}$, $\sigma : (p_1,n_1) \times \ldots \times (p_k,n_k) \to (p,n)$ and each $1 \leq i \leq n$,
let $D_i(\sigma)$ be a context of length $n_i$ with free variables $\{\ A_j : (ty,j)\ |\ 1 \leq j \leq n\ \} \cup \{\ x_j : (p_j,n_j)\ |\ 1 \leq j \leq k\ \}$.

We will denote such context as $D_i(A_1, \ldots A_n \vdash \sigma(x_1, \ldots x_k))$.
The idea is that $D_i(\sigma)$ should be a context in which $x_i$ is typeable if $A_1, \ldots A_n \vdash \sigma(x_1, \ldots x_k)$ holds.

Then \emph{a syntactic atomic formula} over $\mathcal{F}$ with free variables in $V$ is an expression either of the form $A_1, \ldots A_n \vdash A \deq A'$ or of the form $A_1, \ldots A_n \vdash a \deq a' : A$
where $A_i$ is a term of sort $(ty,i-1)$, $A$ and $A'$ are terms of sort $(ty,n)$, and $a$ and $a'$ are terms of sort $(tm,n)$.
Horn sequents are defined as before.
We will use the following abbreviations:
\begin{align*}
\Gamma \vdash A & \text{ means } \Gamma \vdash A \deq A \\
\Gamma \vdash a : A & \text{ means } \Gamma \vdash a \deq a : A
\end{align*}

A \emph{syntactic Horn theory} in a signature $\Sigma = (\mathcal{T}, \mathcal{F}, \varnothing)$ is a set of Horn sequents over $\Sigma$.
Now we need to describe the rules of the logic for these theories.
It has the rules (b1)-(b6) and (a3) as in partial Horn logic.
It does not have an analog for the axiom (a1), but it has the following set of axioms analogous to (a2):
\begin{center}
\end{center}

In these rules for every sequent $\varphi \sststile{}{V} \psi$ the set of variables $V$ is such that $FV(\varphi) \cup FV(\psi) \subseteq V$.
Note that this set of rules is equivalent to the one described in \cite{PHT}.
\begin{center}
$\varphi \sststile{}{V} \varphi$ (b1)
\qquad
\AxiomC{$\varphi \sststile{}{V} \psi$}
\AxiomC{$\psi \sststile{}{V} \chi$}
\RightLabel{(b2)}
\BinaryInfC{$\varphi \sststile{}{V} \chi$}
\DisplayProof
\qquad
$\varphi \sststile{}{V} \top$ (b3)
\end{center}

A \emph{syntactic theory} consists of 

\section{Syntactic presentation of type theories}

A signature $\Sigma = (\mathcal{S}, \mathcal{F}, \mathcal{P})$ consists of three sets as before.
For a syntactic presentation we assume that $\mathcal{S} = \mathcal{T}$ and $\mathcal{P} = \varnothing$.
A \emph{syntactic atomic formula} over $\Sigma$ with free variables in $V$ is an expression either of the form $E_{ty}(A_0, \ldots A_{n-1}, A, A')$
or of the form $E_{tm}(A_0, \ldots A_{n-1}, A, a, a')$ where $A_i \in Term_\Sigma(V)_{(ty,i)}$, $A,A' \in Term_\Sigma(V)_{(ty,n)}$ and $a,a' \in Term_\Sigma(V)_{(tm,n)}$.
A \emph{Horn sequent} over $\Sigma$ is an expression of the form $\varphi \sststile{}{V} \psi$ where $\varphi$ and $\psi$ are finite sets of atomic formulae over $\Sigma$ with free variables in $V$.
We will use the following notations:
\begin{align*}
D_{ty}(A_1, \ldots A_n, A) & \text{ means } E_{ty}(A_1, \ldots A_n, A, A) \\
D_{tm}(A_1, \ldots A_n, A, a) & \text{ means } E_{tm}(A_1, \ldots A_n, A, a, a) \\
A_1, \ldots A_n \vdash A & \text{ means } D_{ty}(A_1, \ldots A_n, A) \\
A_1, \ldots A_n \vdash a : A & \text{ means } D_{tm}(A_1, \ldots A_n, A, a) \\
A_1, \ldots A_n \vdash A \deq A' & \text{ means } E_{ty}(A_1, \ldots A_n, A, A') \\
A_1, \ldots A_n \vdash a \deq a' : A & \text{ means } E_{tm}(A_1, \ldots A_n, A, a, a')
\end{align*}

A \emph{Horn theory} in a signature $\Sigma$ is a set of Horn sequents over $\Sigma$.
% TODO: Describe rules of the logic.
If $\mathbb{T}$ is a Horn theory, then a \emph{theorem} of $\mathbb{T}$ is a sequent derivable from $\mathbb{T}$ in this logic.

Let $F$ be a morphism of signatures $\Sigma$ and $\Sigma'$.
Then for each formula $\varphi$ over $\Sigma$ we can define formula $F(\varphi)$ over $\Sigma'$ just by applying $F$ to every term in $\varphi$.
If $\varphi \sststile{}{V} \psi$ is a sequent over $\Sigma$, then $F(\varphi) \sststile{}{V} F(\psi)$ is a sequent over $\Sigma'$.
Let $\mathbb{T}$ and $\mathbb{T}'$ be Horn theories in signatures $\Sigma$ and $\Sigma'$ respectively.
Then we will say that $F$ \emph{respects} a sequent $\varphi \sststile{}{V} \psi$ if $F(\varphi) \sststile{}{V} F(\psi)$ is a theorem of $\mathbb{T}'$.
Note that if $F$ respects all axioms of $\mathbb{T}$, then it respects all of its theorems too.
We will say that morphisms $F$ and $G$ are \emph{equivalent} if for all $\sigma \in \mathcal{F}_\Sigma$, $\sigma : s_1 \times \ldots \times s_n \to s$ sequent $\sststile{}{x_1, \ldots x_n} F(\sigma(x_1, \ldots x_n)) \cong G(\sigma(x_1, \ldots x_n))$ is a theorem of $\mathbb{T}'$.
Note that if $F$ and $G$ are equivalent then $\sststile{}{V} F(t) = G(t)$ is a theorem of $\mathbb{T}'$ for each $t \in Term_\Sigma(V)_s$.

Now, we define a category of theories.
Its objects are pairs $(\mathcal{F},\mathbb{T})$ where $\mathcal{F}$ is a set of function symbols and $\mathbb{T}$ is a theory in $(\mathcal{S},\mathcal{F},\mathcal{P})$.
Morphisms of theories $(\mathcal{F},\mathbb{T})$ and $(\mathcal{F}',\mathbb{T}')$ are equivalence classes of morphisms of signatures $(\mathcal{S},\mathcal{F},\mathcal{P})$ and $(\mathcal{S},\mathcal{F}',\mathcal{P})$ which respect all axioms of $\mathbb{T}$.
The composition of morphisms of signatures respects the equivalence relation; hence this defines a category of theories which will be denoted by $\Th_{\mathcal{S},\mathcal{P}}$.
Note that $\Sig_{\mathcal{S},\mathcal{P}}$ is a full subcategory of $\Th_{\mathcal{S},\mathcal{P}}$; indeed, every signature can be considered as a theory with an empty set of axioms.

\label{sec:T1}
\section{Theory $\mathbb{T}_1$}

In this section we will describe a quasi-equational theory $\mathbb{T}_1$ and prove that the category of models of $\mathbb{T}_1$ is equivalent to the category of contextual categories.
Later we will use this theory to define algebraic type theories.

The set of function symbols of $\mathbb{T}_1$ consists of the symbols of $\mathbb{T}_0$ and the following symbols:
\begin{align*}
v_{n,i}       & : (ctx,n) \to (tm,n) \text{, } 0 \leq i < n \\
subst_{p,n,k} & : (ctx,n) \times (p,k) \times (tm,n)^k \to (p,n) \text{, } p \in \{ tm, ty \}
\end{align*}

Auxiliary predicates $Hom_{n,k} : (ctx,n) \times (ctx,k) \times (tm,n)^k$ are defined as follows: $Hom_{n,k}(B, A, a_1, \ldots a_k)$ holds if and only if
\[ ty_n(a_i) = subst_{ty,n,i-1}(B, ft^{k-i}_i(A), a_1, \ldots a_{i-1}) \text{ for each } 1 \leq i \leq k \]
The idea is that a tuple of terms should represent a morphism in a contextual category.
So $Hom_{n,k}(B, A, a_1, \ldots a_k)$ holds if and only if $(a_1, \ldots a_k)$ is a morphism with domain $A$ and codomain $B$.
Note that if $Hom_{n,k}(B, A, a_1, \ldots a_k)$, then $ft_n(ty_n(a_i)) = B$.

The set of axioms of $\mathbb{T}_1$ consists of the axioms of $\mathbb{T}_0$ and the axioms we list below.
The following axioms describe when functions are defined:
\begin{align}
\label{ax:def-var}
                                             & \sststile{}{A}           v_{n,i}(A) \downarrow \\
\label{ax:def-Subst}
Hom_{n,k}(B, ft_k(A), a_1, \ldots a_k)       & \ssststile{}{B, A, a_i}  subst_{ty,n,k}(B, A, a_1, \ldots a_k) \downarrow \\
\label{ax:def-subst}
Hom_{n,k}(B, ft_k(ty_k(a)), a_1, \ldots a_k) & \ssststile{}{B, a, a_i}  subst_{tm,n,k}(B, a, a_1, \ldots a_k) \downarrow
\end{align}

The following axioms describe the ``typization'' of the constructions we have:
\begin{align}
\label{ax:type-var}
& \sststile{}{A}         ty_n(v_{n,i}(A)) = Subst_{n,n-i-1}(A, ft^i_{n-i}(A), v_{n,n-1}(A), \ldots v_{n,i+1}(A)) \\
\label{ax:type-Subst}
& \sststile{}{B, A, a_i} ft_n(Subst_{n,k}(B, A, a_1, \ldots a_k)) \leftrightharpoons B \\
\label{ax:type-subst}
& \sststile{}{B, a, a_i} ty_n(subst_{n,k}(B, a, a_1, \ldots a_k)) \leftrightharpoons Subst_{n,k}(B, ty_k(a), a_1, \ldots a_k)
\end{align}

The following axioms prescribe how substitution ($Subst_{n,k}$ and $subst_{n,k}$) must be defined on indices ($v_{n,i}$):
\begin{align}
\label{ax:Subst-var}
& \sststile{}{A}         Subst_{n,n}(ft_n(A), A, v_{n,n-1}(ft_n(A)), \ldots v_{n,0}(ft_n(A))) = A \\
\label{ax:subst-var}
& \sststile{}{a}         subst_{n,n}(ft_n(ty_n(a)), a, v_{n,n-1}(ft_n(ty_n(a))), \ldots v_{n,0}(ft_n(ty_n(a)))) = a \\
\label{ax:var-subst}
& Hom_{n,k}(B, A, a_1, \ldots a_k) \sststile{}{B, a_i, A} subst_{n,k}(B, v_{k,i}(A), a_1, \ldots a_k) = a_{k-i}
\end{align}

The following axioms say that substitution must be ``associative'':
\begin{align}
\label{ax:Subst-Subst}
& Hom_{n,k}(C, B, b_1, \ldots b_k) \land Hom_{k,m}(B, ft_m(A), a_1, \ldots a_m) \sststile{}{C, b_i, B, a_i, A} \\ \notag
& Subst_{n,k}(C, Subst_{k,m}(B, A, a_1, \ldots a_m), b_1, \ldots b_k) = \\ \notag
& Subst_{n,m}(C, A, subst_{n,k}(C, a_1, b_1, \ldots b_k), \ldots subst_{n,k}(C, a_m, b_1, \ldots b_k)) \\
\label{ax:subst-subst}
& Hom_{n,k}(C, B, b_1, \ldots b_k) \land Hom_{k,m}(B, ft_m(ty_m(a)), a_1, \ldots a_m) \sststile{}{C, b_i, B, a_i, a} \\ \notag
& subst_{n,k}(C, subst_{k,m}(B, a, a_1, \ldots a_m), b_1, \ldots b_k) = \\ \notag
& subst_{n,m}(C, a, subst_{n,k}(C, a_1, b_1, \ldots b_k), \ldots subst_{n,k}(C, a_m, b_1, \ldots b_k))
\end{align}

Now, we want to show that the category of models of $\mathbb{T}_1$ is equivalent to the category of contextual categories.
First, we construct a functor $F : \mathbb{T}_1\Mod \to \ccat$.
Let $M$ be a model of $\mathbb{T}_1$.
Then the set of objects of level $n$ of $F(M)$ is $M(Ctx_n)$.
For each $A \in M(Ctx_n)$, $B \in M(Ctx_k)$ morphisms from $A$ to $B$ are tuples $(a_1, \ldots a_k)$ such that $a_i \in M(Tm_n)$ and $Hom_{n,k}(A, B, a_1, \ldots a_k)$.

For each $0 \leq i \leq n$ axiom~\eqref{ax:type-var} implies
\[ \sststile{}{A} Hom_{n,n-i}(A, ft^i_{n-i}(A), v_{n,n-1}(A), \ldots v_{n,i}(A)). \]
For each $A \in M(Ctx_n)$ we define $id_A : A \to A$ as tuple
\[ (v_{n,n-1}(A), \ldots v_{n,0}(A)) \]
and $p_A : A \to ft(A)$ as tuple
\[ (v_{n,n-1}(A), \ldots v_{n,1}(A)). \]

Now, we introduce some notation.
If $B \in M(Ctx_n)$, $A \in M(Ctx_{k+1})$, and $f = (a_1, \ldots a_k) : B \to ft_k(A)$ is a morphism, then we define $A[f] \in M(Ctx_{n+1})$ as $Subst_{n,k}(B, A, a_1, \ldots a_k)$.
If $a \in M(Tm_k)$ and $ty_k(a) = A$, then we define $a[f] \in M(Tm_n)$ as $subst_{n,k}(B, a, a_1, \ldots a_k)$.
By axioms \eqref{ax:def-Subst} and \eqref{ax:def-subst} these constructions are total.

If $A \in M(Ctx_n)$, $B \in M(Ctx_k)$, $C \in M(Ctx_m)$, $f : A \to B$, and $(c_1, \ldots c_m) : B \to C$, then we define composition $(c_1, \ldots c_m) \circ f$ as $(c_1[f], \ldots c_m[f])$.
The following sequence of equations shows that $(c_1, \ldots c_m) \circ f : A \to C$.
\begin{align*}
ty_n(c_i[f]) & = \text{(by axiom~\eqref{ax:type-subst})} \\
ty_k(c_i)[f] & = \text{(since $Hom_{k,m}(c_1, \ldots c_m)$)} \\
ft^{m-i}_i(C)[c_1, \ldots c_{i-1}][f] & = \text{(by axiom~\eqref{ax:Subst-Subst})} \\
ft^{m-i}_i(C)[c_1[f], \ldots c_{i-1}[f]] &
\end{align*}

With these notations we can rewrite axioms \eqref{ax:type-subst}, \eqref{ax:Subst-var}, \eqref{ax:subst-var}, \eqref{ax:Subst-Subst}, \eqref{ax:subst-subst} as follows:
\begin{align}
\setcounter{equation}{\ref{ax:type-subst}}
\addtocounter{equation}{-1}
ty_n(a[f]) & = A[f] \\ \notag
\text{ for each } f : B \to ft_k(A) & \text{ where } A = ty_k(a) \\
A[id_{ft_n(A)}] & = A \\
a[id_{ft_n(ty_n(a))}] & = a \\
\setcounter{equation}{\ref{ax:Subst-Subst}}
\addtocounter{equation}{-1}
A[g][f] & = A[g \circ f] \\ \notag
\text{ for each } f : C \to B \text{ and } & g : B \to ft_m(A) \\
a[g][f] & = a[g \circ f] \\ \notag
\text{ for each } f : C \to B \text{ and } & g : B \to ft_m(ty_m(a))
\end{align}

Associativity of the composition follows from axiom~\eqref{ax:subst-subst}, and the fact that $id$ is identity for it follows from axioms \eqref{ax:subst-var} and \eqref{ax:var-subst}.

For every $A \in M(Ctx_{k+1})$ there is a bijection $\varphi$ between the set of $a \in M(Tm_k)$ such that $ty_k(a) = A$ and the set of morphisms $f : ft_k(A) \to A$ such that $p_A \circ f = id_{ft_k(A)}$.
For every such $a \in M(Tm_k)$ we define $\varphi(a)$ as
\[ (v_{k,k-1}(ft_k(A)), \ldots v_{k,0}(ft_k(A)), a). \]
Note that if $(a_1, \ldots a_{k+1}) : B \to A$ is a morphism, then axiom~\eqref{ax:var-subst} implies that $p_A \circ (a_1, \ldots a_{k+1})$ equals to $(a_1, \ldots a_k)$.
Thus $\varphi(a)$ is a section of $p_A$.
Clearly, $\varphi$ is injective.
Let $f : ft_k(A) \to A$ be a section of $p_A$; then first $k$ components of $f$ must be identity on $ft_k(A)$.
So if $a$ is the last component of $f$, then $\varphi(a)$ equals to $f$.
Hence $\varphi$ is bijective.

If $A \in M(Ctx_{k+1})$, $B \in M(Ctx_n)$, and $f = (a_1, \ldots a_k) : B \to ft_k(A)$, then we define $f^*(A)$ as $A[f] = Subst_{n,k}(B, A, a_1, \ldots a_k)$.
Map $q(f,B)$ defined as the tuple with $i$-th component equals to
\[ \left\{
  \begin{array}{lr}
    a_i[v_{n+1,n}(A[f]), \ldots v_{n+1,1}(A[f])] & \text{ if } 1 \leq i \leq k \\
    v_{n+1,0}(A[f])                              & \text{ if } i = k+1
  \end{array}
\right. \]
Now we have the following commutative square:
\[ \xymatrix{ A[f] \ar[r]^-{q(f,A)} \ar[d]_{p_{A[f]}} & A \ar[d]^{p_A} \\
              B \ar[r]_-f                             & ft_k(A)
            } \]
We need to prove that this square is cartesian.
By proposition~2.3 of \cite{c-systems} it is enough to construct a section $s_{f'} : B \to A[f]$ of $p_{A[f]}$ for each $f' = (a_1, \ldots a_k, a_{k+1}) : B \to A$ and prove a few properties of $s_{f'}$.
We define $s_{f'}$ to be equal to $\varphi(a_{k+1})$.
Axioms \eqref{ax:var-subst} and \eqref{ax:subst-subst} implies that $q(f, B) \circ s_{f'} = f$.
To complete the proof that the square above is cartesian we need for every $g : ft_k(A) \to ft_m(C)$ and $A = C[g]$ prove that $s_{f'} = s_{q(g,C) \circ f'}$.
The last component of $q(g,C) \circ f'$ equals to $v_{n+1,0}(C[g])[f'] = a_{k+1}$.
Thus the last components of $q(g,C) \circ f'$ and $f'$ coincide, hence $s_{f'} = s_{q(g,C) \circ f'}$.

We are left to prove that operations $A[f]$ and $q(f,A)$ are functorial.
Equations $A[id_{ft_k(A)}] = A$ and $A[f \circ g] = A[f][g]$ are precisely axioms \eqref{ax:Subst-var} and \eqref{ax:Subst-Subst}.
The fact that $q(id_{ft_k(A)}, A) = id_A$ follows from axiom~\ref{ax:var-subst}.
Now let $g : C \to B$ and $f : B \to ft_k(A)$ be morphisms; we need to show that $q(f \circ g, A) = q(f,A) \circ q(g,A[f])$.
The last component of $q(f,A) \circ q(g,A[f])$ equals to $v_{n+1,0}(A[f])[q(g,A[f])] = v_{m+1,0}(A[f][g])$ which equals to the last component of $q(f \circ g, A)$, namely $v_{m+1,0}(A[f \circ g])$.
If $1 \leq i \leq k$, then $i$-th component of $q(f,A) \circ q(g,A[f])$ equals to
\[ a_i[v_{n+1,n}(A[f]), \ldots v_{n+1,1}(A[f])][q(g,A[f])] = \]
\[ a_i[b_1[v_{m+1,m}(A[f][g]), \ldots v_{m+1,1}(A[f][g])], \ldots b_n[v_{m+1,m}(A[f][g]), \ldots v_{m+1,1}(A[f][g])]] \]
where $a_i$ is $i$-th component of $f$ and $b_i$ is $i$-th component of $g$.
$i$-th component of $q(f \circ g, A)$ equals to
\[ a_i[g][v_{m+1,m}(A[f \circ g]), \ldots v_{m+1,1}(A[f \circ g])] = \]
\[ a_i[b_1[v_{m+1,m}(A[f \circ g]), \ldots v_{m+1,1}(A[f \circ g])], \ldots b_n[v_{m+1,m}(A[f \circ g]), \ldots v_{m+1,1}(A[f \circ g])]]. \]
Thus $q(f \circ g, A) = q(f,A) \circ q(g,A[f])$.
This completes the construction of contextual category $F(M)$.

\begin{prop}
Mapping $F$ is functorial, and functor $F : \mathbb{T}_1\Mod \to \ccat$ is an equivalence of categories.
\end{prop}
\begin{proof}
Given a map of $\mathbb{T}_1$ models $\alpha : M \to N$, we define a map of contextual categories $F(\alpha) : F(M) \to F(N)$.
$F(\alpha)$ is already defined on objects.
Let $f = (a_1, \ldots a_k) \in Hom_{n,k}(B,A)$.
We define $F(\alpha)(f)$ as $(\alpha(a_1), \ldots \alpha(a_k)) \in Hom_{n,k}(\alpha(B), \alpha(A))$.
$F(\alpha)$ preserves identity morphisms, compositions, $f^*(A)$, and $q(f,A)$ since all of these operations are defined in terms of $\mathbb{T}_1$ operations.
Clearly, $F$ preserves identity maps and compositions of maps of $\mathbb{T}_1$ models.
Thus $F$ is a functor.

First, note that if $a \in M(Tm_k)$ and $\alpha : M \to N$, then $F(\alpha)(\varphi(a)) = \varphi(\alpha(a))$.
Indeed, consider the following sequence of equations:
\begin{align*}
F(\alpha)(\varphi(a)) & = \\
F(\alpha)(v_{k,k-1}(ft_k(ty_k(a))), \ldots v_{k,0}(ft_k(ty_k(a))), a) & = \\
(v_{k,k-1}(ft_k(ty_k(\alpha(a)))), \ldots v_{k,0}(ft_k(ty_k(\alpha(a)))), \alpha(a)) & = \\
\varphi(\alpha(a)) & .
\end{align*}

Now, we prove that $F$ is faithful.
Let $\alpha,\beta : M \to N$ be a pair of maps of $\mathbb{T}_1$ models such that $F(\alpha) = F(\beta)$.
Then $\alpha$ and $\beta$ coincide on contexts.
Given $a \in M(Tm_n)$ we have the following equation: $\alpha(a) = \varphi^{-1}(F(\alpha)(\varphi(a))) = \varphi^{-1}(F(\beta)(\varphi(a))) = \beta(a)$.

Now, we prove that $F$ is full.
Let $\alpha : F(M) \to F(N)$ be a map of contextual categories.
Then we need to define $\beta : M \to N$ such that $F(\beta) = \alpha$.
If $A \in M(Ctx_n)$, then we let $\beta(A) = \alpha(A)$.
Note that if $f : ft_n(A) \to A$ is a section of $p_A$, then $\alpha(f)$ is a section of $\alpha(A)$.
If $a \in M(Tm_n)$, then we let $\beta(a) = \varphi^{-1}(\alpha(\varphi(a)))$.

Maps $F(\beta)$ and $\alpha$ agree on contexts.
We prove by induction on $k$ that they coincide on morphisms $f = (a_1, \ldots a_k) \in M(Hom_{n,k})(B,A)$.
If $k = 0$, then $F(A)$ is terminal objects, hence $F(\beta) = \alpha$.
Suppose $k > 0$ and consider the following equation: $f = q((a_1, \ldots a_{k-1}), A) \circ \varphi(a_k)$.
By induction hypothesis we know that $F(\beta)(q((a_1, \ldots a_{k-1}), A)) = \alpha(q((a_1, \ldots a_{k-1}), A))$.
Thus we only need to prove that $F(\beta)(\varphi(a_k)) = \alpha(\varphi(a_k))$.
But $F(\beta)(\varphi(a_k)) = \varphi(\beta(a_k)) = \varphi(\varphi^{-1}(\alpha(\varphi(a_k)))) = \alpha(\varphi(a_k))$.

Finally, we prove that $F$ is essentially surjective on objects.
Given contextual category $C$ we define $\mathbb{T}_1$ model $M$.
Let $M(Ctx_n)$ be equal to $Ob_n(C)$ and $M(Tm_n)$ be the set of pairs of objects $A \in Ob_{n+1}(C)$ and sections of $p_A : A \to ft_n(A)$.
Let $ty_n$ be the obvious projection.
We will usually identify $a \in M(Tm_n)$ with the section $ft_n(ty_n(a)) \to ty_n(a)$.

For each $n,k \in \mathbb{N}$ we define partial function
\[ Subst_{n,k} : M(Ctx_n) \times M(Ctx_{k+1}) \times M(Tm_n)^k \to M(Ctx_{n+1}) \]
such that $ft_n(Subst_{n,k}(B, A, a_1, \ldots a_k)) = B$.
We also define morphism
\[ q_{n,k} \in Hom_{n+1,k}(Subst_{n,k}(B, A, a_1, \ldots a_k), A) \]
whenever $Subst_{n,k}(B, A, a_1, \ldots a_k)$ is defined.
We define $Subst_{n,k}$ and $q_{n,k}$ by induction on $k$.
Let $Subst_{n,0}(B,A) = !_B^*(A)$ and $q_{n,0} = q(!_B,A)$ where $!_B : B \to Ob_0(C)$ is the unique morphism.
\[ \xymatrix{ Subst_{n,0}(B,A) \ar[r]^-{q_{n,0}} \ar[d] \pb & A \ar[d]^{p_A} \\
              B \ar[r]_{!_B} & 1
            } \]
Let $Subst_{n,k+1}(B, A, a_1, \ldots a_{k+1})$ be defined whenever $Subst_{n,k}(B, ft_k(A), a_1, \ldots a_k)$ is defined and $ty_n(a_{k+1}) = Subst_{n,k}(B, ft_k(A), a_1, \ldots a_k)$.
In this case we let $Subst_{n,k+1}(B, A, a_1, \ldots a_{k+1}) = f^*(A)$ and $q_{n,k+1} = q(f,A)$ where $f$ is the composition of $a_{k+1}$ and $q_{n,k}$.
\[ \xymatrix{ Subst_{n,k+1}(B, A, a_1, \ldots a_{k+1}) \ar[rr]^-{q_{n,k+1}} \ar[d] \pb & & A \ar[d]^{p_A} \\
              B \ar[r]_-{a_{k+1}} & Subst_{n,k}(B, ft_k(A), a_1, \ldots a_k) \ar[r]_-{q_{n,k}} & ft_k(A)
            } \]
It is easy to see by induction on $k$ that axiom~\eqref{ax:def-Subst} holds.
Axiom~\eqref{ax:type-Subst} holds by definition of $Subst_{n,k}$.

The definition of predicates $Hom_{n,k}$ makes sense in $M$ now.
Thus we can define as before the set $Hom^M_{n,k}(B,A)$ of morphisms in $M$ as the set of tuples $(a_1, \ldots a_k)$ such that $Hom_{n,k}(B, A, a_1, \ldots a_k)$.
There is a bijection $\alpha : Hom^M_{n,k}(B,A) \to Hom_{n,k}(B,A)$ such that $Subst_{n,k}(B, A, a_1, \ldots a_k) = \alpha(a_1, \ldots a_k)^*(A)$ and $q_{n,k} = q(\alpha(a_1, \ldots a_k), A)$.
We define $\alpha$ by induction on $k$.
Both $Hom^M_{n,0}(B,A)$ and $Hom_{n,0}(B,A)$ are singletons, so there is a unique bijection between them.
If $(a_1, \ldots a_k) \in Hom^M_{n,k}(B,ft_k(A))$, then there is a bijection between $f \in Hom_{n,k+1}(B,A)$ such that $p_A \circ f = \alpha(a_1, \ldots a_k)$ and sections of $p_{\alpha(a_1, \ldots a_k)^*(A)}$.
By induction hypothesis these sections are just sections of $p_{Subst_{n,k}(B, A, a_1, \ldots a_k)}$.
This gives us a bijection between $Hom^M_{n,k+1}(B,A)$ and $Hom_{n,k+1}(B,A)$, namely $\alpha(a_1, \ldots a_{k+1}) = q(\alpha(a_1, \ldots a_k), A) \circ a_{k+1}$.
Then equations $Subst_{n,k+1}(B, A, a_1, \ldots a_{k+1}) = \alpha(a_1, \ldots a_{k+1})^*(A)$ and $q_{n,k+1} = q(\alpha(a_1, \ldots a_k), A)$ hold by definition.

Now we define total functions $v_{n,i} : M(Ctx_n) \to M(Tm_n)$.
Let $v_{n,i}(A) = (p^{i+1}(A)^*(ft^i_{n-i}(A)), s_{p^i_A})$.
\[ \xymatrix{ p^{i+1}(A)^*(ft^i_{n-i}(A)) \ar[r] \ar[d] \pb & ft^i_{n-i}(A) \ar[d]^{p_{ft^i_{n-i}(A)}} \\
              A \ar[r]_{p^{i+1}(A)} \ar@/^1pc/[u]^{s_{p^i_A}} \ar[ur]_{p^i_A} & ft^{i+1}_{n-i-1}(A)
            } \]
Axiom~\eqref{ax:def-var} holds by definition.
By induction on $n - i$ it is easy to see that $\alpha(v_{n,n-1}(A), \ldots v_{n,i}(A))$ equals to $p_A^i : A \to ft^i_{n-i}(A)$.
Axiom~\eqref{ax:type-var} follows from the following sequence of equations:
\begin{align*}
Subst_{n,n-i-1}(A, ft^i_{n-i}(A), v_{n,n-1}(A), \ldots v_{n,i+1}(A)) & = \\
\alpha(v_{n,n-1}(A), \ldots v_{n,i+1}(A))^*(ft^i_{n-i}(A)) & = \\
p^{i+1}(A)^*(ft^i_{n-i}(A)) & = \\
ty_n(v_{n,i}(A)) & .
\end{align*}
Axiom~\eqref{ax:Subst-var} follows from the facts that $\alpha(v_{n,n-1}(ft_n(A)), \ldots v_{n,0}(ft_n(A))) = id_{ft_n(A)}$ and $id_{ft_n(A)}^*(A) = A$.

Now we define partial functions $subst_{n,k} : M(Ctx_n) \times M(Tm_k) \times M(Tm_n)^k \to M(Tm_n)$.
$subst_{n,k}(B, a, a_1, \ldots a_k)$ is defined whenever $Hom_{n,k}(B, ft_k(ty_k(a)), a_1, \ldots a_k)$ holds.
In this case we let $subst_{n,k}(B, a, a_1, \ldots a_k) = a[\alpha(a_1, \ldots a_k)]$ where $a[f] = s_{a \circ f}$.
Axioms \eqref{ax:def-subst} and \eqref{ax:type-subst} hold by definition.
Axiom~\eqref{ax:subst-var} follows from the fact that $id_{ft_n(ty_n(a))}^*(a) = a$.

To prove axiom~\eqref{ax:var-subst} note that $p_A \circ \alpha(a_1, \ldots a_{k+1}) = \alpha(a_1, \ldots a_k)$ by definition of $\alpha$.
Hence $p^i(A) \circ \alpha(a_1, \ldots a_k) = \alpha(a_1, \ldots a_{k-i})$.
Also note that $s_{\alpha(a_1, \ldots a_k)} = a_k$.
Now the axiom follows from the following equations:
\begin{align*}
subst_{n,k}(B, v_{k,i}(A), a_1, \ldots a_k) & = \\
s_{v_{k,i}(A) \circ \alpha(a_1, \ldots a_k)} & = \\
s_{q(p^{i+1}(A), ft^i_{n-i}(A)) \circ v_{k,i}(A) \circ \alpha(a_1, \ldots a_k)} & = \\
s_{p^i(A) \circ \alpha(a_1, \ldots a_k)} & = \\
s_{\alpha(a_1, \ldots a_{k-i})} & = \\
a_{k-i} & .
\end{align*}

Now we prove that $\alpha$ preserves compositions.
To do this we need to show that $\alpha(a_1, \ldots a_k) \circ f = \alpha(a_1[f], \ldots a_k[f])$.
We do this by induction on $k$.
For $k = 0$ it is trivial and for $k > 0$ we have the following sequence of equations:
\begin{align*}
\alpha(a_1, \ldots a_k) \circ f & = \\
q(\alpha(a_1, \ldots a_{k-1}), A) \circ a_k \circ f & = \\
q(\alpha(a_1, \ldots a_{k-1}), A) \circ q(f, B[\alpha(a_1, \ldots a_k)]) \circ a_k[f] & = \\
q(\alpha(a_1, \ldots a_{k-1}) \circ f, A) \circ a_k[f] & = \\
q(\alpha(a_1[f], \ldots a_{k-1}[f]), A) \circ a_k[f] & = \\
\alpha(a_1[f], \ldots a_k[f]) & .
\end{align*}

Now axioms \eqref{ax:Subst-Subst} and \eqref{ax:subst-subst} follow from the facts that $\alpha$ preserves compositions and $(f \circ g)^*(A) = f^*(g^*(A))$.
This completes the construction of $\mathbb{T}_1$ model $M$ from a contextual category $C$.
To finish the proof we need to show that $F(M)$ is isomorphic to $C$.
The isomorphism is given by bijection $\alpha$.
We already saw that $\alpha$ preserves the structure of contextual categories.
Thus $\alpha$ is a morphism of contextual categories, and it is easy to see that $\alpha^{-1}$ also preserves the structure.
Hence $\alpha$ is isomorphism and $F$ is an equivalence.
\end{proof}

\section{Algebraic presentations of type theories}

In this section we will describe an algebraic approach to defining type theories.
We will consider a particular kind of algebraic type theories which we call \emph{regular}.
Finally, we will define categories $\algtt$ and $\algtt_{reg}$ of algebraic and regular algebraic type theories.

\begin{defn}
An \emph{algebraic type theory} is a quasi-equational theory in a signature with the set of sorts $\mathcal{C}$ together with a map from $\mathbb{T}_1$.
Category $\algtt$ of algebraic type theories is the under category $\mathbb{T}_1 / \cat{Th}_\mathcal{C}$.
\end{defn}

Usually in type theories all of the function symbols are available in every context.
We call such theories \emph{regular}.
Let $\mathcal{F}$ be a set of function symbols such that every $\sigma \in \mathcal{F}$ has a signature of the form $(p_1,q_1) \times \ldots \times (p_n,q_n) \to (p,0)$.
Then we define $reg(\mathcal{F})$ as the set of symbols of $\mathbb{T}_1$ together with $\{ \sigma_k : (ctx, k) \times (p_1, q_1 + k) \times \ldots \times (p_n, q_n + k) \to (p, k) \ |\ \sigma \in \mathcal{F}, \sigma : (p_1,q_1) \times \ldots \times (p_n,q_n) \to (p,0), k \in \mathbb{N} \}$.
We will use term $\sigma(a_1, \ldots a_n)$ as a synonym for $\sigma_0(*, a_1, \ldots a_n)$.

Now, for every set of variables $V$ we define a set $L^n(V)$ which contains a variable $x$ of sort $(p,q+n)$ for every variable $x$ of sort $(p,q)$ in $V$.
For every $t \in Term_{reg(\mathcal{F})}(V)_{(p,q)}$, $m \in \mathbb{N}$, and variable $\Gamma$ we define a term $L^m(\Gamma, t) \in Term_{reg(\mathcal{F})}(L^m(V \amalg \{ \Gamma : (ctx,0) \}))_{(p,q+m)}$ by induction on $t$:
\begin{align*}
& L^m(\Gamma, *) = \Gamma \\
& L^m(\Gamma, x_i) = x_i \\
& L^m(\Gamma, ft_n(A)) = ft_{n+m}(L^m(\Gamma, A)) \\
& L^m(\Gamma, ty_n(a)) = ty_{n+m}(L^m(\Gamma, a)) \\
& L^m(\Gamma, v_{n,i}(A)) = v_{n+m,i}(L^m(\Gamma, A)) \\
& L^m(\Gamma, subst_{p,n,k}(B, A, a_1, \ldots a_k)) = \\
& \qquad subst_{p,n+m,k+m}(L^m(\Gamma, B), L^m(\Gamma, A), b_1, \ldots b_m, a_1', \ldots a_k') \\
& \qquad \text{where $b_i = v_{n+m,n+m-i}(L^m(\Gamma, B))$ and $a_i' = L^m(\Gamma, a_i)$ } \\
& L^m(\Gamma, \sigma_n(A, a_1, \ldots a_k)) = \sigma_{n+m}(L^m(\Gamma, A), L^m(\Gamma, a_1), \ldots L^m(\Gamma, a_k))
\end{align*}
For every formula $\varphi$ we define $L(\varphi)$ as the formula which is obtained from $\varphi$ by applying $L$ to every term in it.
We will say that theory $\mathbb{T}$ in signature $(\mathcal{C}, reg(\mathcal{F}), \varnothing)$ is \emph{stable}
if for every axiom (and hence for every theorem) $\varphi \sststile{}{V} \psi$ of $\mathbb{T}$ sequent $L(\varphi) \sststile{}{V \amalg \{ \Gamma : (ctx,1) \}} L(\psi)$ is a theorem of $\mathbb{T}$.
Given a theory $\mathbb{T}$ there is the smallest stable theory containing $\mathbb{T}$.
We call this theory the stabilization of $\mathbb{T}$ and denote by $st(\mathbb{T})$.

We define auxiliary derived operations in the signature of $\mathbb{T}_1$.
For every $m \in \mathbb{N}$ we define $wk^m_n : Ctx_{n+m} \times Tm_n \to Tm_{n+m}$ as follows:
\[ wk^m_n(B,a) = subst_{n+m,n}(B, a, v_{n+m-1}(B), \ldots v_m(B)) \]
For every $m \in \mathbb{N}$ we define $subst^{m+1}_{p,n,k} : Ctx_n \times (p,k+m) \times Tm^k_n \to (p,k+m)$.
First, let $subst^0_{ty,n,k}(B, A, a_1, \ldots a_k) = B$.
Then let $subst^{m+1}_{p,n,k}(B, a, a_1, \ldots a_k)$ be equal to
\[ subst_{p,n+m+1,k+m+1}(B', a, wk^{m+1}_n(B', a_1), \ldots wk^{m+1}_n(B', a_k), v_m(B'), \ldots v_0(B')) \]
where $B' = subst^m_{ty,n,k}(B, ft(A), a_1, \ldots a_k)$.

\begin{defn}
A \emph{regular algebraic type theory} is a set $\mathcal{F}$ together with a stable theory over $(\mathcal{C}, reg(\mathcal{F}), \varnothing)$
such that axioms of $\mathbb{T}_1$ are derivable and for every $\sigma \in \mathcal{F}$, $\sigma : (p_1,q_1) \times \ldots \times (p_m,q_m) \to (p,0)$ the following sequents are derivable:
\[ \sststile{}{B, b_1, \ldots b_m} ft_k(\sigma_k(B, b_1, \ldots b_m)) = B \text{ if $p = ty$,} \]
\[ \sststile{}{B, b_1, \ldots b_m} ft_k(ty_k(\sigma_k(B, b_1, \ldots b_m))) = B \text{ if $p = tm$, and} \]
\[ \sststile{}{B', B, b_1, \ldots b_m, a_1, \ldots a_k} subst_{p,n,k}(B', \sigma_k(B, b_1, \ldots b_m), a_1, \ldots a_k) = \sigma_n(B', b_1', \ldots b_m') \]
where $b_i' = subst_{p_i,n,k}^{q_i+1}(B', b_i, a_1, \ldots a_k)$.
\end{defn}

Let $(\mathcal{F},\mathbb{T})$ and $(\mathcal{F}',\mathbb{T}')$ be regular algebraic type theories.
Then we say that a morphism $F$ of theories $\mathbb{T}$ and $\mathbb{T}'$ is \emph{regular} if for every $\sigma \in \mathcal{F}$ the following sequent is a theorem of $\mathbb{T}'$.
\[ \sststile{}{\Gamma, a_1, \ldots a_n} F(\sigma_m(\Gamma, a_1, \ldots a_n)) = L^m(\Gamma, F(\sigma_0(*, a_1, \ldots a_n))) \]
Note that term $L^m(\Gamma, F(\sigma_0(*, a_1, \ldots a_n)))$ does not depend on the choice of a representative of the equivalence class.
Indeed, if $\sststile{}{V} t \cong s$, then $\sststile{}{\Gamma,V} L^m(\Gamma,t) \cong L^m(\Gamma,s)$ since $\mathbb{T}'$ is stable.

Category $\algtt_{reg}$ of regular algebraic type theories has regular algebraic type theories as objects and regular morphisms of the underlying theories as morphisms.
To construct a morphism of regular theories $(\mathcal{F},\mathbb{T})$ and $(\mathcal{F}',\mathbb{T}')$ it is enough to give a function $F$ that to each $\sigma \in \mathcal{F}$ assigns a term in $\mathcal{F}'$ of the corresponding signature.
Then we can extend $F$ as follows:
\[ F(\sigma_m(\Gamma, a_1, \ldots a_n)) = L^m(\Gamma, F(\sigma(a_1, \ldots a_n))) \]
If this $F$ respects axioms of $\mathbb{T}$, then it uniquely extends to a regular morphism.

\section{Syntactic presentations of type theories}

In this section we will describe a syntactic approach to defining type theories.
We will define category $\syntt$ of syntactically presented type theories.
Finally, we will give a few examples of such theories.

We will consider theories with total function symbols and without equality.
Terms, atomic formulas and Horn sequents are defined in the same way as before.
If $FV(J_1) \cup \ldots \cup FV(J_n) \subseteq FV(J)$, then a sequent $J_1, \ldots J_n \sststile{}{FV(J)} J$ will be written as
\begin{center}
\AxiomC{$J_1 \quad \ldots \quad J_n$}
\UnaryInfC{$J$}
\DisplayProof
\end{center}
A \emph{(total) Horn theory} in a signature $\Sigma$ is a set of Horn sequents over $\Sigma$.
We will use a standard set of inference rules of Horn logic as presented in \cite[D 1.3]{elephant}.
If $\mathbb{T}$ is a Horn theory, then a \emph{theorem} of $\mathbb{T}$ is a sequent derivable from $\mathbb{T}$ in this logic.

Let $\mathcal{K} = \{ tm, ty \}$ and let $\mathcal{D} = \mathcal{K} \times \mathbb{N}$ be a set of sorts.
Let $\mathcal{P} = \{ D^n_p, E^n_p\ |\ n \in \mathbb{N}, p \in \mathcal{K} \}$ be a set of predicate symbols with the following signatures:
\begin{align*}
D^n_{ty} & : (ty,0) \times \ldots \times (ty,n-1) \times (ty,n) \\
D^n_{tm} & : (ty,0) \times \ldots \times (ty,n-1) \times (tm,n) \times (ty,n) \\
E^n_{ty} & : (ty,0) \times \ldots \times (ty,n-1) \times (ty,n) \times (ty,n) \\
E^n_{tm} & : (ty,0) \times \ldots \times (ty,n-1) \times (tm,n) \times (tm,n)
\end{align*}
We define derived predicates $D^n_{ctx} : (ty,0) \times \ldots \times (ty,n)$ as follows:
\begin{align*}
D^0_{ctx} & = \top \\
D^{n+1}_{ctx}(A_1, \ldots A_{n+1}) & = D^n_{ty}(A_1, \ldots A_{n+1})
\end{align*}
We will use the following standard notations:
\begin{align*}
A_1, \ldots A_n & \vdash \text{ means } D^n_{ctx}(A_1, \ldots A_n), \\
A_1, \ldots A_n & \vdash A \text{ means } D^n_{ty}(A_1, \ldots A_n, A), \\
A_1, \ldots A_n & \vdash a : A \text{ means } D^n_{tm}(A_1, \ldots A_n, a, A), \\
A_1, \ldots A_n & \vdash A \deq B \text{ means } E^n_{ty}(A_1, \ldots A_n, A, B), \\
A_1, \ldots A_n & \vdash a \deq b \text{ means } E^n_{tm}(A_1, \ldots A_n, a, b).
\end{align*}

We do not have equality, instead of it we have equality in context $E^n_{ty}$ and $E^n_{tm}$.
So we need a few axioms for it which are analogous to the usual axioms for equality.
% We will assume that all theories contain the following axioms:
% \begin{center}
% \AxiomC{$\Gamma \vdash A \deq B$}
% \UnaryInfC{$\Gamma \vdash A$}
% \end{center}

Let $F$ be a morphism of signatures $\Sigma = (\mathcal{D}, \mathcal{F}, \mathcal{P})$ and $\Sigma' = (\mathcal{D}, \mathcal{F}', \mathcal{P})$.
Let $\mathbb{T}$ and $\mathbb{T}'$ be total Horn theories in signatures $\Sigma$ and $\Sigma'$ respectively.
Then we will say that $F$ \emph{respects} a sequent $\varphi \sststile{}{V} \psi$ if $F(\varphi) \sststile{}{V} F(\psi)$ is a theorem of $\mathbb{T}'$.
Note that if $F$ respects all axioms of $\mathbb{T}$, then it respects all of its theorems too.
We will say that morphisms $F$ and $G$ are \emph{equivalent} if for all $\sigma \in \mathcal{F}_\Sigma$, $\sigma : s_1 \times \ldots \times s_n \to s$ the following sequents are theorems of $\mathbb{T}'$:
\begin{center}
\AxiomC{$\Gamma \vdash F(\sigma(x_1, \ldots x_n))$}
\UnaryInfC{$\Gamma \vdash G(\sigma(x_1, \ldots x_n))$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash G(\sigma(x_1, \ldots x_n))$}
\UnaryInfC{$\Gamma \vdash F(\sigma(x_1, \ldots x_n))$}
\DisplayProof
\end{center}
\begin{center}
\AxiomC{$\Gamma \vdash F(\sigma(x_1, \ldots x_n))$}
\UnaryInfC{$\Gamma \vdash F(\sigma(x_1, \ldots x_n)) \deq G(\sigma(x_1, \ldots x_n))$}
\DisplayProof
\end{center}
if $s = (ty,k)$, and
\begin{center}
\AxiomC{$\Gamma \vdash F(\sigma(x_1, \ldots x_n)) : A$}
\UnaryInfC{$\Gamma \vdash G(\sigma(x_1, \ldots x_n)) : A$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash G(\sigma(x_1, \ldots x_n)) : A$}
\UnaryInfC{$\Gamma \vdash F(\sigma(x_1, \ldots x_n)) : A$}
\DisplayProof
\end{center}
\begin{center}
\AxiomC{$\Gamma \vdash F(\sigma(x_1, \ldots x_n)) : A$}
\UnaryInfC{$\Gamma \vdash F(\sigma(x_1, \ldots x_n)) \deq G(\sigma(x_1, \ldots x_n))$}
\DisplayProof
\end{center}
if $s = (tm,k)$.

Now, we define a category of theories.
Its objects are pairs $(\mathcal{F},\mathbb{T})$ where $\mathcal{F}$ is a set of function symbols and $\mathbb{T}$ is a theory in $(\mathcal{S},\mathcal{F},\mathcal{P})$.
Morphisms of theories $(\mathcal{F},\mathbb{T})$ and $(\mathcal{F}',\mathbb{T}')$ are equivalence classes of morphisms of signatures $(\mathcal{S},\mathcal{F},\mathcal{P})$ and $(\mathcal{S},\mathcal{F}',\mathcal{P})$ which respect all axioms of $\mathbb{T}$.
The composition of morphisms of signatures respects the equivalence relation; hence this defines a category of theories which will be denoted by $\Th_{\mathcal{S},\mathcal{P}}$.
Note that $\Sig_{\mathcal{S},\mathcal{P}}$ is a full subcategory of $\Th_{\mathcal{S},\mathcal{P}}$; indeed, every signature can be considered as a theory with an empty set of axioms.

First, let us define a syntactic analog of algebraic theory $\mathbb{T}_1$ which we also call $\mathbb{T}_1$.
Its function symbols are the following:
\begin{align*}
v_{n,i} & : (tm,n) \text{, } 0 \leq i < n \\
subst_{p,n,k} & : (p,k) \times (tm,n)^k \to (p,n)
\end{align*}

Theory $\mathbb{T}_1$ has the following axioms:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a : A$}
\AxiomC{$\Gamma \vdash A \deq B$}
\BinaryInfC{$\Gamma \vdash a : B$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$A_1, \ldots A_n \vdash$}
\UnaryInfC{$A_1, \ldots A_n \vdash v_{n,i} : A_{n-i}\!\uparrow^{i+1}$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash$}
\AxiomC{$A_1, \ldots A_k \vdash A$}
\AxiomC{$\Gamma \vdash a_i : subst_{ty,n,i-1}(A_i, a_1, \ldots a_{i-1})$}
\TrinaryInfC{$\Gamma \vdash subst_{ty,n,k}(A, a_1, \ldots a_k)$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash$}
\AxiomC{$A_1, \ldots A_k \vdash a : A$}
\AxiomC{$\Gamma \vdash a_i : subst_{ty,n,i-1}(A_i, a_1, \ldots a_{i-1})$}
\TrinaryInfC{$\Gamma \vdash subst_{tm,n,k}(a, a_1, \ldots a_k) : subst_{ty,n,k}(A, a_1, \ldots a_k)$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash$}
\AxiomC{$A_1, \ldots A_k \vdash$}
\AxiomC{$\Gamma \vdash a_i : subst_{ty,n,i-1}(A_i, a_1, \ldots a_{i-1})$}
\TrinaryInfC{$\Gamma \vdash subst_{tm,n,k}(v_{k,i}, a_1, \ldots a_k) \deq a_{k-i}$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash A$}
\UnaryInfC{$\Gamma \vdash subst_{ty,n,n}(A, v_{n,n-1}, \ldots v_{n,0}) \deq A$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a : A$}
\UnaryInfC{$\Gamma \vdash subst_{ty,n,n}(a, v_{n,n-1}, \ldots v_{n,0}) \deq a$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\def\extraVskip{1pt}
\Axiom$\fCenter \Gamma \vdash$
\noLine
\UnaryInf$\fCenter \Gamma \vdash b_i : subst_{ty,n,i-1}(B_i, b_1, \ldots b_{i-1})$
\Axiom$\fCenter A_1, \ldots A_m \vdash A$
\noLine
\UnaryInf$\fCenter B_1, \ldots B_k \vdash$
\noLine
\UnaryInf$\fCenter B_1, \ldots B_k \vdash a_i : subst_{ty,k,i-1}(A_i, a_1, \ldots a_{i-1})$
\def\extraVskip{2pt}
\BinaryInfC{$\Gamma \vdash subst_{ty,n,k}(subst_{ty,k,m}(A, a_1, \ldots a_m), b_1, \ldots b_k) \deq subst_{ty,n,m}(A, a_1', \ldots a_m')$}
\DisplayProof
\end{center}
where $a_i' = subst_{tm,n,k}(a_i, b_1, \ldots b_k)$

\medskip
\begin{center}
\def\extraVskip{1pt}
\Axiom$\fCenter \Gamma \vdash$
\noLine
\UnaryInf$\fCenter \Gamma \vdash b_i : subst_{ty,n,i-1}(B_i, b_1, \ldots b_{i-1})$
\Axiom$\fCenter A_1, \ldots A_m \vdash a : A$
\noLine
\UnaryInf$\fCenter B_1, \ldots B_k \vdash$
\noLine
\UnaryInf$\fCenter B_1, \ldots B_k \vdash a_i : subst_{ty,k,i-1}(A_i, a_1, \ldots a_{i-1})$
\def\extraVskip{2pt}
\BinaryInfC{$\Gamma \vdash subst_{tm,n,k}(subst_{tm,k,m}(a, a_1, \ldots a_m), b_1, \ldots b_k) \deq subst_{tm,n,m}(a, a_1', \ldots a_m')$}
\DisplayProof
\end{center}
where $a_i' = subst_{tm,n,k}(a_i, b_1, \ldots b_k)$

\begin{defn}
A \emph{syntactic type theory} is a theory in a signature with the set of sorts $\mathcal{D}$ together with a map from $\mathbb{T}_1$.
Category $\syntt$ of syntactic type theories is the under category $\mathbb{T}_1 / \cat{Th}_\mathcal{D}$.
\end{defn}

Let $\mathcal{F}$ be a set of function symbols together with a signature, that is expressions of the form
\[ \sigma : s_1 \times \ldots \times s_n \to s \]
where $s_1, \ldots s_n, s \in \mathcal{S}$.
Then let $\overline{\Sigma}$ be the following set of function symbols:
\[ \{ \sigma_k\ |\ \sigma \in \Sigma, k \in \mathbb{N} \} \cup \{ v_{n,i}\ |\ n,i \in \mathbb{N}, 0 \leq i < n \} \cup \{ subst_{p,n,k}\ |\ p \in \mathcal{K}, n,k \in \mathbb{N} \}. \]
Signatures of these symbols are defined as follows:
\begin{align*}
v_{n,i} & : (tm,n) \\
subst_{p,n,k} & : (p,k) \times (tm,n)^k \to (p,n) \\
\sigma_k\ & : (p_1,q_1+k) \times \ldots \times (p_n,q_n+k) \to (p,q+k)
\end{align*}
where $\sigma : (p_1,q_1) \times \ldots \times (p_n,q_n) \to (p,q)$.
We will omit subscripts $k$ in $\sigma_k$ and $n$ in $v_{n,i}$ if it is clear from the context.
If $V$ is a set, then let $Term_\Sigma(V)$ be the set of terms in signature $\overline{\Sigma}$.

Let $\mathbb{T}_\Sigma$ be the algebraic theory in signature $\overline{\Sigma}$ with the following set of axioms:
\begin{align*}
subst_{p,n,n}(a, v_{n,n-1}, \ldots v_{n,0}) & = a \\
subst_{tm,n,k}(v_{k,i}, a_1, \ldots a_k) & = a_{k-i} \\
subst_{p,m,n}(subst_{p,n,k}(a, b_1, \ldots b_k), c_1, \ldots c_n) & = subst_{p,m,k}(a, b_1', \ldots b_k')
\end{align*}
where $b_i' = subst_{tm,m,n}(b_i, c_1, \ldots c_n)$, and
\[ subst_{p,n,k}(\sigma_k(a_1, \ldots a_m), b_1, \ldots b_k) = \sigma_n(a_1', \ldots a_m') \]
for each $\sigma : (p_1,q_1) \times \ldots \times (p_n,q_n) \to (p,0)$ and $b_j : (tm,n)$ where
\[ a_i' = subst_{p_i,n+q_i,k+q_i}(a_i, b_{i,1}', \ldots b_{i,k}', v_{n+q_i,q_i-1}, \ldots v_{n+q_i,0}) \text{, and} \]
\[ b_{i,j}' = subst_{tm,n+q_i,n}(b_j, v_{n+q_i,n+q_i-1}, \ldots v_{n+q_i,q_i}). \]
Let $\mathbb{T}_\Sigma : \Set^\mathcal{S} \to \Set^\mathcal{S}$ be a monad corresponding to the theory $\mathbb{T}_\Sigma$.
Explicitly, $\mathbb{T}_{\Sigma}(V)_s = Term_{\Sigma}(V)_s/\sim$ where $\sim$ is the congruence generated by the axioms above.
Elements of $\mathbb{T}_{\Sigma}(V)_s$ we will call terms of sort $s$ with free variables in $V$.
A morphism of signatures $\Sigma$ and $\Sigma'$ is a function that to each $(\sigma : s_1 \times \ldots s_k \to s) \in \Sigma$ assigns
a term of sort $s$ in signature $\Sigma'$ with free variables $x_1$, \ldots $x_k$ of sorts $s_1$, \ldots $s_k$ respectively.
Such a function $F$ extends to functions $\overline{F} : \mathbb{T}_\Sigma(V)_s \to \mathbb{T}_{\Sigma'}(V)_s$ in the obvious way.
Compositions of morphisms $F : \Sigma \to \Sigma'$ and $G : \Sigma' \to \Sigma''$ is defined as follows: $(G \circ F)(\sigma) = \overline{G}(F(\sigma))$.
An identity morphism assigns to each $\sigma$ the term $\sigma(x_1, \ldots x_k)$.

If $V \in \Set^{\mathcal{S}}$, then a \emph{context} of length $n$ with free varibles in $V$ is a sequence $A_0$, \ldots $A_{n-1}$ where $A_i \in Term_\Sigma(V)_(ty,i)$.
A \emph{judgement} with free variables in $V$ is simply a predicate of a certain form.
We will consider judgements of the forms $\Gamma \vdash$, $\Gamma \vdash A$, $A \deq A'$, $\Gamma \vdash a : A$, and $a \deq a'$
where $\Gamma$ is context of length $n$ (for some $n \in \mathbb{N}$), $A, A' \in Term_\Sigma(V)_{(ty,n)}$, and $a, a' \in Term_\Sigma(V)_{(tm,n)}$.
An inference rule with free variables in $V$ consists of a finite set of judgements $J_1$, \ldots $J_n$ (with free variables in $V$) called premises and a judgement $J$ (with free variables in $V$) called conclusion.
An inference rule is usually written as
\begin{center}
\AxiomC{$J_1 \quad \ldots \quad J_n$}
\UnaryInfC{$J$}
\DisplayProof
\end{center}
If $\mathcal{I}$ is a set of inference rules, then the set $D(\mathcal{I})$ of derived rules is defined in the usual way.

\begin{defn}
A \emph{syntactic type theory} consists of a set $\Sigma$ of function symbols and a set $\mathcal{I}$ of inference rules.
\end{defn}
Let $F$ be a morphisms of signatures $\Sigma$ and $\Sigma'$.
If $J$ is a judgement of $\Sigma$, then we can define a judgement $\overline{F}(J)$ of $\Sigma'$ by applying $\overline{F}$ to every term in $J$.
If $R$ is an inference rule of $\Sigma$, then we can define an inference rule $\overline{F}(R)$ of $\Sigma'$ by applying $\overline{F}$ to every judgement in $R$.
A morphism of theories $\mathbb{T} = (\Sigma_\mathbb{T}, \mathcal{I}_\mathbb{T})$ and $S = (\Sigma_S, \mathcal{I}_S)$ is a morphism $F$ of signatures $\Sigma$ and $\Sigma'$
such that $\overline{F}(R)$ is a derived inference rules of $S$ for every $R \in \mathcal{I}_\mathbb{T}$.
This defines a cateogry $\syntt$ of syntactic type theories.

Now we introduce a few auxiliary constructions.
If $b$ is a term of sort $(p,n+k)$ and $a_1$, \ldots $a_k$ are terms of sort $(tm,n)$, then we write $b[a_1, \ldots a_k]$ for
\[ subst_{p,n,n+k}(b, v_{n,n-1}, \ldots v_{n,0}, a_1, \ldots a_k). \]
If $b$ is a term of sort $(p,n)$, then we write $b\!\uparrow$ for
\[ subst_{p,n+1,n}(b, v_{n+1,n}, \ldots v_{n+1,1}). \]

\begin{example}
The theory of unit types with eta rules has function symbols $\top : (ty,0)$ and $unit : (tm,0)$ and the following inference rules:
\medskip
\begin{center}
\AxiomC{}
\UnaryInfC{$\vdash \top$}
\DisplayProof
\quad
\AxiomC{}
\UnaryInfC{$\vdash unit : \top$}
\DisplayProof
\quad
\AxiomC{$\vdash t : \top$}
\UnaryInfC{$t \deq unit$}
\DisplayProof
\end{center}
\end{example}

\begin{example}
The theory of unit types without eta rules has function symbols $\top : (ty,0)$, $unit : (tm,0)$ and $\top\text{-}elim : (ty,1) \times (tm,0) \times (tm,0) \to (tm,0)$
and the following inference rules:
\medskip
\begin{center}
\AxiomC{}
\UnaryInfC{$\vdash \top$}
\DisplayProof
\quad
\AxiomC{}
\UnaryInfC{$\vdash unit : \top$}
\DisplayProof
\quad
\AxiomC{$\top \vdash D$}
\AxiomC{$\vdash d : D[unit]$}
\AxiomC{$\vdash t : \top$}
\TrinaryInfC{$\vdash \top\text{-}elim(D, d, t) : D[t]$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\top \vdash D$}
\AxiomC{$\vdash d : D[unit]$}
\BinaryInfC{$\top\text{-}elim(D, d, unit) \deq d$}
\DisplayProof
\end{center}
\end{example}

\begin{example}
The theory of $\Sigma$ types with eta rules has function symbols
$\Sigma : (ty,0) \times (ty,1) \to (ty,0)$, $pair : (ty,0) \times (ty,1) \times (tm,0) \times (tm,0) \to (tm,0)$,
$proj_1 : (ty,0) \times (ty,1) \times (tm,0) \to (tm,0)$ and $proj_2 : (ty,0) \times (ty,1) \times (tm,0) \to (tm,0)$
and the following inference rules:
\medskip
\begin{center}
\AxiomC{$A \vdash B$}
\UnaryInfC{$\vdash \Sigma(A, B)$}
\DisplayProof
\quad
\AxiomC{$A \vdash B$}
\AxiomC{$\vdash a : A$}
\AxiomC{$\vdash b : B[a]$}
\TrinaryInfC{$\vdash pair(A, B, a, b)$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\vdash p : \Sigma(A, B)$}
\UnaryInfC{$\vdash proj_1(A, B, p) : A$}
\DisplayProof
\quad
\AxiomC{$\vdash p : \Sigma(A, B)$}
\UnaryInfC{$\vdash proj_2(A, B, p) : B[proj_1(A, B, p)]$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$A \vdash B$}
\AxiomC{$\vdash a : A$}
\AxiomC{$\vdash b : B[a]$}
\TrinaryInfC{$proj_1(A, B, pair(A, B, a, b)) \deq a$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$A \vdash B$}
\AxiomC{$\vdash a : A$}
\AxiomC{$\vdash b : B[a]$}
\TrinaryInfC{$proj_2(A, B, pair(A, B, a, b)) \deq b$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\vdash p : \Sigma(A, B)$}
\UnaryInfC{$pair(A, B, proj_1(A, B, p), proj_2(A, B, p)) \deq p$}
\DisplayProof
\end{center}
\end{example}

\begin{example}
The theory of $\Sigma$ types without eta rules.
\end{example}

\begin{example}
The theory of $\Pi$ types with eta rules.
\end{example}

\begin{example}
The theory of $\Pi$ types without eta rules.
\end{example}

\begin{example}
The theory of identity types has function symbols $Id : (ty,0) \times (tm,0) \times (tm,0) \to (ty,0)$,
$refl : (ty,0) \times (tm,0) \to (tm,0)$ and $J : (ty,0) \times (ty,3) \times (tm,1) \times (tm,0) \times (tm,0) \times (tm,0) \to (tm,0)$
and the following inference rules:
\medskip
\begin{center}
\AxiomC{$\vdash a : A$}
\AxiomC{$\vdash a' : A$}
\BinaryInfC{$\vdash Id(A, a, a')$}
\DisplayProof
\quad
\AxiomC{$\vdash a : A$}
\UnaryInfC{$\vdash refl(A, a) : Id(A, a, a)$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$A, A\!\uparrow, Id(A\!\uparrow\uparrow, v_1, v_0) \vdash D$}
\AxiomC{$A \vdash d : D[v_0, v_0, refl(A\!\uparrow, v_0)]$}
\AxiomC{$\vdash p : Id(A, a, a')$}
\TrinaryInfC{$\vdash J(A, D, d, a, a', p) : D[a, a', p]$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$A, A\!\uparrow, Id(A\!\uparrow\uparrow, v_1, v_0) \vdash D$}
\AxiomC{$A \vdash d : D[v_0, v_0, refl(A\!\uparrow, v_0)]$}
\AxiomC{$\vdash a : A$}
\TrinaryInfC{$J(A, D, d, a, a, refl(A, a)) \deq d[a]$}
\DisplayProof
\end{center}
\end{example}

\begin{example}
The theory a universe has function symbols $Type : (ty,0)$ and $El : (tm,0) \to (ty,0)$ and the following inference rules:
\medskip
\begin{center}
\AxiomC{}
\UnaryInfC{$\vdash Type$}
\DisplayProof
\quad
\AxiomC{$\vdash A : Type$}
\UnaryInfC{$\vdash El(A)$}
\DisplayProof
\end{center}
\end{example}

% Now, usually universes are assumed to be closed under different type constructions.

\section{Syntactic type theories}

In general, we cannot construct an algebraic type theory from a syntactic one.
So we consider a full subcategory of syntactic type theories for which we can do that.
We call such theories \emph{regular}.

We say that a function symbol $\sigma \in \Sigma$ is \emph{closed} if it has signature $s_1 \times \ldots \times s_n \to (p,0)$ for some $s_1$, \ldots $s_n$, and $p$.
We say that a theory is \emph{closed} if every its function symbol is closed.

We say that a judgement defines variable $x$ if it is either of the form $\Gamma \vdash x$ or of the form $\Gamma \vdash x : A$.
We say that a judgement defines symbol $(\sigma : s_1 \times \ldots s_n \to (p,q)) \in \Sigma$ if it is either
of the form $\Gamma \vdash \sigma(x_1, \ldots x_n)$ or of the form $\Gamma \vdash \sigma(x_1, \ldots x_n) : A$ where $x_i$ are variables.
We say that an inference rule defines symbol $\sigma$ if its conclusion defines it.
We say that such inference rule is \emph{regular} if the length of $\Gamma$ is $q$ and
if all variables in the list $x_1$, \ldots $x_n$ are distinct, this list contains all free variables of the rule,
and every $x_i$ defined by a single premise with free variables in $x_1$, \ldots $x_{i-1}$.
A syntactic type theory $\mathbb{T} = (\Sigma, \mathcal{I})$ is \emph{regular} if the following conditions hold:
\begin{itemize}
\item $\mathbb{T}$ is closed.
\item Every function symbol in $\Sigma$ is defined by a single regular inference rule in $\mathcal{I}$,
\item There is a well-ordering on $\Sigma$ such that the rule that defines $\sigma$ uses in premises only symbols that are less then $\sigma$.
\item Every inference rule in $\mathcal{I}$ is either defines some function symbol or has conclusion of the form $a \deq b$.
\end{itemize}

Now for each regular syntactic type theory $\mathbb{T} = (\Sigma, \mathcal{I})$ we define an algebraic type theory $E(\mathbb{T})$.
There is a function from the set of sorts of syntactic theories to the set of sorts of algebraic theories.
Sort $(tm,n)$ is mapped to $Tm_n$ and $(ty,n)$ is mapped to $Ctx_{n+1}$.
We will usually omit this function and use sorts $(tm,n)$ and $(ty,n)$ directly.
The signature $E(\Sigma)$ of $E(\mathbb{T})$ consists of symbols $v_{n,i}$, $subst_{n,k}$, $Subst_{n,k}$ (with the signatures as in $\mathbb{T}_1$), and
$\sigma_k : Ctx_k \times (p_1,q_1+k) \times \ldots \times (p_n,q_n+k) \to (p,k)$
for each $k \in \mathbb{N}$ and $(\sigma : (p_1,q_1) \times \ldots \times (p_n,q_n) \to (p,0)) \in \Sigma$.

Now we define functions
\[ \alpha_{U,V,p,n,k} : Term_{E(\Sigma)}(V)_{Ctx_{n+k}} \times Term_{\Sigma}(U)_{(p,k)} \times Env_{U,V,p,n} \to Term_{E(\Sigma)}(V)_{(p,n+k)} \]
and
\[ \beta_{U,V,n,k} : Term_{E(\Sigma)}(V)_{Ctx_n} \times Ctx_\Sigma(U)_k \times Env_{U,V,ty,n} \to Term_{E(\Sigma)}(V)_{Ctx_{n+k}} \]
where $Ctx_\Sigma(U)_k$ is the set of contexts of length $k$ and $Env_{U,V,p,n}$ is the set of functions $U_{(p,m)} \to Term_{E(\Sigma)}(V)_{(p,n+m)}$ for all $m \in \mathbb{N}$.
\begin{itemize}
\item $\beta_{U,V,n,0}(\Gamma, (), \rho) = \Gamma$.
\item $\beta_{U,V,n,k+1}(\Gamma, (\Delta,A), \rho) = \alpha_{U,V,ty,n,k}(\beta_{U,V,n,k}(\Gamma, \Delta, \rho), A, \rho)$.
\item $\alpha_{U,V,p,n,k}(\Gamma, v_{k,i}, \rho) = v_{n+k,i}(\Gamma)$.
\item $\alpha_{U,V,p,n,k}(\Gamma, x, \rho) = \rho(x)$ where $x$ is a variable.
\item $\alpha_{U,V,p,n,k}(\Gamma, subst_{ty,k,m}(x, a_1, \ldots a_m)) = Subst_{n+k,n+m}(\Gamma, \rho(x), a_1', \ldots a_{n+m}')$
    where $a_i' = v_{n+k,n+k-i}(\Gamma)$ if $i \leq n$ and $a_i' = \alpha_{U,V,tm,n,k}(\Gamma, a_{i-n}, \rho)$ if $i > n$.
\item $\alpha_{U,V,p,n,k}(\Gamma, subst_{tm,k,m}(x, a_1, \ldots a_m)) = subst_{n+k,n+m}(\Gamma, \rho(x), a_1', \ldots a_{n+m}')$
    where $a_i' = v_{n+k,n+k-i}(\Gamma)$ if $i \leq n$ and $a_i' = \alpha_{U,V,tm,n,k}(\Gamma, a_{i-n}, \rho)$ if $i > n$.
\item $\alpha_{U,V,p,n,k}(\Gamma, \sigma_k(a_1, \ldots a_m)) = \sigma_{n+k}(\Gamma, a_1', \ldots a_m'))$
    where $\sigma : (p_1,q_1) \times \ldots \times (p_m,q_m) \to (p,0)$,
    $\sigma(x_1, \ldots x_m)$ is defined by a rule $R$ in which $x_i$ is defined by a judgement with context $\Delta_i$, and
    \[ a_i' = \alpha_{U,V,p_i,n,k+q_i}(\beta_{\{ x_1, \ldots x_{i-1} \},V,n+k,q_i}(\Gamma, \Delta_i, [x_j \mapsto a_j']), a_i, \rho). \]
\end{itemize}
Conditions in the definition of regularity guarantee that these functions are well-defined.

Let $n \in \mathbb{N}$ and $\Delta \in V_{Ctx_n}$.
Let $i : V_{(p,m)} \to V_{(p,n+m)}$ be any injective function and $\rho : V_{(p,m)} \to Term_{E(\Sigma)}(V)_{(p,n+m)}$ be the function such that $\rho(x) = i(x)$ for each $x$.
Then for each judgement $J$ of the form $\Gamma \vdash A$ we define an equation $A(J)$:
\[ ft(\alpha_{V,V,ty,n,k}(\beta_{V,V,n,k}(\Delta, \Gamma, \rho), A, \rho)) = \beta_{V,V,n,k}(\Delta, \Gamma, \rho). \]
For each judgement $J$ of the form $\Gamma \vdash a : A$ we define an equation $A(J)$:
\[ ty(\alpha_{V,V,tm,n,k}(\beta_{V,V,n,k}(\Delta, \Gamma, \rho), a, \rho)) = \alpha_{V,V,ty,n,k}(\beta_{V,V,n,k}(\Delta, \Gamma, \rho), A, \rho). \]
For each judgement $J$ of the form $a \deq a'$ we define an equation $A(J)$:
\[ \alpha_{V,V,p,n,0}(\Delta, a, \rho) = \alpha_{V,V,p,n,0}(\Delta, a', \rho). \]

For each inference rule $R$ with premises $J_1$, \ldots $J_m$ and conclusion $J$ we define an axiom $A(R)$:
\[ A(J_1), \ldots A(J_m) \sststile{}{FV(A(J_1)) \cup \ldots \cup FV(A(J_m)) \cup FV(A(J))} A(J) \]
For each function symbol $\sigma(x_1, \ldots x_k)$ which is defined by a rule with premises $J_1$, \ldots $J_m$ we define an axiom $D(\sigma)$:
\[ A(J_1), \ldots A(J_m) \ssststile{}{i(x_1), \ldots i(x_k)} \sigma(\rho(x_1), \ldots \rho(x_k)) \downarrow \]
For each function symbol $\sigma : (p_1,q_1) \times \ldots \times (p_m,q_m) \to (p,0)$ such that $\sigma(x_1, \ldots x_m)$ is defined by a rule with premises $J_1$, \ldots $J_m$ we define an axiom $S(\sigma)$:
\[ \sststile{}{\Gamma, \Delta, a_1, \ldots a_m, b_1, \ldots b_k} subst_{p,n,k}(\Delta, \sigma_k(\Gamma, a_1, \ldots a_m), b_1, \ldots b_k) \leftrightharpoons \sigma_n(\Delta, a_1', \ldots a_m') \]
where
\[ a_i' = subst_{p_i,n+q_i,k+q_i}(\Delta_i', a_i, b_{i,1}', \ldots b_{i,k}', v_{n+q_i,q_i-1}(\Delta_i'), \ldots v_{n+q_i,0}(\Delta_i')), \]
\[ b_{i,j}' = subst_{tm,n+q_i,n}(\Delta_i', b_j, v_{n+q_i,n+q_i-1}(\Delta_i'), \ldots v_{n+q_i,q_i}(\Delta')), \]
\[ \Delta_i' = \beta_{\{ x_1, \ldots x_{i-1} \},V,n,q_i}(\Delta, \Delta_i, [x_j \mapsto a_j']) \text{, and} \]
$x_i$ is defined by a judgement with context $\Delta_i$.

Axioms of $E(\Sigma, \mathcal{I})$ are the axioms of $\mathbb{T}_1$, $D(\sigma)$ and $S(\sigma)$ for each $\sigma \in \Sigma$, and $A(R)$ for each $R \in \mathcal{I}$.

\section{Initial models of syntactic type theories}

Results of section~\ref{sec:T1} show that models of algebraic type theories can be described as contextual categories with additional structure.
Initial models are of particular interest.
In this section we show that initial models of those theories that come from (regular) syntactic theories can be constructed from fully annotated lambda terms.
Then we show that in some cases we can drop annotations on lambda terms.

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
