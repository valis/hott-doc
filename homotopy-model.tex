\documentclass{amsart}

\usepackage[english,russian]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amssymb}
\usepackage[all]{xy}
\usepackage{verbatim}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{type1ec}
\usepackage{stmaryrd}

\providecommand\WarningsAreErrors{false}
\ifthenelse{\equal{\WarningsAreErrors}{true}}{\renewcommand{\GenericWarning}[2]{\GenericError{#1}{#2}{}{This warning has been turned into a fatal error.}}}{}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{theorem}{Theorem}
\newref{lem}{lemma}{Lemma}
\newref{prop}{proposition}{Proposition}
\newref{cor}{corollary}{Corollary}

\theoremstyle{definition}
\newref{defn}{definition}{Definition}
\newref{example}{example}{Example}

\theoremstyle{remark}
\newref{remark}{remark}{Remark}

\newcommand{\red}{\Rightarrow}
\newcommand{\deq}{\Leftrightarrow}
\renewcommand{\ll}{\llbracket}
\newcommand{\rr}{\rrbracket}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\numberwithin{figure}{section}

\begin{document}

\title{An interpretation of homotopy type theory in categories with attributes}

\author{Valery Isaev}

% \begin{abstract}
% Abstract
% \end{abstract}

\maketitle

\section{Правила вывода}

\begin{comment}
\begin{table}

\medskip
\begin{center}
\AxiomC{}
\UnaryInfC{$\vdash$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash A$}
\RightLabel{, $x \notin \Gamma$}
\UnaryInfC{$\Gamma, x : A \vdash$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash A$}
\RightLabel{, $x \notin \Gamma$}
\UnaryInfC{$\Gamma, x : A \vdash x : A$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash x : A$}
\AxiomC{$\Gamma \vdash B$}
\RightLabel{, $y \notin \Gamma$}
\BinaryInfC{$\Gamma, y : B \vdash x : A$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a : A_1$}
\AxiomC{$\Gamma \vdash A_2$}
\RightLabel{, $A_1 \deq A_2$}
\BinaryInfC{$\Gamma \vdash a : A_2$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash A \red B$}
\UnaryInfC{$\Gamma \vdash A \deq B$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash A \deq B$}
\UnaryInfC{$\Gamma \vdash B \deq A$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash A \deq B$}
\AxiomC{$\Gamma \vdash B \deq C$}
\BinaryInfC{$\Gamma \vdash A \deq C$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a \red a' : A$}
\UnaryInfC{$\Gamma \vdash a \deq a' : A$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash a \deq a' : A$}
\UnaryInfC{$\Gamma \vdash a' \deq a : A$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a \deq a' : A$}
\AxiomC{$\Gamma \vdash a' \deq a'' : A$}
\BinaryInfC{$\Gamma \vdash a \deq a'' : A$}
\DisplayProof
\end{center}

\medskip
\caption{Правила вывода.}
\label{table:inf-rules}
\end{table}
\end{comment}

\begin{table}

\medskip
\begin{center}
\AxiomC{}
\UnaryInfC{$\vdash$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash A$}
\RightLabel{, $x \notin \Gamma$}
\UnaryInfC{$\Gamma, x : A \vdash$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash A$}
\RightLabel{, $x \notin \Gamma$}
\UnaryInfC{$\Gamma, x : A \vdash x \Uparrow A$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash x \Uparrow A$}
\AxiomC{$\Gamma \vdash B$}
\RightLabel{, $y \notin \Gamma$}
\BinaryInfC{$\Gamma, y : B \vdash x \Uparrow A$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a \Uparrow A_1$}
\AxiomC{$\Gamma \vdash A_2$}
\RightLabel{, $A_1 \deq A_2$}
\BinaryInfC{$\Gamma \vdash a \Downarrow A_2$}
\DisplayProof
\end{center}

\begin{comment}
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash A \red B$}
\UnaryInfC{$\Gamma \vdash A \deq B$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash A \deq B$}
\UnaryInfC{$\Gamma \vdash B \deq A$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash A \deq B$}
\AxiomC{$\Gamma \vdash B \deq C$}
\BinaryInfC{$\Gamma \vdash A \deq C$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a \red a' : A$}
\UnaryInfC{$\Gamma \vdash a \deq a' : A$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash a \deq a' : A$}
\UnaryInfC{$\Gamma \vdash a' \deq a : A$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a \deq a' : A$}
\AxiomC{$\Gamma \vdash a' \deq a'' : A$}
\BinaryInfC{$\Gamma \vdash a \deq a'' : A$}
\DisplayProof
\end{center}
\end{comment}

\medskip
\caption{Правила вывода.}
\label{table:bi-inf-rules}
\end{table}

\newpage

\section{Интерпретация}

\subsection{Категории с атрибутами}

Мы будем интерпретировать теорию в категории с аттрибутами.
Такая категория состоит из следующего набора данных:
\begin{itemize}
\item Для каждого объекта категории $\Gamma$ класс типов над этим объектом $Type(\Gamma)$.
    Мы будем писать $A \dotsb \Gamma$ для обозначения того факта, что $A \in Type(\Gamma)$.
\item Для каждого типа $A \dotsb \Gamma$ объект над $\Gamma$, который мы будем обозначать $\pi_A : \Gamma.A \to \Gamma$.
\item Для каждого морфизма $f : \Delta \to \Gamma$ и типа $A \dotsb \Gamma$ тип над $\Delta$, который обозначается $f^*(A)$,
    и морфизм $f.A : \Delta.f^*(A) \to \Gamma.A$ такой, что квадрат ниже является декартовым.
\[ \xymatrix{ \Delta.f^*(A) \ar[d]_{\pi_{f^*(A)}} \ar[r]^-{f.A} & \Gamma.A \ar[d]^{\pi_A} \\
              \Delta \ar[r]_f & \Gamma
            } \]
\end{itemize}

Эти данные должны удовлетворять следующим требованиям строгости:
\begin{itemize}
\item $id^*(A) = A$.
\item $(g \circ f)^*(A) = g^*(f^*(A))$.
\item $id.A = id$.
\item $(g \circ f).A = f.A \circ g.\Delta.f^*(A)$.
\end{itemize}

Мы будем писать $a : A \dotsb \Gamma$ для обозначения того факта, что $A \in Type(\Gamma)$, и $a : \Gamma \to \Gamma.A$ - сечение $\pi_A$.
Если $f : \Delta \to \Gamma$ - некоторый морфизм, и $a : A \dotsb \Gamma$, то мы будем обозначать $f^*(a) : f^*(A) \dotsb \Delta$ следующее сечение:
\[ \xymatrix{ \Delta \ar[r]^f \ar[d]_{f^*(a)} \pb                   & \Gamma \ar[d]^a \\
              \Delta.f^*(A) \ar[r]_-{f.A} \ar[d]_{\pi_{f^*(A)}} \pb & \Gamma.A \ar[d]^{\pi_A} \\
              \Delta \ar[r]_f                                       & \Gamma
                 }\]

Мы предполагаем, что в категории определены различные конструкции, необходимые для интерпретации правил теории.
Часть этих конструкций ($\Sigma$-типы, $\Pi$-типы, и т.д.) мы опишем позже.
Сейчас мы опишем часть, необходимую для интерпретации гомотопий и расслоений.

Во-первых, категория должна быть конечно полной.
Во-вторых, категория должна содержать интервальный объект $I'$ вместе с парой морфизмов $i_0, i_1 : 1 \to I'$.
Любое отображение вида $\Gamma \simeq \Gamma \times 1 \xrightarrow{id_\Gamma \times i_k} \Gamma \times I'$ мы будем также обозначать $i_k$.
Морфизмы $h : \Gamma \times I' \to X$ мы будем называть гомотопиями между морфизмами $h \circ i_0, h \circ i_1 : \Gamma \to X$.
Если $A \dotsb \Gamma$, то записать $h : I' \to A \dotsb \Gamma$ будет означать, что $h : \Gamma \times I' \to \Gamma.A$ такое, что $\pi_A \circ h = \pi_1$.
Если $f : \Delta \to \Gamma$ - некоторый морфизм, и $h : I' \to A \dotsb \Gamma$, то мы будем обозначать $f^*(h) : I' \to f^*(A) \dotsb \Delta$ следующий морфизм:
\[ \xymatrix{ \Delta \times I' \ar[r]^{f \times id_{I'}} \ar[d]_{f^*(h)} \pb & \Gamma \times I' \ar[d]^h \\
              \Delta.f^*(A) \ar[r]_-{f.A} \ar[d]_{\pi_{f^*(A)}} \pb          & \Gamma.A \ar[d]^{\pi_A} \\
              \Delta \ar[r]_f                                                & \Gamma
                 }\]

\begin{comment}
Также в категории должен быть выбран насыщенный класс морфизмов, которые мы называем \emph{тривиальными корасслоениями}.
Морфизмы, которые имеют правое свойство поднятия по отношению к тривиальным корасслоениям, мы называем \emph{расслоениями}.
Мы требуем, чтобы для любого $A \dotsb \Gamma$ морфизмы $\pi_A : \Gamma.A \to \Gamma$ являлись расслоениями.

Тривиальные корасслоения должны содержать морфизмы вида $i_0 : \Gamma \to \Gamma \times I'$ и
    $(\Gamma \times I' \amalg \Gamma \times I') \amalg_{\Gamma \amalg \Gamma} \Gamma \times I' \to \Gamma \times I' \times I'$, которые определяются как в следующей диаграмме:
\[ \xymatrix@-1pc{ \Gamma \amalg \Gamma \ar[rr]^{i_0 \amalg i_0} \ar[dd]_{[i_0, i_1]} & & \Gamma \times I' \amalg \Gamma \times I' \ar[dd] \ar[rddd]^{[i_0, i_1]} \\ \\
\Gamma \times I' \ar[rr] \ar[rrrd]_{i_0 \times id_{I'}} & & \po (\Gamma \times I' \amalg \Gamma \times I') \amalg_{\Gamma \amalg \Gamma} \Gamma \times I' \ar@{-->}[rd] \\
                                                                       & & & \Gamma \times I' \times I'
                 } \]
\end{comment}

Также нам потребуются следующие конструкции.
Для любого объекта $\Gamma$, для любого $A \dotsb \Gamma \times I'$ и для любого $a : i_0^*(A) \dotsb \Gamma$ должно существовать сечение $ext(A,a) : A \dotsb \Gamma \times I'$ такое, что $i_0^*(ext(A,a)) = a$.
Более того, мы требуем, чтобы для любого морфизма $f : \Delta \to \Gamma$ было верно, что $(f \times id_{I'})^*(ext(A,a)) = ext((f \times id_{I'})^*(A), f^*(a))$.
Для этого достаточно проверить, что следующий квадрат коммутирует:
\[ \xymatrix{ \Gamma \times I' \ar[rr]^{f \times id_{I'}} \ar[d]_{ext((f \times id_{I'})^*(A), f^*(a))} & & \Gamma \times I' \ar[d]^{ext(A,a)} \\
              \Gamma \times I'.(f \times id_{I'})^*(A) \ar[rr]_-{(f \times id_{I'}).A}                  & & \Gamma \times I'.A
            } \]

Если $h_1, h_2 : I' \to A \dotsb \Gamma$ - гомотопии между $a_1, a_2 : \Gamma \to \Gamma.A$ и $a_2, a_3 : \Gamma \to \Gamma.A$ соответственно,
    то $con(h_1, h_2) : I' \to A \dotsb \Gamma$ - гомотопия между $a_1$ и $a_3$.
Если $f : \Delta \to \Gamma$, то $f^*(con(h_1, h_2)) = con(f^*(h_1), f^*(h_2))$.

Последние две конструкции, которые нам сейчас понадобятся, - это обращение и конкатенация расслоений над интервалом.

Если $H$ - тип над $\Gamma \times I'$ со слоями $A_1, A_2 \dotsb \Gamma$, то $Inv(H) \dotsb \Gamma \times I'$ - тип со слоями $A_2$ и $A_1$.
Если $f : \Delta \to \Gamma$, то $(f \times id_{I'})^*(Inv(H)) = Inv((f \times id_{I'})^*(H))$.

Если $H_1$, $H_2$ - типы над $\Gamma \times I'$ со слоями $A_1, A_2 \dotsb \Gamma$ и $A_2, A_3 \dotsb \Gamma$ соответственно, то $Con(H_1, H_2) \dotsb \Gamma \times I'$ - тип со слоями $A_1$ и $A_3$.
Если $f : \Delta \to \Gamma$, то $(f \times id_{I'})^*(Con(H_1, H_2)) = Con((f \times id_{I'})^*(H_1), (f \times id_{I'})^*(H_2))$.

\subsection{Определение интерпретации}

Мы опишем расширение системы, которое нам понадобится для доказательства свойств корректности интерпретации.
Это расширение не является частью системы и лишь служит как вспомогательный инструмент.
Во-первых, мы добаляем новые термы: $coe'\ (\lambda x. a)\ b\ c\ d$, $Red\ a\ b\ c$, $Red^*\ a\ b\ c$, $red\ a\ b\ c$, $red^*\ a\ b\ c$, $left'$, $right'$, где $x$ - переменная, и $a$, $b$, $c$, $d$ - термы.
Во-вторых, определим множества $Term'$ и $Ctx'$.
Пусть $Term$ - множество термов, тогда положим $Term' = Term \cup \{ I' \}$ и $Ctx' = \{ x_1 : A_1, \ldots x_n : A_n\ |\ x_i \text{ - переменные, } A_i \in Term' \}$.
% Также введем отношение $\deq_\phi$ на множестве термов как минимальное отношение конгруэнтности (т.е. отношение эквивалентности, замкнутое относительно всех конструкций термов), содержащее правило $coe\ (\lambda x. A)\ i\ a\ i \deq_\phi a$.
Также введем отношение $\red^*_\phi$ на множестве термов как минимальное рефлексивное, транзитивное отношение, замкнутое относительно всех конструкций термов и содержащее правило $coe\ (\lambda x. A)\ i\ a\ i \red^*_\phi a$.

Теперь мы готовы определить интерпретацию, которая является набором следующих отношений:
\begin{itemize}
\item Отношение $\ll - \vdash \rr = -$ на классе $Ctx' \times Ob$, где $Ob$ - класс объектов категории.
\item Отношение $\ll - \vdash - \rr = -$ на классе $Ctx' \times Term \times Type$, где $Type$ - класс типов категории, т.е. пар $\Gamma \in Ob$ и $A \in Type(\Gamma)$, такую пару мы обозначаем просто $A \dotsb \Gamma$.
\item Отношение $\ll - \vdash - \Uparrow - \rr = -$ на классе $Ctx' \times Term \times Term' \times Sec$, где $Sec$ - класс сечений категории, т.е. троек $\Gamma \in Ob$, $A \in Type(\Gamma)$ и $a$ - сечение $A$, такую тройку мы обозначаем просто $a : A \dotsb \Gamma$.
\item Отношение $\ll - \vdash - \Downarrow - \rr = -$ на классе $Ctx' \times Term \times Term' \times Sec$.
\end{itemize}

Интерпретация контекстов:

\medskip
\begin{center}
\AxiomC{}
\UnaryInfC{$\ll \vdash \rr = 1$}
\DisplayProof
\quad
\AxiomC{$\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$}
\RightLabel{, $x \notin \Gamma$}
\UnaryInfC{$\ll \Gamma, x : A \vdash \rr = \Gamma'.A'$}
\DisplayProof
\end{center}
\bigskip

Интерпретация переменных:

\medskip
\begin{center}
\AxiomC{$\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$}
\RightLabel{, $x \notin \Gamma$}
\UnaryInfC{$\ll \Gamma, x : A \vdash x \Uparrow A \rr = a : \pi_{A'}^*(A') \dotsb \Gamma'.A'$}
\DisplayProof
\end{center}

где $a$ определяется как в следующей диаграме:
\[ \xymatrix@-1pc{ \Gamma'.A' \ar[rddd]_{id_{\Gamma'.A'}} \ar[rrrd]^{id_{\Gamma'.A'}} \ar@{-->}[rd]_a & & & \\
                        & \Gamma'.A'.\pi_{A'}^*(A') \ar[rr]_-{\pi_{A'}.A'} \ar[dd]^{\pi_{\pi_{A'}^*(A')}} \pb & & \Gamma'.A' \ar[dd]^{\pi_{A'}} \\
                        &                                                                       & & \\
                        & \Gamma'.A' \ar[rr]_{\pi_{A'}}                                         & & \Gamma'
                 }\]

\begin{center}
\AxiomC{$\ll \Gamma \vdash x \Uparrow A \rr = a : A' \dotsb \Gamma'$}
\AxiomC{$\ll \Gamma \vdash B \rr = B' \dotsb \Gamma'$}
\RightLabel{, $y \notin \Gamma$}
\BinaryInfC{$\ll \Gamma, y : B \vdash x \Uparrow A \rr = \pi_{B'}^*(a) : \pi_{B'}^*(A') \dotsb \Gamma'.B'$}
\DisplayProof
\end{center}

Интерпретация правила проверки типа:

\medskip
\begin{center}
\AxiomC{$\ll \Gamma \vdash a \Uparrow A_1 \rr = a_1 : i_0^*(H_1) \dotsb \Gamma'$}
\AxiomC{$\ll \Gamma, k : I' \vdash Red^*\ A_i\ B\ k \rr = H_i \dotsb \Gamma' \times I'$, $i \in \{1, 2\}$}
\BinaryInfC{$\ll \Gamma \vdash a \Downarrow A_2 \rr = a_2 : i_0^*(H_2) \dotsb \Gamma'$}
\DisplayProof
\end{center}

Данное правило применимо, если $B \in NF$, и $i_1^*(H_1) = i_1^*(H_2)$.
Тогда мы определяем $H \dotsb \Gamma' \times I'$ как $Con(H_1, Inv(H_2))$, и $a_2$ как $i_1^*(ext(H, a_1))$.

Интерпретация правил редукций типов:

\medskip
\begin{center}
\AxiomC{$\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$}
\UnaryInfC{$\ll \Gamma, k : I' \vdash Red^*\ A\ A\ k \rr = \pi_1^*(A') \dotsb \Gamma' \times I'$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\ll \Gamma, k : I' \vdash Red\ A\ B\ k \rr = H_1 \dotsb \Gamma' \times I'$}
\AxiomC{$\ll \Gamma, k : I' \vdash Red^*\ B\ C\ k \rr = H_2 \dotsb \Gamma' \times I'$}
\BinaryInfC{$\ll \Gamma, k : I' \vdash Red^*\ A\ C\ k \rr = Con(H_1, H_2) \dotsb \Gamma' \times I'$}
\DisplayProof
\end{center}

Данное правило применимо при условии, что $i_1^*(H_1) = i_0^*(H_2)$.

Интерпретация правил редукций термов:

\medskip
\begin{center}
\AxiomC{$\ll \Gamma \vdash a \Downarrow A \rr = a' : A' \dotsb \Gamma'$}
\UnaryInfC{$\ll \Gamma, k : I' \vdash red^*\ a\ a\ k \Downarrow A \rr = \pi_1^*(a') : \pi_1^*(A') \dotsb \Gamma' \times I$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$}
\AxiomC{$\ll \Gamma, k : I' \vdash red\ a\ a'\ k \Downarrow A \rr = h_1 : \pi_1^*(A') \dotsb \Gamma' \times I'$}
\AxiomC{$\ll \Gamma, k : I' \vdash red^*\ a'\ a''\ k \Downarrow A \rr = h_2 : \pi_1^*(A') \dotsb \Gamma' \times I'$}
\TrinaryInfC{$\ll \Gamma, k : I' \vdash red^*\ a\ a''\ k \Downarrow A \rr = con(h_1, h_2) : \pi_1^*(A') \dotsb \Gamma' \times I'$}
\DisplayProof
\end{center}
\bigskip

Данное правило применимо при условии, что $h_1 \circ i_1 = h_2 \circ i_0$.

Интерпретация правил для интервала:

TODO

\begin{comment}
Пусть $\Gamma.A \xrightarrow{t} P(\Gamma.A) \xrightarrow{\langle p_1, p_2 \rangle} \Gamma.A \times \Gamma.A$ - объект путей для $\Gamma.A$.

Во-первых, определим $h'_1 : \Gamma \to P(\Gamma.A)$ как композицию $p \circ i_1$, где $p$ определяется следующим образом:
\[ \xymatrix{ \Gamma \ar[r]^-a \ar[d]_{i_0} & \Gamma.A \ar[r]^-t & P(\Gamma.A) \ar[d]^{\langle p_1, p_2 \rangle} \\
              \Gamma \times I' \ar[rr]_-{\langle a \circ \pi_1, h_1 \rangle} \ar@{-->}[urr]^p & & \Gamma.A \times \Gamma.A
            }\]
Во-вторых, определим $h'_3 : \Gamma \to P(\Gamma.A)$ как композицию $q \circ i_1$, где $q$ определяется следующим образом:
\[ \xymatrix{ \Gamma \ar[rr]^{h'_1} \ar[d]_{i_0}                  & & P(\Gamma.A) \ar[d]^{\langle p_1, p_2 \rangle} \\
              \Gamma \times I' \ar[rr]_-{\langle a \circ \pi_1, h_2 \rangle} \ar@{-->}[urr]^q & & \Gamma.A \times \Gamma.A
            }\]
Теперь определим $h_3 : \Gamma \times I' \to \Gamma.A$ как композицию $p_2 \circ s$, где $s$ определяется следующим образом:
\[ \xymatrix{ \Gamma \amalg \Gamma \ar[rr]^{[t \circ a, h'_3]} \ar[d] & & P(\Gamma.A) \ar[d]^{p_1} \\
              \Gamma \times I' \ar[r]_-{\pi_1} \ar@{-->}[urr]^s & \Gamma \ar[r]_-a & \Gamma.A
            }\]
\end{comment}

\subsection{Свойства интерпретации}

Пусть $\Gamma$ - некоторый объект, и $\Delta$ - некоторая коллекция вида $A_1 \dotsb \Gamma$, \ldots, $A_n \dotsb \Gamma.A_1 \ldots A_{n-1}$.
Тогда мы будем писать $\Delta \dotsb \Gamma$.
Объект $\Gamma.A_1 \ldots A_n$ мы будем обозначать как $\Gamma.\Delta$,
    и проекцию $\pi_{A_1} \circ \ldots \circ \pi_{A_n} : \Gamma.\Delta \to \Gamma$ как $\pi_\Delta : \Gamma.\Delta \to \Gamma$.
Пустую коллекцию $\Delta$ мы будем обозначать как $()$.
Если $A_{n+1} \dotsb \Gamma.\Delta$, то коллекцию $A_1, \ldots A_n, A_{n+1}$ мы будем обозначать как $\Delta.A_{n+1}$.
Нотация $\Gamma.\Delta.A_{n+1}$ не является двусмысленной, т.к. оба объекта $(\Gamma.\Delta).A_{n+1}$ и $\Gamma.(\Delta.A_{n+1})$ означают один и тот же объект $\Gamma.A_1 \ldots A_n.A_{n+1}$.
Если $f : \Gamma' \to \Gamma$, то мы будем обозначать $f^*(\Delta) \dotsb \Gamma'$ коллекцию $f^*(A_1) \dotsb \Gamma'$, \ldots, $(f.A_1 \ldots A_{n-1})^*(A_n) \dotsb \Gamma'.f^*(A_1) \ldots (f.A_1 \ldots A_{n-2})^*(A_{n-1})$,
    и $f.\Delta : \Gamma'.f^*(\Delta) \to \Gamma.\Delta$ морфизм $f.A_1 \ldots A_n : \Gamma'.f^*(\Delta) \to \Gamma.\Delta$.

Введем следующее вспомогательное отношение:

\medskip
\begin{center}
\AxiomC{$\ll \Gamma \vdash \rr = \Gamma'$}
\UnaryInfC{$\ll \Gamma \vdash \rr = () \dotsb \Gamma'$}
\DisplayProof
\quad
\AxiomC{$\ll \Gamma \vdash \Delta \rr = \Delta' \dotsb \Gamma'$}
\AxiomC{$\ll \Gamma, \Delta \vdash A \rr = A' \dotsb \Gamma'.\Delta'$}
\RightLabel{, $x \notin \Gamma, \Delta$}
\BinaryInfC{$\ll \Gamma \vdash \Delta, x : A \rr = \Delta'.A' \dotsb \Gamma'$}
\DisplayProof
\end{center}
\bigskip

Индукцией несложно показать, что если $\ll \Gamma \vdash \Delta \rr = \Delta' \dotsb \Gamma'$, то $\ll \Gamma \vdash \rr = \Gamma'$, и $\ll \Gamma, \Delta \vdash \rr = \Gamma'.\Delta'$.

\begin{lem}[completeness][Completeness of the interpretation of the reduction rules]
Верны следующие утверждения:
\begin{enumerate}
\item Если $\ll \Gamma \vdash A \red B \rr = A' \to B' \dotsb \Gamma'$, то $A \red B$.
\item Если $\ll \Gamma \vdash A \red^* B \rr = A' \to B' \dotsb \Gamma'$, то $A \red^* B$.
\item Если $\ll \Gamma \vdash a \red b \Downarrow A \rr = h : I' \to A' \dotsb \Gamma'$, то $a \red b$.
\item Если $\ll \Gamma \vdash a \red^* b \Downarrow A \rr = h : I' \to A' \dotsb \Gamma'$, то $a \red^* b$.
\end{enumerate}
\end{lem}
\begin{proof}
Индукцией по определению отношения интерпретации.
\end{proof}

\begin{lem}[functionality][Functionality of the interpretation]
Верны следующие утверждения:
\begin{enumerate}
\item Если $\ll \Gamma \vdash \rr = \Gamma_1$, и $\ll \Gamma \vdash \rr = \Gamma_2$, то $\Gamma_1 = \Gamma_2$.
\item Если $\ll \Gamma \vdash A \rr = A_1 \dotsb \Gamma_1$, и $\ll \Gamma \vdash A \rr = A_2 \dotsb \Gamma_2$, то $\Gamma_1 = \Gamma_2$, и $A_1 = A_2$.
\item Если $\ll \Gamma \vdash \Delta \rr = \Delta_1 \dotsb \Gamma_1$, и $\ll \Gamma \vdash \Delta \rr = \Delta_2 \dotsb \Gamma_2$, то $\Gamma_1 = \Gamma_2$, и $\Delta_1 = \Delta_2$.
\item Если $\ll \Gamma \vdash a \Downarrow A \rr = a_1 : A_1 \dotsb \Gamma_1$, и $\ll \Gamma \vdash a \Downarrow A \rr = a_2 : A_2 \dotsb \Gamma_2$, то $\Gamma_1 = \Gamma_2$, $A_1 = A_2$, и $a_1 = a_2$.
\item Если $\ll \Gamma \vdash a \Uparrow A_1 \rr = a_1 : A'_1 \dotsb \Gamma_1$, и $\ll \Gamma \vdash a \Uparrow A_2 \rr = a_2 : A'_2 \dotsb \Gamma_2$, то $A_1 = A_2$, $\Gamma_1 = \Gamma_2$, $A'_1 = A'_2$, и $a_1 = a_2$.
\item Если $\ll \Gamma \vdash A \red B_1 \rr = A_1 \to B'_1 \dotsb \Gamma_1$, и $\ll \Gamma \vdash A \red B_2 \rr = A_2 \to B'_2 \dotsb \Gamma_2$, то $B_1 = B_2$, $\Gamma_1 = \Gamma_2$, $A_1 = A_2$, и $B'_1 = B'_2$.
\item Если $\ll \Gamma \vdash A \red^* B \rr = A_1 \to B_1 \dotsb \Gamma_1$, и $\ll \Gamma \vdash A \red^* B \rr = A_2 \to B_2 \dotsb \Gamma_2$, то $\Gamma_1 = \Gamma_2$, $A_1 = A_2$, и $B_1 = B_2$.
\item Если $\ll \Gamma \vdash a \red b_1 \Downarrow A \rr = h_1 : I' \to A_1 \dotsb \Gamma_1$, и $\ll \Gamma \vdash a \red b_2 \Downarrow A \rr = h_2 : I' \to A_2 \dotsb \Gamma_2$, то $b_1 = b_2$, $\Gamma_1 = \Gamma_2$, $A_1 = A_2$, и $h_1 = h_2$.
\item Если $\ll \Gamma \vdash a \red^* b \Downarrow A \rr = h_1 : I' \to A_1 \dotsb \Gamma_1$, и $\ll \Gamma \vdash a \red^* b \Downarrow A \rr = h_2 : I' \to A_2 \dotsb \Gamma_2$, то $\Gamma_1 = \Gamma_2$, $A_1 = A_2$, и $h_1 = h_2$.
\end{enumerate}
\end{lem}
\begin{proof}
Индукцией по определению отношения интерпретации.

В седьмом и девятом пунктах используется полонота интерпретации и тот факт, что отношение $\red$ иррефлексивно, что следует из сильной нормализуемости.
\end{proof}

Таким образом отношения $\ll - \rr = -$ определяют частичные функции, которые мы будем обозначать $\ll - \rr$.

\begin{lem}[weakening][Weakening lemma]
Пусть $\ll \Gamma \vdash \Delta\rr = \Delta' \dotsb \Gamma'$.
Тогда верны следующие утверждения:
\begin{enumerate}
\item Если $\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$, то $\ll \Gamma, \Delta \vdash A \rr = \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta'$.
\item Если $\ll \Gamma \vdash a \Downarrow A \rr = a' : A' \dotsb \Gamma'$, \\
    то $\ll \Gamma, \Delta \vdash a \Downarrow A \rr = \pi_{\Delta'}^*(a') : \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta'$.
\item Если $\ll \Gamma \vdash a \Uparrow A \rr = a' : A' \dotsb \Gamma'$, \\
    то $\ll \Gamma, \Delta \vdash a \Uparrow A \rr = \pi_{\Delta'}^*(a') : \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta'$.
\item Если $\ll \Gamma \vdash A \red B \rr = H \dotsb \Gamma'$, \\
    то $\ll \Gamma, \Delta \vdash A \red B \rr = (\pi_{\Delta'} \times id_{I'})^*(H) \dotsb \Gamma'.\Delta' \times I'$.
\item Если $\ll \Gamma \vdash A \red^* B \rr = H \dotsb \Gamma'$, \\
    то $\ll \Gamma, \Delta \vdash A \red^* B \rr = (\pi_{\Delta'} \times id_{I'})^*(H) \dotsb \Gamma'.\Delta' \times I'$.
\item Если $\ll \Gamma \vdash a \red b \Downarrow A \rr = h : I' \to A' \dotsb \Gamma'$, \\
    то $\ll \Gamma, \Delta \vdash a \red b \Downarrow A \rr = \pi_{\Delta'}^*(h) : I' \to \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta'$.
\item Если $\ll \Gamma \vdash a \red^* b \Downarrow A \rr = h : I' \to A' \dotsb \Gamma'$, \\
    то $\ll \Gamma, \Delta \vdash a \red^* b \Downarrow A \rr = \pi_{\Delta'}^*(h) : I' \to \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta'$.
\end{enumerate}
\end{lem}
\begin{proof}
Третий пункт в случае, когда $a$ - переменная, легко доказать индукцией по размеру $\Delta$.
Остальные случаи доказываются индукцией по построению $\ll - \rr = -$.
\begin{itemize}
\item
\AxiomC{$\ll \Gamma \vdash a \Uparrow A_1 \rr = a_1 : i_0^*(H_1) \dotsb \Gamma'$}
\AxiomC{$\ll \Gamma \vdash A_i \red^* B \rr = H_i \dotsb \Gamma' \times I'$, $i \in \{1, 2\}$}
\BinaryInfC{$\ll \Gamma \vdash a \Downarrow A_2 \rr = i_1^*(ext(Con(H_1,Inv(H_2)),a_1)) : i_0^*(H_2) \dotsb \Gamma'$}
\DisplayProof
\medskip

По индукционной гипотезе $\ll \Gamma, \Delta \vdash a \Uparrow A_1 \rr = \pi_{\Delta'}^*(a_1) : \pi_{\Delta'}^* i_0^*(H_1) \dotsb \Gamma'.\Delta'$, и
$\ll \Gamma, \Delta \vdash A_i \red^* B \rr = (\pi_{\Delta'} \times id_{I'})^*(H_i) \dotsb \Gamma'.\Delta' \times I'$.
Следовательно $\ll \Gamma, \Delta \vdash a \Downarrow A_2 \rr = i_1^*(ext(Con((\pi_{\Delta'} \times id_{I'})^*(H_1), Inv((\pi_{\Delta'} \times id_{I'})^*(H_2))), \pi_{\Delta'}^*(a_1))) : i_0^* (\pi_{\Delta'} \times id_{I'})^*(H_2) \dotsb \Gamma'.\Delta' = \pi_{\Delta'}^* i_1^*(ext(Con(H_1,Inv(H_2)),a_1)) : \pi_{\Delta'}^* i_0^*(H_2) \dotsb \Gamma'.\Delta'$.

\bigskip
\item
\AxiomC{$\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$}
\UnaryInfC{$\ll \Gamma \vdash A \red^* A \rr = \pi_1^*(A') \dotsb \Gamma' \times I'$}
\DisplayProof
\medskip

По индукционной гипотезе $\ll \Gamma, \Delta \vdash A \rr = \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta'$. \\
Следовательно $\ll \Gamma, \Delta \vdash A \red^* A \rr = \pi_1^* \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta' \times I' =$ \\
    $(\pi_{\Delta'} \times id_{I'})^* \pi_1^*(A') \dotsb \Gamma.\Delta' \times I'$.

\bigskip
\item
\AxiomC{$\ll \Gamma \vdash A \red B \rr = H_1 \dotsb \Gamma' \times I'$}
\AxiomC{$\ll \Gamma \vdash B \red^* C \rr = H_2 \dotsb \Gamma' \times I'$}
\BinaryInfC{$\ll \Gamma \vdash A \red^* C \rr = Con(H_1, H_2) \dotsb \Gamma' \times I'$}
\DisplayProof
\medskip

По индукционной гипотезе $\ll \Gamma, \Delta \vdash A \red B \rr = (\pi_{\Delta'} \times id_{I'})^*(H_1) \dotsb \Gamma'.\Delta' \times I'$,
    и $\ll \Gamma, \Delta \vdash B \red^* C \rr = (\pi_{\Delta'} \times id_{I'})^*(H_2) \dotsb \Gamma'.\Delta' \times I'$.
Следовательно $\ll \Gamma, \Delta \vdash A \red^* C \rr = Con((\pi_{\Delta'} \times id_{I'})^*(H_1), (\pi_{\Delta'} \times id_{I'})^*(H_2)) \dotsb \Gamma'.\Delta' \times I' = (\pi_{\Delta'} \times id_{I'})^*(Con(H_1, H_2)) \dotsb \Gamma'.\Delta' \times I'$.

\bigskip
\item
\AxiomC{$\ll \Gamma \vdash a \Downarrow A \rr = a' : A' \dotsb \Gamma'$}
\UnaryInfC{$\ll \Gamma \vdash a \red^* a \Downarrow A \rr = a' \circ \pi_1 : I' \to A' \dotsb \Gamma'$}
\DisplayProof
\medskip

По индукционной гипотезе $\ll \Gamma, \Delta \vdash a \Downarrow A \rr = \pi_{\Delta'}^*(a') : \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta'$.
Следовательно $\ll \Gamma, \Delta \vdash a \red^* a \Downarrow A \rr = \pi_{\Delta'}^*(a') \circ \pi_1 : I' \to \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta' = \pi_{\Delta'}^*(a' \circ \pi_1) : I' \to \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta'$.

\bigskip
\item
\AxiomC{$\ll \Gamma \vdash a \red a' \Downarrow A \rr = h_1 : I' \to A' \dotsb \Gamma'$}
\AxiomC{$\ll \Gamma \vdash a' \red^* a'' \Downarrow A \rr = h_2 : I' \to A' \dotsb \Gamma'$}
\BinaryInfC{$\ll \Gamma \vdash a \red^* a'' \Downarrow A \rr = con(h_1, h_2) : I' \to A' \dotsb \Gamma'$}
\DisplayProof
\medskip

По индукционной гипотезе $\ll \Gamma, \Delta \vdash a \red a' \Downarrow A \rr = \pi_{\Delta'}^*(h_1) : I' \to \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta'$,
    и $\ll \Gamma, \Delta \vdash a' \red a'' \Downarrow A \rr = \pi_{\Delta'}^*(h_2) : I' \to \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta'$.
Следовательно $\ll \Gamma, \Delta \vdash a \red a'' \Downarrow A \rr = con(\pi_{\Delta'}^*(h_1), \pi_{\Delta'}^*(h_2)) : I' \to \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta' = \pi_{\Delta'}^*(con(h_1, h_2)) : I' \to \pi_{\Delta'}^*(A') \dotsb \Gamma'.\Delta'$.

\end{itemize}
\end{proof}

\begin{lem}[coherence-typing][Coherence of the typing]
Верны следующие утверждения:
\begin{enumerate}
\item Если $\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$, то $\ll \Gamma \vdash \rr = \Gamma'$.
\item Если $\ll \Gamma \vdash a \Downarrow A \rr = a : A' \dotsb \Gamma'$, то $\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$.
\item Если $\ll \Gamma \vdash a \Uparrow A \rr = a : A' \dotsb \Gamma'$, то $\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$.
\item Если $\ll \Gamma \vdash A \red B \rr = H \dotsb \Gamma' \times I'$, то $\ll \Gamma \vdash A \rr = i_0^*(H) \dotsb \Gamma'$ и $\ll \Gamma \vdash B \rr = i_1^*(H) \dotsb \Gamma'$.
\item Если $\ll \Gamma \vdash A \red^* B \rr = H \dotsb \Gamma' \times I'$, то $\ll \Gamma \vdash A \rr = i_0^*(H) \dotsb \Gamma'$ и $\ll \Gamma \vdash B \rr = i_1^*(H) \dotsb \Gamma'$.
\item Если $\ll \Gamma \vdash a \red b \Downarrow A \rr = h : I' \to A' \dotsb \Gamma'$, то $\ll \Gamma \vdash a \Downarrow A \rr = h \circ i_0 : A' \dotsb \Gamma'$ и $\ll \Gamma \vdash b \Downarrow A \rr = h \circ i_1 : A' \dotsb \Gamma'$.
\item Если $\ll \Gamma \vdash a \red^* b \Downarrow A \rr = h : I' \to A' \dotsb \Gamma'$, то $\ll \Gamma \vdash a \Downarrow A \rr = h \circ i_0 : A' \dotsb \Gamma'$ и $\ll \Gamma \vdash b \Downarrow A \rr = h \circ i_1 : A' \dotsb \Gamma'$.
\end{enumerate}
\end{lem}
\begin{proof}
Индукцией по построению $\ll - \rr = -$.
Третий пункт, когда $a$ - переменная, следует из леммы~\rlem{weakening}.
Остальные пункты элементарны.
\end{proof}

\begin{lem}[correctness-subst][Correctness of the substitution]
Пусть $\ll \Gamma \vdash a \Uparrow A \rr = a' : A' \dotsb \Gamma'$, и $\ll \Gamma, x : A \vdash \Delta \rr = \Delta' \dotsb \Gamma'.A'$.
Тогда верны следующие утверждения:
\begin{enumerate}
\item Если $\ll \Gamma, x : A, \Delta \vdash \rr = \Gamma'.A'.\Delta'$, то $\ll \Gamma, \Delta[x := a] \vdash \rr = \Gamma'.a'^*(\Delta')$.
\item Если $\ll \Gamma, x : A, \Delta \vdash B \rr = B' \dotsb \Gamma'.A'.\Delta'$, то $\ll \Gamma, \Delta[x := a] \vdash B[x := a] \rr = (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta')$.
\item Если $\ll \Gamma, x : A, \Delta \vdash b \Downarrow B \rr = b' : B' \dotsb \Gamma'.A'.\Delta'$, то $\ll \Gamma, \Delta[x := a] \vdash b[x := a] \Downarrow B[x := a] \rr = (a'.\Delta')^*(b') : (a'.\Delta')^*(B') \dotsb \Gamma.a'^*(\Delta')$.
\item Если $\ll \Gamma, x : A, \Delta \vdash b \Uparrow B \rr = b' : B' \dotsb \Gamma'.A'.\Delta'$, то $\ll \Gamma, \Delta[x := a] \vdash b[x := a] \Uparrow B[x := a] \rr = (a'.\Delta')^*(b') : (a'.\Delta')^*(B') \dotsb \Gamma.a'^*(\Delta')$.
\item Если $\ll \Gamma, x : A, \Delta \vdash B \red C \rr = H \dotsb \Gamma'.A'.\Delta' \times I'$, то $\ll \Gamma, \Delta[x := a] \vdash B[x := a] \red C[x := a] \rr = (a'.\Delta' \times id_{I'})^*(H) \dotsb \Gamma'.a'^*(\Delta') \times I'$.
\item Если $\ll \Gamma, x : A, \Delta \vdash B \red^* C \rr = H \dotsb \Gamma'.A'.\Delta' \times I'$, то $\ll \Gamma, \Delta[x := a] \vdash B[x := a] \red^* C[x := a] \rr = (a'.\Delta' \times id_{I'})^*(H) \dotsb \Gamma'.a'^*(\Delta') \times I'$.
\item Если $\ll \Gamma, x : A, \Delta \vdash b \red c \Downarrow B \rr = h : I' \to B' \dotsb \Gamma'.A'.\Delta'$, то $\ll \Gamma, \Delta[x := a] \vdash b[x := a] \red c[x := a] \Downarrow B[x := a] \rr = (a'.\Delta')^*(h) : I' \to (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta')$.
\item Если $\ll \Gamma, x : A, \Delta \vdash b \red^* c \Downarrow B \rr = h : I' \to B' \dotsb \Gamma'.A'.\Delta'$, то $\ll \Gamma, \Delta[x := a] \vdash b[x := a] \red^* c[x := a] \Downarrow B[x := a] \rr = (a'.\Delta')^*(h) : I' \to (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta')$.
\end{enumerate}
\end{lem}
\begin{proof}
Индукцией по построению $\ll - \rr = -$.
\begin{itemize}
\item
\AxiomC{$\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$}
\UnaryInfC{$\ll \Gamma, x : A \vdash \rr = \Gamma'.A'$}
\DisplayProof
\medskip

По лемме~\rlem{coherence-typing} $\ll \Gamma \vdash \rr = \Gamma'$.

\bigskip
\item
\AxiomC{$\ll \Gamma, x : A, \Delta \vdash A_{n+1} \rr = A'_{n+1} \dotsb \Gamma'.A'.\Delta'$}
\UnaryInfC{$\ll \Gamma, x : A, \Delta, x_{n+1} : A_{n+1} \vdash \rr = \Gamma'.A'.\Delta'.A'_{n+1}$}
\DisplayProof
\medskip

По индукционному предположению $\ll \Gamma, \Delta[x := a] \vdash A_{n+1}[x := a] \rr = (a'.\Delta')^*(A'_{n+1}) \dotsb \Gamma'.a'^*(\Delta')$.
Следовательно $\ll \Gamma, \Delta[x := a], x_{n+1} : A_{n+1}[x := a] \vdash \rr = \Gamma'.a'^*(\Delta').(a'.\Delta')^*(A'_{n+1}) = \Gamma'.a'^*(\Delta'.A'_{n+1})$.

\bigskip
\item
\AxiomC{$\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$}
\UnaryInfC{$\ll \Gamma, x : A \vdash x \Uparrow A \rr = \langle id_{\Gamma'.A'}, id_{\Gamma'.A'} \rangle : \pi_{A'}^*(A') \dotsb \Gamma'.A'$}
\DisplayProof
\medskip

По предположению $\ll \Gamma \vdash a \Uparrow A \rr = a' : A' \dotsb \Gamma' = a'^*(\langle id_{\Gamma'.A'}, id_{\Gamma'.A'} \rangle) : a'^*(\pi_{A'}^*(A')) \dotsb \Gamma'$.

\bigskip
\item
\AxiomC{$\ll \Gamma, x : A, \Delta \vdash A_{n+1} \rr = A'_{n+1} \dotsb \Gamma'.A'.\Delta'$}
\UnaryInfC{$\ll \Gamma, x : A, \Delta, x_{n+1} : A_{n+1} \vdash x_{n+1} \Uparrow A_{n+1} \rr = \langle id, id \rangle : \pi_{A'_{n+1}}^*(A'_{n+1}) \dotsb \Gamma.A'.\Delta'.A'_{n+1}$}
\DisplayProof
\medskip

По индукционному предположению $\ll \Gamma, \Delta[x := a] \vdash A_{n+1}[x := a] \rr = (a'.\Delta')^*(A'_{n+1}) \dotsb \Gamma'.a'^*(\Delta')$. \\
Следовательно $\ll \Gamma, \Delta[x := a], x_{n+1} : A_{n+1}[x := a] \vdash x_{n+1} \Uparrow A_{n+1}[x := a] \rr = \langle id, id \rangle : \pi_{(a'.\Delta')^*(A'_{n+1})}^*(a'.\Delta')^*(A'_{n+1}) \dotsb \Gamma'.a'^*(\Delta').(a'.\Delta')^*(A'_{n+1}) = (a'.\Delta'.A'_{n+1})^*(\langle id, id \rangle) : (a'.\Delta'.A'_{n+1})^* \pi_{A'_{n+1}}^*(A'_{n+1}) \dotsb \Gamma'.a'^*(\Delta'.A'_{n+1})$.

\bigskip
\item
\AxiomC{$\ll \Gamma \vdash y \Uparrow B \rr = b : B' \dotsb \Gamma'$}
\AxiomC{$\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$}
\BinaryInfC{$\ll \Gamma, x : A \vdash y \Uparrow B \rr = \pi_{A'}^*(b) : \pi_{A'}^*(B') \dotsb \Gamma'.A'$}
\DisplayProof
\medskip

$\ll \Gamma \vdash y[x := a] \Uparrow B[x := a] \rr = \ll \Gamma \vdash y \Uparrow B \rr = b : B' \dotsb \Gamma' = a'^* \pi_{A'}^*(b) : a'^* \pi_{A'}^*(B') \dotsb \Gamma'$.

\bigskip
\item
\AxiomC{$\ll \Gamma, x : A, \Delta \vdash y \Uparrow B \rr = b : B' \dotsb \Gamma'.A'.\Delta'$}
\AxiomC{$\ll \Gamma, x : A, \Delta \vdash A_{n+1} \rr = A'_{n+1} \dotsb \Gamma'.A'.\Delta'$}
\BinaryInfC{$\ll \Gamma, x : A, \Delta, x_{n+1} : A_{n+1} \vdash y \Uparrow B \rr = \pi_{A'_{n+1}}^*(b) : \pi_{A'_{n+1}}^*(B') \dotsb \Gamma'.A'.\Delta'.A'_{n+1}$}
\DisplayProof
\medskip

По индукционному предположению $\ll \Gamma, \Delta[x := a] \vdash y[x := a] \Uparrow B[x := a] \rr = (a'.\Delta')^*(b) : (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta')$,
    и $\ll \Gamma, \Delta[x := a] \vdash A_{n+1}[x := a] \rr = (a'.\Delta')^*(A'_{n+1}) \dotsb \Gamma'.a'^*(\Delta')$. \\
По лемме~\rlem{weakening} $\ll \Gamma, \Delta[x := a], x_{n+1} : A_{n+1} \vdash y[x := a] \Uparrow B[x := a] \rr = \pi_{(a'.\Delta')^*(A'_{n+1})}^*(a'.\Delta')^*(b) : \pi_{(a'.\Delta')^*(A'_{n+1})}^*(a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta'.A'_{n+1})$,
Теперь утверждение следует из того факта, что $a'.\Delta' \circ \pi_{(a'.\Delta')^*(A'_{n+1})} = \pi_{A'_{n+1}} \circ a'.\Delta'.A'_{n+1}$.

\bigskip
\item
\def\extraVskip{0.5pt}
\Axiom$\fCenter \ll \Gamma, x : A, \Delta \vdash b \Uparrow B_1 \rr = b_1 : i_0^*(H_1) \dotsb \Gamma'.A'.\Delta'$
\noLine
\UnaryInf$\fCenter \ll \Gamma, x : A, \Delta \vdash B_i \red^* C \rr = H_i \dotsb \Gamma'.A'.\Delta' \times I' \text{, } i \in \{1, 2\}$
\def\extraVskip{2pt}
\UnaryInf$\fCenter \ll \Gamma, x : A, \Delta \vdash b \Downarrow B_2 \rr = i_1^*(ext(Con(H_1,Inv(H_2)),b_1)) : i_0^*(H_2) \dotsb \Gamma'.A'.\Delta'$
\DisplayProof
\medskip

По индукционной гипотезе $\ll \Gamma, \Delta[x := a] \vdash b[x := a] \Uparrow B_1[x := a] \rr = (a'.\Delta')^*(b_1) : (a'.\Delta')^* i_0^*(H_1) \dotsb \Gamma'.a'^*(\Delta')$,
    и $\ll \Gamma, \Delta[x := a] \vdash B_i[x := a] \red^* C[x := a] \rr = (a'.\Delta' \times id_{I'})^*(H_i) \dotsb \Gamma'.a'^*(\Delta') \times I'$.
Следовательно $\ll \Gamma, \Delta[x := a] \vdash b[x := a] \Downarrow B_2[x := a] \rr = i_1^*(ext(Con((a'.\Delta' \times id_{I'})^*(H_1), Inv((a'.\Delta' \times id_{I'})^*(H_2))), (a'.\Delta')^*(b_1))) : i_0^* (a'.\Delta' \times id_{I'})^*(H_2) \dotsb \Gamma'.a'^*(\Delta') =$ \\
    $(a'.\Delta')^* i_1^*(ext(Con(H_1, Inv(H_2)), b_1)) : (a'.\Delta')^* i_0^*(H_2) \dotsb \Gamma'.a'^*(\Delta')$.

\bigskip
\item
\AxiomC{$\ll \Gamma, x : A, \Delta \vdash B \rr = B' \dotsb \Gamma'.A'.\Delta'$}
\UnaryInfC{$\ll \Gamma, x : A, \Delta \vdash B \red^* B \rr = \pi_1^*(B') \dotsb \Gamma'.A'.\Delta' \times I'$}
\DisplayProof
\medskip

По индукционной гипотезе $\ll \Gamma, \Delta[x := a] \vdash B[x := a] \rr = (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta')$.
Следовательно $\ll \Gamma, \Delta[x := a] \vdash B[x := a] \red^* B[x := a] \rr = \pi_1^* (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta') \times I' = (a'.\Delta' \times id_{I'})^* \pi_1^*(B') \dotsb \Gamma'.a'^*(\Delta') \times I'$.

\bigskip
\item
\AxiomC{$\ll \Gamma, x : A, \Delta \vdash B \red C \rr = H_1 \dotsb \Gamma'.A'.\Delta' \times I'$}
\AxiomC{$\ll \Gamma, x : A, \Delta \vdash C \red^* D \rr = H_2 \dotsb \Gamma'.A'.\Delta' \times I'$}
\BinaryInfC{$\ll \Gamma, x : A, \Delta \vdash B \red^* D \rr = Con(H_1, H_2) \dotsb \Gamma'.A'.\Delta' \times I'$}
\DisplayProof
\medskip

По индукционной гипотезе $\ll \Gamma, \Delta[x := a] \vdash B[x := a] \red C[x := a] \rr = (a'.\Delta' \times id_{I'})^*(H_1) \dotsb \Gamma'.a'^*(\Delta')$,
    и $\ll \Gamma, \Delta[x := a] \vdash C[x := a] \red^* D[x := a] \rr = (a'.\Delta' \times id_{I'})^*(H_2) \dotsb \Gamma'.a'^*(\Delta')$.
Следовательно $\ll \Gamma, \Delta[x := a] \vdash B[x := a] \red^* D[x := a] \rr = Con((a'.\Delta' \times id_{I'})^*(H_1), (a'.\Delta' \times id_{I'})^*(H_2)) \dotsb \Gamma'.a'^*(\Delta') = (a'.\Delta' \times id_{I'})^*(Con(H_1, H_2)) \dotsb \Gamma'.a'^*(\Delta')$.

\bigskip
\item
\AxiomC{$\ll \Gamma, x : A, \Delta \vdash b \Downarrow B \rr = b' : B' \dotsb \Gamma'.A'.\Delta'$}
\UnaryInfC{$\ll \Gamma, x : A, \Delta \vdash b \red^* b \Downarrow B \rr = b' \circ \pi_1 : I' \to B' \dotsb \Gamma'.A'.\Delta'$}
\DisplayProof
\medskip

По индукционной гипотезе $\ll \Gamma, \Delta[x := a] \vdash b[x := a] \Downarrow B[x := a] \rr = (a'.\Delta')^*(b') : (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta')$.
Следовательно $\ll \Gamma, \Delta[x := a] \vdash b[x := a] \red^* b[x := a] \Downarrow B[x := a] \rr = (a'.\Delta')^*(b') \circ \pi_1 : I' \to (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta') = (a'.\Delta')^*(b' \circ \pi_1) : I' \to (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta')$.

\bigskip
\item
\def\extraVskip{0.5pt}
\Axiom$\fCenter \ll \Gamma, x : A, \Delta \vdash b \red c \Downarrow B \rr = h_1 : I' \to B' \dotsb \Gamma'.A'.\Delta'$
\noLine
\UnaryInf$\fCenter \ll \Gamma, x : A, \Delta \vdash c \red^* d \Downarrow B \rr = h_2 : I' \to B' \dotsb \Gamma'.A'.\Delta'$
\def\extraVskip{2pt}
\UnaryInf$\fCenter \ll \Gamma, x : A, \Delta \vdash b \red^* d \Downarrow B \rr = con(h_1, h_2) : I' \to B' \dotsb \Gamma'.A'.\Delta'$
\DisplayProof
\medskip

По индукционной гипотезе $\ll \Gamma, \Delta[x := a] \vdash b[x := a] \red c[x := a] \Downarrow B[x := a] \rr = (a'.\Delta')^*(h_1) : (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta')$,
    и $\ll \Gamma, \Delta[x := a] \vdash c[x := a] \red^* d[x := a] \Downarrow B[x := a] \rr = (a'.\Delta')^*(h_2) : (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta')$,
Следовательно $\ll \Gamma, \Delta[x := a] \vdash b[x := a] \red^* d[x := a] \Downarrow B[x := a] \rr = con((a'.\Delta')^*(h_1), (a'.\Delta')^*(h_2)) : (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta') = (a'.\Delta')^*(con(h_1, h_2)) : (a'.\Delta')^*(B') \dotsb \Gamma'.a'^*(\Delta')$,

\end{itemize}
\end{proof}

\begin{lem}[correctness-reductions][Correctness of the interpretation of the reductions rules]
Верны следующие утверждения:
\begin{enumerate}
\item Если $\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$, и $A \red B$, то $\ll \Gamma \vdash A \red B \rr$ определенно.
\item Если $\ll \Gamma \vdash A \rr = A' \dotsb \Gamma'$, и $A \red^* B$, то $\ll \Gamma \vdash A \red^* B \rr$ определенно.
\item Если $\ll \Gamma \vdash a \Downarrow A \rr = a' : A' \dotsb \Gamma'$, и $a \red b$, то $\ll \Gamma \vdash a \red b \Downarrow A \rr$ определенно.
\item Если $\ll \Gamma \vdash a \Downarrow A \rr = a' : A' \dotsb \Gamma'$, и $a \red^* b$, то $\ll \Gamma \vdash a \red^* b \Downarrow A \rr$ определенно.
\end{enumerate}
\end{lem}
\begin{proof}
Второй и четвертый пункты элементарно следуют из первого и третьего соответственно.
Первый и третий пункты на данный момент тривиальны, т.к. мы не ввели пока никаких правил редукций.
\end{proof}

\begin{lem}[correctness-typing][Correctness of the interpretation of the typing rules]
Верны следующие утверждения:
\begin{enumerate}
\item Если $\Gamma \vdash$, то $\ll \Gamma \vdash \rr$ определенно.
\item Если $\Gamma \vdash A$, то $\ll \Gamma \vdash A \rr$ определенно.
\item Если $\Gamma \vdash a \Downarrow A$, то $\ll \Gamma \vdash a \Downarrow A \rr$ определенно.
\item Если $\Gamma \vdash a \Uparrow A$, то $\ll \Gamma \vdash a \Uparrow A \rr$ определенно.
\end{enumerate}
\end{lem}
\begin{proof}
Индукцией по построению $- \vdash -$, используя лемму~\rlem{coherence-typing}.
Единственный нетривиальный случай:
\begin{center}
\AxiomC{$\Gamma \vdash a \Uparrow A_1$}
\AxiomC{$\Gamma \vdash A_2$}
\RightLabel{, $A_1 \deq A_2$}
\BinaryInfC{$\Gamma \vdash a \Downarrow A_2$}
\DisplayProof
\end{center}

В этом случае, используя свойства конфлюентности и сильной нормализации, мы получаем, что существует терм $B \in NF$ такой, что $A_1 \red^* B$, и $A_2 \red^* B$.
Таким образом этот случай следует из леммы~\rlem{correctness-reductions}.
\end{proof}

\section{Конструкции}

\subsection{Тип интервала}

Мы добавляем следующие правила вывода:

\begin{center}
\AxiomC{$\Gamma \vdash$}
\UnaryInfC{$\Gamma \vdash I$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash$}
\UnaryInfC{$\Gamma \vdash left \Uparrow I$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash$}
\UnaryInfC{$\Gamma \vdash right \Uparrow I$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma, x : I \vdash A$}
\AxiomC{$\Gamma \vdash a \Downarrow A[x := left]$}
\AxiomC{$\Gamma \vdash i \Downarrow I$}
\TrinaryInfC{$\Gamma \vdash coe\ (\lambda x. A)\ a\ i \Uparrow A[x := i]$}
\DisplayProof
\end{center}

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
