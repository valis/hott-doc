\documentclass[reqno]{amsart}

\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{verbatim}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{turnstile}
\usepackage{etex}

\hypersetup{colorlinks=true,linkcolor=blue}

\newcommand{\axlabel}[1]{(#1) \phantomsection \label{ax:#1}}
\newcommand{\axtag}[1]{\label{ax:#1} \tag{#1}}
\newcommand{\axref}[1]{(\hyperref[ax:#1]{#1})}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{#3~\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\expandafter\newcommand\csname n#2\endcsname[1]{\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{Theorem}{Theorem}
\newref{lem}{Lemma}{Lemma}
\newref{prop}{Proposition}{Proposition}
\newref{cor}{Corollary}{Corollary}
\newref{cond}{Condition}{Condition}

\theoremstyle{definition}
\newref{defn}{Definition}{Definition}
\newref{example}{Example}{Example}

\theoremstyle{remark}
\newref{remark}{Remark}{Remark}

\newcommand{\type}{}
\newcommand{\ob}{}
\newcommand{\term}{1}
\newcommand{\unit}{()}

\newcommand{\fs}[1]{\mathrm{#1}}
\newcommand{\cat}[1]{\mathbf{#1}}
\newcommand{\scat}[1]{\mathcal{#1}}
\newcommand{\Fib}{\mathcal{F}}
\newcommand{\sSet}{\cat{sSet}}
\newcommand{\Set}{\cat{Set}}
\newcommand{\Hom}{\fs{Hom}}
\newcommand{\Id}{\fs{Id}}
\newcommand{\id}{\fs{id}}
\newcommand{\cof}{\fs{id}}

\newcommand{\class}[2]{#1\text{-}\mathrm{#2}}
\newcommand{\I}{\mathrm{I}}
\newcommand{\Icof}[1][\I]{\class{#1}{cof}}
\newcommand{\Iinj}[1][\I]{\class{#1}{inj}}

\numberwithin{figure}{section}

\newcommand{\ct}{%
  \mathchoice{\mathbin{\raisebox{0.25ex}{$\displaystyle\centerdot$}}}%
             {\mathbin{\raisebox{0.25ex}{$\centerdot$}}}%
             {\mathbin{\raisebox{0.25ex}{$\scriptstyle\,\centerdot\,$}}}%
             {\mathbin{\raisebox{0.25ex}{$\scriptscriptstyle\,\centerdot\,$}}}
}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\begin{document}

\title{Contextually indexed categories and complete Segal objects}

\author{Valery Isaev}

\begin{abstract}
% TODO
\end{abstract}

\maketitle

\section{Introduction}

% TODO

\section{Models of indexed type theories}

In this section, we discuss several examples of models of indexed type theories.
Indexed type theories are defined in \cite{indexed-tt} as certain essentially algebraic theory.
Thus, we have a notion of a model of such a theory.
We will call models of indexed unary (resp., dependent) type theories \emph{contextually indexed categories} (resp., \emph{contextually indexed contextual categories}).
A contextually indexed category is a contextual category $\scat{B}$ together with a category indexed over $\scat{B}$, that is a functor $\scat{B}^\fs{op} \to \cat{Cat}$.
A contextually indexed contextual category is a contextual category $\scat{B}$ together with a contextual category indexed over $\scat{B}$, that is a functor $\scat{B}^\fs{op} \to \cat{ConCat}$.

One class of contextually indexed contextual categories was already defined in \cite{indexed-tt}.
An indexed type theory can be interpreted in an appropriate homotopy type theory.
This implies that there is a forgetful functor $U$ from the category of contextual categories to the category of contextually indexed contextual categories.
If $M$ is a contextual category, then $U(M)$ will be called \emph{the canonical indexing of $M$ over itself}.
The underlying contextual category of $U(M)$ is indeed $M$ itself.

Let $F$ be a functor between underlying categories of contextual categories $\scat{B}'$ and $\scat{B}$.
If $\scat{C}$ is a contextual category over $\scat{B}$, then \emph{change of base} of $\scat{C}$ along $F$ is defined as $\scat{C} \circ F^\fs{op}$ and denoted by $F^*(\scat{C})$.
If $F$ and $G$ are isomorphic functors between categories underlying contextual categories $\scat{B}'$ and $\scat{B}$, then $F^*(\scat{C})$ and $G^*(\scat{C})$ are also isomorphic for every contextuall indexed (contextual) category $\scat{C}$.

Our aim in this section is to define models for simplicial spaces, Segal spaces, and complete Segal spaces.
These models can be roughly described as full subcategories of the contextually indexed category $\sSet^{\Delta^\fs{op}}$,
where $\sSet$ is the canonical indexing of the category of simplicial set (considered as a contextual category as described in \cite{kap-lum-voe}) over itself.
Since it requires little additional effort, we will define a contextually indexed contextual category $\scat{C}^\scat{J}$ over $\scat{C}^\scat{I}$ for all appropriate categories $\scat{C}$, $\scat{J}$, and $\scat{I}$.

\subsection{Change of base}

Let $\scat{C}$ be a category with a chosen class of maps $\Fib$, called fibrations, such that the terminal object exists and pullbacks of fibrations exist and are fibrations.
The pair $(\scat{C},\Fib)$ will be called a \emph{category with fibrations}.
We will write simply $\scat{C}$ for such a category if the class of fibrations is clear from the context.
The local universes construction defined in \cite{local-universes}, for every category with fibrations $\scat{C}$,
gives us a contextual category $\scat{C}_!$ whose types over $\Gamma$ are diagrams of the form
\[ \xymatrix{                       & E_A \ar@{->>}[d]^{p_A} \\
              \Gamma \ar[r]_-{r_A}  & V_A
            } \]
where $p_A$ is a fibration.
Terms of this type are sections $\Gamma \to E_A$.
For every type $\Gamma \vdash A$, the extended context $\Gamma, x : A$ is the pullback of this diagram.
If $\scat{C}$ satisfies additional conditions listed in \cite[Definition~4.2.1]{local-universes}, then $\scat{C}_!$ models unit types, identity types, $\Sigma$-types, and $\Pi$-types.

If $\scat{B}$ is a category with fibrations, then the underlying category of $\scat{B}_!$ is equivalent to the category $\scat{B}_\fs{f}$ of fibration objects of $\scat{B}$.
Thus, change of base for (contextual) categories indexed over $\scat{B}_!$ is defined for every functor $\scat{B}'_\fs{f} \to \scat{B}_\fs{f}$.
If $F : \scat{B}' \to \scat{B}$ is a functor that preserves fibrations, terminal objects, and pullbacks of fibrations, then there is an obvious contextual functor between contextual categories $F_! : \scat{B}'_! \to \scat{B}_!$.
The underlying functor of $F_!$ is isomorphic to $F_\fs{f} : \scat{B}'_\fs{f} \to \scat{B}_\fs{f}$, the restriction of $F$ to fibrant objects of $\scat{B}'$.

Let $\scat{B}$ be a contextual category, let $\scat{C}$ be a category with fibrations, and let $F : \scat{B} \to \scat{C}$ be a functor.
We showed above that if the image of $F$ consists of fibrant objects, then we can define change of base $F^*(\scat{C}_!)$.
Actually, we can define this contextual category for arbitrary $F$.
This is a straightforward generalization of the local universes model.
Closed indexed types in context $\Gamma$ are diagrams of the form
\[ \xymatrix{                           & E_A \ar@{->>}[d]^{p_A} \\
              F(\Gamma) \ar[r]_-{r_A}   & V_A
            } \]
where $p_A$ is a fibration.
Contexts, terms, and non-closed types are defined as before.

We are mainly interested in locally small contextually indexed categories since most of the constructions in \cite{indexed-tt} use this property.
In general, local smallness of $\scat{C}$ does not imply local smallness of $F^*(\scat{C})$.
We consider a special case when it does:

\begin{prop}[locally-small]
Let $F : \scat{B} \to \scat{C}$ be a functor between categories with fibrations (which might not preserve any structure).
Suppose that, for every fibration $f : A \twoheadrightarrow B$ in $\scat{C}$, the pullback functor $f^* : \scat{C}/B \to \scat{C}/A$ has a right adjoint $\Pi_f : \scat{C}/A \to \scat{C}/B$
Then
\begin{enumerate}
\item If $\Pi_f$ maps fibrations over $A$ to fibrations over $B$, then $F^*(\scat{C}_!)$ has $\Pi$-types.
\item If $F$ has a right adjoint $G : \scat{C} \to \scat{B}$ and $G(\Pi_f(g))$ is a fibration over $G(B)$ for every fibration $g$ over $A$, then $F^*(\scat{C}_!)$ has dependent $\Hom$-types.
In particular, it is locally small.
\end{enumerate}
\end{prop}
\begin{proof}
The first claim was proved in \cite{local-universes}.
Let us prove the second one.
First, we need to describe the interpretation of the following rule:
\begin{center}
\AxiomC{$\Gamma \mid \Delta \vdash B \ob$}
\UnaryInfC{$\Gamma \vdash \Hom(\Delta.B) \type$}
\DisplayProof
\end{center}
We almost have $\Pi$-types, which means that we can interpret $\Pi(\Delta.B)$ as the following diagram:
\[ \xymatrix{                           & E_B \ar[d]^{p_B} \\
              F(\Gamma) \ar[r]_-{r_B}   & V_B
            } \]
where $p_B$ is defined as $\Pi_f(g)$ for some fibrations $f$ and $g$.
This map might not be a fibration, but $G(p_B)$ is, so we can define the interpretation of $\Gamma \vdash \Hom(\Delta.B)$ as follows:
\[ \xymatrix{                               & G(E_B) \ar@{->>}[d]^{G(p_B)} \\
              \Gamma \ar[r]_-{\varphi(r_B)} & G(V_B)
            } \]
where $\varphi(r_B)$ is the map corresponding to $r_B$ by adjointness.

Since we have the abstraction and the application operations for $\Pi$-types, it is enough to define corresponding operations for dependent $\Hom$-types for closed types:
\begin{center}
\AxiomC{$\Gamma \mid \cdot \vdash b : B$}
\UnaryInfC{$\Gamma \vdash \lambda(b) : \Hom(\cdot.B)$}
\DisplayProof
\qquad
\AxiomC{$\Gamma \vdash f : \Hom(\cdot.B)$}
\UnaryInfC{$\Gamma \mid \Delta \vdash f\,() : B$}
\DisplayProof
\end{center}

\begin{align*}
\lambda(b)\,() & = b \\
\lambda(f\,()) & = f
\end{align*}

A term $\Gamma \mid \cdot \vdash b : B$ corresponds to a section $b : F(\Gamma) \to E_B$ of $p_B$.
We define $\lambda(b)$ as $\varphi(b) : \Gamma \to G(E_B)$.
Conversely, if $f : \Gamma \to G(E_B)$ is a section of $G(p_B)$, then we define $f\,()$ as $\varphi^{-1}(f) : F(\Gamma) \to E_B$.
The fact that these constructions are stable under substitution follows from the naturality of $\varphi$.
\end{proof}

Many examples of categories with fibrations that we are interested in can be constructed as localizations of larger categories.
If $\scat{M}$ is a combinatorial model category, then left Bousfield localizations of $\scat{M}$ can be described model structures on $\scat{M}$ that have the same class of cofibrations, but less fibrations.
The following proposition implies that every such localization preserves various nice properties of $\scat{M}_!$:

\begin{prop}[localized-hom]
Let $\scat{B}$ be a contextual category, let $\scat{C}$ be a category, and let $F : \scat{B} \to \scat{C}$ be a functor between them.
Let $(\scat{C},\Fib)$ and $(\scat{C},\Fib')$ be two categories with fibrations such that $\Fib' \subseteq \Fib$.
If $F^*((\scat{C},\Fib)_!)$ is locally small or has dependent $\Hom$-types, then this is also true for $F^*((\scat{C},\Fib')_!)$.
\end{prop}
\begin{proof}
Since types of $(\scat{C},\Fib')_!$ are also types of $F^*((\scat{C},\Fib)_!)$ and the base types, base terms, and indexed terms in these contextually indexed contextual categories are the same,
we can define $\Hom$-types between types of $(\scat{C},\Fib')_!$ as $\Hom$-types in $F^*((\scat{C},\Fib)_!)$.
\end{proof}

\subsection{Type-theoretic semi-fibration categories}

Let $\scat{C}$ be a category with fibrations.
Then over categories $\scat{C}/\Gamma$ are also categories with fibrations.
We will say that a map of $\scat{C}$ is a \emph{trivial cofibration} if it has the left lifting property with respect to fibrations.
Then a map in each of the categories $\scat{C}_\fs{f}$, $\scat{C}/\Gamma$, and $(\scat{C}/\Gamma)_\fs{f}$ is a trivial cofibration if and only if it is a trivial cofibration in $\scat{C}$.

Let $\scat{C}$ be a category with fibrations.
We will say that $\scat{C}$ is \emph{right proper} if, for every fibration $p : A \twoheadrightarrow B$, the right adjoint $\Pi_p : \scat{C}/A \to \scat{C}/B$ to the pullback functor $p^* : \scat{C}/B \to \scat{C}$ exists and maps fibrations over $A$ to fibrations over $B$.
We will say that $\scat{C}$ is \emph{cofibrantly generated} if it is cocomplete and fibrations are precisely the maps with the right lifting property with respect to a small set of maps permiting the small object argument.
We will say that $\scat{C}$ is \emph{combinatorial} if it is locally presentable and cofibrantly generated.
We will say that the class of fibrations of $\scat{C}$ is \emph{saturated} if every map that has the right lifting property with respect to trivial cofibrations is a fibration.
The class of fibrations in every cofibrantly generated category is saturated.

The notion of a type-theoretic fibration category was defined in \cite[Definition~2.1]{shul-inv}.
We define a generalization of this notion:
\begin{defn}[ttsfc]
A \emph{type-theoretic semi-fibration category} consists of a category $\scat{C}$ with a chosen class of maps, called fibrations, a chosen terminal object, and chosen pullbacks of fibrations such that the following conditions hold:
\begin{enumerate}
\item \label{it:ttsfc-pi} Fibrations are exponentiable.
\item \label{it:ttsfc-fib} The class of fibrations contains identity morphisms and is closed under compositions and pullbacks.
\item Let $i : A \to B$ be a trivial cofibration in $(\scat{C}/\Gamma)_\fs{f}$ for some $\Gamma$.
Then pullbacks of $i$ along fibrations are trivial cofibrations.
\item \label{it:ttsfc-factor} Let $i : A \to B$ be a map in $(\scat{C}/\Gamma)_\fs{f}$ for some $\Gamma$.
Then $i$ factors as a trivial cofibration followed by a fibration.
\item Let $i : A \to B$ be a trivial cofibration in $(\scat{C}/\Gamma)_\fs{f}$ for some $\Gamma$.
Then, for every map $r : \Delta \to \Gamma$, the pullback map $r^*(A) \to r^*(B)$ is a trivial cofibration.
\end{enumerate}
\end{defn}

The first condition is a technical assumption required by the local universes construction.
The second condition implies the existence of $\Sigma$-types and unit types.
The third condition is a technical assumption that guarantees that the category is homotopically well-behaved.
The last two conditions imply the existence of identity types.

The following conditions on a category with fibrations are equivalent:
\begin{itemize}
\item It is a right proper type-theoretic semi-fibration category in which all objects are fibrant.
\item It is a type-theoretic fibration category in which fibrations are exponentiable.
\end{itemize}
We put a stronger condition on our categories that fibrations are exponentiable since we need it to use the local universes construction.

\begin{remark}[semi-fib]
The results of the second and the third sections of \cite{shul-inv} hold for a type-theoretic semi-fibration category in which all objects are fibrant even if it is not right proper since this condition was not used there.
In particular, such a type-theoretic semi-fibration category is a category of fibrant objects.
\end{remark}

\begin{remark}[semi-over]
Slice categories of a type-theoretic semi-fibration category are also type-theoretic semi-fibration categories.
\end{remark}

Let $p : X \twoheadrightarrow Y$ be a fibration in a type-theoretic semi-fibration category.
We will say that $p$ is \emph{trivial} if there is a map $s : Y \to X$ such that $p \circ s = \id_Y$ and a homotopy $h : X \to P(X)$ between $s \circ p$ and $\id_X$,
where $P(X)$ is a factorization of $\langle \id_X, \id_X \rangle : X \to X \times_Y X$ into a trivial cofibration followed by a fibration.
We will say that $\scat{C}$ is \emph{extensional} if $\Pi_p$ maps trivial fibrations over $X$ to trivial fibrations over $Y$.

\begin{example}
Let $\scat{M}$ be a model category in which fibrations are exponentiable and pullbacks of trivial cofibrations are cofibrations.
Then $\scat{M}$ is a type-theoretic semi-fibration category.
We will call such a model category \emph{type-theoretic model category}.
This is a slightly more general notion than the one defined in \cite[Definition~2.12]{shul-inv}.

A type-theoretic model category is right proper as a type-theoretic semi-fibration category if and only if it is right proper as a model category.
If trivial fibrations in a type-theoretic model category $\scat{M}$ are homotopy equivalences, then $\scat{M}$ is extensional.
In particular, every right proper locally Cartesian closed model category in which cofibrations are precisely monomorphisms is an extensional type-theoretic semi-fibration category.

Every cofibrantly generated (resp., combinatorial) type-theoretic model category is cofibrantly generated (resp., combinatorial) as a type-theoretic semi-fibration category.
\end{example}

\begin{defn}
A \emph{Quillen adjunction} between type-theoretic semi-fibration categories is an adjunction such that the right adjoint preserves fibrations.
If $F \dashv G$ is a Quillen adjunction, then $F$ (resp., $G$) will be called \emph{left (resp., right) Quillen functor}.
We will say that a Quillen adjunction is \emph{extensional} if the right adjoint also preserves trivial fibrations.
\end{defn}

\begin{prop}[indexed-locally-small]
Let $F$ be a left Quillen functor between type-theoretic semi-fibration categories $\scat{B}$ and $\scat{C}$.
Then $F^*(\scat{C}_!)$ is a contextually indexed contextual category with unit types, $\Sigma$-types, and identity types.
If $\scat{C}$ is right proper, then $F^*(\scat{C}_!)$ has $\Pi$-types and dependent $\Hom$-types.
In particular, it is locally small.
If $\scat{C}$ is right proper and extensional and the adjunction is extensional, then $\Pi$-types and identity types are extensional.
\end{prop}
\begin{proof}
The existence of unit types, $\Sigma$-types, identity types, and $\Pi$-types follows from \cite{local-universes}.
The existence of dependent $\Hom$-types is proved in \rprop{locally-small}.
The functional extensionality holds by \cite[Lemma~5.9]{shul-inv}.
Thus, we just need to prove that identity types are extensional.

We need to prove that the canonical function
\[ \Id_{\Hom(\Delta.B)}(f,g) \to \Hom(\Delta.\,\Id_B(f\,\overline{x},g\,\overline{x})) \] is an equivalence, where $\Delta = x_1 : A_1, \ldots x_n : A_n$.
Since we have $\Pi$-types this function is equivalent to the canonical function $\Id_{\Hom(\cdot . \Pi(\Delta,B))(\lambda(\lambda \overline{x}.f\overline{x}),\lambda(\lambda \overline {x}.g\overline{x}))} \to \Hom(\cdot . \Pi(\Delta, \Id(f\,\overline{x},g\,\overline{x})))$.
This function factors through the canonical function $\Hom(\cdot . \Id_{\Pi(\Delta,B)}(\lambda \overline{x}. f\,\overline{x}, \lambda \overline{x}. g\,\overline{x})) \to \Hom(\cdot . \Pi(\Delta, \Id(f\,\overline{x},g\,\overline{x})))$.
Since $\Pi$-types are extensional, we just need to show that the map $\Id_{\Hom(\cdot . \Pi(\Delta,B))(\lambda(\lambda \overline{x}.f\overline{x}),\lambda(\lambda \overline {x}.g\overline{x}))} \to \Hom(\cdot . \Id_{\Pi(\Delta,B)}(\lambda \overline{x}. f\,\overline{x}, \lambda \overline{x}. g\,\overline{x}))$ is an equivalence.
We prove that, more generally, for every closed type $A$ and terms $\Gamma \vdash a : \Hom(\cdot.A)$ and $\Gamma \vdash a' : \Hom(\cdot.A)$, the canonical function $\Id_{\Hom(\cdot . A)}(a,a') \to \Hom(\cdot . \Id_A(a\,(),a'\,()))$ is an equivalence.
This function will be denoted by $\fs{hap}_A$.

The type $A$ correspond to a diagram of the form
\[ \xymatrix{                           & E_A \ar@{->>}[d]^{p_A} \\
              F(\Gamma) \ar[r]_-{r_A}   & V_A
            } \]
and terms $a$ and $a'$ correspond to section $a,a' : F(\Gamma) \to E_A$ of $p_A$.
Types $\Id_{\Hom(\cdot . A)}(a,a')$ and $\Hom(\cdot . \Id_A(a\,(),a'\,()))$ are interpreted as the following diagrams:
\[ \xymatrix{                                                           & & P_{G(V_A)}(G(E_A)) \ar@{->>}[d]^q \\
              \Gamma \ar[rr]_-{\langle \varphi(a), \varphi(a') \rangle} & & G(E_A) \times_{G(V_A)} G(E_A)
            } \qquad
   \xymatrix{                                                   & & G(P_{V_A}(E_A)) \ar@{->>}[d]^{G(q')} \\
              \Gamma \ar[rr]_-{\varphi(\langle a, a' \rangle)}  & & G(E_A \times_{V_A} E_A)
            } \]
where $P_{X}(Y)$ is the path object for the diagonal $Y \to Y \times_{X} Y$.
Since the map $G(E_A) \to P_{G(V_A)}(G(E_A))$ is a trivial cofiration, we have a lift in the following diagram:
\[ \xymatrix{ G(E_A) \ar[d]_r \ar[rr]^-{G(r')}                      &                                               & G(P_{V_A}(E_A)) \ar@{->>}[d]^{G(q')} \\
              P_{G(V_A)}(G(E_A)) \ar@{->>}[r]_-q \ar@{-->}[urr]^s   & G(E_A) \times_{G(V_A)} G(E_A) \ar[r]_-\simeq  & G(E_A \times_{V_A} E_A)
            } \]
This lift is the interpretation of $\fs{hap}_A$.
To prove that the pullback of $s$ over $\Gamma$ is an equivalence which is stable under pullbacks, it is enough to show that $s$ is an equivalence.

There is a fibration $G(E_A \times_{V_A} E_A) \twoheadrightarrow G(E_A)$.
Moreover, the induced maps $X \to G(E_A)$ for every object in the diagram above are also fibrations.
By \rremark{semi-fib} and \rremark{semi-over}, we can think of this diagram as a diagram in the (non-right-proper) type-theoretic fibration category of fibrations over $G(E_A)$.
Since $r$ is trivial cofibration, \cite[Lemma~3.6]{shul-inv} implies that it is an equivalence.
The map $r'$ is also an equivalence for the same reasons.
By the 2-out-of-3 property, the map $P_{V_A}(E_A) \to E_A$ is a trivial fibration.
Since $G$ preserves trivial fibrations, the 2-out-of-3 property implies that $G(r')$ is an equivalence.
Finally, by the 2-out-of-3 property, $s$ is an equivalence.
\end{proof}

\begin{example}[cisinski]
A \emph{Cisinski model structure} on a Grothendieck topos $\scat{C}$ is any cofibrantly generated model structure in which cofibrations are precisely monomorphisms.
For every such model structure and every left Quillen functor $F : \scat{B} \to \scat{C}$,
the contextually indexed contextual category $F^*(\scat{C}_!)$ has dependent $\Hom$-types, unit types, $\Sigma$-types, and identity types.

The existence of unit types, $\Sigma$-types, and identity types follows from \rprop{indexed-locally-small}.
By \rprop{localized-hom}, it is enough to prove that any Cisinski model structure is a left Bousfield localization of a right proper model structure.
Every such model structure is indeed a left Bousfield localization of the minimal model structure in which weak equivalences are generated by the empty set in an appropriate sense \cite[Th\'{e}or\`{e}me~3.9]{cisinski}.
The minimal model structure is right proper by \cite[Remarque~4.9]{cisinski}.
\end{example}

\subsection{Categories of functors}

Let $\scat{C}$ be a category with fibrations and let $\scat{J}$ be a small category.
A map of $\scat{C}^\scat{J}$ is a \emph{projective fibration} (resp., \emph{injective trivial cofibration}) if it is objectwise fibration (resp., objectwise trivial cofibration).
A map of $\scat{C}^\scat{J}$ is an \emph{injective fibration} if it has the right lifting property with respect to injective trivial cofibrations.
The \emph{injective} structure of a category with fibrations on $\scat{C}^\scat{J}$ has all injective fibrations as its fibrations.

\begin{lem}[inj-proj]
Let $\scat{C}$ be a cofibrantly generated category with fibrations and let $\scat{J}$ be a small category.
Then every injective fibration of $\scat{C}^\scat{J}$ is a projective fibration.
\end{lem}
\begin{proof}
Let $j$ be an object of $\scat{J}$.
Then the functor $E_j : \scat{C}^\scat{J} \to \scat{C}$ of evaluating at $j$ has a left adjoint $F : \scat{C} \to \scat{C}^\scat{J}$, which is defined as $F(X) = \Hom(j,-) \cdot X$.
If $f : A \to B$ is a trivial cofibration of $\scat{C}$, then $F(f)$ is an injective trivial cofiration.
Thus, every injective ibration $p : X \twoheadrightarrow Y$ has the right lifting property with respect to $F(f)$.
By adjointness, $p_j : X_j \to E_j$ has the right lifting property with respect to $f$.
Since $\scat{C}$ is cofibrantly generated, fibrations are precisely the maps which have the right lifting property with respect to trivial cofibrations.
Thus, $p_j$ is a fibration.
\end{proof}

\begin{prop}[injective]
Let $\scat{C}$ be a complete cofibrantly generated type-theoretic semi-fibration category and let $\scat{J}$ be a small category.
Let $\Fib$ be a class of injective fibrations closed under pullbacks, identity morphisms, and compositions such that every map in $(\scat{C}^\scat{J}/\Gamma)_\fs{f}$ for every $\Gamma$ factors into an injective trivial cofibration followed by a fibration in $\Fib$.
Then $(\scat{C}^\scat{J},\Fib)$ is a type-theoretic semi-fibration category.
\end{prop}
\begin{proof}
By \rlem{inj-proj}, fibrations in $\Fib$ are projective fibrations.
Since $\scat{C}$ is complete, fibrations in $\Fib$ are projective fibrations, and fibrations of $\scat{C}$ are exponentiable, \cite[Theorem~2.12]{comp-fact-tor} implies that fibrations of $\scat{C}^\scat{J}$ are also exponentiable.
Since fibrations in $\Fib$ are projective fibrations, to prove that other conditions hold, it is enough to prove that a map in $(\scat{C}^\scat{J}/\Gamma)_\fs{f}$ is a trivial cofibration if and only if it is an injective trivial cofibration.
The ``if'' direction holds by the assumption that fibrations are injective.
Coversely, if $i : A \to B$ is a map in $(\scat{C}^\scat{J}/\Gamma)_\fs{f}$ that has the left lifting property with respect to fibrations, then we can factor it into an injective trivial cofibration $i' : A \to A'$ followed by a fibration $A' \twoheadrightarrow B$.
Then $i$ is a retract of $i'$ which implies that it is also an injective trivial cofibration.
\end{proof}

\begin{cor}[injective-combinatorial]
Let $\scat{C}$ be a combinatorial type-theoretic semi-fibration category and let $\scat{J}$ be a small category.
Then $\scat{C}^\scat{J}$ is a combinatorial injective type-theoretic semi-fibration category.
If $\scat{C}$ is right proper, then so is $\scat{C}^\scat{J}$.
If $\scat{C}$ is a right proper type-theoretic combinatorial model category in which all object are cofibrant, then $\scat{C}^\scat{J}$ with its injective model structure is an extensional combinatorial type-theoretic model category.
\end{cor}
\begin{proof}
By \rprop{injective}, it is enough to prove that every map factors into an injective trivial cofibration followed by an injective fibration which is true by \cite[Lemma~A.2.8.3]{lurie-topos}.
If $\scat{C}$ is right proper, then the fact that $\scat{C}^\scat{J}$ is also right proper follows from the fact that injective trivial cofibrations are stable under pullbacks along fibrations which is true since injective fibrations are objectwise fibrations and pullbacks of trivial cofibrations are stable under pullbacks along fibrations in $\scat{C}$ by the right properness.
Finally, if $\scat{C}$ is a model category in which all objects are cofibrant, then objects of $\scat{C}^\scat{J}$ are also cofibrant.
It follows that trivial fibrations are precisely maps with the right lifting property with respect to cofibrations.
Thus, $\Pi$ preserves trivial fibrations whenever cofibrations are stable under pullbacks which is true since cofibrations are precisely objectwise cofibrations.
\end{proof}

\begin{example}
If $\scat{M}$ is right proper type-theoretic model category and all objects of $\scat{M}$ are cofibrant, then this is also true for $\scat{M}^\scat{J}$, which implies that it is extensional.
\end{example}

\begin{example}
If $\scat{C}$ is a combinatorial type-theoretic semi-fibration category and $F : \scat{J} \to \scat{I}$ is a functor between small categories,
then the functor $F^* : \scat{C}^\scat{I} \to \scat{C}^\scat{J}$ (defined by postcomposition with $F$) is a left Quillen functor between combinatorial type-theoretic semi-fibration categories with injective structures.
If $\scat{C}$ is also a model category in which all objects are cofibrant, then this adjunction is extensional.
We will denote the contextually indexed contextual category $(F^*)^*((\scat{C}^\scat{J})_!)$ simply by $F^*((\scat{C}^\scat{J})_!)$.
\end{example}

\section{(Co)limits}

In this section, we give sufficient conditions for a model $F^*(\scat{C})$ to have products, initial types, coproducts, and pushouts.

\subsection{Products}

Let $F$ be a functor between type-theoretic semi-fibration categories $\scat{B}$ and $\scat{C}$.
We will say that a map of $\scat{C}$ is an \emph{$F$-fibration} if it is a pullback of the map $F(f)$ for some fibration $f$.

\begin{prop}[products]
Let $F : \scat{B} \to \scat{C}$ be a functor between categories with fibrations.
Suppose that $F$ preserves pullbacks along fibrations and that, for every $F$-fibration $g : A \to B$, pullbacks of $g$ exist and the pullback functor $g^* : \scat{C}/B \to \scat{C}/A$ has a right adjoint $\Pi_g : \scat{C}/A \to \scat{C}/B$ which maps fibrations over $A$ to fibrations over $B$
Then $F^*(\scat{C}_!)$ has dependent products.
\end{prop}
\begin{proof}
First, we need to describe the interpretation of the following rule:
\begin{center}
\AxiomC{$\Gamma, i : I \mid \Delta \vdash B \ob$}
\RightLabel{, $i \notin \mathrm{FV}(\Delta)$}
\UnaryInfC{$\Gamma \mid \Delta \vdash \prod_{i : I} B \ob$}
\DisplayProof
\end{center}
Suppose that we have diagrams depicted below which correspond to types $\Gamma \vdash I$ and $\Gamma, i : I \mid \Delta \vdash B$.
\[ \xymatrix{                       & E_I \ar@{->>}[d]^{p_I} \\
              \Gamma \ar[r]_{r_I}   & V_I
            } \qquad
   \xymatrix{                               & E_B \ar@{->>}[d]^{p_B} \\
              \Gamma.I.\Delta \ar[r]_{r_B}  & V_B
            } \]
where $\Gamma.I.\Delta$ is the following pullback:
\[ \xymatrix{ \Gamma.I.\Delta \ar[r] \ar@{->>}[d] \pb   & \Delta \ar@{->>}[d]^{p_\Delta} \\
              F(\Gamma.I) \ar[r] \ar[d] \pb             & F(\Gamma) \ar[d]^{F(r_I)} \\
              F(E_I) \ar[r]_{F(p_I)}                    & F(V_I)
            } \]
We define $V_\Pi$ as $\Pi_{F(p_I)}(F(E_I) \times V_B)$.
Consider the following diagrams:
\[ \xymatrix{ V_\Pi \times_{F(V_I)} F(E_I) \ar[r] \ar[d]_p \pb  & F(E_I) \ar[d]^{F(p_I)} \\
              V_\Pi \ar[r]                                      & F(V_I)
            } \qquad
   \xymatrix{ Z \ar[r] \ar@{->>}[d]_q \pb                       & F(E_I) \times E_B \ar@{->>}[d]^{\id_{F(E_I)} \times p_B} \\
              V_\Pi \times_{F(V_I)} F(E_I) \ar[r]_-{\fs{ev}}    & F(E_I) \times V_B
            } \]
We define $p_\Pi : E_\Pi \twoheadrightarrow V_\Pi$ as $\Pi_p(Z)$.
To define a map $\Delta \to V_\Pi$, it is enough to specify a map $r_I' : \Delta \to F(V_I)$ together with a map $r_B' : \Delta.I \to V_B$, where $\Delta.I$ is the pullback of $r_I'$ and $F(p_I)$.
Let $r_I' = F(r_I) \circ p_\Delta$ and $r_B' = r_B$.
These maps determine a map $[r_I',r_B] : \Delta \to V_\Pi$.
We define the interpretation of $\prod_{i : I} B$ as the following diagram:
\[ \xymatrix{                               & E_\Pi \ar@{->>}[d]^{p_\Pi} \\
              \Delta \ar[r]_{[r_I',r_B]}    & V_\Pi
            } \]

Now, let us decribe the interpretation of the following rule:
\begin{center}
\AxiomC{$\Gamma, i : I \mid \Delta \vdash b : B$}
\RightLabel{, $i \notin \mathrm{FV}(\Delta)$}
\UnaryInfC{$\Gamma \mid \Delta \vdash \lambda i.\,b : \prod_{i : I} B$}
\DisplayProof
\end{center}
The interpretation of $b$ is a section $b : \Gamma.I.\Delta \to E_B$ of $p_B$.
Note that we have the following diagram in which the composition of bottom maps equals to $r_I'$:
\[ \xymatrix{ \Gamma.I.\Delta \ar[r]^-s \ar[d] \pb  & V_\Pi \times_{F(V_I)} F(E_I) \ar[r] \ar[d]_p \pb  & F(E_I) \ar[d]^{F(p_I)} \\
              \Delta \ar[r]_{[r_I',r_B]}            & V_\Pi \ar[r]                                      & F(V_I)
            } \]
An interpretation of $\lambda i.\,b$ is a section of $\Delta \to E_\Pi$ of $p_\Pi$.
To define such a section, it is enough to specify a section $b' : \Gamma.I.\Delta \to Z$ of $q$ over $s$.
Since $q$ is a pullback of $p_B$, this is equivalent to specifying a section of $p_B$ and we can take this section to be $b$.

Finally, we need to define the interpretation of the application:
\begin{center}
\AxiomC{$\Gamma \mid \Delta \vdash f : \prod_{i : I} B$}
\AxiomC{$\Gamma \vdash j : I$}
\BinaryInfC{$\Gamma \mid \Delta \vdash f\,j : B[j/i]$}
\DisplayProof
\end{center}
Let $f : \Delta \to E_\Pi$ be a section of $p_\Pi$ and let $j : \Gamma \to E_I$ be a section of $p_I$.
We define the interpretation of $f\,j$ as $f' \circ j''$, where $f' : \Gamma.I.\Delta \to E_B$ is a section of $p_B$ corresponding to $f$ as discussed before and $j''$ is the following pullback:
\[ \xymatrix{ \Delta \ar[r]^-{j''} \ar@{->>}[d]_{p_\Delta} \pb  & \Gamma.I.\Delta \ar[r] \ar@{->>}[d] \pb   & \Delta \ar@{->>}[d]^{p_\Delta} \\
              F(\Gamma) \ar[r]_{F(j')}                          & F(\Gamma.I) \ar[r]                        & F(\Gamma)
            } \]
where $j' : \Gamma \to \Gamma.I$ is a section of $\Gamma.I \twoheadrightarrow \Gamma$ corresponding to $j$.

It is easy to verify the stability under substitutions of the constructions that we decsribed.
We also need to prove that $\beta$ and $\eta$ equivalences hold, but this follows from the fact that functions that we used to go from sections of $p_\Pi$ and $p_B$ and back are mutually inverse.
\end{proof}

\begin{example}[products]
Let $\scat{C}$ be a complete right proper cofibrantly generated type-theoretic semi-fibration.
Then, for every functor $F : \scat{J} \to \scat{I}$ between small categories, the contextually indexed contextual category $F^*((\scat{C}^\scat{J})_!)$ has dependent products,
where $\scat{C}^\scat{J}$ and $\scat{C}^\scat{I}$ are equipped with the injective structures.

Indeed, $F^* : \scat{C}^\scat{I} \to \scat{C}^\scat{J}$ preserves all limits.
By \rlem{inj-proj}, $F^*$-fibrations are objectwise fibrations.
Since fibrations are exponentiable in $\scat{C}$, \cite[Theorem~2.12]{comp-fact-tor} and \cite[Corollary~2.6]{comp-fact-tor} imply that $F^*$-fibrations are also exponentiable in $\scat{C}^\scat{J}$.
The fact that $\Pi_g$ preserves fibrations is equivalent to the fact that injective trivial cofibrations are stable under pullbacks along $F^*$-fibrations.
This follows from the facts that $\scat{C}$ is right proper and that $F^*$-fibrations are objectwise fibrations.
\end{example}

\subsection{Colimits}

For the discussion of colimits, it will be convenient to use the notion of a pseudo-fibration which we now define.
We will say that a map $f : X \to Z$ in a category with fibrations is a \emph{pseudo-fibration} if it factors as a trivial cofibration $i : X \to Y$ followed by a fibration $p : Y \twoheadrightarrow Z$ and, for every diagram of the form
\[ \xymatrix{ X' \ar[r] \ar[d]_{i'} \pb         & X \ar[d]^i \\
              Y' \ar[r] \ar@{->>}[d]_{p'} \pb   & Y \ar@{->>}[d]^p \\
              Z' \ar[r]                         & Z
            } \]
the map $i'$ is a trivial cofibration.

\begin{example}
Every fibration is a pseudo-fibration.
\end{example}

\begin{lem}[proj-pseudo]
Let $\scat{C}$ be a combinatorial type-theoretic semi-fibration category and let $\scat{J}$ be a small category.
Then every projective fibration of $\scat{C}^\scat{J}$ is a pseudo-fibration in the injective structure.
\end{lem}
\begin{proof}
Let $f : X \to Z$ be a projective fibration.
The factorization of $f$ into an injective trivial cofibration $i : X \to Y$ followed by an injective fibration $p : Y \twoheadrightarrow Z$ exists by \cite[Lemma~A.2.8.3]{lurie-topos}.
By \rlem{inj-proj}, injective fibrations are projective.
Thus, for every $j \in \scat{J}$, the map $i_j : X_j \to Y_j$ is a trivial cofibration between fibrant objects in $\scat{C}/Z$.
It follows that its pullbacks along maps $Z' \to Z$ are trivial cofibrations by the definition of a type-theoretic semi-fibration category.
\end{proof}

The following lemma was proved in \cite[Theorem~3.3]{lum-shul-hits}.
We just extract the minimal set of conditions that was used in the proof.

\begin{lem}[pseudo-fib]
In a right proper type-theoretic model category, stable under pullbacks coproducts of fibrations over a fixed base are pseudo-fibrations.
\end{lem}

\begin{prop}
Let $\scat{B}$ be a contextual category, let $\scat{C}$ be a category with fibrations, and let $F : \scat{B} \to \scat{C}$ be a functor between them.
If $\scat{C}$ has a strict pseudo-fibrant initial object, then $F^*(\scat{C})$ has strict initial types.
\end{prop}
\begin{proof}
Factor the map $0 \to 1$ into a trivial cofibration $0 \to R(0)$ followed by a fibration $R(0) \twoheadrightarrow 1$.
We define the initial type in any context as follows:
\[ \xymatrix{               & R(0) \ar@{->>}[d] \\
              \Delta \ar[r] & 1
            } \]
By \cite[Proposition~7.4]{indexed-tt}, we just need to described the interpretation of the following rule:
\begin{center}
\AxiomC{$\Gamma \mid \Delta \vdash D \type$}
\AxiomC{$\Gamma \mid \Delta \vdash a : 0$}
\BinaryInfC{$\Gamma \mid \Delta \vdash 0\text{-}\fs{elim'}(D,a) : D$}
\DisplayProof
\end{center}

Let $a : \Delta \to R(0)$ be a map in $\scat{C}$ and let $r_D : \Delta \to V_D$, $p_D : E_D \twoheadrightarrow V_D$ be the interpretation of $D$.
Then we need to construct a section of $p_D$ over $r_D$.
The map $0 \times V_D \to R(0) \times V_D$ is a trivial cofibration since it is a pullback of $0 \to R(0)$ and $0$ is pseudo-fibrant.
Since $0$ is strict, $0 \times V_D$ is initial.
Hence, the unique map $0 \to R(0) \times V_D$ is a trivial cofibration.
It follows that we have a lift in the following diagram:
\[ \xymatrix{ 0 \ar[r] \ar[d]                                   & E_D \ar@{->>}[d]^{p_D} \\
              V_D \times R(0) \ar[r]_-{\pi_1} \ar@{-->}[ur]^s   & V_D
            } \]
Then the interpretation of $0\text{-}\fs{elim'}$ is defined as $\Delta \xrightarrow{\langle r_D, a \rangle} V_D \times R(0) \xrightarrow{s} E_D$.
\end{proof}

\begin{remark}
Let $\scat{C}$ be a category with fibrations with a strict initial object $0$.
If $0$ is fibrant, then trivial cofibrations with the initial domain also have the initial codomain.
The converse holds if the class of fibrations is saturated.
\end{remark}

\begin{example}
Let $\scat{C}$ be a category with fibrations and let $\scat{J}$ be a small category.
If $\scat{C}$ has a strict fibrant initial object $0$, then $\scat{C}^\scat{J}$ has a strict injectively fibrant initial object.
Indeed, the constant functor on $0$ is a strict initial object.
The previous remark implies that it is injectively fibrant.
\end{example}

\begin{example}
If $\scat{C}$ is a right proper type-theoretic model category with a strict initial object, then $\scat{C}^\scat{J}$ has a strict injectively pseudo-fibrant initial object.
This follows from \rlem{pseudo-fib} and the fact that $\scat{C}^\scat{J}$ is right proper.
\end{example}

Since the definition of pushouts in indexed type theories does not involve the base context, we can use the same construction as in ordinary type theory.
Such a construction was described in \cite{lum-shul-hits}.
The only difference between pushouts in contextual categories and indexed contextual categories is that not all context are fibrant in the indexed case;
it is only true that context are fibrant over $F(\Gamma)$, where $\Gamma$ is a base context, and $F(\Gamma)$ is usually not fibrant.
This condition was not used in \cite{lum-shul-hits}, so we can apply theorem from this paper.

\begin{defn}[good-cyl]
We will say that a model category has \emph{good cylinder objects} if, for every object $A$, there is a functorial cylinder object $A \amalg A \to A \otimes \Delta^1 \to A$ which is stable under pullbacks and,
for every trivial cofibration $A \to B$, the canonical map $A \otimes \Delta^1 \amalg_{A \amalg A} B \amalg B \to B \otimes \Delta^1$ is a trivial cofibration.
\end{defn}

Every simplicial locally Cartesian closed model category has good cylinder objects.
We will give another example of model categories with good cylinder objects in \rremark{good-cyl}.

\begin{prop}[pushouts]
Let $\scat{B}$ be a category with fibrations, let $\scat{C}$ be a locally Cartesian closed right proper type-theoretic model category which has good cylinder objects, and let $F : \scat{B} \to \scat{C}$ be a functor between them.
Then $F^*(\scat{C}_!)$ has dependent pushouts.
\end{prop}
\begin{proof}
The construction is essentially the same as the construction of pushouts in sections 4, 5, and 6 of \cite{lum-shul-hits}.
\end{proof}

\begin{example}
If $\scat{M}$ is the category of simplicial presheaves on a small category with its Cisinski model structure \cite{cisinski-presheaf,cisinski} and $\scat{J}$ is a small category,
then the injective model structure on $\scat{M}^\scat{J}$ satisfies the conditions of \rprop{pushouts}.
\end{example}

Finally, let us construct indexed coproducts:

\begin{prop}[coproducts]
Let $F : \scat{B} \to \scat{C}$ be a functor between categories with fibrations.
Suppose that the following conditions hold:
\begin{enumerate}
\item $F$ preserves pullbacks along fibrations and pullbacks of $F$-fibrations exist.
\item Fibrations and $F$-fibrations are exponentiable.
\item The composition of a fibration and an $F$-fibration is a pseudo-fibration.
\end{enumerate}
Then $F^*(\scat{C}_!)$ has stable dependent coproducts.
\end{prop}
\begin{proof}
Suppose that we have diagrams depicted below which correspond to types $\Gamma \vdash I$ and $\Gamma, i : I \mid \Delta \vdash B$.
\[ \xymatrix{                       & E_I \ar@{->>}[d]^{p_I} \\
              \Gamma \ar[r]_{r_I}   & V_I
            } \qquad
   \xymatrix{                               & E_B \ar@{->>}[d]^{p_B} \\
              \Gamma.I.\Delta \ar[r]_{r_B}  & V_B
            } \]
where $\Gamma.I.\Delta$ is the following pullback:
\[ \xymatrix{ \Gamma.I.\Delta \ar[r] \ar@{->>}[d] \pb   & \Delta \ar@{->>}[d]^{p_\Delta} \\
              F(\Gamma.I) \ar[r] \ar[d] \pb             & F(\Gamma) \ar[d]^{F(r_I)} \\
              F(E_I) \ar[r]_{F(p_I)}                    & F(V_I)
            } \]
We define $V_\amalg$ as $\Pi_{F(p_I)}(F(E_I) \times V_B)$.
Consider the following diagrams:
\[ \xymatrix{ V_\Pi \times_{F(V_I)} F(E_I) \ar[r] \ar[d]_p \pb  & F(E_I) \ar[d]^{F(p_I)} \\
              V_\Pi \ar[r]                                      & F(V_I)
            } \qquad
   \xymatrix{ Z \ar[r] \ar@{->>}[d]_q \pb                       & F(E_I) \times E_B \ar@{->>}[d]^{\id_{F(E_I)} \times p_B} \\
              V_\Pi \times_{F(V_I)} F(E_I) \ar[r]_-{\fs{ev}}    & F(E_I) \times V_B
            } \]
Since $p \circ q$ is a pseudo-fibration, we can factor it into a trivial cofibration $t : Z \to E_\amalg$ followed by a fibration $p_\amalg : E_\amalg \twoheadrightarrow V_\amalg$.
To define a map $\Delta \to V_\Pi$, it is enough to specify a map $r_I' : \Delta \to F(V_I)$ together with a map $r_B' : \Delta.I \to V_B$, where $\Delta.I$ is the pullback of $r_I'$ and $F(p_I)$.
Let $r_I' = F(r_I) \circ p_\Delta$ and $r_B' = r_B$.
These maps determine a map $[r_I',r_B] : \Delta \to V_\amalg$.
We define the interpretation of $\coprod_{i : I} B$ as the following diagram:
\[ \xymatrix{                               & E_\amalg \ar@{->>}[d]^{p_\amalg} \\
              \Delta \ar[r]_{[r_I',r_B]}    & V_\amalg
            } \]

Now, let us describe the interpretation of the following rule:
\begin{center}
\AxiomC{$\Gamma \vdash j : I$}
\AxiomC{$\Gamma \mid \Delta \vdash b : B_j$}
\BinaryInfC{$\Gamma \mid \Delta \vdash (j,b) : \coprod_{i : I} B_i$}
\DisplayProof
\end{center}
The interpretation of $j$ is a section $j : \Gamma \to E_I$ of $p_I$ over $r_I$.
This map determines a section $j' : \Gamma \to \Gamma.I$ of the map $\Gamma.I \to \Gamma$.
The pullback of $F(j')$ along $p_\Delta$ will be denoted by $j'' : \Delta \to \Gamma.I.\Delta$.
The interpretation of $b$ is a section $b : \Gamma.I.\Delta \to E_B$ of $p_B$.
This map determines a section $b' : \Gamma.I.\Delta \to Z$ of $q$:
\[ \xymatrix{                                                   & Z \ar[r] \ar@{->>}[d]^q \pb                                   & F(E_I) \times E_B \ar@{->>}[d]^{\id_{F(E_I) \times p_B}}  &                           \\
              \Gamma.I.\Delta \ar[r] \ar[d] \ar[ur]^{b'} \pb    & V_\Pi \times_{F(V_I)} F(E_I) \ar[r]_-{\fs{ev}} \ar[d]^p \pb   & F(E_I) \times V_B \ar[r]_-{\pi_1}                         & F(E_I) \ar[d]^{F(p_I)}    \\
              \Delta \ar[r]_{[r_I',r_B]}                        & V_\amalg \ar[rr]                                              &                                                           & F(V_I)
            } \]
We define the interpretation of $(j,b)$ as $t \circ b' \circ j''$.

Finally, let us describe the interpretation of the eliminator:
\begin{center}
\def\extraVskip{1pt}
\Axiom$\fCenter \Gamma \mid \Delta, z : \coprod_{i : I} B_i \vdash D \ob$
\noLine
\UnaryInf$\fCenter \Gamma, i : I \mid \Delta, x : B_i \vdash d : D[(i,x)/z]$
\Axiom$\fCenter \Gamma \mid \Delta \vdash c : \coprod_{i : I} B_i$
\def\extraVskip{2pt}
\BinaryInfC{$\Gamma \mid \Delta \vdash \coprod\text{-}\fs{elim}(z.D, i x.d, c) : D$}
\DisplayProof
\end{center}
The interpretation of $D$ consists of a map $r_\amalg : \Delta \to V_\amalg$ together with a map $r_D : \Delta.\amalg \to V_D$ and a fibration $p_D : E_D \twoheadrightarrow V_D$, where $\Delta.\amalg$ is the pullback of $r_\amalg$ and $p_\amalg$.
The interpretation of $d$ is a section $d : \Gamma.I.\Delta.B \to E_D$ of $p_D$, where $\Gamma.I.\Delta.B$ is the pullback of $r_B$ and $p_B$.
The interpretation of $c$ is a section $c : \Delta \to E_\amalg$ of $p_\amalg$ over $r_\amalg$.

Let $s$ be the pullback of $p \circ q$:
\[ \xymatrix{ \Pi_{p_\amalg}(E_\amalg \times V_D) \times_{V_\amalg} Z \ar[r] \ar[d]_s \pb   & Z \ar[d]^{p \circ q} \\
              \Pi_{p_\amalg}(E_\amalg \times V_D) \ar[r]                                    & V_\amalg
            } \]
Let $X$ be the following pullback:
\[ \xymatrix{ X \ar[rr] \ar@{->>}[d] \pb                                                            &                                                                                   & E_\amalg \times E_D \ar@{->>}[d]^{\id \times p_D} \\
              \Pi_{p_\amalg}(E_\amalg \times V_D) \times_{V_\amalg} Z \ar[r]_-{\id \times_\id t}    & \Pi_{p_\amalg}(E_\amalg \times V_D) \times_{V_\amalg} E_\amalg \ar[r]_-{\fs{ev}}  & E_\amalg \times V_D
            } \]
Maps $p$ and $q$ are exponentiable by assumption.
By \cite[Corollary~2.6]{comp-fact-tor}, $s$ is also exponentiable.
Let $t'$ be the pullback of $t$:
\[ \xymatrix{ \Pi_s(X) \times_{V_\amalg} Z \ar[r] \ar[d]_{t'} \pb           & Z \ar[d]^t                        \\
              \Pi_s(X) \times_{V_\amalg} E_\amalg \ar[r] \ar@{->>}[d] \pb   & E_\amalg \ar@{->>}[d]^{p_\amalg}  \\
              \Pi_s(X) \ar[r]                                               & V_\amalg
            } \]
Since $p \circ q$ is a pseudo-fibration, $t'$ is a trivial cofibration.
It follows that we have a lift in the following diagram:
\[ \xymatrix{ \Pi_s(X) \times_{V_\amalg} Z \ar[r]^-{\fs{ev}} \ar[d]_{t'}    & X \ar[rr]                                                                         &                                       & E_D \ar@{->>}[d]^{p_D} \\
              \Pi_s(X) \times_{V_\amalg} E_\amalg \ar[r] \ar@{-->}[urrr]^e  & \Pi_{p_\amalg}(E_\amalg \times V_D) \times_{V_\amalg} E_\amalg \ar[r]_-{\fs{ev}}  & E_\amalg \times V_D \ar[r]_-{\pi_2}   & V_D
            } \]
We define the interpretation of the eliminator as the composite $\Delta \to \Pi_s(X) \times_{V_\amalg} E_\amalg \xrightarrow{e} E_D$, where the first map is defined below.
To define such a map, it is enough to specify maps $\Delta \to \Pi_s(X)$ and $\Delta \to E_\amalg$ which are equal over $V_\amalg$.
We define the latter map as $c : \Delta \to E_\amalg$.
To define the former map, it is enough to specify two maps:
\begin{itemize}
\item A map $\Delta \to \Pi_{p_\amalg}(E_\amalg \times V_D)$ such that its composition with the map $\Pi_{p_\amalg}(E_\amalg \times V_D) \to V_\amalg$ equals to $r_\amalg$.
To define such a map, it is enough to specify a map $\Delta.\amalg \to V_D$.
We define it as $r_D$.
\item A section $\Gamma.I.\Delta.B \to E_D$ of $p_D$.
We define this section as $d$.
\end{itemize}
This completes the definition of the interpretation of the eliminator.
\end{proof}

\begin{example}
If $\scat{C}$ is a combinatorial type-theoretic semi-fibration category and $F : \scat{J} \to \scat{I}$ is a functor between small categories
then $F^*((\scat{C}^\scat{J})_!)$ satisfies the conditions of \rprop{coproducts}, where $\scat{C}^\scat{J}$ is equipped with the injective structure.
Indeed, both injective fibrations and $F$-fibrations are objectwise fibrations which implies that they are exponentiable.
Moreover, \rlem{proj-pseudo} implies that their composition is a pseudo-fibration.
\end{example}

\section{Localization}
\label{sec:loc}

In this section, we consider the following problem.
Let $\scat{C}$ be a category and let $\Fib$ and $\Fib'$ be two classes of fibrations of $\scat{C}$ such that $\Fib' \subseteq \Fib$.
If we know that a contextually indexed contextual category of the form $F^*((\scat{C},\Fib)_!)$ has some categorical constructions, when does $F^*((\scat{C},\Fib')_!)$ also have these constructions?
% It is probably impossible to answer this question in full generality, so we consider its special case.

% Let $\scat{C}$ be a combinatorial category with fibrations and let $\scat{J}$ be a small category.
% Let $\Fib$ be the class of injective fibrations of $\scat{C}^\scat{J}$ and let $\Fib'$ be a subclass of $\Fib$
% which is defined as the intersection of $\Fib$ with the class of maps that have the right lifting property with respect to a set of maps with discrete codomains (we define this notion later).
% Let $D : \scat{C} \to \scat{C}^\scat{J}$ be the diagonal functor.
% We will prove under some mild additional hypotheses on $\scat{C}$ that $D^*((\scat{C}^\scat{J},\Fib')_!)$ has many categorical constructions that $D^*((\scat{C}^\scat{J},\Fib)_!)$ has.

\subsection{Identity types}

Let $(\scat{C},\Fib)$ be a category with fibrations and let $\Fib'$ be a subclass of $\Fib$.
We will say that $\Fib'$ is \emph{closed under identity types} if every map in $((\scat{C},\Fib')/\Gamma)_\fs{f}$ factors into a trivial cofibration of $(\scat{C},\Fib)$ followed by a fibration in $\Fib'$.

\begin{lem}[subfib]
Let $(\scat{C},\Fib)$ be a category with fibrations and let $\Fib'$ be a subclass of $\Fib$.
Then $\Fib'$ is closed under identity types if and only if the following conditions hold:
\begin{enumerate}
\item \label{it:subfib-factor} Every map in $((\scat{C},\Fib')/\Gamma)_\fs{f}$ factors into a trivial cofibration of $(\scat{C},\Fib')$ followed by a fibration in $\Fib'$.
\item \label{it:subfib-we} A map in $((\scat{C},\Fib')/\Gamma)_\fs{f}$ is a trivial cofibration of $(\scat{C},\Fib')$ if and only if it is a trivial cofibration of $(\scat{C},\Fib)$.
\end{enumerate}
\end{lem}
\begin{proof}
First, suppose that $\Fib'$ is closed under identity types.
Since every trivial cofibration of $(\scat{C},\Fib)$ is a trivial cofibration of $(\scat{C},\Fib')$, the first condition and the ``if'' part of the second condition are obvious.
Let $f$ be a trivial cofibration in $((\scat{C},\Fib')/\Gamma)_\fs{f}$.
Factor it into a map $i$ which is a trivial cofibration of $(\scat{C},\Fib)$ followed by a fibration in $\Fib'$.
Since $f$ has the left lifting property with respect to $\Fib'$, the standard argument implies that it is a retract of $i$, hence also is a trivial cofibration of $(\scat{C},\Fib)$.

To prove the converse, it is enough to factor a map into a trivial cofibration in $((\scat{C},\Fib')/\Gamma)_\fs{f}$ followed by a fibration in $\Fib'$.
Then the second condition implies that the first map is also a trivial cofibration of $(\scat{C},\Fib)$.
\end{proof}

\begin{lem}[subfib-model-cats]
Let $(\scat{C},\Fib)$ be either a type-theoretic semi-fibration category or a model category and let $\Fib'$ be a subclass of $\Fib$ which is closed under retracts, compositions, and pullbacks and contains all trivial fibrations.
Then the following conditions are equivalent:
\begin{enumerate}
\item \label{it:subfib-model-id} The class $\Fib'$ is closed under identity types.
\item \label{it:subfib-model-fib} A map in $((\scat{C},\Fib')/\Gamma)_\fs{f}$ belongs to $\Fib$ if and only if it belongs to $\Fib'$.
\item \label{it:subfib-model-path} For every fibration $p : Y \twoheadrightarrow \Gamma$ in $\Fib'$,
the diagonal $Y \to Y \times_\Gamma Y$ factors as a trivial cofibration $Y \to P(Y)$ of $\scat{C}$ followed by a fibration $P(Y) \twoheadrightarrow Y \times_\Gamma Y$ in $\Fib'$.
\end{enumerate}
\end{lem}
\begin{proof}
\eqref{it:subfib-model-id} $\implies$ \eqref{it:subfib-model-fib}
Since $\Fib' \subseteq \Fib$, we just need to prove that every map in $((\scat{C},\Fib')/\Gamma)_\fs{f}$ which belongs to $\Fib$ also belongs to $\Fib'$.
Let $f : X \to Y$ be such a map.
Factor it into a trivial cofibration $i : X \to Z$ followed by a fibration $p : Z \twoheadrightarrow Y$ in $\Fib'$.
Since $i$ has the left lifting property with respect to $f$, the standard argument implies that $f$ is a retract of $p$.
Since $\Fib'$ is closed under retracts, $f$ belongs to $\Fib'$.

\eqref{it:subfib-model-fib} $\implies$ \eqref{it:subfib-model-path}
Let $p : Y \twoheadrightarrow \Gamma$ be a fibration in $\Fib'$.
Factor the diagonal $Y \to Y \times_\Gamma Y$ into a trivial cofibration $Y \to P(Y)$ of $\scat{C}$ followed by a fibration $q : P(Y) \to Y \times_\Gamma Y$ in $\Fib$.
Since $\Fib'$ is closed under pullbacks, the projection $\pi_1 : Y \times_\Gamma Y \to Y$ belongs to $\Fib'$.
Since $\Fib'$ contains all trivial fibrations, the map $\pi_1 \circ q$ also belongs to $\Fib'$.
It follows that $q$ belongs to $\Fib'$.

\eqref{it:subfib-model-path} $\implies$ \eqref{it:subfib-model-id}
Let $f : X \to Y$ be a map in $((\scat{C},\Fib')/\Gamma)_\fs{f}$.
We can factor $f$ as usual as $X \to Z \xrightarrow{q} X \times_\Gamma Y \xrightarrow{\pi_2} Y$, where $q$ is a pullback of $P(Y) \twoheadrightarrow Y \times_\Gamma Y$:
\[ \xymatrix{ Z \ar[r] \ar@{->>}[d]_q \pb                       & P(Y) \ar@{->>}[d] \\
              X \times_\Gamma Y \ar[r] \ar@{->>}[d]_{\pi_1} \pb & Y \times_\Gamma Y \ar@{->>}[d]^{\pi_1} \\
              X \ar[r]_f                                        & Y
            } \]
Since $\Fib'$ is closed under pullbacks, $q$ belongs to $\Fib'$.
The projection $\pi_2 : X \times_\Gamma Y \to Y$ also belongs to $\Fib'$ since it is a pullback of the map $X \twoheadrightarrow \Gamma$ which belongs to $\Fib'$.
Since $\Fib'$ is closed under compositions, the map $\pi_2 \circ q$ belongs to $\Fib'$.
Thus, we just need to prove that the map $X \to Z$ factors into a trivial cofibration followed by a fibration in $\Fib'$.
Since $\pi_1 \circ q$ is a pullback of the trivial fibration $P(Y) \twoheadrightarrow Y$, it is also a trivial fibration.
Thus, $X \to Z$ is a weak equivalence by 2-out-of-3.
Factor it into a trivial cofibration $X \to Z'$ followed by a fibration $Z' \to Z$.
By 2-out-of-3, $Z' \to Z$ is a trivial fibration.
Hence, it belongs to $\Fib'$.
\end{proof}

\begin{prop}[localized-fib]
Let $(\scat{C},\Fib)$ be a type-theoretic semi-fibration category and let $\Fib'$ be a subclass of $\Fib$ which contains identity morphisms and closed under compositions, pullbacks, and identity types.
Then $(\scat{C},\Fib')$ is also a type-theoretic semi-fibration category.
Moreover $(\scat{C},\Fib')$ is closed under identity types in the sense that identity types in this category are equivalent to identity types in $(\scat{C},\Fib)$.
\end{prop}
\begin{proof}
The fact that $(\scat{C},\Fib')$ is a type-thereotic semi-fibration category easily follows from \rlem{subfib}.
The interpretation of identity types is defined as a factorization of the map $E_A \to E_A \times_{V_A} E_A$ into a trivial cofibration followed by a fibration.
We can factor this map into a trivial cofibration of $(\scat{C},\Fib)$ followed by a fibration in $\Fib'$.
Then this type is an interpretation of the identity type in both $(\scat{C},\Fib)$ and $(\scat{C},\Fib')$.
Since identity types are unique up to an equivalence, this implies that they are equivalent in these categories.
\end{proof}

\begin{cor}[localized-con-fib]
Let $F$ be a left Quillen functor between type-theoretic semi-fibration categories $\scat{B}$ and $\scat{C}$ such that $F^*(\scat{C}_!)$ has extensional identity types.
Let $\Fib'$ be a subclass of fibrations of $\scat{C}$ which contains identity morphisms and closed under compositions, pullbacks, and identity types.
Then $F^*((\scat{C},\Fib')_!)$ is a contextually indexed contextual category with unit types, $\Sigma$-types, and extensional identity types.
\end{cor}
\begin{proof}
This follows from \rprop{indexed-locally-small} and \rprop{localized-fib}.
\end{proof}

The following theorem provides the main class of examples of contextually indexed contextual categories.

\begin{thm}
Let $\scat{C}$ be a right proper combinatorial type-theoretic semi-fibration category in which all objects are cofibrant and let $F : \scat{J} \to \scat{I}$ be a functor between small categories.
Let $\Fib$ be a class of injective fibrations which contains identity morphisms and closed under compositions, pullbacks, and identity types.
Then $F^*((\scat{C}^\scat{J},\Fib)_!)$ is a locally small contextually indexed contextual category with dependent $\Hom$-types, unit types, $\Sigma$-types, and extensional identity types.
\end{thm}
\begin{proof}
By \rcor{injective-combinatorial} and \rprop{indexed-locally-small}, $(\scat{C}^\scat{J},\Fib_\fs{inj})$ is a type-theoretic semi-fibration category with dependent $\Hom$-types, unit types, $\Sigma$-types, and extensional identity types.
By \rcor{localized-con-fib}, $F^*((\scat{C}^\scat{J},\Fib)_!)$ is a contextually indexed contextual category with unit types, $\Sigma$-types, and extensional identity types.
By \rprop{localized-hom}, it has dependent $\Hom$-types.
\end{proof}

\subsection{Localization of model categories}

Let $S$ be a class of maps of a model category $\scat{C}$.
Then the class of fibrations that have the right lifting property with respect to $S$ is not necessarily closed under identity types, but if $S$ satisfies certain closure conditions, then this is true.
We will say that $S$ is closed under \emph{coidentity types} if, for every map $f : X \to Y$ in $S$, there exist cylinder objects $C(X)$ for $X$ and $C(Y)$ for $Y$ such that the map $C(X) \amalg_{(X \amalg X)} (Y \amalg Y) \to C(Y)$ belongs to $S$.

\begin{lem}
Let $S$ be a class of cofibrations of a model category $\scat{C}$ closed under coidentity types.
Suppose that either the domains of maps in $S$ are cofibrant or $\scat{C}$ is left proper.
Then the class of fibrations that have the right lifting property with respect to $S$ is closed under identity types.
\end{lem}
\begin{proof}
% TODO
\end{proof}

A \emph{cosimplicial resolution} of an object $X$ of $\scat{C}$ is a cofibrant replacement of the constant functor on $X$ in the Reedy model structure on $\scat{C}^\Delta$.
Let $\Delta$ be a fibrant cofibrant replacement of the terminal object of $\scat{C}^\Delta$.
That is, $\Delta$ is a functor $\Delta \to \scat{C}$ such that $\Delta^n \to 1$ is a trivial fibration for all $n$ and $\partial \Delta^n \to \Delta^n$ is a cofibration in $\scat{C}$.
Then $n \mapsto Q(X) \times \Delta^n$ is a cosimplicial resolution of $X$, where $Q(X)$ is any cofibrant replacement of $X$.

\begin{remark}[good-cyl]
Every Cartesian model category has good cylinder objects (\rdefn{good-cyl}) defined as $X \times \Delta^1$.
\end{remark}

A \emph{cosimplicial resolution} of a map $f : X \to Y$ consists of cosimplicial resolution of its domain and codomain and a map between them such that the obvious square commutes.
Let $Q(X)$ be a cofibrant replacement of $X$.
Factor the map $Q(X) \to X \xrightarrow{f} Y$ into a cofibration $Q(f) : Q(X) \to Q(Y)$ followed by a weak equivalence $Q(Y) \to Y$.
Then $n \mapsto Q(X) \times \Delta^n \to Q(Y) \times \Delta^n$ is a cosimplicial resolution of $f$.

For a class $S$ of maps of a model category, a class $\Lambda(S)$ of \emph{horns on $S$} \cite[Definition~3.3.8]{hirschhorn} is defined as the class of maps of the form
\[ X \otimes \Delta^n \amalg_{X \otimes \partial \Delta^n} Y \otimes \partial \Delta^n \to Y \otimes \Delta^n, \]
where $X \otimes \Delta^n \to Y \otimes \Delta^n$ is a cosimplicial resolution of a map $X \to Y$ from $S$.

\begin{prop}
Let $S$ be a set of maps of a left proper combinatorial model category $\scat{C}$ and let $\Lambda(S)$ be a set of horns on $S$.
Then the class of fibrations that have the right lifting property with respect to $\Lambda(S)$ is closed under identity types.
\end{prop}
\begin{proof}
Let $J$ be a set of generating trivial cofibrations of $\scat{C}$.
Then a map has the right lifting property with respect to $\overline{\Lambda(S)} = \Lambda(S) \cup J$ if and only if it is a fibration and has the right lifting property with respect to $\Lambda(S)$.
We will denote this class of fibrations by $\Fib'$.

Since $S$ is a small set and $\scat{C}$ is combinatorial and left proper, there exists a left Bousfield localization of $\scat{C}/\Gamma$ such that its fibrant objects are precisely maps in $\Fib'$.
Moreover, a map between fibrant objects is a weak equivalence in the localized model structure if and only if it is a weak equivalence in $\scat{C}$.
Thus, by \rlem{subfib}, $\Fib'$ is closed under identity types.
\end{proof}

\begin{defn}
Let $\scat{C}$ be a combinatorial left proper model category and let $S$ be a set of maps of $\scat{C}$.
We define the \emph{localization} of $\scat{C}$ at $S$ as the type-theoretic semi-fibration category $(\scat{C},\Fib)$, where $\Fib$ consists of fibrations that have the right lifting property with respect to $\Lambda(S)$.
The localization of $\scat{C}$ at $S$ will be denoted by $L_S(\scat{C})$.
\end{defn}

\begin{remark}
The class of fibrations defined in in the previous definition may be bigger than the class of fibration of the localized model structure.
This smaller class is also closed under identity types, but we prefer to work with the larger class since it can be described more explicitly.
This will allow us to prove that it is closed under other type-theoretic constructions.
\end{remark}

\begin{example}
If $F : \scat{B} \to \scat{C}$ is a left Quillen functor and $\scat{C}$ is a Cisinski model category, then 
the contextually indexed contextual category $F^*(\scat{C}_!)$ has dependent $\Hom$-types, unit types, $\Sigma$-types, and extensional identity types.
This example was discussed in \rexample{cisinski}.
The only new part is that $F^*(\scat{C}_!)$ has extensional identity types which follows from \rcor{localized-con-fib}.
\end{example}

\subsection{Products}

Let $D : \scat{C} \to \scat{C}^\scat{J}$ be the diagonal functor.
We will say that a functor $F : \scat{J} \to \scat{C}$ is \emph{anticonstant} if, for every constant functor $D(X) : \scat{J} \to \scat{C}$, every map $F \to D(X)$ factor through the map $D(1) \to D(X)$ for some map $1 \to X$.

\begin{lem}[anticonstant-coproduct]
If the category $\fs{el}(F)$ of elements of a functor $F : \scat{J} \to \Set$ is non-empty, then the functor $F(-) \cdot 1 : \scat{J} \to \scat{C}$ is anticonstant if and only if $\fs{el}(F)$ is connected.
\end{lem}
\begin{proof}
By the universal property of coproducts, there is a bijection between the set of maps $p : F(-) \cdot 1 \to D(X)$ and the set of collections of maps $\{ p_{j,a} : 1 \to X \}_{j \in \scat{J}, a \in F(j)}$ such that,
for every map $f : j \to j'$, it is true that $p_{j,a} = p_{j',F(f)(a)}$.
On the other hand, the set of such collections is the set of maps between constant functors on $1$ and $X$ in the category $\scat{C}^{\fs{el}(F)}$.
A map $p : F(-) \cdot 1 \to D(X)$ factors through $D(c)$ for some $c : 1 \to X$ if and only if $p_{j,a} = c$ for all $j$ and $a$.
Since $\fs{el}(F)$ is non-empty, a map of the form $c : 1 \to X$ exists.
The assertion follows from the fact that every map between constant functors $D(Y), D(X) : \scat{I} \to \scat{C}$ equals to $D(c)$ for some fixed $c : Y \to X$ if and only if the category $\scat{I}$ is connected.
\end{proof}

\begin{example}
If $F : \scat{J} \to \Set$ is a representable functor on an object $j \in \scat{J}$, then the functor $F(-) \cdot 1$ is anticonstant.
This follows from \rlem{anticonstant-coproduct} since the category of elements of $F$ is equivalent to the category $j/\scat{J}$ which is non-empty and connected since it has an initial object.
\end{example}

\begin{example}
If $F$ is a non-empty simplicial set, then $F(-) \cdot 1 : \Delta^\fs{op} \to \scat{C}$ is anticonstant if and only if $F$ is connected as a simplicial set.
This follows from \rlem{anticonstant-coproduct} and the fact that a simplicial set is connected if and only if its category of elements is connected.
\end{example}

\begin{lem}[anticonstant-factor]
Let $\scat{C}$ be a Cartesian closed category and let $F : \scat{J} \to \scat{C}$ be an anticonstant functor.
Then every map of the form $F \times D(X) \to D(Y)$ factors as the projection $\pi_2 : F \times D(X) \to D(X)$ followed by a map $D(g)$ for some $g : X \to Y$.
\end{lem}
\begin{proof}
First, it is easy to see that the diagonal functor $D$ preserves exponential objects.
Then a map $f : F \times D(X) \to D(Y)$ corresponds to a map $F \to D(Y^X)$.
Since $F$ is anticonstant, the latter map factors through a map $D(c)$ for some $c : 1 \to Y^X$.
The map $c$ corresponds to a map $g : X \to Y$ such that $D(g) \circ \pi_2 = f$.
\end{proof}

\begin{prop}[localized-products]
Let $\scat{J}$ be a small category and let $S$ be a set of cofibrations of $\sSet^\scat{J}$ such that the domains of maps in $S$ are cofibrant and the codomains are anticonstant.
Then $D^*(L_S(\sSet^\scat{J}))$ has dependent products, where $D : \sSet \to \sSet^\scat{J}$ is the diagonal functor.
Moreover, products in $D^*(L_S(\sSet^\scat{J}))$ are computed as products in $D^*(\sSet^\scat{J})$.
\end{prop}
\begin{proof}
The functor $D : \sSet \to \sSet^\scat{J}$ satisfies most of the conditions of \rprop{products} as discussed in \rexample{products}.
We just need to prove that $\Pi_g$ preserves fibrations for all $D$-fibrations $g$.
This is true if and only if (generating) trivial cofibrations are stable under pullbacks along $D$-fibrations.
Maps that are trivial cofibrations in the injective model structure on $\sSet^\scat{J}$ are stable under pullbacks since $\sSet$ is right proper and $D$-fibrations are objectwise fibrations.
Thus, we just need to prove that maps in $\Lambda(S)$ are stable under pullbacks along $D$-fibraions.
We will use the cosimplicial resolution of the form $X \times D(\Delta^n) \to Y \times D(\Delta^n)$.
Consider the following diagram:
\[ \xymatrix{ W \ar[r] \ar[d] \pb & X \times D(\Delta^n) \amalg_{X \times D(\partial \Delta^n)} Y \times D(\partial \Delta^n) \ar[d] \\
              V \ar[r] \ar[d] \pb & Y \times D(\Delta^n) \ar[d] \\
              D(B) \ar[r]_{D(p)} & D(A)
            } \]
where $p : B \to A$ is a fibration and $f : X \to Y$ is a map in $S$.
We need to prove that $W \to V$ is a trivial cofibration in $L_S(\scat{C}^\scat{J})$.
\Rlem{anticonstant-factor} implies that the map $Y \times D(\Delta^n) \to D(A)$ factor as the second projection followed by a map of the form $D(\Delta^n) \to D(A)$ for some map $c : \Delta^n \to A$.
Let us denote by $T$ the pullback of $p$ and $c$.
Then $V \simeq Y \times D(T)$.

Since $\sSet^\scat{J}$ is locally Cartesian closed, pullbacks along the map $Y \times D(T) \to Y \times D(\Delta^n)$ preserve colimits.
Thus, $W \to V$ is the following map:
\[ (X \times D(T)) \amalg_{(X \times D(T \times_{\Delta^n} \partial \Delta^n))} (Y \times D(T \times_{\Delta^n} \partial \Delta^n)) \to Y \times D(T). \]
That is, this map is $f \square D(g)$, where $g$ is the map $T \times_{\Delta^n} \partial \Delta^n \to T$.

The set $\Lambda(S)$ consists of maps of the form $f \square D(i)$ for all $f \in S$ and $i : \partial \Delta^n \to \Delta^n$.
By the usual argument, maps of the form $f \square i'$ belong to $\Icof[\Lambda(S)]$, where $i' \in \Icof[D(i)]$ and
$\Icof$ is the class of maps that have the left lifting property with respect to $\Iinj$ and $\Iinj$ is the class of maps that have the right lifting property with respect to $I$.
Thus, we just need to prove that $D(g) \in \Icof[D(\I)]$, where $\I = \{ \partial \Delta^n \to \Delta^n \}$, but this follows from the fact that $g \in \Icof$ and $D(\Icof) \subseteq \Icof[D(\I)]$ since $D$ is a left adjoint.
\end{proof}

\begin{remark}
We can replace simplicial sets with a proper Cartesian closed combinatorial type-theoretic model category $\scat{C}$ in the previous proposition.
To prove it in this generality, we need to assume that $\scat{C}$ has a cosimplicial resolution $\Delta^n$ of the terminal object
such that projections $A \times \Delta^n \to A$ are weak equivalences for all cofibrant $A$ and one of the following conditions hold:
\begin{enumerate}
\item Maps $\partial \Delta^n \to \Delta^n$ generate all cofibrations of $\scat{C}$, that is every cofibration belongs to $\Icof$, where $\I$ is the set of such maps.
\item The set $S$ is closed under the functions $- \square D(i)$ for all cofibrations $i$ of $\scat{C}$.
\end{enumerate}
The second condition is weaker than the first one in the sense that if the first condition holds, then we can enlarge $S$ so that the second condition also holds and the resulting localized structure does not change.
\end{remark}

\subsection{Coproducts}

\section{Extension types}

% TODO

\section{Factorization systems}

Let $\scat{B}$ be a contextual category, let $\scat{C}$ be a category with fibrations, and let $F : \scat{B} \to \scat{C}$ be a functor between them.
A convenient way to define a full indexed subcategory of $F^*(\scat{C}_!)$ is to specify a subclass $\Fib$ of fibrations of $\scat{C}$.
But this actually defines not only full subcategory of $\scat{C}$, but also full subcategories of all slice categories $(\scat{C}/\Delta)_\fs{f}$.
We will say that $\Fib$ is \emph{locally reflective} if it the right class in a weak factorization system.

The notition of a locally relective class of fibrations is similar to the homonymous notion defined in \cite[Subsection~10.1]{indexed-tt}.
The difference is that we require that there exists a predicate in $\scat{B}$ on maps in $\scat{C}$.
We will say that a class $\Fib$ is \emph{representable} if there is a class of fibrations $\fs{Fib}$ as defined in \cite[Subsection~9.2]{indexed-tt} such that $\fs{Fib}(f)$ is inhabited if and only if $f$ belongs to $\Fib$.
In this case, we will say that $\fs{Fib}$ \emph{represents} $\Fib$ and that $\Fib$ is \emph{represented} by $\fs{Fib}$.

% TODO

\section{Universes}

% TODO

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
