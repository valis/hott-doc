\documentclass[reqno]{amsart}

\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{verbatim}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{turnstile}
\usepackage{etex}
\usepackage{todonotes}

\hypersetup{colorlinks=true,linkcolor=blue}

\renewcommand{\turnstile}[6][s]
    {\ifthenelse{\equal{#1}{d}}
        {\sbox{\first}{$\displaystyle{#4}$}
        \sbox{\second}{$\displaystyle{#5}$}}{}
    \ifthenelse{\equal{#1}{t}}
        {\sbox{\first}{$\textstyle{#4}$}
        \sbox{\second}{$\textstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{s}}
        {\sbox{\first}{$\scriptstyle{#4}$}
        \sbox{\second}{$\scriptstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{ss}}
        {\sbox{\first}{$\scriptscriptstyle{#4}$}
        \sbox{\second}{$\scriptscriptstyle{#5}$}}{}
    \setlength{\dashthickness}{0.111ex}
    \setlength{\ddashthickness}{0.35ex}
    \setlength{\leasturnstilewidth}{2em}
    \setlength{\extrawidth}{0.2em}
    \ifthenelse{%
      \equal{#3}{n}}{\setlength{\tinyverdistance}{0ex}}{}
    \ifthenelse{%
      \equal{#3}{s}}{\setlength{\tinyverdistance}{0.5\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{d}}{\setlength{\tinyverdistance}{0.5\ddashthickness}
        \addtolength{\tinyverdistance}{\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{t}}{\setlength{\tinyverdistance}{1.5\dashthickness}
        \addtolength{\tinyverdistance}{\ddashthickness}}{}
        \setlength{\verdistance}{0.4ex}
        \settoheight{\lengthvar}{\usebox{\first}}
        \setlength{\raisedown}{-\lengthvar}
        \addtolength{\raisedown}{-\tinyverdistance}
        \addtolength{\raisedown}{-\verdistance}
        \settodepth{\raiseup}{\usebox{\second}}
        \addtolength{\raiseup}{\tinyverdistance}
        \addtolength{\raiseup}{\verdistance}
        \setlength{\lift}{0.8ex}
        \settowidth{\firstwidth}{\usebox{\first}}
        \settowidth{\secondwidth}{\usebox{\second}}
        \ifthenelse{\lengthtest{\firstwidth = 0ex}
            \and
            \lengthtest{\secondwidth = 0ex}}
                {\setlength{\turnstilewidth}{\leasturnstilewidth}}
                {\setlength{\turnstilewidth}{2\extrawidth}
        \ifthenelse{\lengthtest{\firstwidth < \secondwidth}}
            {\addtolength{\turnstilewidth}{\secondwidth}}
            {\addtolength{\turnstilewidth}{\firstwidth}}}
        \ifthenelse{\lengthtest{\turnstilewidth < \leasturnstilewidth}}{\setlength{\turnstilewidth}{\leasturnstilewidth}}{}
    \setlength{\turnstileheight}{1.5ex}
    \sbox{\turnstilebox}
    {\raisebox{\lift}{\ensuremath{
        \makever{#2}{\dashthickness}{\turnstileheight}{\ddashthickness}
        \makehor{#3}{\dashthickness}{\turnstilewidth}{\ddashthickness}
        \hspace{-\turnstilewidth}
        \raisebox{\raisedown}
        {\makebox[\turnstilewidth]{\usebox{\first}}}
            \hspace{-\turnstilewidth}
            \raisebox{\raiseup}
            {\makebox[\turnstilewidth]{\usebox{\second}}}
        \makever{#6}{\dashthickness}{\turnstileheight}{\ddashthickness}}}}
        \mathrel{\usebox{\turnstilebox}}}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{#3~\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\expandafter\newcommand\csname n#2\endcsname[1]{\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{theorem}{Theorem}
\newref{lem}{lemma}{Lemma}
\newref{prop}{proposition}{Proposition}
\newref{cor}{corollary}{Corollary}
\newref{cond}{condition}{Condition}

\theoremstyle{definition}
\newref{defn}{definition}{Definition}
\newref{example}{example}{Example}

\theoremstyle{remark}
\newref{remark}{remark}{Remark}

\newcommand{\deq}{\equiv}
\newcommand{\repl}{:=}

\newcommand{\cat}[1]{\mathbf{#1}}
\newcommand{\C}{\cat{C}}
\newcommand{\PAlg}[1]{#1\text{-}\cat{PAlg}}
\newcommand{\Mod}[1]{#1\text{-}\cat{Mod}}
\newcommand{\Th}{\cat{Th}}
\newcommand{\algtt}{\cat{AlgTT}}
\newcommand{\ThC}{\Th_{\mathcal{C}}}
\newcommand{\emptyCtx}{\mathbf{1}}
\newcommand{\tta}{\mathbb{T}_0}
\newcommand{\tts}{\mathbb{T}_1}

\newcommand{\we}{\mathcal{W}}
\newcommand{\fib}{\mathcal{Fib}}
\newcommand{\cof}{\mathcal{Cof}}
\newcommand{\I}{\mathrm{I}}
\newcommand{\J}{\mathrm{J}}
\newcommand{\class}[2]{#1\text{-}\mathrm{#2}}
\newcommand{\Iinj}[1][\I]{\class{#1}{inj}}
\newcommand{\Icell}[1][\I]{\class{#1}{cell}}
\newcommand{\Icof}[1][\I]{\class{#1}{cof}}
\newcommand{\Jinj}[1][]{\Iinj[\J#1]}
\newcommand{\Jcell}[1][]{\Icell[\J#1]}
\newcommand{\Jcof}[1][]{\Icof[\J#1]}
\newcommand{\cyli}{i}

\numberwithin{figure}{section}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\begin{document}

\title{Model Structures on Models of Algebraic Dependent Type Theories}

\author{Valery Isaev}

\begin{abstract}
\end{abstract}

\maketitle

 \makeatletter
    \providecommand\@dotsep{5}
  \makeatother
  \listoftodos\relax

\section{Introduction}

\section{Theories with an interval type}

In this section we describe the theory of an interval type.
We describe several constructions in this theory which we will need later.
In partical, we will show that theories with an interval type and path types also have $Id$ types.
We will use a (slightly informal) named presentation of terms,
from which a formal presentation in terms of De Bruijn indices can be recovered.

Theories with an interval type are closely related to theories with identity types.
So, let us first recall its definition from \cite{alg-tt}.
Theory $Id$ is a regular theory with the following function symbols:
\begin{align*}
Id & : (tm,n) \times (tm,n) \to (ty,n) \\
refl & : (tm,n) \to (tm,n) \\
J & : (ty,n+3) \times (tm,n+1) \times (tm,n) \times (tm,n) \times (tm,n) \to (tm,n)
\end{align*}
and the following axioms:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash ty(a) \deq ty(a')$}
\UnaryInfC{$\Gamma \vdash Id(a, a')\ type$}
\DisplayProof
\quad
\AxiomC{}
\UnaryInfC{$\Gamma \vdash refl(a) : Id(a, a)$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma, x : A, y : A, z : Id(x,y) \vdash D\ type$}
\AxiomC{$\Gamma, x : A \vdash d : D'$}
\AxiomC{$\Gamma \vdash p : Id(a,a')$}
\TrinaryInfC{$\Gamma \vdash J(D,d,a,a',p) : D[a,a',p]$}
\DisplayProof
\end{center}
where $D' = D[y \repl x, z \repl refl(x)]$ and $A = ty(a)$.

\medskip
\begin{center}
\AxiomC{$\Gamma, x : ty(a), y : ty(a), z : Id(x,y) \vdash D\ type$}
\AxiomC{$\Gamma, x : ty(a) \vdash d : D'$}
\BinaryInfC{$\Gamma \vdash J(D,d,a,a,refl(a)) \deq d[a]$}
\DisplayProof
\end{center}
\medskip
where $D' = D[y \repl x, z \repl refl(x)]$.

We will also need slightly weaker version of $Id$ which we will denote by $Id_-$.
It has all of the function symbols of $Id$ together with the following one:
\[ Jeq : (tm,n+3) \times (tm,n+1) \times (tm,n) \to (tm,n) \]
Theory $Id_-$ has all of the axioms of $Id$ except the last one; instead it has the following additional axiom:
\begin{center}
\AxiomC{$\Gamma, x : ty(a), y : ty(a), z : Id(x,y) \vdash D\ type$}
\AxiomC{$\Gamma, x : ty(a) \vdash d : D'$}
\BinaryInfC{$\Gamma \vdash Jeq(D,d,a) : Id(J(D,d,a,a,refl(a)),d[a])$}
\DisplayProof
\end{center}
\medskip
where $D' = D[y \repl x, z \repl refl(x)]$.
The idea is that the last axiom of $Id$ holds in $Id_-$ only propositionally.

Now, we can define the theory of the interval type.
Actually, there are several different ways to define such theory.
These theories are not isomorphic, but should be equivalent in some weaker sense.
First, let us define the most basic theory which has only the interval type and its constructors, but lacks any kind of eliminator for it.
Theory $I$ is a regular theory with function symbols $I : (ty,n)$, $left : (tm,n)$, $right : (tm,n)$, and the following axioms:
\begin{center}
\AxiomC{}
\UnaryInfC{$\Gamma \vdash I\ type$}
\DisplayProof
\quad
\AxiomC{}
\UnaryInfC{$\Gamma \vdash left : I$}
\DisplayProof
\quad
\AxiomC{}
\UnaryInfC{$\Gamma \vdash right : I$}
\DisplayProof
\end{center}

There are at least three different ways to define an eliminator for $I$.
The idea always the same: given a fibration over $I$ and a point in the fibre over
some point $i : I$, we can transport it to the fibre over some other point $j : I$.
In different eliminators, we can take different $i$ and $j$.
In $coe_0$, we can only take $i = left$ and $j = right$.

\medskip
\begin{center}
\AxiomC{$\Gamma, x : I \vdash D\ type$}
\AxiomC{$\Gamma \vdash d : D[x \repl left]$}
\BinaryInfC{$\Gamma \vdash coe_0(\lambda x.\,D, d) : D[x \repl right]$}
\DisplayProof
\end{center}

In $coe_1$, we can take $i = left$ and arbitrary $j$.

\medskip
\begin{center}
\AxiomC{$\Gamma, x : I \vdash D\ type$}
\AxiomC{$\Gamma \vdash d : D[x \repl left]$}
\AxiomC{$\Gamma \vdash i : I$}
\TrinaryInfC{$\Gamma \vdash coe_1(\lambda x.\,D, d, i) : D[x \repl i]$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma, x : I \vdash D\ type$}
\AxiomC{$\Gamma \vdash d : D[x \repl left]$}
\BinaryInfC{$\Gamma \vdash coe_1(\lambda x.\,D, d, left) \deq d$}
\DisplayProof
\end{center}

In $coe_2$, both $i$ and $j$ may be arbitrary.

\medskip
\begin{center}
\AxiomC{$\Gamma, x : I \vdash D\ type$}
\AxiomC{$\Gamma \vdash i : I$}
\AxiomC{$\Gamma \vdash d : D[x \repl i]$}
\AxiomC{$\Gamma \vdash j : I$}
\QuaternaryInfC{$\Gamma \vdash coe_2(\lambda x.\,D, i, d, j) : D[x \repl j]$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma, x : I \vdash D\ type$}
\AxiomC{$\Gamma \vdash d : D[x \repl left]$}
\BinaryInfC{$\Gamma \vdash coe_2(\lambda x.\,D, left d, left) \deq d$}
\DisplayProof
\end{center}

It turns out that $coe_0$ is too weak.
To make it equivalent to other two theories, we need to add regular theory $sq$ to it,
which has one function symbol $sq : (tm,n) \times (tm,n) \to (tm,n)$ and the following axioms:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash i : I$}
\AxiomC{$\Gamma \vdash j : I$}
\BinaryInfC{$\Gamma \vdash sq(i,j) : I$}
\DisplayProof
\qquad
\AxiomC{$\Gamma \vdash i : I$}
\UnaryInfC{$\Gamma \vdash sq(i,left) \deq left$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash j : I$}
\UnaryInfC{$\Gamma \vdash sq(left,j) \deq left$}
\DisplayProof
\qquad
\AxiomC{$\Gamma \vdash j : I$}
\UnaryInfC{$\Gamma \vdash sq(right,j) \deq j$}
\DisplayProof
\end{center}

Also, these theories correspond to $Id_-$.
To get theories that correspond to $Id$, we need to add one additional rule to each of them:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a : A$}
\UnaryInfC{$\Gamma \vdash coe_0(\lambda x.\,A, a) \deq a$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash a : A$}
\UnaryInfC{$\Gamma \vdash coe_1(\lambda x.\,A, a, right) \deq a$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a : A$}
\UnaryInfC{$\Gamma \vdash coe_2(\lambda x.\,A, left, a, right) \deq a$}
\DisplayProof
\end{center}
\smallskip
We denote these theories by $coe_0 + \sigma$, $coe_1 + \sigma$ and $coe_2 + \sigma$.

We will also consider theory $coe_2 + \beta_2$ which is $coe_2$ together with the following axiom:
\medskip
\begin{center}
\AxiomC{$\Gamma, x : I \vdash D\ type$}
\AxiomC{$\Gamma \vdash d : D[x \repl left]$}
\AxiomC{$\Gamma \vdash i : I$}
\TrinaryInfC{$\Gamma \vdash coe_2(\lambda x.\,D, i, d, i) \deq d$}
\DisplayProof
\end{center}
\medskip

Theory $coe_2 + \beta_2$ is slightly stronger than other theories.
To make them equivalent to $coe_2 + \beta_2$, we need to assume additional operations.
For example, we can consider regular theory $dc$ which has one function symbol
$dc : (tm,n) \times (tm,n) \times (tm,n) \to (tm,n)$ and the following axiom:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash i : I$}
\AxiomC{$\Gamma \vdash j : I$}
\AxiomC{$\Gamma \vdash k : I$}
\TrinaryInfC{$\Gamma \vdash dc(i,j,k) : I$}
\DisplayProof
\qquad
\AxiomC{$\Gamma \vdash i : I$}
\AxiomC{$\Gamma \vdash j : I$}
\BinaryInfC{$\Gamma \vdash dc(i,j,left) \deq i$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash i : I$}
\AxiomC{$\Gamma \vdash j : I$}
\BinaryInfC{$\Gamma \vdash dc(i,j,right) \deq j$}
\DisplayProof
\qquad
\AxiomC{$\Gamma \vdash i : I$}
\AxiomC{$\Gamma \vdash k : I$}
\BinaryInfC{$\Gamma \vdash dc(i,i,k) \deq i$}
\DisplayProof
\end{center}

\subsection{Homogeneous path types}

To define maps between theories with $Id$ types and theories with an interval type,
we need to add an additional construction to the latter, which we call \emph{homogeneous path types}.
Let $HPath$ be a regular theory with function symbols $=\ : (tm,n) \times (tm,n) \to (ty,n)$,
    $path : (tm,n+1) \to (tm,n)$, and $at : (tm,n) \times (tm,n) \times (tm,n) \times (tm,n) \to (tm,n)$, and the following axioms:
\begin{center}
\AxiomC{$\Gamma \vdash a : A$}
\AxiomC{$\Gamma \vdash a' : A$}
\BinaryInfC{$\Gamma \vdash a = a'\ type$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma \vdash A\ type$}
\AxiomC{$\Gamma, x : I \vdash a : A$}
\BinaryInfC{$\Gamma \vdash path(\lambda x.\,a) : a[x \repl left] = a[x \repl right]$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma \vdash a : A$}
\AxiomC{$\Gamma \vdash p : a = a'$}
\AxiomC{$\Gamma \vdash i : I$}
\TrinaryInfC{$\Gamma \vdash at(a, a', p, i) : A$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma \vdash A\ type$}
\AxiomC{$\Gamma, x : I \vdash a : A$}
\AxiomC{$\Gamma \vdash i : I$}
\TrinaryInfC{$\Gamma \vdash at(a[x \repl left], a[x \repl right], path(\lambda x.\,a), i) \deq a[x \repl i]$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma \vdash p : a = a'$}
\UnaryInfC{$\Gamma \vdash path(\lambda x.\,at(a, a', p, x)) \deq p$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma \vdash p : a = a'$}
\UnaryInfC{$\Gamma \vdash at(a, a', p, left) \deq a$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash p : a = a'$}
\UnaryInfC{$\Gamma \vdash at(a, a', p, right) \deq a'$}
\DisplayProof
\end{center}

We can summarize the relationship between different theories in the following (noncommutative) diagram of theories:
\[ \xymatrix{ & Id_- \ar[rr] \ar[d] & & Id \ar[d] \\
              coe'_0 + sq \ar[r] & coe'_1 \ar[r] & coe'_2 \ar[d]    \ar[r] & coe'_0 + \sigma + sq \ar@<1.5pt>[r] \ar[d] & coe'_1 + \sigma \ar[d] \ar@<1.5pt>[l] \\
              sq          \ar[r] & dc     \ar[r] & coe'_2 + \beta_2 \ar[r] & coe'_0 + \sigma + dc \ar@<1.5pt>[r]        & coe'_1 + \sigma + dc   \ar@<1.5pt>[l]
            } \]
where $coe'_\alpha = coe_\alpha + HPath$.
This diagram does not commute strictly, but it should commute up to some appropriately defined notion of homotopy between morphisms of theories.

Arrows $Id_- \to Id$ and $coe'_1 \to coe'_2$ are obvious.
Let us construct vertical maps.
Let $refl(a) = path(\lambda x.\,a)$ and $J(A, \lambda x y z.\,D, \lambda x.\,d, a, a', p) = coe_0(\lambda i.\,D', d[x \repl a])$, where $D'$ is defined as
\[ D[x \repl a, y \repl at(a, a', p, sq(i,right)), z \repl path(\lambda j.\,at(a, a', p, sq(i,j)))]. \]
Note that $J(A, \lambda x y z.\,D, \lambda x.\,d, a, a, refl(a))$ equals to $coe_0(\lambda i. D'', d[x \repl a])$ where $D'' = D[x \repl a, y \repl a, z \repl refl(a)]$.
Thus if we have $\sigma$ rule, then equation $\vdash J(A, \lambda x y z.\,D, \lambda x.\,d, a, a, refl(a)) \deq d[x \repl a]$ holds.
If we have $coe_1$, then we can define $Jeq(D,d,a)$ as $coe_0(\lambda j.\,coe_1(\lambda i. D'', d[a], j) = d[a], refl(d[a]))$.

Map $sq \to coe'_1$ can be defined as follows:
\[ sq(i,j) = at(left, j, coe_1(\lambda x.\,left = x, refl(left), j), i). \]

Now, let us define arrow $coe_2 \to coe'_0 + sq + \sigma$.
First, note that we can define a map $coe_1 \to coe_0 + sq + \sigma$ as follows: $coe_1(\lambda x.\,D, d, j) = coe_0(\lambda i.\,D[x \repl sq(i,j)], d)$.
Then let $Ic(i) = path(\lambda j.\,sq(j,i))$.
Since $Ic(i) : left = i$, we can define a term $dc'(i,j)$ of type $i = j$.
Now, let $coe_2(\lambda x.\,D, i, d, j)$ be equal to $coe_0(\lambda x.\,D[x \repl at(i, j, dc'(i,j), x)], d)$.
Note that $\Gamma \vdash dc'(left,left) \deq refl(left)$; hence $\Gamma \vdash coe_2(\lambda x.\,D, left, d, left) \deq d$.

Maps in the bottom row are easy to define:
\begin{align*}
sq(i,j) & = dc(left,j,i) \\
dc(i,j,k) & = at(i,j,coe_2(\lambda x.\,i = x, i, refl(i), j),k) \\
coe_2(\lambda x.\,D, i, d, j) & = coe_0(\lambda x.\,D[x \repl dc(i,j,x)], d)
\end{align*}

\begin{comment}
Finally, let us describe the last construction we will need.
Let \[ inv(i) = at(right, left, coe(v_0 = left, refl(left), right), i). \]
If $\Gamma \vdash i : I$, then $\Gamma \vdash inv(i) : I$, $\Gamma \vdash inv(left) \deq right$, and $\Gamma \vdash inv(right) \deq left$.
\end{comment}

\subsection{Heterogeneous path types}

\emph{Heterogeneous path types} are a useful generalization of homogeneous path types.
Theory $Path$ be a theory with function symbols $Path : (ty,n+1) \times (tm,n) \times (tm,n) \to (ty,n)$,
    $path : (tm,n+1) \to (tm,n)$, and $at : (ty,n+1) \times (tm,n) \times (tm,n) \times (tm,n) \times (tm,n) \to (tm,n)$, and the following axioms:
\begin{center}
\AxiomC{$\Gamma, x : I \vdash A\ type$}
\AxiomC{$\Gamma \vdash a : A[x \repl left]$}
\AxiomC{$\Gamma \vdash a' : A[x \repl right]$}
\TrinaryInfC{$\Gamma \vdash Path(\lambda x.\, A, a, a')\ type$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma, x : I \vdash a : A$}
\UnaryInfC{$\Gamma \vdash path(\lambda x.\,a) : Path(\lambda x.\,A, a[x \repl left], a[x \repl right])$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma \vdash p : Path(\lambda x.\,A, a, a')$}
\AxiomC{$\Gamma \vdash i : I$}
\BinaryInfC{$\Gamma \vdash at(\lambda x.\,A, a, a', p, i) : A[x \repl i]$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma, x : I \vdash a : A$}
\AxiomC{$\Gamma \vdash i : I$}
\BinaryInfC{$\Gamma \vdash at(\lambda x.\,A, a[x \repl left], a[x \repl right], path(\lambda x.\,a), i) \deq a[x \repl i]$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma \vdash p : Path(\lambda x.\,A, a, a')$}
\UnaryInfC{$\Gamma \vdash path(\lambda y.\,at(\lambda x.\,A, a, a', p, y)) \deq p$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma \vdash p : Path(\lambda x.\,A, a, a')$}
\UnaryInfC{$\Gamma \vdash at(\lambda x.\,A, a, a', p, left) \deq a$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash p : Path(\lambda x.\,A, a, a')$}
\UnaryInfC{$\Gamma \vdash at(\lambda x.\,A, a, a', p, right) \deq a'$}
\DisplayProof
\end{center}

There is an obvious morphism $f : HPath \to Path$ such that $f(a = a') = Path(\lambda x.\,ty(a), a, a')$.

The theory we are describing has many similarities to the theory of cubical sets.
The reason is that we can think of contexts $I, \ldots I \vdash$ as $n$-dimensional cubes.
Let $M$ be a model of $I$ and let $A,B \in M_{(ty,0)}$, then the sequence of sets
$\{\,x \in M_{(tm,n+1)}\ |\ ty(x) = (A, I, \ldots I \vdash B\!\uparrow^{n+1})\,\}$ has a natural structure of a cubical set.
If $M$ is a model of $coe_1 + Path$, then these cubical sets are fibrant, that is have fillers for all cubical horns.
We will formally define operations $Fill^n$ which give us these fillers in subsection~\ref{sec:fillers}.
Now, we need these fillers to define several operations that we will use in the next subsection.

First, let us define $sq'$ which satisfies all of the axioms of $sq$ together with axiom $\Gamma \vdash sq(i,right) \deq i$.
This operation is analogous to connections in cubical sets.
Actually, this construction shows that cubical sets that we defined before from a model of the theory have connections.
We can define $sq'$ by filling the following horn:
\[ \xymatrix @C=0.5pc @R=0.5pc
    { left \ar[rrrr] \ar[dddd] &          & &                      & left \ar[dddd] \\
           & left \ar[rr] \ar[dd] \ar[ul] & & left \ar[dd] \ar[ur] & \\
           &                              & &                      & \\
           & left \ar[rr] \ar[dl]         & & left \ar[dr]         & \\
      left \ar[rrrr]           &          & &                      & right
    }\]
The inner, left, and top squares are $\lambda i\,j.\,left$, the bottom and right squares are $sq$,
and the filler gives us the outter square which is the required operation $sq'$.
Formally, we define $sq'(i,j)$ as
\[ at(at(coe_0(\lambda x_1.\,Path(\lambda x_2.\,left = sq(x_1,x_2), refl(left), p_1), p_2),i),j) \]
where we omit first three arguments of $at$, and $p_1 = path(\lambda x_3.\,sq(x_1,x_3))$, $p_2 = refl(refl(left))$.

We will also need operation $dc'$ which satisfies the following axioms:
\begin{align*}
\Gamma & \vdash dc'(i,j,left) \deq i \\
\Gamma & \vdash dc'(i,j,right) \deq j \\
\Gamma & \vdash dc'(left,left,k) \deq left \\
\Gamma & \vdash dc'(right,right,k) \deq right
\end{align*}
Thus we need to find a map from $I^3$ to $I$, and we can do this by filling some horn.
Conditions that we put on $dc'$ are not enough to define a cubical horn, but we can fill missing parts.
Consider the following picture:
\[ \xymatrix @C=0.5pc @R=0.5pc
    { right \ar[rrrr] \ar[dddd] &         & &                      & right \ar[dddd] \\
           & left \ar[rr] \ar[dd] \ar[ul] & & left \ar[dd] \ar[ur] & \\
           &                              & &                      & \\
           & left \ar[rr] \ar[dl]         & & right \ar[dr]        & \\
      left \ar[rrrr]           &          & &                      & right
    }\]
Here $j$ is going from left to right, $k$ is going from top to bottom, and $i$ is going diagonally.
Top square is $\lambda j\,i.\,i$, bottom square is $\lambda j\,i.\,j$, left side of the inner square is $\lambda k.\,left$,
and the right side of the outter square is $\lambda k.\,right$.
We can take the inner square to be $\lambda j\,k.\,sq'(j,k)$.
The left square we can define by the filler operation.
Thus we only need to fill the right square.
We can do this by filling the following horn:
\[ \xymatrix @C=0.5pc @R=0.5pc
    { left \ar[rrrr] \ar[dddd] &          & &                      & right \ar[dddd] \\
           & left \ar[rr] \ar[dd] \ar[ul] & & left \ar[dd] \ar[ur] & \\
           &                              & &                      & \\
           & left \ar[rr] \ar[dl]         & & left \ar[dr]         & \\
      right \ar[rrrr]           &         & &                      & right
    }\]
The inner square is $\lambda x_1\,x_2.\,left$, the left square is $\lambda x_2\,x_3.\,sq'(x_2,x_3)$,
the top square is $\lambda x_1\,x_3.\,sq'(x_1,x_3)$, the right square is $\lambda x_2.\,x_3.\,x_3$,
and the bottom square is $\lambda x_1\,x_3.\,x_3$.
The outter square gives us the required square for the horn that we considered before.

\subsection{Local versions of $coe$}

Usually, we can define two different versions of an eliminator for a type in type theory, one of which is stronger.
For example, stronger versions of $coe$ look like this:

\medskip
\begin{center}
\AxiomC{$\Gamma, x : I, \Delta \vdash D\ type$}
\AxiomC{$\Gamma, \Delta[x \repl left] \vdash d : D[x \repl left]$}
\BinaryInfC{$\Gamma, \Delta[x \repl right] \vdash coe^l_0(\lambda x.\,D, d) : D[x \repl right]$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma, x : I, \Delta \vdash D\ type$}
\AxiomC{$\Gamma, \Delta[x \repl left] \vdash d : D[x \repl left]$}
\AxiomC{$\Gamma \vdash i : I$}
\TrinaryInfC{$\Gamma, \Delta[x \repl i] \vdash coe^l_1(\lambda x.\,D, d, i) : D[x \repl i]$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma, x : I, \Delta \vdash D\ type$}
\AxiomC{$\Gamma, \Delta[x \repl left] \vdash d : D[x \repl left]$}
\BinaryInfC{$\Gamma, \Delta[x \repl left] \vdash coe^l_1(\lambda x.\,D, d, left) \deq d$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma, x : I, \Delta \vdash D\ type$}
\AxiomC{$\Gamma \vdash i : I$}
\AxiomC{$\Gamma, \Delta[x \repl i] \vdash d : D[x \repl i]$}
\AxiomC{$\Gamma \vdash j : I$}
\QuaternaryInfC{$\Gamma, \Delta[x \repl j] \vdash coe^l_2(\lambda x.\,D, i, d, j) : D[x \repl j]$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma, x : I, \Delta \vdash D\ type$}
\AxiomC{$\Gamma, \Delta[x \repl left] \vdash d : D[x \repl left]$}
\BinaryInfC{$\Gamma, \Delta[x \repl left] \vdash coe^l_2(\lambda x.\,D, left, d, left) \deq d$}
\DisplayProof
\end{center}

We can also consider theory $coe^l_2 + \beta^l_2$ which is $coe^l_2$ together with the following axiom:
\begin{center}
\AxiomC{$\Gamma, x : I, \Delta \vdash D\ type$}
\AxiomC{$\Gamma \vdash i : I$}
\AxiomC{$\Gamma, \Delta[x \repl i] \vdash d : D[x \repl i]$}
\TrinaryInfC{$\Gamma, \Delta[x \repl i] \vdash coe^l_2(\lambda x.\,D, i, d, i) \deq d$}
\DisplayProof
\end{center}

We call such verions of these operations \emph{local}, and the ones that were defined before \emph{global}.
Usually, if we have $\Pi$ type, then we can define local versions in terms of global, but without them local are strictly stronger.
But this is not the case for $coe_2 + \beta_2$; it turns out that $coe^l_2 + \beta^l_2$ follow from $coe_2 + \beta_2$ even without $\Pi$ types.

It is not convenient to work with such local operations directly since context in the conclusion is extended, but we can always rewrite them in the usual form.
For example, if $\Delta$ equals to $y_1 : B_1, \ldots y_k : B_k$, then we can rewrite $coe^l_2$ as follows:
\medskip
\begin{center}
\def\extraVskip{1pt}
\Axiom$\fCenter \Gamma, x : I, \Delta \vdash D\ type$
\noLine
\UnaryInf$\fCenter \Gamma \vdash i : I$
\noLine
\UnaryInf$\fCenter \Gamma, \Delta[x \repl i] \vdash d : D[x \repl i]$
\noLine
\UnaryInf$\fCenter \Gamma \vdash j : I$
\def\extraVskip{2pt}
\Axiom$\fCenter \Gamma \vdash b_1 : B_1[x \repl j]$
\noLine
\UnaryInf$\fCenter \ldots$
\noLine
\UnaryInf$\fCenter \Gamma \vdash b_k : B_k[x \repl j, y_1 \repl b_1, \ldots y_{k-1} \repl b_{k-1}]$
\BinaryInfC{$\Gamma \vdash coe^{l'}_2(\lambda x\,y_1 \ldots y_k.\,D, i, d, j, b_1, \ldots b_k) : D[x \repl j, y_1 \repl b_1, \ldots y_k \repl b_k]$}
\DisplayProof
\end{center}
Then theories $coe^l_2$ and $coe^{l'}_2$ are isomorphic.
Maps between them are defined as follows:
\begin{align*}
coe^l_2(\lambda x.\,D, i, d, j) & = coe^{l'}_2(\lambda x\,y_1 \ldots y_k.\,D, i, d, j, y_1, \ldots y_k) \\
coe^{l'}_2(\lambda x\,y_1 \ldots t_k.\,D, i, d, j, b_1, \ldots b_k) & = coe^l_2(\lambda x.\,D, i, d, j)[b_1, \ldots b_k]
\end{align*}

Now, we can define a map $coe^{l'}_2 + \beta^l_2 \to coe_2 + \beta_2$.
First, let $b'_m(z)$ be equal to
\[ coe_2(\lambda x.\,B_m[y_1 \repl b_1'(x), \ldots y_{m-1} \repl b_{m-1}'(x)], j, b_m, z) \]
for every $1 \leq m \leq k$.
If $\Gamma \vdash z : I$, then $\Gamma \vdash b_m'(z) : B_m[x \repl z, y_1 \repl b_1'(z), \ldots b_{m-1}'(z)]$.
Now, we can define $coe^{l'}_2(\lambda x\,y_1 \ldots y_k.\,D, i, d, j, b_1, \ldots b_m)$ as follows:
\[ coe_2(\lambda x.\,D[y_1 \repl b_1'(x), \ldots y_k \repl b_k'(x)], i, d[y_1 \repl b'_1(i), \ldots y_k \repl b'_k(i)], j) \]

Theories $coe^{l'}_0$ and $coe^{l'}_1$ are defined similarly to $coe^{l'}_2$.
Theory $coe^{l'}_1 + \sigma^l$ is $coe^{l'}_1$ together with the following axiom:
\medskip
\begin{center}
\def\extraVskip{1pt}
\Axiom$\fCenter \Gamma, \Delta \vdash D\ type$
\noLine
\UnaryInf$\fCenter \Gamma, \Delta \vdash d : D$
\noLine
\UnaryInf$\fCenter \Gamma \vdash i : I$
\def\extraVskip{2pt}
\Axiom$\fCenter \Gamma \vdash b_1 : B_1$
\noLine
\UnaryInf$\fCenter \ldots$
\noLine
\UnaryInf$\fCenter \Gamma \vdash b_k : B_k[y_1 \repl b_1, \ldots y_{k-1} \repl b_{k-1}]$
\BinaryInfC{$\Gamma \vdash coe^{l'}_1(\lambda x\,y_1 \ldots y_k.\,D, d, i, b_1, \ldots b_k) \deq d[b_1, \ldots b_k]$}
\DisplayProof
\end{center}

If we have heterogeneous path types, then we can define $coe^{l'}_0 + \sigma^l + sq$ in terms of $coe_0 + \sigma + sq$ and $coe^{l'}_1 + \sigma^l$ in terms of $coe_1 + \sigma$.
We can define map $coe^{l'}_1 \to coe^{l'}_0$ as before:
\[ coe^{l'}_1(\lambda x\,y_1 \ldots y_k.\,D, d, i, b_1, \ldots b_k) = coe^{l'}_0(\lambda x\,y_1 \ldots y_k.\,D[x := sq(x,i)], d, b_1, \ldots b_k) \]
Since we already know that there are maps going in both directions between $coe_0 + \sigma + sq$ and $coe_1 + \sigma$,
we just need to construct a map $coe^{l'}_0 + \sigma^l + sq + Path \to coe_0 + \sigma + sq + Path$.

To do this, first we define a map $coe_2 \to coe_0 + \sigma + sq + Path$:
\[ coe_2(\lambda x.\,D, i, d, j)  = coe_0(\lambda x.\,D[x \repl dc'(i,j,x)], d) \]
This definition of $coe_2$ satisfies additional axiom:
\[ \Gamma \vdash coe_2(\lambda x.\,D, right, d, right) \deq d \]
Now, we can define $coe^{l'}_0(\lambda x\,y_1 \ldots y_k.\,D, d, b_1, \ldots b_m)$ as follows:
\[ coe_0(\lambda x.\,D[y_1 \repl b_1'(x), \ldots y_k \repl b_k'(x)], d[y_1 \repl b'_1(left), \ldots y_k \repl b'_k(left)]) \]
where $b'_m(z)$ equals to
\[ coe_2(\lambda x.\,B_m[y_1 \repl b_1'(x), \ldots y_{m-1} \repl b_{m-1}'(x)], right, b_m, z) \]

\subsection{Fillers}
\label{sec:fillers}

We already saw examples of two and three-dimensional filler operations.
Here we define theories $Fill^l_{tm}$ and $Fill^l_{ty}$ of (local) filler operations for terms and types respectively.
We will also construct morphisms between $Fill^l_{tm} + Path$ and $coe^l_1 + Path$;
we do not have an analogous construction for $Fill^l_{ty}$.
In this subsection we switch back to the presentation of terms using de Bruijn indices since it will be notationally more convenient.

First, let us introduce a bit of notation.
Recall that if $(a_1, \ldots a_k)$ is a morphism of contexts $\Gamma$ and $\Delta$ and $b : (p,k+m)$ is such that $\vdash ctx^m(b) \deq \Delta$,
then we have $s = subst^m(\Gamma, b, a_1, \ldots a_k) : (p,n+m)$ such that $\vdash ctx^m(s) \deq \Gamma$.
We will also denote $s$ by $(a_1, \ldots a_k)^*(b)$.
In particular, if $h : (p,n+1)$ is such that $\vdash ctx^n(h) \deq I$, then for every $c \in \{ left, right \}$, we have $c^*(h) = subst^n(\emptyCtx, h, c) : (ctx,n)$.
Also, if $a : (p,n)$, then let $I \times a = subst^n(I, a) : (p,n+1)$.

Now, we need to describe certain morphisms of contexts which corresponds to cubical faces.
For every $n,k \in \mathbb{N}$, $0 \leq i \leq k$, and $c \in \{ left, right \}$, let $[i = c]$ denote sequence $v_{n+k-1}, \ldots v_i, c, v_{i-1}, \ldots v_0$.
The idea is that if $\Gamma : (ctx,n)$, $a : (p,n+k+1+m)$, and $ctx^m(a) = (\Gamma, I^{k+1} \vdash)$,
then $[i = c]^*(a)$ corresponds to the left or right (depending on $c$) $i$-th face of $a$.
We will also need an operation that gives us degenerate cubes.
For every $\Gamma : (ctx,n)$, $a : (p,n+k+m)$ and $0 \leq i \leq k$,
let $\delta_i(a) = subst^m((\Gamma, I^{k+1} \vdash), a, v_{n+k}, \ldots v_{i+1}, v_{i-1}, \ldots v_0)$.

Now we can define regular theory $Fill^l_{tm}$.
It is the regularization of a theory that has function symbol $Fill^n_{(tm,n+k)} : (ty,n+k) \times (tm,n-1+k)^{2n-1} \to (tm,n+k)$
for every $n,k \in \mathbb{N}$, $n > 0$, and the following axioms:
\medskip
\begin{center}
\def\extraVskip{1pt}
\Axiom$\fCenter I^n, \Delta \vdash D\ type$
\noLine
\UnaryInf$\fCenter I^{n-1}, [i = c]^*(\Delta) \vdash d_{[i = c]} : [i = c]^*(D)$
\noLine
\UnaryInf$\fCenter [i_1 = c]^*(d_{[i_2 = c']}) = [i_2-1=c']^*(d_{[i_1=c]}),\ 0 \leq i_1 < i_2 \leq n-1$
\def\extraVskip{2pt}
\UnaryInf$\fCenter I^n, \Delta \vdash Fill^n_{(tm,n+k)}(D, d_{[n-1=left]}, d_{[n-1=right]}, \ldots d_{[0=left]}) : D$
\DisplayProof
\end{center}
where $Fill^n_{(tm,n+k)}$ has arguments of the form $d_{[i=c]}$ for every $0 \leq i < n$ and $c \in \{ left, right \}$ except for $d_{[0=right]}$.

\medskip
\begin{center}
\def\extraVskip{1pt}
\Axiom$\fCenter I^n, \Delta \vdash D\ type$
\noLine
\UnaryInf$\fCenter I^{n-1}, [i = c]^*(\Delta) \vdash d_{[i = c]} : [i = c]^*(D)$
\noLine
\UnaryInf$\fCenter [i_1 = c]^*(d_{[i_2 = c']}) = [i_2-1=c']^*(d_{[i_1=c]}),\ 0 \leq i_1 < i_2 \leq n-1$
\def\extraVskip{2pt}
\UnaryInf$\fCenter [i=c]^*(Fill^n_{(tm,n+k)}(D, d_{[n-1=left]}, d_{[n-1=right]}, \ldots d_{[0=left]})) = d_{[i=c]}$
\DisplayProof
\end{center}
\medskip

Theory $Fill^l_{ty}$ is defined analogously to $Fill^l_{tm}$ as the regularization
of a theory with function symbol $Fill^n_{(ty,n+k)} : (ctx,n+k) \times (ty,n-1+k)^{2n-1} \to (ty,n+k)$
for every $n,k \in \mathbb{N}$, $n > 0$, and the following axioms:
\medskip
\begin{center}
\def\extraVskip{1pt}
\Axiom$\fCenter I^n, \Delta \vdash ctx$
\noLine
\UnaryInf$\fCenter I^{n-1}, [i = c]^*(\Delta) \vdash D_{[i = c]}\ type$
\noLine
\UnaryInf$\fCenter [i_1 = c]^*(D_{[i_2 = c']}) = [i_2-1=c']^*(D_{[i_1=c]}),\ 0 \leq i_1 < i_2 \leq n-1$
\def\extraVskip{2pt}
\UnaryInf$\fCenter I^n, \Delta \vdash Fill^n_{(ty,n+k)}((I^n, \Delta \vdash), D_{[n-1=left]}, D_{[n-1=right]}, \ldots D_{[0=left]})\ type$
\DisplayProof
\end{center}

\medskip
\begin{center}
\def\extraVskip{1pt}
\Axiom$\fCenter I^n, \Delta \vdash ctx$
\noLine
\UnaryInf$\fCenter I^{n-1}, [i = c]^*(\Delta) \vdash D_{[i = c]}\ type$
\noLine
\UnaryInf$\fCenter [i_1 = c]^*(D_{[i_2 = c']}) = [i_2-1=c']^*(D_{[i_1=c]}),\ 0 \leq i_1 < i_2 \leq n-1$
\def\extraVskip{2pt}
\UnaryInf$\fCenter [i=c]^*(Fill^n_{(ty,n+k)}((I^n, \Delta \vdash), D_{[n-1=left]}, D_{[n-1=right]}, \ldots D_{[0=left]})) = D_{[i=c]}$
\DisplayProof
\end{center}

It is easy to define a map from $coe^l_1$ to $Fill^l_{tm}$:
\[ coe^l_1(D, d, i) = i^*(Fill^1(D, d)) \]
Now, let us construct a morphism $Fill^l_{tm} \to coe^l_1 + Path$.
We define terms $Fill^n_{(tm,n+k)}$ by induction on $n$.
Let $Fill^1_{(tm,1+k)}(D, d_{[0=left]}) = coe^l_1(I \times D, I \times d_{[0 = left]}, v_0)$.

\subsection{Univalence}

We will consider regular theory $UA$ under $coe_0$, which has additional symbol
\[ iso : (ty,n)^2 \times (tm,n+1)^4 \times (tm,n) \to (ty,n) \]

Axioms of this theory have a lot of premises, so we list them now.
We will denote by $S$ the following set of formulae:
\begin{align*}
\Gamma & \vdash A\ type \\
\Gamma & \vdash B\ type \\
\Gamma, x : A & \vdash f : B \\
\Gamma, y : B & \vdash g : A \\
\Gamma, x : A, i : I & \vdash p : A \\
\Gamma, x : A & \vdash p[i \repl left] \deq g[y \repl f] \\
\Gamma, x : A & \vdash p[i \repl right] \deq x \\
\Gamma, y : B, i : I & \vdash q : B \\
\Gamma, y : B & \vdash q[i \repl left] \deq f[x \repl g] \\
\Gamma, y : B & \vdash q[i \repl right] \deq y
\end{align*}
If we have path types, then the last six axioms can be replaced with the following two:
\begin{align*}
\Gamma, x : A & \vdash p : g[y \repl f] = x \\
\Gamma, y : B & \vdash q : f[x \repl g] = y
\end{align*}

Now, we can define axioms of $UA$:
\medskip
\begin{center}
\AxiomC{$S$}
\AxiomC{$\Gamma \vdash j : I$}
\BinaryInfC{$\Gamma \vdash iso(A, B, \lambda x.\,f, \lambda y.\,g, \lambda x i.\,p, \lambda y i.\,q, j)\ type$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$S$}
\UnaryInfC{$\Gamma \vdash iso(A, B, \lambda x.\,f, \lambda y.\,g, \lambda x i.\,p, \lambda y i.\,q, left) \deq A$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$S$}
\UnaryInfC{$\Gamma \vdash iso(A, B, \lambda x.\,f, \lambda y.\,g, \lambda x i.\,p, \lambda y i.\,q, right) \deq B$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$S$}
\UnaryInfC{$\Gamma \vdash coe_0(\lambda j.\,iso(A, B, \lambda x.\,f, \lambda y.\,g, \lambda x i.\,p, \lambda y i.\,q, j), a) \deq f[x \repl a]$}
\DisplayProof
\end{center}
\medskip

This theory is similar to the univalence axiom, but it is defined for all types.
The univalence axiom for a universe follows from the assumption that this universe is closed under $iso$.

\section{A model structure on models of theories with an interval type}

In this section we construct a model structure on the category of models of an algebraic type theory with enough additional structure.
Let $T$ be a regular theory under $I$.
Then we define a model structure on the category of models of $T$.
To do this, we will need the following theorem from \cite{f-model-structures}:
\begin{thm}
Let $\C$ be a complete and cocomplete category, and let $\I$ be a set of maps of $\C$
such that the domains and the codomains of maps in $\I$ are cofibrant and small relative to $\Icell$.
For every $i : U \to V \in \I$, choose a reflexive relative cylinder object $C_U(V)$
such that $[\cyli_0,\cyli_1] : V \amalg_U V \to C_U(V) \in \Icof$.
Let $\J_\I = \{\ \cyli_0 : V \to C_U(V)\ |\ i : U \to V \in \I \ \}$, and
let $\we_\I$ be the set of maps which have RLP up to $\sim_i$ with respect to every $i \in \I$.

Suppose that for every object $X$, there exists a reflexive path object $P(X)$ such that the following conditions hold:
\begin{enumerate}
\item $p_0$ has RLP with respect to $\I$.
\item For every $f : X \to Y$, there exists a morphism of path objects $(f,P(f)) : P(X) \to P(Y)$,
\item For every object $X$, there exists a map $s : P(X) \to P(X)$ such that $p_0 \circ s = p_1$ and $p_1 \circ s = p_0$.
\item Maps $\langle p_0, p_1 \rangle : P(X) \to X \times X$ have RLP with respect to $\J_\I$.
\end{enumerate}
Then there exists a cofibrantly generated model structure on $\C$ with $\I$ as a set of generating cofibrations,
$\J_\I$ as a set of generating trivial cofibrations, and $\we_\I$ as a class of weak equivalences.
\end{thm}

Now, we want to define the set of generating cofibrations.
We will see later that we can take smaller sets to get different (or, in some cases, the same) classes of cofibrations.
We will show that even if the class of cofibrations is different,
the model structure will often have the same class of weak equivalences.

First, let us introduce a bit of notation.
Recall that if $(a_1, \ldots a_k)$ is a morphism of contexts $\Gamma$ and $\Delta$ and $b \in X_{(p,k+m)}$ is such that $ctx^m(b) = \Delta$,
then we have $s = subst^m(\Gamma, b, a_1, \ldots a_k) \in X_{(p,n+m)}$ such that $ctx^m(s) = \Gamma$.
We will also denote $s$ by $(a_1, \ldots a_k)^*(b)$.
In particular, if $h \in X_{(p,n+1)}$ is such that $ctx^n(h) = I$, then for every $c \in \{ left, right \}$, we have $c^*(h) = subst^n(\emptyCtx, h, c) \in X_{(ctx,n)}$.
Also, if $a \in X_{(p,n)}$, then let $I \times a = subst^n(I, a) \in X_{(p,n+1)}$.

To define generating cofibrations, we first need to describe certain morphisms of contexts which corresponds to cubical faces.
For every $n,k \in \mathbb{N}$, $0 \leq i \leq k$, and $c \in \{ left, right \}$, let $[i = c]$ denote sequence $v_{n+k-1}, \ldots v_i, c, v_{i-1}, \ldots v_0$.
The idea is that if $\Gamma : (ctx,n)$, $a : (p,n+k+1+m)$, and $ctx^m(a) = (\Gamma, I^{k+1} \vdash)$,
then $[i = c]^*(a)$ corresponds to the left or right (depending on $c$) $i$-th face of $a$.
Here, $\Gamma, I^k, \Delta \vdash$ denotes $\Gamma, I, \ldots I, \Delta \vdash$, where $I$ is repeated $k$ times.

We will also need an operation that gives us degenerate cubes.
Let $\Gamma : (ctx,n)$, and $a : (p,n+k+m)$ are such that $ctx^m(a) = (\Gamma, I^k \vdash)$.
Then for every $0 \leq i \leq k$, let $\delta_i(a) = subst^m((\Gamma, I^{k+1}), a, v_{n+k}, \ldots v_{i+1}, v_{i-1}, \ldots v_0)$.

Now, we are ready to define generating cofibrations:
\[ i^k_{(tm,n)} : F(\{\,I^k, \Gamma \vdash A\ type\,\} \cup S^k_{(tm,n)}) \to F(\{\,I^k, \Gamma \vdash a : A\,\}), \]
where $S^k_{(tm,n)} = \{\,I^{k-1}, [i = c]^*(\Gamma) \vdash a_{[i = c]} : [i = c]^*(A)\ |\ 0 \leq i < k,\ c \in \{ left, right \}\,\}$.
\[ i^k_{(ty,n)} : F(\{\,I^k, \Gamma \vdash A\,\} \cup S^k_{(ty,n)}) \to F(\{\,I^k, \Gamma \vdash A\ type\,\}), \]
where $S^k_{(ty,n)} = \{\,I^{k-1}, [i = c]^*(\Gamma) \vdash A_{[i = c]}\ type\ |\ 0 \leq i < k,\ c \in \{ left, right \}\,\}$.

\begin{comment}
Now, we need to define relative cylinder objects for maps in $\I$.
First, let us define them for maps in $\I^0$.
Let $C^0_{(tm,n)} = F(\{\,h : (tm,n+1), A : (ty,n)\,\}, \{\,ty(h) = (I(ft(A)) \vdash A\!\!\uparrow)\,\})$.
Maps $\cyli_0, \cyli_1 : F(\{\,a : (tm,n)\,\}) \to C^0_{(tm,n)}$ are defined as $\cyli_0(a) = h[left]$ and $\cyli_1(a) = h[right]$,
and map $s : C^0_{(tm,n)} \to F(\{\,a : (tm,n)\,\})$ is defined as $s(h) = a\!\!\uparrow$, $s(A) = ty(a)$.

Let $C^0_{(ty,n)} = F(\{\,H : (ty,n+1)\,\}, \{\,ft(H) = I(ft^2(H))\,\})$.
Then $C^0_{(ty,n)}$ is a reflexive relative cylinder object for $F(\{\,A : (ty,n)\,\})$.
Maps $\cyli_0, \cyli_1 : F(\{\,A : (ty,n)\,\}) \to C^0_{(ty,n)}$ are defined as $\cyli_0(A) = H[left]$ and $\cyli_1(A) = H[right]$,
and map $s : C^0_{(ty,n)} \to F(\{\,A : (ty,n)\,\})$ is defined as $s(H) = A\!\!\uparrow$.

Note that two terms $a,a' \in Y_{(tm,n)}$ of the same type $A \in Y_{(ty,n)}$ are homotopic relative to $A$
if and only if there exists a term of type $a = a'$.
Two types $A,B \in Y_{(ty,n)}$ in the same context $\Gamma \in Y_{(ctx,n)}$ are homotopic relative to $\Gamma$
if and only if there exist terms $\Gamma, A \vdash b : B\!\!\uparrow$ and $\Gamma, B \vdash a : A\!\!\uparrow$
such that $a \circ b$ is homotopic to $v_0$ and $b \circ a$ is homotopic to $v_0$.

We can use $V^{k+2}_{p,n,m}$ as a cylinder object for $V^{k+1}_{p,n,m}$.
But since we need a relative cylinder object, we add new relations to $V^{k+2}_{p,n,m}$.
Note that $V^{k+1}_{p,n,m} \amalg_{U^{k+1}_{p,n,m}} V^{k+1}_{p,n,m}$ can be described as an object
generated by $\Gamma : (ctx,n)$, $a : (p,n+k+1+m)$, $a' : (p,n+k+1+m)$
and $a_{[i = c]} : (p,n+k+m)$ for every $0 \leq i \leq k$ and $c \in \{ left, right \}$,
with relations $ctx^m(a) = ctx^m(a') = (\Gamma, I^{k+1} \vdash)$ and $[i = c]^*(a) = [i = c]^*(a') = a_{[i = c]}$.
To define $C^{k+1}_{p,n,m}$, we add to these generators and relations one more generator $h : (p,n+k+2+m)$ and the following relations:
$ctx^m(h) = (\Gamma, I^{k+2} \vdash)$, $[k + 1 = left]^*(h) = a$, $[k + 1 = right]^*(h) = a'$ and $[i = c]^*(h) = \delta_k(a_{[i = c]})$.
Map $[\cyli_0,\cyli_1] : V^{k+1}_{p,n,m} \amalg_{U^{k+1}_{p,n,m}} V^{k+1}_{p,n,m} \to C^{k+1}_{p,n,m}$ is the obvious inclusion.
Map $s : C^{k+1}_{p,n,m} \to V^{k+1}_{p,n,m}$ is defined as follows:
$s(\Gamma) = \Gamma$, $s(a) = s(a') = a$, $s(a_{[i = c]}) = [i = c]^*(a)$ and $s(h) = \delta_{k+1}(a)$.

Cylinders for $i^{k+1}_{tm,n,-1}$ are defined similarly.
First, $V^{k+1}_{tm,n,-1} \amalg_{U^{k+1}_{tm,n,-1}} V^{k+1}_{tm,n,-1}$ can be described as an object
generated by $A : (ty,n)$, $a : (p,n+k+1)$, $a' : (p,n+k+1)$
and $a_{[i = c]} : (p,n+k)$ for every $0 \leq i \leq k$ and $c \in \{ left, right \}$,
with relations $ty(a) = ty(a') = (ft(A), I^{k+1} \vdash A\!\!\uparrow^{k+1})$ and $[i = c]^*(a) = [i = c]^*(a') = a_{[i = c]}$.
To define $C^{k+1}_{p,n,m}$, we add to these generators and relations one more generator $h : (p,n+k+2)$ and the following relations:
$ty(h) = (ft(A), I^{k+2} \vdash A\!\!\uparrow^{}k+2)$, $[k + 1 = left]^*(h) = a$, $[k + 1 = right]^*(h) = a'$ and $[i = c]^*(h) = \delta_k(a_{[i = c]})$.
Map $[\cyli_0,\cyli_1] : V^{k+1}_{tm,n,-1} \amalg_{U^{k+1}_{tm,n,-1}} V^{k+1}_{tm,n,-1} \to C^{k+1}_{tm,n,-1}$ is the obvious inclusion.
Map $s : C^{k+1}_{tm,n,-1} \to V^{k+1}_{tm,n,-1}$ is defined as follows:
$s(A) = A$, $s(a) = s(a') = a$, $s(a_{[i = c]}) = [i = c]^*(a)$ and $s(h) = \delta_{k+1}(a)$.

Let us show that for every $i \in \I$, map $[\cyli_0,\cyli_1] : V \amalg_U V \to C_U(V)$ belongs to $\Icof$.
Map $[\cyli_0,\cyli_1] : V^0_{(tm,n)} \amalg_{U^0_{(tm,n)}} V^0_{(tm,n)} \to C^0_{(tm,n)}$ is (isomorphic to) $i^1_{tm,n,-1}$.
Also, note that it is a pushout of $i^0_{(tm,n)}$:
\[ \xymatrix{ U^0_{(tm,n)} \ar[rr]^-{A \mapsto a = a'} \ar[d]_{i^0_{(tm,n)}} & & V^0_{(tm,n)} \amalg_{U^0_{(tm,n)}} V^0_{(tm,n)} \ar[d]^{[\cyli_0,\cyli_1]} \\
              V^0_{(tm,n)} \ar[rr]_-{a \mapsto path(h)}                      & & \po C^0_{(tm,n)}
            } \]
where $V^0_{(p,n)} \amalg_{U^0_{(p,n)}} V^0_{(p,n)}$ is defined as $F(\{\,a : (p,n), a' : (p,n)\,\}, \{\,d_p(a) = d_p(a')\,\})$.
Map $[\cyli_0,\cyli_1] : V^0_{(ty,n)} \amalg_{U^0_{(ty,n)}} V^0_{(ty,n)} \to C^0_{(ty,n)}$ is (isomorphic to) $i^1_{ty,n,0}$.

Maps of the form $i^{k+1}_{p,n,m}$ (including $i^{k+1}_{tm,n,-1}$) can be described as following pushouts:
\[ \xymatrix{ U^{k+2}_{p,n,m} \ar[r]^-g \ar[d]_{i^{k+2}_{p,n,m}} & V^{k+1}_{p,n,m} \amalg_{U^{k+1}_{p,n,m}} V^{k+1}_{p,n,m} \ar[d]^{[\cyli_0,\cyli_1]} \\
              V^{k+2}_{p,n,m} \ar[r]_-{a \mapsto h}              & \po C^{k+1}_{p,n,m}
            } \]
where $g(a_{[k + 1 = left]}) = a$, $g(a_{[k + 1 = right]}) = a'$, $g(a_{[i = c]}) = \delta_k(a_{[i = c]})$.

Now, for every stable theory $(T,\alpha)$ under $I$, we define a functor $P : \Mod{T} \to \Mod{T}$.
Let $P(X)_{(p,n)} = \{\,a \in P(X)_{(p,n+1)}\ |\ ctx^n(a) = I\,\}$.
For every function and predicate symbol $S$, let $P(X)(S)(a_1, \ldots a_k)$ as $X(\alpha(L(S)))(a_1, \ldots a_k)$.
Since $\alpha$ preserves theorems, this definition satisfies axioms of $T$; hence it is a correct definition of a model of $T$.
For every morphism of models $f : X \to Y$, let $P(f)(a) = f(a)$.
The fact that $f$ is a morphism of models implies that $P(f)$ is a morphism too.
It is obvious that $P$ preserves identity morphisms and compositions.

To define the structure of a path object on $P(X)$, we need to assume that $(T,\alpha)$ is regular.
In this case, we define $t : X \to P(X)$ as $t(a) = I \times a$, and $p_0,p_1 : P(X) \to X$ as $p_0(a) = left^*(a)$ and $right^*(a)$ respectively.
The regularity conidition ensures that function and predicate symbols are stable under operations $I \times -$ and $c^*(-)$.
Hence these definitions indeed determine morphisms of models.
The fact that $p_0 \circ t = p_1 \circ t = id_X$ follows from properties of operation $subst^n$.
We also define $s : P(X) \to P(X)$ as $s(a) = subst^n(I, a, inv(v_0))$.
Then $p_0 \circ s = p_1$ and $p_1 \circ s = p_0$.

Let us prove that $p_0 : P(X) \to X$ has RLP with respect to $\I$.
\todo{Rewrite this}
Given a type $I, \Gamma \vdash H$ and a term $left^*(\Gamma) \vdash a : left^*(H)$ in $X$,
we need to find a term $I, \Gamma \vdash h : H$ such that $left^*(h) = a$.
We can define $h$ as $coe'(I \times H, I \times a, v_0)$.
Given a context $I, \Gamma$ and a type $left^*(\Gamma) \vdash A$,
we need to find a type $I, \Gamma \vdash H$ such that $left^*(H) = A$.

Finally, let us prove that $\langle p_0, p_1 \rangle$ has RLP with respect to $\J_\I$.
\todo{Finish this}
\end{comment}

\begin{comment}
We will define several sets of maps that can be used as generating cofibrations.
Some of these sets work in a more general theories,
but if we assume that the theory we are working with has some additional constructions,
then we can use smaller sets of generating cofibrations.
These sets define several model structures, but in most cases the classes of weak equivalences are equal.

Let $i^0_{(ctx,n)}$ be the unique map $0 \to F(\{\,\Gamma : (ctx,n)\,\})$.
Let $\I^k_p$ be the set of maps of the form $i^k_{(p,n)}$.
Let $\I^k_p = \{\,i^k_{(p,n)}\ |\ n \in \mathbb{N}\,\}$ and $\I_{(p,n)} = \{\,i^k_{(p,n)}\ |\ k \in \mathbb{N}\,\}$.

Now, we need to define more generating cofibrations.
There are at least two natural ways in which we can try to define them: using either globular or cubical shapes.
First, let us describe the cubical generating cofibrations.
Define objects $V^{\square^k}_{(p,n)}$ as follows:
\begin{align*}
V^{\square^k}_{(tm,n)} & = F(\{\,a : (tm,n+k)\,\}, \{\,ctx(a) = (ctx^k(a), I^k \vdash)\,\}) \\
V^{\square^k}_{(ty,n)} & = F(\{\,A : (ty,n+k)\,\}, \{\,ctx(A) = (ctx^k(A), I^k \vdash)\,\}) \\
V^{\square^k}_{(ctx,n)} & = F(\{\,\Gamma : (ctx,n+k)\,\}, \{\,ctx^n(\Gamma) = (I^k \vdash)\,\})
\end{align*}
where $\Gamma, I^k \vdash$ is defined as $\Gamma, I, \ldots I$, where $I$ is repeated $k$ times.

\begin{prop}
The classes of cofibrations generated by $\I$ and $\I_{tm} \cup \I_{ty}$ are equal.
\end{prop}
\begin{proof}
Every map $0 \to F(\{\,\Gamma : (ctx,n)\,\})$ in $\I_{ctx}$ is a finite composition $0 = F(\{\,\Gamma : (ctx,0)\,\}) \to F(\{\,\Gamma : (ctx,1)\,\}) \to \ldots \to F(\{\,\Gamma : (ctx,n)\,\})$ of maps in $\I_{ty}$.
\todo{Prove the converse}
\end{proof}

Let $C_{(ctx,n)} = F(\{\,H : (ctx,n+1)\,\}, \{\,ctx^n(H) = I\,\})$.
Then $C_{(ctx,n)}$ is a reflexive relative cylinder object for $F(\{\,\Gamma : (ctx,n)\,\})$.
Maps $\cyli_0, \cyli_1 : F(\{\,\Gamma : (ctx,n)\,\}) \to C_{(ctx,n)}$ are defined as $\cyli_0(\Gamma) = left^*(\Gamma)$ and $\cyli_1(A) = right^*(\Gamma)$,
and map $s : C_{(ty,n)} \to F(\{\,A : (ty,n)\,\})$ is defined as $s(H) = I \times \Gamma$.

We can rephrase the definition of weak equivalences in more concrete terms.
\begin{enumerate}
\item We will say that $f : X \to Y$ is \emph{essentially surjective on terms} if
for every type $A \in X_{(ty,n)}$ and every term $a \in Y_{(tm,n)}$ of type $f(A)$,
there exists a term $a' \in X_{(tm,n)}$ of type $A$ such that $f(a')$ and $a$ are homotopic relative to $f(A)$.
\item We will say that $f : X \to Y$ is \emph{essentially surjective on types} if
for every context $\Gamma \in X_{(ctx,n)}$ and every type $A \in Y_{(ty,n)}$ in context $f(\Gamma)$,
there exists a type $A' \in X_{(ty,n)}$ in context $\Gamma$ such that $f(A')$ and $A$ are homotopic relative to $f(\Gamma)$.
\item We will say that $f : X \to Y$ is \emph{essentially surjective on contexts} if
for every context $\Gamma \in Y_{(ctx,n)}$, there exists a context $\Gamma' \in X_{(ty,n)}$ such that $f(\Gamma')$ and $\Gamma$ are homotopic.
\end{enumerate}
A map is a weak equivalence if and only if it is essentially surjective on terms and contexts.
Propositions \todo{Which propositions?} imply that this is equivalent to the condition that it is essentially surjective on terms and types.

If $H = (I, A_1, \ldots A_n \vdash) \in X_{(ctx,n+1)}$, then for every $c \in \{ left, right \}$, let $c^*(H) = (A_1[c], \ldots A_n[c] \vdash) \in X_{(ctx,n)}$.
A \emph{homotopy between} contexts $\Gamma,\Delta \in X_{(ctx,n)}$ is a context $H \in X_{(ctx,n+1)}$ such that $\vdash ft^n(H) \equiv I$, $left^*(H) = \Gamma$ and $right^*(H) = \Delta$.
Contexts $\Gamma$ and $\Delta$ are \emph{homotopic} if there is a homotopy between them.
In this case we will write $\Gamma \sim \Delta$.

A \emph{relative homotopy between} types $(\Gamma \vdash A), (\Gamma \vdash B) \in X_{(ty,n)}$ is a type $(\Gamma, I \vdash H) \in X_{(ty,n+1)}$ such that $H[left] = A$ and $H[right] = B$.
Types $A$ and $B$ are \emph{homotopic relative to $(ctx,n)$} if there is a relative homotopy between them.
In this case we will write $A \sim_r B$.

A \emph{relative homotopy between} terms $(\Gamma \vdash a : A), (\Gamma \vdash b : A) \in X_{(tm,n)}$ is a term $(\Gamma, I \vdash h : A\!\uparrow) \in X_{(tm,n+1)}$ such that $h[left] = a$ and $h[right] = b$.
Terms $a$ and $b$ are \emph{homotopic relative to $(ty,n)$} if there is a relative homotopy between them.
In this case we will write $a \sim_r b$.

\begin{remark}[types-hom-ua]
To define a relative homotopy between types $(\Gamma \vdash A), (\Gamma \vdash B) \in X_{(ty,n)}$,
    it is enought to specify terms $(\Gamma, A \vdash f : B\!\uparrow), (\Gamma, B \vdash g : A\!\uparrow) \in X_{(tm,n+1)}$
    such that $g \circ f \sim_r v_0(A)$ and $f \circ g \sim_r v_0(B)$.
Then we can define a relative homotopy $\Gamma, I \vdash iso(A\!\uparrow, B\!\uparrow, f\!\uparrow_1, g\!\uparrow_1, path(h_1\!\!\uparrow_2), path(h_2\!\!\uparrow_2), v_0)$ between $A$ and $B$,
    where $h_1$ is a relative homotopy between $g \circ f$ and $v_0(A)$, and $h_2$ is a relative homotopy between $f \circ g$ and $v_0(B)$.
\end{remark}

There is a bijection between morphisms $F(\{\,A : (p,n)\,\}) \to X$ and elements of $X_{(p,n)}$.
We can directly describe homotopies between morphisms $f,g : F(\{\,A : (p,n)\,\}) \to X$.
For this, we define (relative) cylinder objects $C$ together with maps $i^0,i^1 : F(\{\,A : (p,n)\,\}) \to C$.
Then a homotopy between $f$ and $g$ can be described as a map $h : C \to X$ such that $h \circ i^0 = f$ and $h \circ i^1 = g$.

A \emph{cylinder object} of sort $(ctx,n)$ is $F(\{\,H : (ctx,n+1)\,\}, \{\,ft^n(H) = I(\emptyCtx)\,\})$.
We will denote this object by $Cyl_{(ctx,n)}$.
Inclusions $i^0_{(ctx,n)}, i^1_{(ctx,n)} : F(\{\,\Gamma : (ctx,n)\,\}) \to Cyl_{(ctx,n)}$ are defined as $i^k_{(ctx,n)}(\Gamma) = c_k^*(H)$, where $c_0 = left$ and $c_1 = right$.

\begin{remark}
A relative homotopy between $f,g : F(\{\,A : (p,n)\,\}) \to X$ exists only if $f \circ \delta_{(p,n)} = g \circ \delta_{(p,n)}$, and in this case a homotopy $h$ is a map such that the following triangle commutes:
\[ \xymatrix{ F(\{\,a : (p,n)\,\}) \amalg_{F(\{\,A : (e(p),n)\,\})} F(\{\,a : (p,n)\,\}) \ar[d]_{[i^0,i^1]} \ar[r]^-{[f,g]} & X \\
              RCyl_{(p,n)} \ar@{-->}[ur]_h
            } \]
\end{remark}

Given two morphisms $f \in \I$ and $g : X \to Y$, we say that $f$ \emph{has the left lifting property (LLP) up to $\sim_r$} with respect to $g$,
and $g$ \emph{has the right lifting property (RLP) up to $\sim_r$} with respect to $f$ if for every commutative square of the form
\[ \xymatrix{ F(\{\,A : (e(p),n)\,\}) \ar[r]^-u \ar@{}[dr]|(.7){\sim_r} \ar[d]_f & X \ar[d]^g \\
              F(\{\,a : (p,n)\,\}) \ar[r]_-v \ar@{-->}[ur]^h                     & Y,
            } \]
there is a dotted arrow $h : F(\{\,a : (p,n)\,\}) \to X$ such that $h \circ f = u$ and $(g \circ h) \sim_r v$.
We define the set $\we$ of weak equivalences as the set of maps that have RLP up to $\sim_r$ with respect to every map in $\I$.
Thus a map $g : X \to Y$ is a weak equivalence if and only if the following conditions are satisfied:
\begin{enumerate}
\item For every context $\Gamma \in X_{(ctx,n)}$ and every type $A \in Y_{(ty,n)}$ in context $g(\Gamma)$, there exists a type $A' \in X_{(ty,n)}$ in context $\Gamma$ such that $g(A')$ and $A$ are homotopic relative to $(ctx,n)$.
    This is true if and only if $g$ has RLP up to $\sim_r$ with respect to every map in $\I_{ty}$.
    In this case we will say that $g$ is \emph{essentially surjective on types}.
\item For every type $A \in X_{(ty,n)}$ and every term $a \in Y_{(tm,n)}$ of type $g(A)$, there exists a term $a' \in X_{(tm,n)}$ of type $A$ such that $g(a')$ and $a$ are homotopic relative to $(ty,n)$.
    This is true if and only if $g$ has RLP up to $\sim_r$ with respect to every map in $\I_{tm}$.
    In this case we will say that $g$ is \emph{essentially surjective on terms}.
\end{enumerate}

\begin{prop}[hom-eq]
Relation $\sim_r$ is reflexive, symmetric, transitive and preserved by morphisms.
\end{prop}
\begin{proof}
If $h$ is a homotopy between $a$ and $b$, then $k(h)$ is a homotopy between $k(a)$ and $k(b)$.

If $(\Gamma \vdash A) \in X_{(p,n)}$, then $\Gamma, I \vdash A\!\uparrow$ is a homotopy between $A$ and $A$.

Let $h_1, h_2 : RCyl_{(tm,n)}(h) \to X$ be relative homotopies such that $h_1 \circ i^1 = h_2 \circ i^0$.
Then we define a relative homotopy $h_3$ between $h_1 \circ i^0$ and $h_2 \circ i^1$.
Let $h_3(h) = (ctx(h_1(h)) \vdash at(h_1[left]\!\uparrow, h_2[right]\!\uparrow, coe(Path(ty(h_1), h_1[left]\!\uparrow, h_2), path(h_1), right)\!\uparrow, v_0))$.

Let $H_1, H_2 : RCyl_{(ty,n)}(H) \to X$ be relative homotopies such that $H_1 \circ i^1 = H_2 \circ i^0$.
Then we define a relative homotopy $H_3$ between $H_1 \circ i^0$ and $H_2 \circ i^1$.
Let $H_3(H) = $.
\todo{Finish the proof}
\end{proof}

\begin{lem}
Let $k : X \to Y$ be a weak equivalence.
If $a,b \in X_{(p,n)}$ are such that $k(f) \sim_r k(g)$, then $a \sim_r b$.
\end{lem}
\begin{proof}
\todo{Write the proof}
\end{proof}

\begin{lem}[hom-ext][Homotopy extension property]
Let $f : F(\{\,\Gamma : (e(p),n)\,\}) \to F(\{\,A : (p,n)\,\}) \in \I$, $u : U \to X$, and $v : V \to X$ be maps such that $u \sim^r v \circ i$.
Then there exists a map $v' : V \to X$ such that $u = v' \circ i$ and $v' \sim v$.
\end{lem}

\begin{lem}
If $f : X \to Y$ is essentially surjective on types, then it is essentially surjective on context.
That is, for every $\Gamma \in Y_{(ctx,n)}$, there is a context $\Gamma' \in X_{(ctx,n)}$ such that $f(\Gamma') \sim \Gamma$.
\end{lem}
\begin{proof}
If $n = 0$, then $\Gamma = \emptyCtx$, and we can take $\Gamma' = \emptyCtx$.
If $n > 0$, then let $\Delta = ft(\Gamma)$.
There exists a context $\Delta' \in X_{(ctx,n-1)}$ such that $f(\Delta') \sim \Delta$.
By \rlem{hom-ext}, there exists
\end{proof}
\end{comment}

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
