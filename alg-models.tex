\documentclass[reqno]{amsart}

\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{verbatim}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{turnstile}
\usepackage{etex}
\usepackage{todonotes}

\hypersetup{colorlinks=true,linkcolor=blue}

\renewcommand{\turnstile}[6][s]
    {\ifthenelse{\equal{#1}{d}}
        {\sbox{\first}{$\displaystyle{#4}$}
        \sbox{\second}{$\displaystyle{#5}$}}{}
    \ifthenelse{\equal{#1}{t}}
        {\sbox{\first}{$\textstyle{#4}$}
        \sbox{\second}{$\textstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{s}}
        {\sbox{\first}{$\scriptstyle{#4}$}
        \sbox{\second}{$\scriptstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{ss}}
        {\sbox{\first}{$\scriptscriptstyle{#4}$}
        \sbox{\second}{$\scriptscriptstyle{#5}$}}{}
    \setlength{\dashthickness}{0.111ex}
    \setlength{\ddashthickness}{0.35ex}
    \setlength{\leasturnstilewidth}{2em}
    \setlength{\extrawidth}{0.2em}
    \ifthenelse{%
      \equal{#3}{n}}{\setlength{\tinyverdistance}{0ex}}{}
    \ifthenelse{%
      \equal{#3}{s}}{\setlength{\tinyverdistance}{0.5\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{d}}{\setlength{\tinyverdistance}{0.5\ddashthickness}
        \addtolength{\tinyverdistance}{\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{t}}{\setlength{\tinyverdistance}{1.5\dashthickness}
        \addtolength{\tinyverdistance}{\ddashthickness}}{}
        \setlength{\verdistance}{0.4ex}
        \settoheight{\lengthvar}{\usebox{\first}}
        \setlength{\raisedown}{-\lengthvar}
        \addtolength{\raisedown}{-\tinyverdistance}
        \addtolength{\raisedown}{-\verdistance}
        \settodepth{\raiseup}{\usebox{\second}}
        \addtolength{\raiseup}{\tinyverdistance}
        \addtolength{\raiseup}{\verdistance}
        \setlength{\lift}{0.8ex}
        \settowidth{\firstwidth}{\usebox{\first}}
        \settowidth{\secondwidth}{\usebox{\second}}
        \ifthenelse{\lengthtest{\firstwidth = 0ex}
            \and
            \lengthtest{\secondwidth = 0ex}}
                {\setlength{\turnstilewidth}{\leasturnstilewidth}}
                {\setlength{\turnstilewidth}{2\extrawidth}
        \ifthenelse{\lengthtest{\firstwidth < \secondwidth}}
            {\addtolength{\turnstilewidth}{\secondwidth}}
            {\addtolength{\turnstilewidth}{\firstwidth}}}
        \ifthenelse{\lengthtest{\turnstilewidth < \leasturnstilewidth}}{\setlength{\turnstilewidth}{\leasturnstilewidth}}{}
    \setlength{\turnstileheight}{1.5ex}
    \sbox{\turnstilebox}
    {\raisebox{\lift}{\ensuremath{
        \makever{#2}{\dashthickness}{\turnstileheight}{\ddashthickness}
        \makehor{#3}{\dashthickness}{\turnstilewidth}{\ddashthickness}
        \hspace{-\turnstilewidth}
        \raisebox{\raisedown}
        {\makebox[\turnstilewidth]{\usebox{\first}}}
            \hspace{-\turnstilewidth}
            \raisebox{\raiseup}
            {\makebox[\turnstilewidth]{\usebox{\second}}}
        \makever{#6}{\dashthickness}{\turnstileheight}{\ddashthickness}}}}
        \mathrel{\usebox{\turnstilebox}}}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{#3~\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\expandafter\newcommand\csname n#2\endcsname[1]{\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{theorem}{Theorem}
\newref{lem}{lemma}{Lemma}
\newref{prop}{proposition}{Proposition}
\newref{cor}{corollary}{Corollary}
\newref{cond}{condition}{Condition}

\theoremstyle{definition}
\newref{defn}{definition}{Definition}
\newref{example}{example}{Example}

\theoremstyle{remark}
\newref{remark}{remark}{Remark}

\newcommand{\deq}{\equiv}
\newcommand{\cat}[1]{\mathbf{#1}}
\newcommand{\C}{\cat{C}}
\newcommand{\PAlg}[1]{#1\text{-}\cat{PAlg}}
\newcommand{\Mod}[1]{#1\text{-}\cat{Mod}}
\newcommand{\Th}{\cat{Th}}
\newcommand{\algtt}{\cat{AlgTT}}
\newcommand{\ThC}{\Th_{\mathcal{C}}}
\newcommand{\emptyCtx}{\mathbf{1}}
\newcommand{\tta}{\mathbb{T}_0}
\newcommand{\tts}{\mathbb{T}_1}

\newcommand{\we}{\mathcal{W}}
\newcommand{\fib}{\mathcal{Fib}}
\newcommand{\cof}{\mathcal{Cof}}
\newcommand{\I}{\mathrm{I}}
\newcommand{\J}{\mathrm{J}}
\newcommand{\class}[2]{#1\text{-}\mathrm{#2}}
\newcommand{\Iinj}[1][\I]{\class{#1}{inj}}
\newcommand{\Icell}[1][\I]{\class{#1}{cell}}
\newcommand{\Icof}[1][\I]{\class{#1}{cof}}
\newcommand{\Jinj}[1][]{\Iinj[\J#1]}
\newcommand{\Jcell}[1][]{\Icell[\J#1]}
\newcommand{\Jcof}[1][]{\Icof[\J#1]}

\numberwithin{figure}{section}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\begin{document}

\title{Models of Algebraic Dependent Type Theories}

\author{Valery Isaev}

\begin{abstract}
\end{abstract}

\maketitle

 \makeatletter
    \providecommand\@dotsep{5}
  \makeatother
  \listoftodos\relax

\section{Introduction}

\section{Properties of categories of theories and their models}

It was shown in \cite{PHL} that partial Horn theories are equivalent to essentially algebraic theories.
It follows that categories of models of these theories are locally presentable.
In this section we will prove that the category of partial Horn theories are also locally finitely presentable.
We will also show that the category of models of $\mathbb{T}$ is a coreflective full subcategory of theories under $\mathbb{T}$.

\subsection{The category of theories}

Let $\lambda$ be a regular cardinal.
We will say that a partial Horn theory $\mathbb{T}$ is \emph{$\lambda$-small} if cardinalities of
sets of functions symbols, predicate symbols and axioms of $\mathbb{T}$ are less than $\lambda$.
We will say that $\mathbb{T}$ is \emph{finite} if it is $\omega$-small.

\begin{prop}
If $\mathbb{T}$ is $\lambda$-small, then it is $\lambda$-presentable.
\end{prop}
\begin{proof}
Let $colim_{i \in I} \mathbb{T}_i$ be a directed colimit of theories.
We can construct such colimit as a coequalizer of the coproduct $\coprod_{i \in I} \mathbb{T}_i$.
The construction of coproducts and coequalizers was described in \cite{alg-tt}.
Thus we can assume that the sets of function and predicate symbols $colim_{i \in I} \mathbb{T}_i$ are disjoint unions of the corresponding sets of $\mathbb{T}_i$.
The axioms of $colim_{i \in I} \mathbb{T}_i$ are axioms of $\mathbb{T}_i$ together with axioms of the form $\sststile{}{x_1, \ldots x_n} \sigma(x_1, \ldots x_n) \cong f(\sigma(x_1, \ldots x_n))$
and $R(x_1, \ldots x_n) \ssststile{}{x_1, \ldots x_n} f(R(x_1, \ldots x_n))$ for every morphism $f : \mathbb{T}_i \to \mathbb{T}_j$ in the diagram and every function symbol $\sigma$ and predicate symbol $R$ of $\mathbb{T}_i$.

Every term and every formula of a theory is constructed from a finite number of function and predicate symbols.
Thus for every formula of $colim_{i \in I} \mathbb{T}_i$ there exists a theory $\mathbb{T}_i$ such that this formula belongs to $\mathbb{T}_i$.
The same is true for terms and partial terms.

Every derivation of a theorem $\varphi \sststile{}{V} \psi$ is constructed from a finite number of function symbols, predicate symbols and axioms.
Thus for every theorem $\varphi \sststile{}{V} \psi$ of $colim_{i \in I} \mathbb{T}_i$ there exists a theory $\mathbb{T}_i$ such that $\varphi \sststile{}{V} \psi$ is a theorem of $\mathbb{T}_i$.
Note that the additional axioms of $colim_{i \in I} \mathbb{T}_i$ that was added for every $f : \mathbb{T}_i \to \mathbb{T}_j$ are always true in $\mathbb{T}_j$.

Let $h : \mathbb{T} \to colim_{i \in I} \mathbb{T}_i$ be a morphism from a $\lambda$-small theory $\mathbb{T}$ to a directed colimit of theories $\{ \mathbb{T}_i \}_{i \in I}$.
Since $\mathbb{T}$ is $\lambda$-small, there exists a theory $\mathbb{T}_i$ such that for every function symbol $\sigma$, predicate symbol $R$ and axiom $\varphi \sststile{}{V} \psi$ of $\mathbb{T}$,
partial terms $h(\sigma(x_1, \ldots x_n))$ and formulae $h(R(x_1, \ldots x_n))$ belong to $\mathbb{T}_i$, and $h(\varphi) \sststile{}{V} f(\psi)$ is a theorem of $\mathbb{T}$.
Thus $h$ factors through $\mathbb{T}_i$.

Let $h_1,h_2 : \mathbb{T} \to \mathbb{T}_i$ be morphisms such that $g_i \circ h_1 = g_i \circ h_2$, where $g_i : \mathbb{T}_i \to colim_{i \in I} \mathbb{T}_i$.
Then for every function symbol $\sigma$ of $\mathbb{T}$, $\sststile{}{x_1, \ldots x_n} h_1(\sigma(x_1, \ldots x_n)) \cong h_2(\sigma(x_1, \ldots x_n))$ is a theorem of $colim_{i \in I} \mathbb{T}_i$.
But we already know that there exists a theory $\mathbb{T}_j$ such that $i \leq j$ and this sequent is a theorem of $\mathbb{T}_j$.
The same is true for every predicate symbol of $\mathbb{T}$.
It follows that $f \circ h_1 = f \circ h_2$, where $f : \mathbb{T}_i \to \mathbb{T}_j$.
\end{proof}

\begin{prop}
The category $\Th_\mathcal{S}$ of partial Horn theories with sorts $\mathcal{S}$ is locally finitely presentable.
\end{prop}
\begin{proof}
It was shown in \cite{alg-tt} that $\Th_\mathcal{S}$ is cocomplete.
Thus by the previous proposition, we only need to show that every theory is a colimit of its finite subtheories.
Let $\mathbb{T}$ be a theory, and let $\{ f_i : \mathbb{T}_i \to \mathbb{T}' \}_{i \in I}$ be a cocone over the diagram of finite subtheories of $\mathbb{T}$.
For every function or predicate symbol $p$ of $\mathbb{T}$ there is a finite suntheory $\mathbb{T}_p$ of $\mathbb{T}$ which contains a single symbol $p$ and no axiom.
A morphism $h$ of cocones $\mathbb{T}$ and $\mathbb{T}'$ must commute with morphisms from $\mathbb{T}_p$.
Thus it must be defined as $h(p(x_1, \ldots x_n)) = f_p(p(x_1, \ldots x_n))$; hence it is unique.
To prove that this defines a morphism, we need to show that $h$ preserves axioms of $\mathbb{T}$.
But every axiom involes only a finite number of symbols of $\mathbb{T}$.
Hence there exists a subtheory $\mathbb{T}_i$ of $\mathbb{T}$ which consists of these symbols and this axiom.
Since $f_i$ is a morphism of theories, this axiom also holds in $\mathbb{T}'$.
\end{proof}

\subsection{The category of models}

Let $\mathbb{T} = ((\mathcal{S},\mathcal{F},\mathcal{P}),\mathcal{A})$ be a standard partial Horn theory and let $M = (A,\alpha,\beta)$ be its model.
If $\sigma \in \mathcal{F}$, $\sigma : s_1 \times \ldots \times s_k \to s$, then we will write $M(\sigma) : A_{s_1} \times \ldots A_{s_k} \to A_s$
    for the partial function defined as $M(\sigma)(a_1, \ldots a_k) = \alpha(x_i \mapsto a_i)(\sigma(x_1, \ldots x_k))$.
If $R \in \mathcal{P}$, $R : s_1 \times \ldots \times s_k$ then we will write $M(R)$ for the subset of $A_{s_1} \times \ldots A_{s_k}$,
    which consists of tuples $(a_1, \ldots a_k)$ such that $\beta(x_i \mapsto a_i)(R(x_1, \ldots x_k)) = \top$.

For every model $M$ of $\mathbb{T}$, we define a theory $Lang(M)$.
It has function and predicate symbols of $\mathbb{T}$ together with function symbol $O_a : s$ for every $a \in A_s$.
Axioms of $Lang(M)$ are axioms of $\mathbb{T}$ together with the following sequents:
\begin{align*}
& \sststile{}{} O_a \downarrow \\
& \sststile{}{} \sigma(O_{a_1}, \ldots O_{a_k}) = O_{M(\sigma)(a_1, \ldots a_k)} \\
& \sststile{}{} R(O_{a_1}, \ldots O_{a_k})
\end{align*}
for every $a \in A_s$, every $a_i \in A_{s_i}$,
every $\sigma \in \mathcal{F}$ such that $M(\sigma)(a_1, \ldots a_k)$ is defined,
and every $R \in \mathcal{P}$ such that $(a_1, \ldots a_k) \in M(R)$.

Models of $Lang(M)$ are just models of $\mathbb{T}$ together with a morphism from $M$.
That is, categories $M/\Mod{\mathbb{T}}$ and $\Mod{Lang(M)}$ are isomorphic.
In particular, $A$ has a natural structure of a model of $Lang(M)$ defined as follows:
\begin{align*}
\alpha'(f)(O_a) & = a \\
\alpha'(f)(\sigma(x_1, \ldots x_k)) & = \alpha(f)(\sigma(x_1, \ldots x_k)) \\
\beta'(f)(R(x_1, \ldots x_k)) & = \beta(f)(R(x_1, \ldots x_k))
\end{align*}

\begin{lem}[cl-term]
If $t \in Term_\mathcal{F}(\varnothing)_s$ is such that $\sststile{}{} t \downarrow$ is a theorem of $Lang(M)$,
    then there is a unique $a \in A_s$ such that $\sststile{}{} t = O_a$ is a theorem of $Lang(M)$.
\end{lem}
\begin{proof}
Since $(A,\alpha',\beta')$ is a model of $Lang(M)$, for every theorem $\varphi \sststile{}{V} \psi$ of $Lang(M)$
    and every total function $f : V \to A$, if $\beta'(f)(\varphi) = \top$, then $\beta'(f)(\psi) = \top$.
In particular, if $\sststile{}{} O_a = O_{a'}$, then $a = a'$.
Hence if $\sststile{}{} t = O_a$ and $\sststile{}{} t = O_{a'}$, then $a = a'$, so such $a$ is unique.

Let us prove its existence.
We do this by induction on $t$.
If $t = O_a$, then we are done.
If $t = \sigma(t_1, \ldots t_k)$, then by induction hypothesis, $\sststile{}{} t = \sigma(O_{a_1}, \ldots O_{a_k})$ for some $a_1$, \ldots $a_k$.
Note that if $\sststile{}{} \sigma(O_{a_1}, \ldots O_{a_k})\!\!\downarrow$ is derivable, then $M(\sigma)(a_1, \ldots a_k)$ is defined.
Thus $\sststile{}{} \sigma(O_{a_1}, \ldots O_{a_k}) = O_{M(\sigma)(a_1, \ldots a_k)}$ is also derivable.
\end{proof}

For every morphism $h : M \to N$ of models of $\mathbb{T}$, we can define a morphism $Lang(h) : Lang(M) \to Lang(N)$ of theories under $\mathbb{T}$ as $Lang(h)(O_a) = O_{h(a)}$.
Thus $Lang$ is a functor $\Mod{\mathbb{T}} \to \mathbb{T}/\Th_\mathcal{S}$.

\begin{prop}
$Lang$ is fully faithful.
\end{prop}
\begin{proof}
Let $h_1$, $h_2$ be morphisms of models such that $Lang(h_1) = Lang(h_2)$.
Then $O_{h_1(a)} = Lang(h_1)(O_a) = Lang(h_2)(O_a) = O_{h_2(a)}$, and by \rlem{cl-term}, $h_1(a) = h_2(a)$.
Thus $Lang$ is faithful.

Let $M_1 = (A_1,\alpha_1,\beta_1)$ and $M_2 = (A_2,\alpha_2,\beta_2)$ be models of $\mathbb{T}$,
    and let $h : Lang(M_1) \to Lang(M_2)$ be a morphism of theories under $\mathbb{T}$.
Then by \rlem{cl-term}, for every $a \in A_1$, there is a unique $h'(a) \in A_2$ such that $\sststile{}{} h(O_a) = O_{h'(a)}$ is a theorem of $Lang(M_2)$.
Let us show that $h' : A_1 \to A_2$ is a morphism of models $M_1$ and $M_2$.
Indeed, if $M_1(\sigma)(a_1, \ldots a_k)$ is defined, then $\sststile{}{} \sigma(O_{a_1}, \ldots O_{a_k}) = O_{M_1(\sigma)(a_1, \ldots a_k)}$ is a theorem of $Lang(M_1)$.
Hence \[ \sststile{}{} \sigma(O_{h'(a_1)}, \ldots O_{h'(a_k)}) = O_{h'(M_1(\sigma)(a_1, \ldots a_k))} \] is a theorem of $Lang(M_2)$.
But \[ \sststile{}{} \sigma(O_{h'(a_1)}, \ldots O_{h'(a_k)}) = O_{M_2(\sigma)(h'(a_1), \ldots h'(a_k))} \] is also a theorem of $Lang(M_2)$.
Hence by \rlem{cl-term}, $h'(M_1(\sigma)(a_1, \ldots a_k)) = M_2(\sigma)(h'(a_1), \ldots h'(a_k))$.

If $(a_1, \ldots a_k) \in M_1(R)$, then $\sststile{}{} R(O_{a_1}, \ldots O_{a_k})$ is a theorem of $Lang(M_1)$.
Hence $\sststile{}{} R(O_{h'(a_1)}, \ldots O_{h'(a_k)})$ is a theorem of $Lang(M_2)$.
Since $M_2$ is a model of $Lang(M_2)$, it follows that $(h'(a_1), \ldots h'(a_k)) \in M_2(R)$.

Thus $h'$ is a morphism of models.
Note that by definition of $h'$, $Lang(h') = h$.
Hence $Lang$ is full.
\end{proof}

Now, let us describe a functor $Syn : \mathbb{T}/\Th_\mathcal{S} \to \Mod{\mathbb{T}}$.
For every $i : \mathbb{T} \to \mathbb{T}'$, let $Syn(i) = i^*(0_{\mathbb{T}'})$, where $0_{\mathbb{T}'}$ is the initial object of $\Mod{\mathbb{T}'}$,
    and $i^* : \Mod{\mathbb{T}'} \to \Mod{\mathbb{T}}$ is the functor that was defined in \cite{alg-tt}.
If $f : \mathbb{T}_1 \to \mathbb{T}_2$ is a morphism of theories under $\mathbb{T}$, then let $Syn(f) = i_1^*(!_{f^*(0_{\mathbb{T}_2})})$,
    where $!_{f^*(0_{\mathbb{T}_2})}$ is the unique morphism $0_{\mathbb{T}_1} \to f^*(0_{\mathbb{T}_2})$.

The construction of initial models of partial Horn theories was given in \cite{PHL}.
Let us repeat it here.
Let $\mathbb{T} = ((\mathcal{S},\mathcal{F},\mathcal{P}),\mathcal{A})$ be a standard partial Horn theory.
First, we define a partial equivalence relations on sets $Term_\mathcal{F}(\varnothing)$ as $t_1 \sim t_2$ if and only if $\sststile{}{} t_1 = t_2$ is a theorem of $\mathbb{T}$.
The interpretation of $R \in \mathcal{P}$ consists of tuples $(t_1, \ldots t_k)$ such that $\sststile{}{} R(t_1, \ldots t_k)$ is derivable in $\mathbb{T}$.
Then $\mathcal{S}$-set $Term_\mathcal{F}(\varnothing)/\!\sim$ has a natural structure of a model of $((\mathcal{S},\mathcal{F},\mathcal{P}),\mathcal{A})$, and this model is initial.

\begin{prop}
$Syn$ is right adjoint to $Lang$.
\end{prop}
\begin{proof}
Let $\epsilon_{\mathbb{T}'} : Lang(Syn(\mathbb{T}')) \to \mathbb{T}'$ be defined as $\epsilon_{\mathbb{T}'}(O_t) = t$.
It is easy to see that $\epsilon_{\mathbb{T}'}$ preserves axioms of $Lang(Syn(\mathbb{T}'))$.
Moreover, $\epsilon$ is natural in $\mathbb{T}'$.
Let us prove that $\epsilon$ is the counit of the adjunction.
Let $f : Lang(M) \to \mathbb{T}'$ be a morphism.
Then we need to show that there is a unique morphism $g : Lang(M) \to Lang(Syn(\mathbb{T}'))$ such that $\epsilon_{\mathbb{T}'} \circ g = f$.
By \rlem{cl-term}, there is a unique $t$ such that $g(O_a) = O_t$.
Since $t = \epsilon_{\mathbb{T}'}(g(O_a)) = f(O_a)$, $g$ must satisfy equation $g(O_a) = O_{f(O_a)}$.
Thus $g$ is unique.
It is easy to see that this $g$ preserves axioms of $Lang(M)$; hence it defines a morphism $g : Lang(M) \to Lang(Syn(\mathbb{T}'))$.
\end{proof}

Let $\mathbb{T}$ be an algebraic dependent type theory.
Then categories $\mathbb{T}/\algtt^0$ and $\mathbb{T}/\ThC$ are isomorphic.
Thus we still have adjoint functors $Lang^0 \dashv Syn^0 : \mathbb{T}/\algtt^0 \to \Mod{\mathbb{T}}$.
If $\mathbb{T}$ is a contextual theory, then category $\mathbb{T}/\algtt^0_{con}$ is a full subcategory of $\mathbb{T}/\algtt^0$.
We have functor $Syn^0_{con} : \mathbb{T}/\algtt^0_{con} \to \Mod{\mathbb{T}}$ which is defined as the composition of the inclusion $\mathbb{T}/\algtt^0_{con} \to \mathbb{T}/\algtt^0$ and $Syn$.
Let us construct its left adjoint $Lang^0_{con} : \Mod{\mathbb{T}} \to \mathbb{T}/\algtt^0_{con}$.

Theory $Lang^0_{con}(M)$ has has function and predicate symbols of $\mathbb{T}$ together with function symbol $O_a : (ctx,n) \to (p,n)$ for every $a \in A_{(p,n)}$, $p \in \{ ty, tm \}$.
For every $a \in A_{(p,n)}$, we define term $C_a$ of sort $(p,n)$ by induction on $n$.
If $n = 0$, then let $C_a = O_a(\emptyCtx)$.
If $n > 0$, then let $C_a = O_a(C_{M(ctx_{p,n})(a)})$.

Axioms of $Lang^0_{con}(M)$ are axioms of $\mathbb{T}$ together with the following sequents:
\begin{align*}
O_a(\Gamma) \downarrow & \sststile{}{\Gamma} \Gamma = C_{M(ctx_{p,n})(a)}\\
& \sststile{}{} \sigma(C_{a_1}, \ldots C_{a_k}) = C_{M(\sigma)(a_1, \ldots a_k)} \\
& \sststile{}{} R(C_{a_1}, \ldots C_{a_k})
\end{align*}
for every $a \in A_s$, every $a_i \in A_{s_i}$,
every $\sigma \in \mathcal{F}$ such that $M(\sigma)(a_1, \ldots a_k)$ is defined,
and every $R \in \mathcal{P}$ such that $(a_1, \ldots a_k) \in M(R)$.

For every morphism $h : M \to N$ of models of $\mathbb{T}$, we can define a morphism $Lang^0_{con}(h) : Lang^0_{con}(M) \to Lang^0_{con}(N)$ of theories under $\mathbb{T}$ as $Lang(h)(O_a(\Gamma)) = O_{h(a)}(\Gamma)$.
Thus $Lang^0_{con}$ is a functor $\Mod{\mathbb{T}} \to \mathbb{T}/\algtt^0_{con}$.

\begin{prop}
$Lang^0_{con}$ is left adjoint to $Syn^0_{con}$.
\end{prop}
\begin{proof}
To prove this, it is enough to show that the composition of $Lang^0_{con}$ and the inclusion $\mathbb{T}/\algtt^0_{con} \to \mathbb{T}/\algtt^0$ is isomorphic to $Lang^0$.
Let $\alpha_M : Lang^0(M) \to Lang^0_{con}(M)$ be defined as $\alpha_M(O_a) = C_a$.
Let $\beta_M : Lang^0_{con}(M) \to Lang^0(M)$ be defined as $\beta_M(O_a(\Gamma)) = O_a|_{\Gamma = C_{M(ctx_{p,n})(a)}}$.
To prove that $\alpha$ and $\beta$ are inverses of each other, we need to show that $\sststile{}{\Gamma} O_a(\Gamma) \cong C_a|_{\Gamma = C_{M(ctx_{p,n})(a)}}$ is a theorem of $Lang^0_{con}(M)$.
But this follows from the first axiom of $Lang^0_{con}(M)$.
\end{proof}

For every algebraic dependent type theory with substitutions $\mathbb{T}$, there are adjoint functors $Lang^1 \dashv Syn^1 : \mathbb{T}/\algtt^1 \to \Mod{\mathbb{T}}$.
For every contextual algebraic dependent type theory with substitutions $\mathbb{T}$, there are adjoint functors $Lang^1_{con} \dashv Syn^1_{con} : \mathbb{T}/\algtt^1_{con} \to \Mod{\mathbb{T}}$.
These functors are defined in the same way as $Lang^0 \dashv Syn^0$ and $Lang^0_{con} \dashv Syn^0_{con}$.

For every morphism of theories $f : \mathbb{T} \to \mathbb{T}'$ there is a functor $f^* : \Mod{\mathbb{T}'} \to \Mod{\mathbb{T}}$ which was consttucted in \cite{alg-tt}.
We also can define functor $f_* : \Mod{\mathbb{T}} \to \Mod{\mathbb{T}'}$ as $f_*(M) = Syn(Lang(M) \amalg_{\mathbb{T}} \mathbb{T}')$.
It was shown in \cite{PHL} that $f_*$ is left adjoint to $f^*$.
This theorem was proved there only for a weaker notion of morphisms of theories, but the proof also works for general morphisms as defined in \cite{alg-tt}.

Functor $f_*$ can be used to present a model of a theory by generators and relations.
Let $\mathbb{T}$ be a fixed $\mathcal{S}$-theory.
Note that models of the empty theory are just $\mathcal{S}$-sets.
If $f : 0 \to \mathbb{T}$ is the unique morphism from the empty theory, then $f^*(M)$ is just the underlying $\mathcal{S}$-set of $M$,
    and $f_*(X)$ is the free model of $\mathbb{T}$ on $\mathcal{S}$-set $X$.
We will denote this free model by $F(X)$.
If $R$ is a set of axioms in the language of theory $Lang(X) \amalg \mathbb{T}$,
    then let $F(X,R)$ be a model of $\mathbb{T}$ defined as $Syn(Lang(X) \amalg \mathbb{T} \cup R)$.
By definition of $Syn$, to construct a morphism $F(X,R) \to M$ it is necessary and sufficient
    to construct a morphism from $X$ to the underlying $\mathcal{S}$-set of $M$ such that relations from $R$ are true in $M$.

Sometimes we will omit the set of generators if it can be inferred from the set of relations.
For examples, we will write $F(\{\,\vdash p : Id(A,a,a')\,\})$ for the model $F(\{\,a : (tm,0), a' : (tm,0), A : (ty,0), p : (tm,0)\,\}, \{\,ty(p) = Id(A,a,a')\,\})$.
Another examples is $F(\{\,A_1, \ldots A_n \vdash a : A\,\})$ which equals to $F(\{\,A_i : (ty,i), A : (ty,n), a : (tm,n)\,\}, \{\,ty(a) = A, ft^{i+1}(A) = A_{n-i}\,\})$.
Thus this model is isomorphic to the free model $F(\{\,a : (tm,n)\,\})$.

\section{Theories with an interval type}

In this section we describe the theory of an interval type.
We describe several constructions in this theory which we will need later.
In partical, we will show that theories with an interval type and path types also have $Id$ types.

Let $I_0$ be a theory with function symbols $I : (ty,0)$, $left : (tm,0)$, $right : (tm,0)$, and $coe : (ty,1) \times (tm,0) \times (tm,0) \to (tm,0)$, and the following axioms:
\begin{center}
\AxiomC{}
\UnaryInfC{$\vdash I\ type$}
\DisplayProof
\quad
\AxiomC{}
\UnaryInfC{$\vdash left : I$}
\DisplayProof
\quad
\AxiomC{}
\UnaryInfC{$\vdash right : I$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$I \vdash D\ type$}
\AxiomC{$\vdash d : D[left]$}
\AxiomC{$\vdash i : I$}
\TrinaryInfC{$\vdash coe(D, d, i) : D[i]$}
\DisplayProof
\qquad
\AxiomC{$I \vdash D\ type$}
\AxiomC{$\vdash d : D[left]$}
\BinaryInfC{$\vdash coe(D, d, left) \deq d$}
\DisplayProof
\end{center}
Let $I$ be the regularization of $I_0$.
We will work with theories under $I$, which we call theories with \emph{an interval type}.

\subsection{Path types}

Let $HPath$ be a regular theory with function symbols $Path : (ty,n) \times (tm,n) \times (tm,n) \to (ty,n)$,
    $path : (tm,n+1) \to (tm,n)$, and $at : (tm,n) \times (tm,n) \times (tm,n) \times (tm,n) \to (tm,n)$, and the following axioms:
\begin{center}
\AxiomC{$\Gamma \vdash a : A$}
\AxiomC{$\Gamma \vdash a' : A$}
\BinaryInfC{$\Gamma \vdash Path(A, a, a')\ type$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash A\ type$}
\AxiomC{$\Gamma, I \vdash a : A\!\uparrow$}
\BinaryInfC{$\Gamma \vdash path(a) : Path(A, a[left], a[right])$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma \vdash p : Path(A, a, a')$}
\AxiomC{$\Gamma \vdash i : I$}
\BinaryInfC{$\Gamma \vdash at(a, a', p, i) : A$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma \vdash A\ type$}
\AxiomC{$\Gamma, I \vdash a : A\!\uparrow$}
\AxiomC{$\Gamma \vdash i : I$}
\TrinaryInfC{$\Gamma \vdash at(a[left], a[right], path(a), i) \deq a[i]$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma \vdash p : Path(A, a, a')$}
\UnaryInfC{$\Gamma \vdash path(at(a\!\uparrow, a'\!\uparrow, p\!\uparrow, v_0)) \deq p$}
\DisplayProof
\end{center}

\smallskip
\begin{center}
\AxiomC{$\Gamma \vdash p : Path(A, a, a')$}
\UnaryInfC{$\Gamma \vdash at(a, a', p, left) \deq a$}
\DisplayProof
\quad
\AxiomC{$\Gamma \vdash p : Path(A, a, a')$}
\UnaryInfC{$\Gamma \vdash at(a, a', p, right) \deq a'$}
\DisplayProof
\end{center}
We will work with theories under $HPath$, which we call theories with \emph{homogeneous path types}.

Let $refl(a) = path(a\!\uparrow)$.
If $\Gamma \vdash a : A$, then $\Gamma \vdash refl(a) : Path(A, a, a)$.

Let $squeeze(i,j) = at(left, j, coe(Path(I, left, v_0), refl(left), j), i)$.
If $\Gamma \vdash i : I$ and $\Gamma \vdash j : I$,
    then $\Gamma \vdash squeeze(i,j) : I$, $\Gamma \vdash squeeze(left,j) \deq left$, $\Gamma \vdash squeeze(right,j) \deq j$, and $\Gamma \vdash squeeze(i,left) \deq left$.

Now, we can define $J(A, D, d, a, a', p)$ as $coe(D', d[a], right)$, where
    $D' = D\!\uparrow_3[a\!\uparrow, at(a\!\uparrow, a'\!\uparrow, p\!\uparrow, squeeze(v_0,right)), path(at(a\!\uparrow^2, a'\!\uparrow^2, p\!\uparrow^2, squeeze(v_1,v_0)))]$.
If $\Gamma, A, A\!\uparrow, Id(A\!\uparrow^2, v_1, v_0) \vdash D\ type$, $\Gamma, A \vdash d : D'$, and $\Gamma \vdash p : Id(A, a, a')$,
    then $\Gamma \vdash J(A, D, d, a, a', p) : D[a, a', p]$.

Thus $Path$, $refl$, and $J$ almost define a morphism from the theory of $Id$ types.
The only problem is that axiom $\Gamma \vdash J(A, D, d, a, a, refl(a)) \deq d[a]$ is not satisfied.
This axiom will be satisfied if we assume an additional axiom:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a : A$}
\UnaryInfC{$\Gamma \vdash coe(A\!\uparrow, a, right) \deq a$}
\DisplayProof
\end{center}
\medskip
But we do not need this axiom, since it holds propositionally.
That is, \todo{Finish this}

Finally, let us describe the last construction we will need.
Let \[ inv(i) = at(right, left, coe(Path(I, v_0, left), refl(left), right), i). \]
If $\Gamma \vdash i : I$, then $\Gamma \vdash inv(i) : I$, $\Gamma \vdash inv(left) \deq right$, and $\Gamma \vdash inv(right) \deq left$.

\subsection{Univalence}

If $\Gamma \vdash A\ type$, $\Gamma \vdash B\ type$, $\Gamma \vdash C\ type$, $\Gamma, A \vdash f : B\!\uparrow$ and $\Gamma, B \vdash g : C\!\uparrow$,
    then we will write $g \circ f$ for term $\Gamma, A \vdash subst(g, v_n, \ldots v_1, f) : C\!\uparrow$.

We will consider regular theory $UA$ under $HPath$, which has additional symbols
\[ iso : (ty,n)^2 \times (tm,n+1)^4 \times (tm,n) \to (ty,n) \]
and the following axioms:
\medskip
\begin{center}
\def\extraVskip{0.5pt}
\Axiom$\fCenter \Gamma \vdash A\ type$
\noLine
\UnaryInf$\fCenter \Gamma \vdash B\ type$
\Axiom$\fCenter \Gamma, A \vdash f : B\!\uparrow$
\noLine
\UnaryInf$\fCenter \Gamma, B \vdash g : A\!\uparrow$
\Axiom$\fCenter \Gamma, A \vdash p : Path(A\!\uparrow, g \circ f, v_0)$
\noLine
\UnaryInf$\fCenter \Gamma, B \vdash q : Path(B\!\uparrow, f \circ g, v_0)$
\Axiom$\fCenter \Gamma \vdash i : I$
\def\extraVskip{2pt}
\QuaternaryInfC{$\Gamma \vdash iso(A, B, f, g, p, q, i)\ type$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\def\extraVskip{0.5pt}
\Axiom$\fCenter \Gamma \vdash A\ type$
\noLine
\UnaryInf$\fCenter \Gamma \vdash B\ type$
\Axiom$\fCenter \Gamma, A \vdash f : B\!\uparrow$
\noLine
\UnaryInf$\fCenter \Gamma, B \vdash g : A\!\uparrow$
\Axiom$\fCenter \Gamma, A \vdash p : Path(A\!\uparrow, g \circ f, v_0)$
\noLine
\UnaryInf$\fCenter \Gamma, B \vdash q : Path(B\!\uparrow, f \circ g, v_0)$
\def\extraVskip{2pt}
\TrinaryInfC{$\Gamma \vdash iso(A, B, f, g, p, q, left) \deq A$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\def\extraVskip{0.5pt}
\Axiom$\fCenter \Gamma \vdash A\ type$
\noLine
\UnaryInf$\fCenter \Gamma \vdash B\ type$
\Axiom$\fCenter \Gamma, A \vdash f : B\!\uparrow$
\noLine
\UnaryInf$\fCenter \Gamma, B \vdash g : A\!\uparrow$
\Axiom$\fCenter \Gamma, A \vdash p : Path(A\!\uparrow, g \circ f, v_0)$
\noLine
\UnaryInf$\fCenter \Gamma, B \vdash q : Path(B\!\uparrow, f \circ g, v_0)$
\def\extraVskip{2pt}
\TrinaryInfC{$\Gamma \vdash iso(A, B, f, g, p, q, right) \deq B$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\def\extraVskip{0.5pt}
\Axiom$\fCenter \Gamma \vdash A\ type$
\noLine
\UnaryInf$\fCenter \Gamma \vdash B\ type$
\Axiom$\fCenter \Gamma, A \vdash f : B\!\uparrow$
\noLine
\UnaryInf$\fCenter \Gamma, B \vdash g : A\!\uparrow$
\Axiom$\fCenter \Gamma, A \vdash p : Path(A\!\uparrow, g \circ f, v_0)$
\noLine
\UnaryInf$\fCenter \Gamma, B \vdash q : Path(B\!\uparrow, f \circ g, v_0)$
\def\extraVskip{2pt}
\TrinaryInfC{$\Gamma \vdash coe(iso(A\!\uparrow, B\!\uparrow, f\!\uparrow_1, g\!\uparrow_1, p\!\uparrow_1, q\!\uparrow_1, v_0), a, right) \deq f[a]$}
\DisplayProof
\end{center}
\medskip

This theory is similar to the univalence axiom, but it is defined for all types.
The univalence axiom for a universe follows from the assumption that this universe is closed under $iso$.

\todo{Add some constructions}

\section{A model structure on the category of theories}

In this section we construct a model structure on the category $UA/\Th_\mathcal{C}$ of theories with an interval type, homogeneous path types and the univalence axiom.
For an introduction to the theory of model categories see \cite{hovey}.
We will need the following proposition to construct our model structure:

\begin{prop}[model-cat]
Suppose that $\C$ is a complete and cocomplete category, $\we$ is a class of morphisms of $\C$, and $\I$, $\J$ are sets of morphisms of $\C$.
Then $\C$ is a cofibrantly generated model category with $\I$ as the set of generating cofibrations,
$\J$ as the set of generating trivial cofibrations, and $\we$ as the class of weak equivalences if and only if the following conditions are satisfied:
\begin{description}
\item[(A1)] The domains of maps in $\I$ and $\J$ are small relative to $\Icell$ and $\Jcell$ respectively.
\item[(A2)] $\we$ has 2-out-of-3 property and is closed under retracts.
\item[(A3)] $\Iinj \subseteq \we$.
\item[(A4)] $\Jcell \subseteq \we \cap \Icof$.
\item[(A5)] Either $\Jinj \cap \we \subseteq \Iinj$ or $\Icof \cap \we \subseteq \Jcof$.
\end{description}
\end{prop}

We will often define theories just by specifying its set of axioms.
The sets of function and predicate symbols then can be defined as the sets of those symbols that appear in the axioms.

Let $e : \{ ctx, ty, tm \} \to \{ ctx, ty \}$ be the function defined as $e(ctx) = ctx$, $e(ty) = ctx$, $e(tm) = ty$.
Also we define $d_p : (p,n) \to (e(p),n)$ as $d_{ctx}(\Gamma) = \Gamma$ $d_{ty}(A) = ft(A)$, $d_{tm}(a) = ty(a)$.
Let $s_1$, \ldots $s_n$, $s$ be a sequence of sorts such that $s = (p,n)$ for some $p \in \{ ty, tm \}$ and $n \in \mathbb{N}$.
Then we define algebraic dependent type theories $\mathbb{U}^1_{s_1, \ldots s_k, s}$,
$\mathbb{V}^1_{s_1, \ldots s_k, s}$, $\mathbb{U}^2_{s_1, \ldots s_k, s}$ and $\mathbb{V}^2_{s_1, \ldots s_k, s}$.
Apart from symbols and axioms of $\mathbb{T}_0$ theories $\mathbb{U}^1_{s_1, \ldots s_k, s}$
and $\mathbb{V}^1_{s_1, \ldots s_k, s}$ have two predicate symbols $P,Q : s_1 \times \ldots \times s_k$.
$\mathbb{U}^1_{s_1, \ldots s_k, s}$ has one function symbol $A : s_1 \times \ldots \times s_k \to (e(p),n)$ and one axiom:
\[ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} A(x_1, \ldots x_k)\!\downarrow \land Q(x_1, \ldots x_k) \]
$\mathbb{V}^1_{s_1, \ldots s_k, s}$ has two function symbols $A : s_1 \times \ldots s_k \to (e(p),n)$ and $a : s_1 \times \ldots \times s_k \to (p,n)$ and two axioms:
\begin{align*}
P(x_1, \ldots x_k) & \sststile{}{x_1, \ldots x_k} a(x_1, \ldots x_k)\!\downarrow \\
a(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} d_p(a(x_1, \ldots x_k)) = A(x_1, \ldots x_k) \land Q(x_1, \ldots x_k)
\end{align*}
Theories $\mathbb{U}^2_{s_1, \ldots s_k, s}$ and $\mathbb{V}^2_{s_1, \ldots s_k, s}$ have one predicate symbol $P : s_1 \times \ldots \times s_k$.
$\mathbb{U}^2_{s_1, \ldots s_k, s}$ has one function symbol $A : s_1 \times \ldots \times s_k \to (e(p),n)$ and one axiom:
\[ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} A(x_1, \ldots x_k)\!\downarrow \]
$\mathbb{V}^2_{s_1, \ldots s_k, s}$ has two function symbols $A : s_1 \times \ldots s_k \to (e(p),n)$ and $a : s_1 \times \ldots \times s_k \to (p,n)$ and two axioms:
\begin{align*}
P(x_1, \ldots x_k) & \ssststile{}{x_1, \ldots x_k} a(x_1, \ldots x_k)\!\downarrow \\
a(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} d_p(a(x_1, \ldots x_k)) = A(x_1, \ldots x_k)
\end{align*}

There are obvious morphisms $\mathbb{U}^1_{s_1, \ldots s_k, s} \to \mathbb{V}^1_{s_1, \ldots s_k, s}$ and $\mathbb{U}^2_{s_1, \ldots s_k, s} \to \mathbb{V}^2_{s_1, \ldots s_k, s}$.
Let $\I^1$ and $\I^2$ be sets of these morphisms for every sequence $s_1$, \ldots $s_k$, $s$.
Note that every map in $\I^2$ is a pushout of a map in $\I^1$:
\[ \xymatrix{ \mathbb{U}^1_{s_1, \ldots s_k, s} \ar[r]^f \ar[d] & \mathbb{U}^2_{s_1, \ldots s_k, s} \ar[d] \\
              \mathbb{V}^1_{s_1, \ldots s_k, s} \ar[r]_g & \po \mathbb{V}^2_{s_1, \ldots s_k, s}
            } \]
where $f(P) = f(Q) = P$, $f(A) = A$, $g(P) = g(Q) = P$, $g(A) = A$ and $g(a) = a$.
It follows that $\Icof[\I^2] \subseteq \Icof[\I^1]$.

A cylinder object for a theory $\mathbb{T}$ is a theory $C$ together with three maps $i_0,i_1 : \mathbb{T} \to C$ and $w : C \to \mathbb{T}$
such that $w \circ i_0 = w \circ i_1 = id_{\mathbb{T}}$.
If $\mathbb{T}$ is an algebraic dependent type theory, then let $F(\mathbb{T})$ be a free theory under $UA$, that is $\mathbb{T} \amalg_{\mathbb{T}_0} UA$.
For every theory of the form $F(\mathbb{U}_{s_1, \ldots s_k, (p,n)})$ we define a cylinder object $C(\mathbb{U}_{s_1, \ldots s_k, (p,n)})$.
Apart from symbols and axioms of $UA$, it has two predicate symbols $P,Q : s_1 \times \ldots \times s_k$,
one function symbol $H : s_1 \times \ldots \times s_k \to (e(p),n+1)$ and one axiom:
\[ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} ft^n(d_{e(p)}(H(x_1, \ldots x_k))) = I(\emptyCtx) \land Q(x_1, \ldots x_k) \]

If $A_1, \ldots A_n \vdash a$, then let $I \times a = (I, A_1[], \ldots A_n[v_{n-2}, \ldots v_0] \vdash a[v_{n-1}, \ldots v_0])$.
Morphism $w : C(\mathbb{U}_{s_1, \ldots s_k, (p,n)}) \to F(\mathbb{U}_{s_1, \ldots s_k, (p,n)})$ is defined as follows:
$w(P) = P$, $w(Q) = Q$, $w(H(x_1, \ldots x_k)) = I \times A(x_1, \ldots x_k)$.
If $I, A_1, \ldots A_n \vdash h$, then for every $c \in \{ left, right \}$, let $c^*(h) = (A_1[c], \ldots A_n[c, v_{n-2}, \ldots v_0] \vdash h[c, v_{n-1}, \ldots v_0])$.
Morphisms $i_0,i_1 : F(\mathbb{U}_{s_1, \ldots s_k, (p,n)}) \to C(\mathbb{U}_{s_1, \ldots s_k, (p,n)})$ are defined as follows:
$i_j(P) = P$, $i_j(Q) = Q$ and $i_j(A(x_1, \ldots x_k)) = c_j^*(H(x_1, \ldots x_k))$ for every $j \in \{ 0, 1 \}$, where $c_0 = left$ and $c_1 = right$.
Note that $c_j^*(I \times A) = A$; hence $w \circ i_0 = w \circ i_1 = id_{F(\mathbb{U}_{s_1, \ldots s_k, (p,n)})}$.

For every theory $F(\mathbb{V}_{s_1, \ldots s_k, (p,n)})$ we define a cylinder object $C(\mathbb{V}_{s_1, \ldots s_k, (p,n)})$.
Apart from symbols and axioms of $UA$, it has two predicate symbols $P,Q : s_1 \times \ldots \times s_k$,
two function symbols $H : s_1 \times \ldots \times s_k \to (e(p),n+1)$, $h : s_1 \times \ldots \times s_k \to (p,n+1)$, and the following axioms:
\begin{align*}
P(x_1, \ldots x_k) & \sststile{}{x_1, \ldots x_k} h(x_1, \ldots x_k)\!\downarrow \\
h(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} ft^n(d_{e(p)}(H(x_1, \ldots x_k))) = I(\emptyCtx) \\
h(x_1, \ldots x_k)\!\downarrow & \sststile{}{x_1, \ldots x_k} d_p(h(x_1, \ldots x_k)) = H(x_1, \ldots x_k) \land Q(x_1, \ldots x_k)
\end{align*}
Morphism $w : C(\mathbb{V}_{s_1, \ldots s_k, (p,n)}) \to F(\mathbb{V}_{s_1, \ldots s_k, (p,n)})$ is defined as follows:
$w(P) = P$, $w(Q) = Q$, $w(H(x_1, \ldots x_k)) = I \times A(x_1, \ldots x_k)$, $w(h(x_1, \ldots x_k)) = I \times a(x_1, \ldots x_k)$.
Morphisms $i_0,i_1 : F(\mathbb{U}_{s_1, \ldots s_k, (p,n)}) \to C(\mathbb{U}_{s_1, \ldots s_k, (p,n)})$ are defined as follows:
$i_j(P) = P$, $i_j(Q) = Q$, $i_j(A(x_1, \ldots x_k)) = c_j^*(H(x_1, \ldots x_k))$ and $i_j(a(x_1, \ldots x_k)) = c_j^*(h(x_1, \ldots x_k))$.

% If $p \in \{ ty, tm \}$, then let $\I^1_p$ be the set of morphisms of theories of the form
% $\{ P(x_1, \ldots x_n) \sststile{}{x_1, \ldots x_n} A(x_1, \ldots x_n)\!\downarrow \land Q(x_1, \ldots x_n) \} \to \{ P(x_1, \ldots x_n) \sststile{}{x_1, \ldots x_n} a(x_1, \ldots x_n)\!\downarrow, a(x_1, \ldots x_n)\!\downarrow\ \sststile{}{x_1 : s_1, \ldots x_n : s_n} d_p(a(x_1, \ldots x_n)) = A(x_1, \ldots x_n) \land Q(x_1, \ldots x_n) \}$
% for every sequence of sorts $s_1$, \ldots $s_n$, $s$, where $s = (p,n)$ for some $n$, and $a : s_1 \times \ldots \times s_n \to s$.
% We define the set $\I$ of generating cofibrations to be the union $\I_{ty} \cup \I_{tm}$.
% Let $\J_p$ be the set of arrows of the form $i^0_{(p,n)}$.
% We define the set $\J$ of generating trivial cofibrations to be the union $\J_{ty} \cup \J_{tm}$.

\section{A model structure on models of theories with an interval type}

In this section we construct a model structure on the category of models of an algebraic type theory with enough additional structure.
Let $\mathbb{T}$ be a theory under $UA$.
Then we define a model structure on the category of models of $\mathbb{T}$.

If $H = (I, A_1, \ldots A_n \vdash) \in X_{(ctx,n+1)}$, then for every $c \in \{ left, right \}$, let $c^*(H) = (A_1[c], \ldots A_n[c] \vdash) \in X_{(ctx,n)}$.
A \emph{homotopy between} contexts $\Gamma,\Delta \in X_{(ctx,n)}$ is a context $H \in X_{(ctx,n+1)}$ such that $\vdash ft^n(H) \equiv I$, $left^*(H) = \Gamma$ and $right^*(H) = \Delta$.
Contexts $\Gamma$ and $\Delta$ are \emph{homotopic} if there is a homotopy between them.
In this case we will write $\Gamma \sim \Delta$.

A \emph{relative homotopy between} types $(\Gamma \vdash A), (\Gamma \vdash B) \in X_{(ty,n)}$ is a type $(\Gamma, I \vdash H) \in X_{(ty,n+1)}$ such that $H[left] = A$ and $H[right] = B$.
Types $A$ and $B$ are \emph{homotopic relative to $(ctx,n)$} if there is a relative homotopy between them.
In this case we will write $A \sim_r B$.

A \emph{relative homotopy between} terms $(\Gamma \vdash a : A), (\Gamma \vdash b : A) \in X_{(tm,n)}$ is a term $(\Gamma, I \vdash h : A\!\uparrow) \in X_{(tm,n+1)}$ such that $h[left] = a$ and $h[right] = b$.
Terms $a$ and $b$ are \emph{homotopic relative to $(ty,n)$} if there is a relative homotopy between them.
In this case we will write $a \sim_r b$.

\begin{remark}[types-hom-ua]
To define a relative homotopy between types $(\Gamma \vdash A), (\Gamma \vdash B) \in X_{(ty,n)}$,
    it is enought to specify terms $(\Gamma, A \vdash f : B\!\uparrow), (\Gamma, B \vdash g : A\!\uparrow) \in X_{(tm,n+1)}$
    such that $g \circ f \sim_r v_0(A)$ and $f \circ g \sim_r v_0(B)$.
Then we can define a relative homotopy $\Gamma, I \vdash iso(A\!\uparrow, B\!\uparrow, f\!\uparrow_1, g\!\uparrow_1, path(h_1\!\!\uparrow_2), path(h_2\!\!\uparrow_2), v_0)$ between $A$ and $B$,
    where $h_1$ is a relative homotopy between $g \circ f$ and $v_0(A)$, and $h_2$ is a relative homotopy between $f \circ g$ and $v_0(B)$.
\end{remark}

There is a bijection between morphisms $F(\{\,A : (p,n)\,\}) \to X$ and elements of $X_{(p,n)}$.
We can directly describe homotopies between morphisms $f,g : F(\{\,A : (p,n)\,\}) \to X$.
For this, we define (relative) cylinder objects $C$ together with maps $i^0,i^1 : F(\{\,A : (p,n)\,\}) \to C$.
Then a homotopy between $f$ and $g$ can be described as a map $h : C \to X$ such that $h \circ i^0 = f$ and $h \circ i^1 = g$.

A \emph{cylinder object} of sort $(ctx,n)$ is $F(\{\,H : (ctx,n+1)\,\}, \{\,ft^n(H) = I(\emptyCtx)\,\})$.
We will denote this object by $Cyl_{(ctx,n)}$.
Inclusions $i^0_{(ctx,n)}, i^1_{(ctx,n)} : F(\{\,\Gamma : (ctx,n)\,\}) \to Cyl_{(ctx,n)}$ are defined as $i^k_{(ctx,n)}(\Gamma) = c_k^*(H)$, where $c_0 = left$ and $c_1 = right$.

A \emph{relative cylinder object} of sort $(ty,n)$ is $F(\{\,H : (ty,n+1)\,\}, \{\,ft(H) = I(ft^2(H))\,\})$.
We will denote this object by $RCyl_{(ty,n)}$.
Inclusions $i^0_{(ty,n)}, i^1_{(ty,n)} : F(\{\,A : (ty,n)\,\}) \to RCyl_{(ty,n)}$ are defined as $i^k_{(ty,n)}(A) = H[c_k]$.

A \emph{relative cylinder object} of sort $(tm,n)$ is $F(\{\,h : (tm,n+1), A : (ty,n)\,\}, \{\,ty(h) \allowbreak = (I(ft(A)) \vdash A\!\!\uparrow)\,\})$.
We will denote this object by $RCyl_{(tm,n)}$.
Inclusions $i^0_{(tm,n)}, i^1_{(tm,n)} : F(\{\,a : (tm,n)\,\}) \to RCyl_{(tm,n)}$ are defined as $i^k_{(tm,n)}(a) = h[c_k]$.

Let $e : \{ ty, tm \} \to \{ ctx, ty \}$ be the function defined as $e(ty) = ctx$, $e(tm) = ty$.
Also we define $d_p : (p,n) \to (e(p),n)$ as $d_{ty} = ft$, $d_{tm} = ty$.
If $p \in \{ ty, tm \}$, then let $\I_p$ be the set of maps of the form $\delta_{(p,n)} : F(\{\,A : (e(p),n)\,\}) \to F(\{\,a : (p,n)\,\})$, $\delta_{(p,n)}(A) = d_p(a)$.
We define the set $\I$ of generating cofibrations to be the union $\I_{ty} \cup \I_{tm}$.
Let $\J_p$ be the set of arrows of the form $i^0_{(p,n)}$.
We define the set $\J$ of generating trivial cofibrations to be the union $\J_{ty} \cup \J_{tm}$.

\begin{remark}
A relative homotopy between $f,g : F(\{\,A : (p,n)\,\}) \to X$ exists only if $f \circ \delta_{(p,n)} = g \circ \delta_{(p,n)}$, and in this case a homotopy $h$ is a map such that the following triangle commutes:
\[ \xymatrix{ F(\{\,a : (p,n)\,\}) \amalg_{F(\{\,A : (e(p),n)\,\})} F(\{\,a : (p,n)\,\}) \ar[d]_{[i^0,i^1]} \ar[r]^-{[f,g]} & X \\
              RCyl_{(p,n)} \ar@{-->}[ur]_h
            } \]
\end{remark}

Given two morphisms $f \in \I$ and $g : X \to Y$, we say that $f$ \emph{has the left lifting property (LLP) up to $\sim_r$} with respect to $g$,
and $g$ \emph{has the right lifting property (RLP) up to $\sim_r$} with respect to $f$ if for every commutative square of the form
\[ \xymatrix{ F(\{\,A : (e(p),n)\,\}) \ar[r]^-u \ar@{}[dr]|(.7){\sim_r} \ar[d]_f & X \ar[d]^g \\
              F(\{\,a : (p,n)\,\}) \ar[r]_-v \ar@{-->}[ur]^h                     & Y,
            } \]
there is a dotted arrow $h : F(\{\,a : (p,n)\,\}) \to X$ such that $h \circ f = u$ and $(g \circ h) \sim_r v$.
We define the set $\we$ of weak equivalences as the set of maps that have RLP up to $\sim_r$ with respect to every map in $\I$.
Thus a map $g : X \to Y$ is a weak equivalence if and only if the following conditions are satisfied:
\begin{enumerate}
\item For every context $\Gamma \in X_{(ctx,n)}$ and every type $A \in Y_{(ty,n)}$ in context $g(\Gamma)$, there exists a type $A' \in X_{(ty,n)}$ in context $\Gamma$ such that $g(A')$ and $A$ are homotopic relative to $(ctx,n)$.
    This is true if and only if $g$ has RLP up to $\sim_r$ with respect to every map in $\I_{ty}$.
    In this case we will say that $g$ is \emph{essentially surjective on types}.
\item For every type $A \in X_{(ty,n)}$ and every term $a \in Y_{(tm,n)}$ of type $g(A)$, there exists a term $a' \in X_{(tm,n)}$ of type $A$ such that $g(a')$ and $a$ are homotopic relative to $(ty,n)$.
    This is true if and only if $g$ has RLP up to $\sim_r$ with respect to every map in $\I_{tm}$.
    In this case we will say that $g$ is \emph{essentially surjective on terms}.
\end{enumerate}

\begin{prop}[hom-eq]
Relation $\sim_r$ is reflexive, symmetric, transitive and preserved by morphisms.
\end{prop}
\begin{proof}
If $h$ is a homotopy between $a$ and $b$, then $k(h)$ is a homotopy between $k(a)$ and $k(b)$.

If $(\Gamma \vdash A) \in X_{(p,n)}$, then $\Gamma, I \vdash A\!\uparrow$ is a homotopy between $A$ and $A$.

Let $h_1, h_2 : RCyl_{(tm,n)}(h) \to X$ be relative homotopies such that $h_1 \circ i^1 = h_2 \circ i^0$.
Then we define a relative homotopy $h_3$ between $h_1 \circ i^0$ and $h_2 \circ i^1$.
Let $h_3(h) = (ctx(h_1(h)) \vdash at(h_1[left]\!\uparrow, h_2[right]\!\uparrow, coe(Path(ty(h_1), h_1[left]\!\uparrow, h_2), path(h_1), right)\!\uparrow, v_0))$.

Let $H_1, H_2 : RCyl_{(ty,n)}(H) \to X$ be relative homotopies such that $H_1 \circ i^1 = H_2 \circ i^0$.
Then we define a relative homotopy $H_3$ between $H_1 \circ i^0$ and $H_2 \circ i^1$.
Let $H_3(H) = $.
\todo{Finish the proof}
\end{proof}

\begin{lem}
Let $k : X \to Y$ be a weak equivalence.
If $a,b \in X_{(p,n)}$ are such that $k(f) \sim_r k(g)$, then $a \sim_r b$.
\end{lem}
\begin{proof}
\todo{Write the proof}
\end{proof}

\begin{lem}[hom-ext][Homotopy extension property]
Let $f : F(\{\,\Gamma : (e(p),n)\,\}) \to F(\{\,A : (p,n)\,\}) \in \I$, $u : U \to X$, and $v : V \to X$ be maps such that $u \sim^r v \circ i$.
Then there exists a map $v' : V \to X$ such that $u = v' \circ i$ and $v' \sim v$.
\end{lem}

\begin{lem}
If $f : X \to Y$ is essentially surjective on types, then it is essentially surjective on context.
That is, for every $\Gamma \in Y_{(ctx,n)}$, there is a context $\Gamma' \in X_{(ctx,n)}$ such that $f(\Gamma') \sim \Gamma$.
\end{lem}
\begin{proof}
If $n = 0$, then $\Gamma = \emptyCtx$, and we can take $\Gamma' = \emptyCtx$.
If $n > 0$, then let $\Delta = ft(\Gamma)$.
There exists a context $\Delta' \in X_{(ctx,n-1)}$ such that $f(\Delta') \sim \Delta$.
By \rlem{hom-ext}, there exists
\end{proof}

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
