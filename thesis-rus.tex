\documentclass[reqno]{amsart}

\usepackage[russian]{babel}
\usepackage[utf8]{inputenc}
\usepackage{mathtools}
\usepackage{cmap}
\usepackage{amsfonts}
\usepackage{upgreek}
\usepackage{xargs}
\usepackage{ifthen}
\usepackage[all]{xy}
\usepackage{hyperref}
\usepackage{etex}
\usepackage{bussproofs}
\usepackage{turnstile}
\usepackage{amssymb}
\usepackage{verbatim}

\hypersetup{colorlinks=true,linkcolor=blue}

\renewcommand{\turnstile}[6][s]
    {\ifthenelse{\equal{#1}{d}}
        {\sbox{\first}{$\displaystyle{#4}$}
        \sbox{\second}{$\displaystyle{#5}$}}{}
    \ifthenelse{\equal{#1}{t}}
        {\sbox{\first}{$\textstyle{#4}$}
        \sbox{\second}{$\textstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{s}}
        {\sbox{\first}{$\scriptstyle{#4}$}
        \sbox{\second}{$\scriptstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{ss}}
        {\sbox{\first}{$\scriptscriptstyle{#4}$}
        \sbox{\second}{$\scriptscriptstyle{#5}$}}{}
    \setlength{\dashthickness}{0.111ex}
    \setlength{\ddashthickness}{0.35ex}
    \setlength{\leasturnstilewidth}{2em}
    \setlength{\extrawidth}{0.2em}
    \ifthenelse{%
      \equal{#3}{n}}{\setlength{\tinyverdistance}{0ex}}{}
    \ifthenelse{%
      \equal{#3}{s}}{\setlength{\tinyverdistance}{0.5\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{d}}{\setlength{\tinyverdistance}{0.5\ddashthickness}
        \addtolength{\tinyverdistance}{\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{t}}{\setlength{\tinyverdistance}{1.5\dashthickness}
        \addtolength{\tinyverdistance}{\ddashthickness}}{}
        \setlength{\verdistance}{0.4ex}
        \settoheight{\lengthvar}{\usebox{\first}}
        \setlength{\raisedown}{-\lengthvar}
        \addtolength{\raisedown}{-\tinyverdistance}
        \addtolength{\raisedown}{-\verdistance}
        \settodepth{\raiseup}{\usebox{\second}}
        \addtolength{\raiseup}{\tinyverdistance}
        \addtolength{\raiseup}{\verdistance}
        \setlength{\lift}{0.8ex}
        \settowidth{\firstwidth}{\usebox{\first}}
        \settowidth{\secondwidth}{\usebox{\second}}
        \ifthenelse{\lengthtest{\firstwidth = 0ex}
            \and
            \lengthtest{\secondwidth = 0ex}}
                {\setlength{\turnstilewidth}{\leasturnstilewidth}}
                {\setlength{\turnstilewidth}{2\extrawidth}
        \ifthenelse{\lengthtest{\firstwidth < \secondwidth}}
            {\addtolength{\turnstilewidth}{\secondwidth}}
            {\addtolength{\turnstilewidth}{\firstwidth}}}
        \ifthenelse{\lengthtest{\turnstilewidth < \leasturnstilewidth}}{\setlength{\turnstilewidth}{\leasturnstilewidth}}{}
    \setlength{\turnstileheight}{1.5ex}
    \sbox{\turnstilebox}
    {\raisebox{\lift}{\ensuremath{
        \makever{#2}{\dashthickness}{\turnstileheight}{\ddashthickness}
        \makehor{#3}{\dashthickness}{\turnstilewidth}{\ddashthickness}
        \hspace{-\turnstilewidth}
        \raisebox{\raisedown}
        {\makebox[\turnstilewidth]{\usebox{\first}}}
            \hspace{-\turnstilewidth}
            \raisebox{\raiseup}
            {\makebox[\turnstilewidth]{\usebox{\second}}}
        \makever{#6}{\dashthickness}{\turnstileheight}{\ddashthickness}}}}
        \mathrel{\usebox{\turnstilebox}}}

\newcommand{\axlabel}[1]{(#1) \phantomsection \label{ax:#1}}
\newcommand{\axtag}[1]{\label{ax:#1} \tag{#1}}
\newcommand{\axref}[1]{(\hyperref[ax:#1]{#1})}

\newcommand{\newref}[6][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{#3~\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\expandafter\newcommand\csname d#2\endcsname[1]{#5~\ref{#2:##1}}
\expandafter\newcommand\csname p#2\endcsname[1]{#6~\ref{#2:##1}}
\expandafter\newcommand\csname n#2\endcsname[1]{\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{теорема}{Теорема}{теореме}{теореме}
\newref{lem}{лемма}{Лемма}{лемме}{лемме}
\newref{prop}{утверждение}{Утверждение}{утверждению}{утверждении}
\newref{cor}{следствие}{Следствие}{следствию}{следствии}

\theoremstyle{definition}
\newref{defn}{определение}{Определение}{определению}{определении}
\newref{example}{пример}{Пример}{примеру}{примере}

\theoremstyle{remark}
\newref{remark}{замечание}{Замечание}{замечанию}{замечании}

\newcommand{\bcat}[1]{\mathbf{#1}}
\newcommand{\cat}[1]{\mathcal{#1}}
\newcommand{\Mod}[1]{#1\text{-}\bcat{Mod}}
\newcommand{\Set}{\bcat{Set}}
\newcommand{\fs}[1]{\mathrm{#1}}
\newcommand{\Hom}{\fs{Hom}}
\newcommand{\Lang}{\fs{Lang}}
\newcommand{\Syn}{\fs{Syn}}
\newcommand{\nf}{\mathrm{nf}}
\newcommand{\FV}{\fs{FV}}
\newcommand{\repl}{:=}
\newcommand{\Term}{\mathrm{Term}}
\newcommand{\Th}{\bcat{Th}}
\newcommand{\colim}{\fs{colim}}

\newcommand{\I}{\mathrm{I}}
\newcommand{\J}{\mathrm{J}}
\newcommand{\class}[2]{#1\text{-}\mathrm{#2}}
\newcommand{\Iinj}[1][\I]{\class{#1}{inj}}
\newcommand{\Icell}[1][\I]{\class{#1}{cell}}
\newcommand{\Icof}[1][\I]{\class{#1}{cof}}
\newcommand{\Jinj}[1][]{\Iinj[\J#1]}
\newcommand{\Jcell}[1][]{\Icell[\J#1]}
\newcommand{\Jcof}[1][]{\Icof[\J#1]}

\newenvironment{tolerant}[1]{\par\tolerance=#1\relax}{\par}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}

\begin{document}

\title{Title}

\author{Valery Isaev}

\maketitle

\section{Введение}

\section{Частичные хорновские теории}

В данной диссертации мы будем работать с определенным классом логических теорий, которые известны под разными названиями, но наиболее распространенный термин -- это \emph{существенно алгебраические теории}.
Существует несколько эквивалентных способов определить такие теории:
\begin{enumerate}
\item Декартовы теории \cite[Definition~D1.3.4]{elephant} -- это специальный вид теорий в логике первого порядка, где единственные логческие связки -- это конъюнкция и квантор существования.
Кроме того, множество аксиом должно удовлетворять определенному условию.
Мы не будем использовать это понятие, поэтому точное определение нам не понадобится.
\item Обобщенные алгебраические теории \cite{GAT} могут содержать сорта, зависящие от других сортов.
\item Существенно алгебраические теории \cite[Definition~3.34]{LPC} -- это теории, в которых некоторые функциональные символы могут интерпретироваться как \emph{частичные} функции.
Мы не будем использовать это понятие, поэтому точное определение нам не понадобится.
\item Частичные хорновские теории \cite{PHL} являются обобщением существенно алгебраических теорий.
\item Категорное определение теорий является самым простым.
Согласно нему (финитарная) существенно алгебраическая теория -- это просто конечно полная малая категория.
Модель такой теории $\cat{C}$ -- это просто функтор $\cat{C} \to \Set$, сохраняющий конечные пределы.
Другое преимущество этого определения заключается в том, что легко определить структуру категории (и даже 2-категории) на классе теорий.
\end{enumerate}

Мы будем работать с частичными хорновскими теориями, определение которых мы приведем в следующем подразделе.
Часто аксиомы теории пораждаются отношением, которое обладает различными хорошими свойствами такими, как сильная нормализация и конфлюэнтность.
Мы изучим такие теории в этом разделе.
Кроме того, мы обсудим связь чистичных хорновских теорий с категорным определением существенно алгебраических теорий.
Конкретно, мы зададим структуру 2-категории на них и докажем, что она эквивалентна 2-категории конечно полных малых категорий.

\subsection{Определение}

В этом подразделе мы приведем основные определения из \cite{PHL}.
Мы дадим более общее определение инфинитарных теорий.
\emph{Сигнатура} -- это тройка $(\mathcal{S},\mathcal{F},\mathcal{P})$, где $\mathcal{S}$ -- множество сортов, $\mathcal{F}$ -- множество функциональных символов, и $\mathcal{P}$ -- множество предикатных символов.
Каждому функциональному символу $\sigma$ сопоставляется его сигнатура, то есть множество $I$, функция $s : I \to \mathcal{S}$ и сорт $s$, что записывается как $\sigma : \prod_{i \in I} s_i \to s$.
Каждому предикатному символу $R$ сопоставляется множество $I$ и функция $s : I \to \mathcal{S}$, что записывается как $R : \prod_{i \in I} s_i$.
Если $I = \{ 1, \ldots n \}$ -- конечное множество, то сигнатуры $\sigma$ и $R$ мы будем записывать как $\sigma : s_1 \times \ldots \times s_n \to s$ и $R : s_1 \times \ldots \times s_n$.

Если $\lambda$ -- регулярный кардинал, то мы будем говорить, что функциональный символ $\sigma : \prod_{i \in I} s_i \to s$ является \emph{$\lambda$-достижимым}, если $|I| < \lambda$.
Аналогично предикатный символ $R : \prod_{i \in I} s_i$ является \emph{$\lambda$-достижимым}, если $|I| < \lambda$.
Сигнатура является \emph{$\lambda$-достижимой}, если все ее функциональные и предикатные символы $\lambda$-достижимы.

\begin{defn}
Если $\mathcal{S}$ -- некоторое множество, то \emph{$\mathcal{S}$-множество} -- это множество $X$ вместе с функцией $p : X \to \mathcal{S}$.
Если $\mathcal{S}$ -- множество сортов некоторой теории и $x \in X$, то мы будем говорить, что $x$ имеет сорт $s$, если $p(x) = s$.
\end{defn}

Для любого $\mathcal{S}$-множества $V$ мы можем определить $\mathcal{S}$-множество термов $\Term(V)$ с переменными в $V$ индуктивным образом:
\begin{enumerate}
\item Любая переменная сорта $s$ является термом этого сорта.
\item Если $\sigma : \prod_{i \in I} s_i \to s$ -- функциональный символ, и $t_i$ -- терм сорта $s_i$ для всех $i \in I$, то $\sigma(\{ t_i \}_i)$ -- терм сорта $s$.
\end{enumerate}

\emph{Атомарная формула} -- это выражение вида $t_1 = t_2$, где $t_1$ и $t_2$ -- термы одного и того же сорта,
либо вида $R(\{ t_i \}_i)$, где $R : \prod_{i \in I} s_i$ -- предикатный символ, а $t_i$ -- терм сорта $s_i$ для всех $i \in I$.
\emph{(Хорновская) формула} -- это выражение вида $\bigwedge_{i \in I} \varphi_i$, где $\varphi_i$ -- атомарные формулы.
Конъюнкция пустого множества формул будет обозначаться как $\top$.
Выражение $t\!\downarrow$ является сокращением для $t = t$.
Функциональные символы интерпретируются как частичные функции.
Формула $t\!\downarrow$ означает, что все подвыражения в $t$ определены.
\emph{Секвенция} -- это выражение вида $\varphi \sststile{}{V} \psi$, где $V$ -- $\mathcal{S}$-множество, а $\varphi$ и $\psi$ -- формулы с переменными в $V$.
Множество переменных, встречающихся в формуле или терме $\varphi$ будет обозначаться как $\FV(\varphi)$.
Если $I = \{ 1, \ldots n \}$, то мы будем записывать $\bigwedge_{i \in I} \varphi_i$ как $\varphi_1 \land \ldots \land \varphi_n$.
Вместо $\varphi_1 \land \ldots \land \varphi_n \sststile{}{V} \psi$ мы будем часто писать $\varphi_1, \ldots \varphi_n \sststile{}{V} \psi$.

Мы будем использовать следующие сокращения:
\begin{align*}
\varphi \sststile{}{V} t \cong s & \Longleftrightarrow \varphi \land t\!\downarrow\,\sststile{}{V} t = s \text{ и } \varphi \land s\!\downarrow\,\sststile{}{V} t = s \\
\varphi \ssststile{}{V} \psi & \Longleftrightarrow \varphi \sststile{}{V} \psi \text{ и } \psi \sststile{}{V} \varphi
\end{align*}

\begin{defn}
\emph{Частичная хорновская теория} -- это четверка $(\mathcal{S},\mathcal{F},\mathcal{P},\mathcal{A})$, где $(\mathcal{S},\mathcal{F},\mathcal{P})$ -- это сигнатура, а $\mathcal{A}$ -- множество секвенций.
Элементы $\mathcal{A}$ мы будем называть аксиомами.
\end{defn}

\begin{remark}
Так как частичные хорновские теории -- это единственный вид теорий, с которым мы будем работать, то мы их будем называть просто теориями.
\end{remark}

Мы будем говорить, что формула $\bigwedge_{i \in I} \varphi_i$, где $\varphi_i$ атомарны, является \emph{$\lambda$-достижимой} если $|I| < \lambda$.
Мы будем говорить, что секвенция $\varphi \sststile{}{V} \psi$ является \emph{$\lambda$-достижимой} если $|V| < \lambda$ и $\varphi$ и $\psi$ являются $\lambda$-достижимыми.
Мы будем говорить, что теория является \emph{$\lambda$-достижимой}, если ее подлежащая сигнатура и аксиомы являются таковыми.
Теория является финитарной, если она $\aleph_0$-достижима.

\emph{Интерпретация} сигнатуры $(\mathcal{S},\mathcal{F},\mathcal{P})$ -- это $\mathcal{S}$-множество $M$
вместе с коллекцией частичных функций $M(\sigma) : \prod_{i \in I} M_{s_i} \to M_s$ для каждого функционального символа $\sigma : \prod_{i \in I} s_i \to s$
и коллекцией отношений $M(R) \subseteq \prod_{i \in I} M_{s_i}$ для каждого предикатного символа $R : \prod_{i \in I} s_i$.

Пусть $V$ -- некоторое $\mathcal{S}$-множество.
Если $t$ -- терм сорта $s$ в сигнатуре $\Sigma$ с переменными в $V$, и $M$ -- интерпретация $\Sigma$, то мы можем определить частичную функцию $M(t) : \prod_{s \in \mathcal{S}} M_s^{V_s} \to M_s$ рекурсией по структуре $t$.
Если $t = x \in V_s$, то $M(t)(f) = f_s(x)$.
Если $t = \sigma(\{ t_i \}_i)$, то $M(t)(f) = M(\sigma)(\{ M(t_i)(f) \}_i)$.
Если $\varphi$ -- формула в сигнатуре $\Sigma$ с переменными в $V$, и $M$ -- интерпретация $\Sigma$, то мы можем определить отношение $M(\varphi) \subseteq \prod_{s \in \mathcal{S}} M_s^{V_s}$.
Если $\varphi$ -- формула вида $t_1 = t_2$, то $M(\varphi)$ состоит из таких $f$, что $M(t_1)(f)$ и $M(t_2)(f)$ определены и $M(t_1)(f) = M(t_2)(f)$.
Если $\varphi$ -- формула вида $R(\{ t_i \}_i)$, то $M(\varphi)$ состоит из таких $f$, что функции $M(t_i)(f)$ определены для всех $i \in I$ и $\{ M(t_i)(f) \}_i \in M(R)$.
Если $\varphi = \bigwedge_{i \in I} \varphi_i$, то $M(\varphi) = \bigcap_{i \in I} M(\varphi_i)$.
Секвенция $\varphi \sststile{}{V} \psi$ верна в интерпретации $M$ если $M(\varphi) \subseteq M(\psi)$.

\begin{defn}
\emph{Модель} теории -- это интерпретация ее сигнатуры такая, что все аксиомы теории верны в этой интерпретации.
\end{defn}

\begin{example}
Теория категорий -- это финитарная теория, состоящая из двух сортов $\fs{ob}$ и $\fs{hom}$, функциональных символов $d,c : \fs{hom} \to \fs{ob}$, $\fs{id} : \fs{ob} \to \fs{hom}$, $\circ : \fs{hom} \times \fs{hom} \to \fs{hom}$ и следующих аксиом:
\begin{align*}
& \sststile{}{f} d(f)\!\downarrow \land c(f)\!\downarrow \\
& \sststile{}{x} d(\fs{id}(x)) = x \land c(\fs{id}(x)) = x \\
c(f) = d(g) & \ssststile{}{f,g} \circ(g,f)\!\downarrow \\
c(f) = d(g) & \sststile{}{f,g} d(\circ(g,f)) = d(f) \land c(\circ(g,f)) = c(g) \\
& \sststile{}{f} \circ(\fs{id}(c(f)),f) = f \land \circ(f,\fs{id}(d(f))) = f \\
c(f) = d(g) \land c(g) = d(h) & \sststile{}{f,g,h} \circ(\circ(h,g),f) = \circ(h,\circ(g,f))
\end{align*}
Первые две аксиомы говорят, что функции $c$, $d$ и $\fs{id}$ тотальны и описывают домен и кодомен морфизма $\fs{id}(x)$.
Третья аксиома говорит, что функция $\circ(g,f)$ определена тогда и только тогда, когда домен $g$ совпадает с кодоменом $f$.
Четвертая аксиома описывает домен и кодомен морфизма $\circ(g,f)$.
Последние две аксиомы говорят, что $\circ$ ассоциативна и $\fs{id}$ является единицей для $\circ$.
Модели этой теории -- это в точности малые категории.
\end{example}

\begin{example}[fc-cats]
Теория конечно полных категорий является расширением теории категорий.
Мы добавляем функциональные символы $1 : \fs{ob}$, $! : \fs{ob} \to \fs{hom}$, $\pi_1,\pi_2 : \fs{hom} \times \fs{hom} \to \fs{hom}$, $\fs{pair} : \fs{hom} \times \fs{hom} \times \fs{hom} \times \fs{hom} \to \fs{hom}$ и следующие аксиомы:
\begin{align*}
& \sststile{}{x} d(!(x)) = x \land c(!(x)) = 1 \\
c(f) = 1 & \sststile{}{f} f =\ !(d(f)) \\
c(f) = c(g) & \ssststile{}{f,g} \pi_1(f,g)\!\downarrow \\
c(f) = c(g) & \ssststile{}{f,g} \pi_2(f,g)\!\downarrow \\
c(f) = c(g) & \sststile{}{f,g} c(\pi_1(f,g)) = d(f) \land c(\pi_2(f,g)) = d(g) \\
c(f) = c(g) & \sststile{}{f,g} d(\pi_1(f,g)) = d(\pi_2(f,g)) \\
\fs{pair}(a,b,f,g)\!\downarrow & \ssststile{}{f,g,a,b} d(a) = d(b) \land c(a) = d(f) \land c(b) = d(g) \land c(f) = c(g) \\
\fs{pair}(a,b,f,g)\!\downarrow & \sststile{}{f,g,a,b} \circ(\pi_1(f,g),\fs{pair}(a,b,f,g)) = a \\
\fs{pair}(a,b,f,g)\!\downarrow & \sststile{}{f,g,a,b} \circ(\pi_2(f,g),\fs{pair}(a,b,f,g)) = b \\
c(h) = d(\pi_1(f,g)) & \sststile{}{f,g,h} \fs{pair}(\circ(\pi_1(f,g),h),\circ(\pi_2(f,g),h),f,g) = h
\end{align*}
Модели этой теории -- это в точности конечно полные малые категории.
\end{example}

Правила вывода \emph{частичной хорновской логики} приведены ниже.
В этом подразделе мы приведем правила только для финитарных теорий, правила для произвольных будут приведены в следующем.
\emph{Теорема} теории -- это секвенция, выводимая из аксиом этой теории при помощи этих правил вывода.
Мы будем писать $\varphi \sststile{T}{V} \psi$ для обозначения того факта, что $\varphi \sststile{}{V} \psi$ является теоремой теории $T$.

\begin{center}
$\varphi \sststile{}{V} \varphi$ \axlabel{b1}
\qquad
\AxiomC{$\varphi \sststile{}{V} \psi$}
\AxiomC{$\psi \sststile{}{V} \chi$}
\RightLabel{\axlabel{b2}}
\BinaryInfC{$\varphi \sststile{}{V} \chi$}
\DisplayProof
\qquad
$\varphi \sststile{}{V} \top$ \axlabel{b3}
\end{center}

\medskip
\begin{center}
$\varphi \land \psi \sststile{}{V} \varphi$ \axlabel{b4}
\qquad
$\varphi \land \psi \sststile{}{V} \psi$ \axlabel{b5}
\qquad
\AxiomC{$\varphi \sststile{}{V} \psi$}
\AxiomC{$\varphi \sststile{}{V} \chi$}
\RightLabel{\axlabel{b6}}
\BinaryInfC{$\varphi \sststile{}{V} \psi \land \chi$}
\DisplayProof
\end{center}

\medskip
\begin{center}
$\sststile{}{V} x\!\downarrow$ \axlabel{a1}
\qquad
$x = y \land \varphi \sststile{}{V} \varphi[y/x]$ \axlabel{a2}
\end{center}

\medskip
\begin{center}
\AxiomC{$\varphi \sststile{}{V,x} \psi$}
\RightLabel{, $x \in \FV(\varphi)$ \axlabel{a3}}
\UnaryInfC{$\varphi[t/x] \sststile{}{V,V'} \psi[t/x]$}
\DisplayProof
\end{center}
\medskip

Эти правила немного отличаются от тех, что приведены в \cite{PHL}.
Правило вывода \axref{a3} там заменено на следующие правила вывода:
\begin{align*}
R(t_1, \ldots t_k) & \sststile{}{V} t_i\!\downarrow \axtag{a4} \\
t_1 = t_2 & \sststile{}{V} t_i\!\downarrow \axtag{a4'} \\
\sigma(t_1, \ldots t_k)\!\downarrow & \sststile{}{V} t_i\!\downarrow \axtag{a5}
\end{align*}

\medskip
\begin{center}
\AxiomC{$\varphi \sststile{}{x_1, \ldots x_n} \psi$}
\RightLabel{\axlabel{a3'}}
\UnaryInfC{$t_1\!\downarrow \land \ldots \land t_n\!\downarrow \land \varphi[t_1/x_1, \ldots t_n/x_n] \sststile{}{V} \psi[t_1/x_1, \ldots t_n/x_n]$}
\DisplayProof
\end{center}
\medskip

\begin{prop}
В присутствии остальных правил вывода, правило \axref{a3} эквивалентно правилам \axref{a3'}, \axref{a4}, \axref{a4'} и \axref{a5}.
\end{prop}
\begin{proof}
Так как секвенции $R(x_1, \ldots x_k) \sststile{}{V} x_i\!\downarrow$, $x_1 = x_2 \sststile{}{V} x_i\!\downarrow$ и $\sigma(x_1, \ldots x_k)\!\downarrow \sststile{}{V} x_i\!\downarrow$ выводимы из \axref{b2}, \axref{b3} и \axref{a1},
то \axref{a3} влечет \axref{a4}, \axref{a4'} и \axref{a5}.
Мы можем доказать, что \axref{a3'} выводимо индукцией по $n$.
Для этого достаточно показать, что следующее правило выводимо:
\medskip
\begin{center}
\AxiomC{$\varphi \sststile{}{V,x} \psi$}
\UnaryInfC{$t\!\downarrow \land \varphi[t/x] \sststile{}{V} \psi[t/x]$}
\DisplayProof
\end{center}
\medskip
Для этого в правиле \axref{a3} достаточно в качестве $\varphi$ взять $x\!\downarrow \land \varphi$.

Теперь покажем, что \axref{a3} выводимо из правил \axref{a3'}, \axref{a4}, \axref{a4'} и \axref{a5}.
По \axref{a3'} из $\varphi \sststile{}{x_1, \ldots x_n, x} \psi$ выводится $x_1\!\downarrow \land \ldots \land x_n\!\downarrow \land t\!\downarrow \land \varphi[t/x] \sststile{}{x_1, \ldots x_n, V'} \psi[t/x]$.
По \axref{b2} и \axref{b6} нам достаточно показать, что $\varphi[t/x] \sststile{}{x_1, \ldots x_n, V'} x_i\!\downarrow$, $\varphi[t/x] \sststile{}{x_1, \ldots x_n, V'} t\!\downarrow$ и $\varphi[t/x] \sststile{}{x_1, \ldots x_n, V'} \varphi[t/x]$.
Первая секвенция следует из \axref{a1}, \axref{b2} и \axref{b3}, а последняя из \axref{b1}.
Докажем, что вторая секвенция выводится.
Если $\varphi$ -- это формула вида $R(t_1, \ldots t_k)$, то $x \in \FV(t_i)$ для некоторого $1 \leq i \leq k$.
По \axref{a4} верно, что $R(t_1[t/x], \ldots t_k[t/x]) \sststile{}{x_1, \ldots x_n, V'} t_i[t/x]\!\downarrow$
Если $\varphi$ -- это формула вида $t_1 = t_2$, то $x \in \FV(t_i)$ для некоторого $1 \leq i \leq 2$.
По \axref{a4'} верно, что $t_1[t/x] = t_2[t/x] \sststile{}{x_1, \ldots x_n, V'} t_i[t/x]\!\downarrow$.
По \axref{b2} достаточно доказать, что секвенция $t'[t/x]\!\downarrow\ \sststile{}{V} t\!\downarrow$ выводима для любого терма $t'$ такого, что $x \in \FV(t')$.
Это легко сделать индукцией по $t'$.
Если $t' = x$, то это верно по \axref{b1}.
Если $t' = \sigma(t_1, \ldots t_k)$, то $x \in \FV(t_i)$ для некоторого $1 \leq i \leq k$.
По \axref{a5} секвенция $\sigma(t_1[t/x], \ldots t_k[t/x])\!\downarrow\ \sststile{}{V} t_i[t/x]\!\downarrow$ выводима.
По индукционной гипотезе $t_i[t/x]\!\downarrow\ \sststile{}{V} t\!\downarrow$.
\end{proof}

Позже нам понадобится следующая лемма:

\begin{lem}[mcf]
Секвенция $\varphi \sststile{}{x_1, \ldots x_n} \psi$ доказуема в финитарной теории $T$ тогда и только тогда,
когда секвенция $\sststile{}{} \psi[c_1/x_1, \ldots c_n/x_n]$ доказуема в теории $T \cup \{ \sststile{}{} c_i\!\downarrow\ \mid 1 \leq i \leq n \} \cup \{ \sststile{}{} \varphi[c_1/x_1, \ldots c_n/x_n] \}$, где $c_1$, \ldots $c_n$ -- новые константы.
\end{lem}
\begin{proof}
Это следует из \cite[Theorem~10, Theorem~11]{PHL}.
\end{proof}

Мы будем говорить, что две теории \emph{эквивалентны}, если их множества функциональных символов, предикатных символов и теорем совпадают.

\subsection{Естественный вывод}

Позже мы встретим несколько утверждений, которые доказываются индукцией по выводу секвенции.
Мы будем работать с секвенциями, левая сторона которых обладает некоторым свойством, но в выводе секвенции в частичной хорновской логике левая сторона может варьироваться произвольным образом.
Таким образом, нам нужно описать эквивалентный набор правил вывода, в котором левая формула не менялась бы.
Мы будем называть эти правила \emph{естественным выводом}.
В этой системе правая сторона секвенций всегда является атомарной формулой.

\begin{center}
\AxiomC{}
\RightLabel{\axlabel{nv}}
\UnaryInfC{$\varphi \sststile{}{V} x\!\downarrow$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} t_1 = t_2$}
\RightLabel{\axlabel{ns}}
\UnaryInfC{$\varphi \sststile{}{V} t_2 = t_1$}
\DisplayProof
\end{center}
\medskip

\begin{center}
\AxiomC{}
\RightLabel{\axlabel{nh}}
\UnaryInfC{$\varphi_1 \land \ldots \land \varphi_n \sststile{}{V} \varphi_i$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} t_1 = t_2$}
\AxiomC{$\varphi \sststile{}{V} \psi[t_1/x]$}
\RightLabel{\axlabel{nl}}
\BinaryInfC{$\varphi \sststile{}{V} \psi[t_2/x]$}
\DisplayProof
\end{center}
\medskip

\begin{center}
\AxiomC{$\varphi \sststile{}{V} R(t_1, \ldots t_n)$}
\RightLabel{\axlabel{np}}
\UnaryInfC{$\varphi \sststile{}{V} t_i\!\downarrow$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} \sigma(t_1, \ldots t_n)\!\downarrow$}
\RightLabel{\axlabel{nf}}
\UnaryInfC{$\varphi \sststile{}{V} t_i\!\downarrow$}
\DisplayProof
\end{center}
где $R$ -- это предикатный символ теории, а $\sigma$ -- функциональный символ.

Наконец, для каждой аксиомы $\psi_1 \land \ldots \land \psi_n \sststile{}{x_1 : s_1, \ldots x_k : s_k} \chi_1 \land \ldots \land \chi_m$
и всех термов $t_1 : s_1$, \ldots $t_k : s_k$ мы добавляем следующее правило для всех $1 \leq j \leq m$:
\begin{center}
\AxiomC{$\varphi \sststile{}{V} t_i\!\downarrow$, $1 \leq i \leq k$}
\AxiomC{$\varphi \sststile{}{V} \psi_i[t_1/x_1, \ldots t_k/x_k]$, $1 \leq i \leq n$}
\RightLabel{\axlabel{na}}
\BinaryInfC{$\varphi \sststile{}{V} \chi_j[t_1/x_1, \ldots t_k/x_k]$}
\DisplayProof
\end{center}

\begin{prop}
Секвенция $\varphi \sststile{}{V} \psi_1 \land \ldots \land \psi_n$ выводима из правил \axref{b1}-\axref{b6}, \axref{a1}-\axref{a3} тогда и только тогда, когда
секвенции $\varphi \sststile{}{V} \psi_1$, \ldots $\varphi \sststile{}{V} \psi_n$ выводимы из правил естественного вывода.
\end{prop}
\begin{proof}
Легко доказать ``только тогда'' направление.
Наоборот, правила \axref{b1}, \axref{b4} и \axref{b5} следуют из \axref{nh},
правила \axref{b3} и \axref{b6} верны тривиально,
правило \axref{a1} следует из \axref{nv},
правило \axref{a2} следует из \axref{nl} и \axref{nh},
и аксиомы выводимы по \axref{na}.

Чтобы доказать правило \axref{b2}, нам достаточно показать, что если секвенции $\varphi \sststile{}{V} \psi_1$, \ldots $\varphi \sststile{}{V} \psi_n$
и $\psi_1 \land \ldots \land \psi_n \sststile{}{V} \chi$ выводимы в естественном выводе, то $\varphi \sststile{}{V} \chi$ также выводима.
Мы можем сконструировать дерево вывода для этой секвенции как дерево вывода для $\psi_1 \land \ldots \land \psi_n \sststile{}{V} \chi$,
в котором левая сторона каждой секвенции заменена на $\varphi$ и правила \axref{nh} заменены на деревья вывода для $\varphi \sststile{}{V} \psi_i$.

Чтобы доказать правило \axref{a3}, рассмотрим дерево вывода для секвенции $\varphi \sststile{}{V} \psi$.
Чтобы сконструировать дерево вывода для $\varphi[t/x] \sststile{}{V,V'} \psi[t/x]$, нам достаточно применить подстановку $t/x$ к каждой секвенции в этом дереве вывода.
Единственное правило, которое не замкнуто относительно подстановки, -- это \axref{nv}.
По предположению $x \in \FV(\varphi)$.
Это влечет, что $\varphi[t/x] \sststile{}{V,V'} t\!\downarrow$ выводима из \axref{np}, \axref{nf} и следующих правил:
\begin{center}
\AxiomC{$\varphi \sststile{}{V} t_1 = t_2$}
\RightLabel{\axlabel{ne1}}
\UnaryInfC{$\varphi \sststile{}{V} t_1\!\downarrow$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} t_1 = t_2$}
\RightLabel{\axlabel{ne2}}
\UnaryInfC{$\varphi \sststile{}{V} t_2\!\downarrow$}
\DisplayProof
\end{center}
Правило \axref{ne2} следует из \axref{nl} если мы возьмем $\psi(x)$ равным $x = b$.
Правило \axref{ne1} следует из \axref{ne2} и \axref{ns}.
\end{proof}

Теперь мы можем привести правила вывода для инфинитарных теорий.
Большинство правил вывода остаются прежними с очевидными поправками:

\begin{center}
\AxiomC{}
\RightLabel{\axlabel{iv}}
\UnaryInfC{$\varphi \sststile{}{V} x\!\downarrow$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} t_1 = t_2$}
\RightLabel{\axlabel{is}}
\UnaryInfC{$\varphi \sststile{}{V} t_2 = t_1$}
\DisplayProof
\qquad
\AxiomC{}
\RightLabel{\axlabel{ih}}
\UnaryInfC{$\bigwedge_{i \in I} \varphi_i \sststile{}{V} \varphi_i$}
\DisplayProof
\end{center}
\medskip

\begin{center}
\AxiomC{$\varphi \sststile{}{V} R(\{ t_i \}_i)$}
\RightLabel{\axlabel{ip}}
\UnaryInfC{$\varphi \sststile{}{V} t_i\!\downarrow$}
\DisplayProof
\qquad
\AxiomC{$\varphi \sststile{}{V} \sigma(\{ t_i \}_i)\!\downarrow$}
\RightLabel{\axlabel{if}}
\UnaryInfC{$\varphi \sststile{}{V} t_i\!\downarrow$}
\DisplayProof
\end{center}
где $R$ -- это предикатный символ теории, а $\sigma$ -- функциональный символ.

Для каждой аксиомы $\bigwedge_{i \in I} \psi_i \sststile{}{V} \bigwedge_{j \in J} \chi_j$
и всех термов $\{ t_i \}_{i \in V}$ мы добавляем следующее правило для всех $j \in J$:
\begin{center}
\AxiomC{$\varphi \sststile{}{V'} t_x\!\downarrow$, $x \in V$}
\AxiomC{$\varphi \sststile{}{V'} \psi_i[t_x/x,]$, $i \in I$}
\RightLabel{\axlabel{ia}}
\BinaryInfC{$\varphi \sststile{}{V'} \chi_j[t_x/x]$}
\DisplayProof
\end{center}

Правило \axref{nl} удобно разбить на несколько правил:

\begin{center}
\AxiomC{$\varphi \sststile{}{V} t_1 = t_2$}
\AxiomC{$\varphi \sststile{}{V} t_2 = t_3$}
\RightLabel{\axlabel{it}}
\BinaryInfC{$\varphi \sststile{}{V} t_1 = t_3$}
\DisplayProof
\end{center}
\medskip

\begin{center}
\AxiomC{$\varphi \sststile{}{V} a_i = b_i$, $i \in I$}
\AxiomC{$\varphi \sststile{}{V} \sigma(\{ a_i \}_i)\!\downarrow$}
\RightLabel{\axlabel{ic}}
\BinaryInfC{$\varphi \sststile{}{V} \sigma(\{ a_i \}_i) = \sigma(\{ b_i \}_i)$}
\DisplayProof
\end{center}
\medskip

\begin{center}
\AxiomC{$\varphi \sststile{}{V} a_i = b_i$, $i \in I$}
\AxiomC{$\varphi \sststile{}{V} R(\{ a_i \}_i)$}
\RightLabel{\axlabel{ii}}
\BinaryInfC{$\varphi \sststile{}{V} R(\{ b_i \}_i)$}
\DisplayProof
\end{center}
\medskip

Легко видеть, что в финитарном случае эти правила эквивалентны \axref{nl}.

\subsection{Классифицирующая категория теории}

В этом подразделе для каждой достижимой теории $T$ мы определим категорию $\cat{C}_T$, которая называется \emph{классифицирующей категорией} этой теории.

\emph{Производный сорт} некоторой теории -- это класс эквивалентности пар $(V,\varphi)$, состоящих из $\mathcal{S}$-множества $V$ и формулы $\varphi$ с переменными в $V$.
Две такие пары $(V,\varphi)$ и $(V',\varphi')$ эквивалентны если существует биекция $h : V \simeq V'$ такая, что формулы $\varphi[h]$ и $\varphi'$ эквивалентны.
Мы будем записывать сорт, соответствующий такой паре как $\{ \overline{x} : \prod V \mid \varphi(\overline{x}) \}$ или более коротко как $\{ \overline{x} \mid \varphi(\overline{x}) \}$.
Кроме того, производный сорт может быть записан как $\{ \overline{x} : \prod_{i \in I} s_i \mid \varphi(\overline{x}) \}$, где $I$ -- некоторое множество, а $s_i$ -- некоторый сорт.
Если $s = (V,\varphi)$ -- производный сорт, то мы будем обозначать $V$ как $\FV(s)$.
Мы будем говорить, что производный сорт является \emph{$\lambda$-достижимым} для некоторого регулярного кардинала $\lambda$, если $|V| < \lambda$ и $\varphi = \bigwedge_{i \in I} \varphi_i$, где $|I| < \lambda$ и $\varphi_i$ -- атомарные формулы.

Пусть $\{ s_i \}_{i \in I}$ -- множество производных сортов таких, что $s_i = \{ \overline{x} : \prod V_i \mid \varphi_i \}$ и $s = \{ \overline{x} : \prod W \mid \psi \}$ -- еще один производный сорт.
Тогда \emph{суженный производный терм} $t$ сигнатуры $\prod_{i \in I} s_i \to s$ -- это пара, состоящая из $W$-множества термов $\{ t_k \}_{k \in W}$ и формулы $\chi$ с переменными в $\amalg_{i \in I} \FV(s_i)$, такая, что $t_k$ имеет сорт $s'_k$,
и выводима секвенция $\bigwedge_{k \in W} t_k\!\downarrow \land \chi \sststile{}{\amalg_{i \in I} \FV(s_i)} \psi[\{t_k/k\}_{k \in W}] \land \bigwedge_{i \in I} \varphi_i$
(мы будем говорить, что терм \emph{определен} в некоторой теории для обозначения того факта, что в ней выводима эта секвенция).
Мы будем записывать такую пару как $\{ t_k \}_{k \in W}|_\chi$ или просто $\{ t_k \}_k|_\chi$.
Если $W = \{ 1, \ldots k \}$, то такую пару можно записывать как $(t_1, \ldots t_k)|_\chi$.

Теперь мы можем определить классифицирующую категорию $\cat{C}_T$ теории $T$.
Объекты категории $\cat{C}_T$ -- это производные сорта $T$.
Морфизм между объектами $s = \{ \overline{x} : \prod V \mid \varphi \}$ и $s' = \{ \overline{x} : \prod W \mid \psi \}$ -- это класс эквивалентности суженных производных термов $\{ t_k \}_{k \in W}|_\chi$ сигнатуры $s \to s'$ таких,
что выводима секвенция $\varphi \sststile{}{\FV(s)} \bigwedge_{k \in W} t_k\!\downarrow \land \chi$.
Два терма $\{ t_k \}_{k \in W}$ и $\{ t'_k \}_{k \in W'}$ эквивалентны, если существует биекция $h : W \simeq W'$ такая, что выводима секвенция $\varphi \sststile{}{\FV(s)} \bigwedge_{k \in W'} t_k[h] = t'_k$.

Тождественный морфизм на объекте $\{ \overline{x} : \prod V \mid \varphi \}$ -- это терм $\{ x_i \}_{i \in V}|_\varphi$.
Композиция морфизмов $\{ t_i \}_{i \in I}|_\chi : \{ \overline{x} \mid \varphi \} \to \{ \overline{y} \mid \varphi' \}$
и $\{ t'_j \}_{j \in J}|_\chi' : \{ \overline{y} \mid \varphi' \} \to \{ \overline{z} \mid \varphi'' \}$ -- это терм $\{ t'_j[\rho] \}_j|_{\chi'[\rho] \land \chi \land \bigwedge_{i \in I} t_i \downarrow}$, где $\rho(i) = t_i$.
Легко видеть, что это определение корректно и действительно задает категорию.

\begin{remark}
На производные сорта можно смотреть как на модели $T$.
С этой точки зрения если $(V,\varphi)$ -- производный сорт, то $V$ -- это множество порождающих элементов модели, а $\varphi$ -- это множество соотношений.
Таким образом, если производный сорт является $\lambda$-достижимым, то соответствующая модель является $\lambda$-представимой.
\end{remark}

Категория $\cat{C}_T$ не является малой.
Если теория $T$ является $\lambda$-достижимой, то мы можем определить малую полную подкатегорию $\cat{C}_T^\lambda$ категории $\cat{C}_T$, состоящую из $\lambda$-достижимых производных сортов.
Часто под классифицирующей категорией теории $T$ подразумевают $\cat{C}_T^\lambda$, но мы будем называть такую каетегорию \emph{$\lambda$-классифицирующей},
так как любая $\lambda$-достижимая теория является $\mu$-достижимой для $\mu > \lambda$, но категории $\cat{C}_T^\lambda$ и $\cat{C}_T^\mu$ не эквивалентны, поэтому их необходимо различать.

\begin{remark}
Мы определяем $\lambda$-классифицирующую категорию только для теорий, являющихся $\lambda$-достижимыми,
так как только в этом случае эта категория содержит достаточно информации для восстановления по ней исходной теории.
\end{remark}

\begin{prop}[class-cat]
Категория $\cat{C}_T$ является полной, а в категрии $\cat{C}_T^\lambda$ существуют все $\lambda$-малые пределы.
Если $T$ является $\lambda$-достижимой теорией, то $\cat{C}_T^\fs{op}$ является локально $\lambda$-представимой категорией.
\end{prop}
\begin{proof}
Если $\{ t_i \}_{i \in I}|_\varphi$ и $\{ t_i' \}_{i \in I}|_{\varphi'}$ -- пара морфизмов сигнатуры $s \to s'$ в $\cat{C}_T$ или $\cat{C}_T^\lambda$,
то их уравнитель можно определить как сужение $s$ на формулу $\bigwedge_{i \in I} t_i = t_i'$.
Пусть $\{ s_i \}_{i \in I}$ -- множество производных сортов, где $s_i = (V_i,\varphi_i)$.
Тогда их произведение можно определить как $(\coprod_{i \in I} V_i, \bigwedge_{i \in I} \varphi_i[(i,x)/x])$.
Если $s_i$ -- объекты $\cat{C}_T^\lambda$ и $|I| < \lambda$, то это произведение также является объектом $\cat{C}_T^\lambda$, так как $\lambda$ -- регулярный кардинал.

Мы только что видели, что в $\cat{C}_T^\fs{op}$ существуют все копределы.
Так как любой объект этой категории является копределом сортов, нам достаточно доказать, что сорта являются $\lambda$-представимыми объектами в этой категории.
Это означает, что нам нужно показать, что следующая каноническая функция является биекцией для любого сорта $s$ и любой $\lambda$-направленной диаграммы $X : I \to \cat{C}_T^\fs{op}$.
\[ f : \colim_{i \in I} \Hom_{\cat{C}_T}(X_i, s) \to \Hom_{\cat{C}_T}(\fs{lim}_{i \in I}(X_i), s) \]

Предел $\fs{lim}_{i \in I}(X_i)$ может быть записан как $\{ \overline{x} : \prod_{i \in I} s_i \mid \varphi \}$, где $s_i$ -- производные сорта, и $\varphi$ -- некоторая формула.
Пусть $t$ -- суженный производный терм сигнатуры $\prod_{i \in I} s_i \to s$.
Так как символы теории $T$ являются $\lambda$-достижимыми, множество $i$ для которых переменные из $\FV(s_i)$ встречаются в $t$ имеет мощность $< \lambda$.
Так как $I$ является $\lambda$-направленным множеством, то отсюда следует, что $t$ эквивалентен терму вида $f(t')$.

Нам осталось доказать инъективность $f$.
Пусть $t,t'$ -- пара суженных производных термов сигнатуры $s_i \to s$ для некоторого $i \in I$ таких, что $\varphi \sststile{T}{\amalg_{i \in I} \FV(s_i)} t = t'$.
Так как теория $T$ является $\lambda$-достижимой, множество атомарных формул из $\varphi$, которые используются в этом выводе, имеет мощность $< \lambda$.
Так как каждая атомарная формула из $\varphi$ верна в $X_j$ для некоторого $j \in I$, и $I$ является $\lambda$-направленным множеством, то отсюда следует, что $t$ и $t'$ равны как элементы $\Hom_{\cat{C}_T}(X_j, s)$ для некоторого $j \in I$.
\end{proof}

\begin{remark}
В \pprop{cart-mod-dual} мы докажем, что категория $\cat{C}_T^\fs{op}$ эквивалентна категории моделей $T$.
\end{remark}

В \cite{PHL} приводится другое определение $\aleph_0$-классифицирующей категории для финитарных теорий.
Она определяется как начальный объект теории $\mathrm{Cart} \overline{\omega} T$.
Эта теория является расширением теории, описанной в \pexample{fc-cats}.
Для каждого сорта $s$ теории $T$ мы добавляем константу $\upgamma^s : \fs{ob}$ и аксиому $\sststile{}{} \upgamma^s\!\downarrow$.
Для каждого предикатного символа $R : s_1 \times \ldots \times s_n$ теории $T$ мы добавляем константу $\upgamma^R : \fs{hom}$
и аксиому $\sststile{}{} c(\upgamma^R) = \upgamma^{s_1} \times \ldots \times \upgamma^{s_n} \land \fs{Mon}(\upgamma^R)$,
где $X \times Y$ -- декартово произведение объектов, которое определяется очевидным образом в теории конечно полных категорий, и $\fs{Mon}(f)$ -- предикат,
утверждающий, что $f$ является мономорфизмом (это верно тогда и только тогда, когда $\pi_1(f,f) = \pi_2(f,f)$).
Для каждого функционального символа $\sigma : s_1 \times \ldots \times s_n \to s$ теории $T$ мы добавляем константы $\upgamma^\sigma_d, \upgamma^\sigma_m : \fs{hom}$ и аксиому
$\sststile{}{} c(\upgamma^\sigma_m) = \upgamma^{s_1} \times \ldots \times \upgamma^{s_n} \land c(\upgamma^\sigma_d) = \upgamma^s \land d(\upgamma^\sigma_d) = d(\upgamma^\sigma_m) \land \fs{Mon}(\upgamma^\sigma_m)$.
Идея заключается в том, что $\upgamma^\sigma_m$ задает некоторый подобъект домена $\sigma$, а $\upgamma^\sigma_d$ является морфизмом из этого подобъекта в кодомен $\sigma$.
То есть такая пара морфизмов -- это в точности частичный морфизм из домена $\sigma$ в его кодомен.

В \cite[Section~8]{PHL} описана категориальная семантика частичных хорновских теорий.
В частности, она описывает интерпретацию термов и формул.
Если $V = \{ x_1 : s_1, \ldots x_n : s_n \}$ -- упорядоченное множество переменных, а $t$ -- терм сорта $s$ такой, что $\FV(t) \subseteq V$,
то категориальная семантика дает нам пару морфизмов $\upgamma^t_d$ и $\upgamma^t_m$, задающих частичный морфизм из $\upgamma^{s_1} \times \ldots \times \upgamma^{s_n} \to \upgamma^s$.
Если $\varphi$ -- формула такая, что $\FV(\varphi) \subseteq V$, то по категориальной семантике мы получаем мономорфизм $\gamma^\varphi$, задающий подобъект $\upgamma^{s_1} \times \ldots \times \upgamma^{s_n}$.

Для каждой аксиомы $a$ вида $\varphi \sststile{}{V} \psi$ мы добавляем константу $\upgamma^a : \fs{hom}$ и аксиому $\sststile{}{} \upgamma^\varphi = \circ(\upgamma^\psi,\upgamma^a)$.
Это завершает определение теории $\mathrm{Cart} \overline{\omega} T$.
Нам понадобятся следующие утверждения, доказанные в \cite[Lemma~39]{PHL}, \cite[Lemma~40]{PHL} и \cite[Theorem~41]{PHL}:

\begin{lem}[term-subst]
Если $V = \{ x_1 : s_1, \ldots x_n : s_n \}$ и $V' = \{ y_1 : s_1', \ldots y_k : s_k' \}$ -- два упорядоченных множества переменных, $t'$ -- терм такой, что $\FV(t') \subseteq V'$,
и $(t_1, \ldots t_k)$ -- список термов таких, что $\FV(t_i) \subseteq V$ и $t_i$ имеет сорт $s_i'$.
Тогда ограничение частичного морфизма $\upgamma^{t'[t_1/y_1, \ldots t_k/y_k] \land t_1 \land \ldots \land t_k}$ на пересечение подобъектов $\upgamma^{t_i}_m$ изоморфно композиции частичных морфизмов $\gamma^{\langle t_1, \ldots t_k \rangle}$ и $\gamma^{t'}$,
где $\gamma^{\langle t_1, \ldots t_k \rangle}$ -- это морфизм из пересечения подобъектов $\upgamma^{t_i}_m$, который задается как $\langle t_1, \ldots t_k \rangle$.
\end{lem}

\begin{lem}[form-subst]
Если $V = \{ x_1 : s_1, \ldots x_n : s_n \}$ и $V' = \{ y_1 : s_1', \ldots y_k : s_k' \}$ -- два упорядоченных множества переменных, $\psi$ -- формула такая, что $\FV(\psi) \subseteq V'$,
и $(t_1, \ldots t_k)$ -- список термов таких, что $\FV(t_i) \subseteq V$ и $t_i$ имеет сорт $s_i'$.
Тогда подобъект $\upgamma^{\psi[t_1/y_1, \ldots t_k/y_k] \land t_1 \land \ldots \land t_k}$ изоморфен $j \circ p$, где $j$ -- пересечение подобъектов $\upgamma^{t_i}_m$, а $p$ -- прообраз $\upgamma^\psi$ вдоль $\langle t_1, \ldots t_k \rangle$.
\end{lem}

\begin{thm}[phl-sound]
Если секвенция $\varphi \sststile{}{V} \psi$ выводима, то $\upgamma^\varphi$ является подобъектом $\upgamma^\psi$.
\end{thm}

Начальную модель этой теории мы будем обозначать $\cat{C}_T'$.
Определение моделей будет приведено в подразделе~\ref{sec:models}.
Теперь мы можем доказать, что эта категория эквивалентна $\aleph_0$-классифицирующей категории для финитарных теорий.
Мы не будем использовать это утверждение нигде в этом тексте, и оно приведено просто для демонстрации того, что два определения классифицирующей категории согласованы.

\begin{prop}
Для любой финитарной теории $T$ категории $\cat{C}_T^{\aleph_0}$ и $\cat{C}_T'$ эквивалентны.
\end{prop}
\begin{proof}
Во-первых, покажем, что $\cat{C}_T^{\aleph_0}$ является моделью $\mathrm{Cart} \overline{\omega} T$.
Эта категория конечно полная.
Действительно, $\{ () \mid \top \}$ является терминальным объектом.
Если $(t_1, \ldots t_k)|_\tau : \{ \overline{x} \mid \varphi \} \to \{ \overline{z} \mid \chi \}$ и $(t_1', \ldots t_k')|_{\tau'} : \{ \overline{y} \mid \psi \} \to \{ \overline{z} \mid \chi \}$ -- два морфизма в $\cat{C}_T^{\aleph_0}$,
то их послойное произведение можно определить как $\{ \overline{x}, \overline{y} \mid \varphi \land \psi \land t_1 = t_1' \land \ldots \land t_k = t_k' \}$.
Легко видеть, что этот объект обладает необходимым универсальным свойством.

Константа $\upgamma^s$ интерпретируется как $\{ x : s \mid \top \}$.
Константа $\upgamma^R$ интерпретируется как
\[ (x_1, \ldots x_n)|_{R(x_1, \ldots x_n)} : \{ (x_1, \ldots x_n) \mid R(x_1, \ldots x_n) \} \to \{ (x_1, \ldots x_n) \mid \top \}. \]
Константа $\upgamma^\sigma_m$ интерпретируется как
\[ (x_1, \ldots x_n)|_{\sigma(x_1, \ldots x_n) \downarrow} : \{ (x_1, \ldots x_n) \mid \sigma(x_1, \ldots x_n)\!\downarrow \} \to \{ (x_1, \ldots x_n) \mid \top \}. \]
Константа $\upgamma^\sigma_d$ интерпретируется как
\[ \sigma(x_1, \ldots x_n)|_{\sigma(x_1, \ldots x_n) \downarrow} : \{ (x_1, \ldots x_n) \mid \sigma(x_1, \ldots x_n)\!\downarrow \} \to \{ y \mid \top \}. \]
Чтобы проинтерпретировать константу $\upgamma^a$, соответствующую аксиоме $\varphi \sststile{}{V} \psi$, достаточно показать, что подобъект $\upgamma^\varphi$ вкладывается в $\upgamma^\psi$.
Для этого достаточно показать, что для любой формулы $\varphi$ подобъекты $\overline{x}|_\varphi : \{ \overline{x} \mid \varphi \} \to \{ \overline{x} \mid \top \}$ и $\upgamma^\varphi$ эквивалентны.
Легко индукцией по структуре терма $t$ показать, что подобъекты $\upgamma^t_m$ и $\overline{x}|_{t \downarrow} : \{ \overline{x} \mid t\!\downarrow \} \to \{ \overline{x} \mid \top \}$ эквивалентны
и $\upgamma^t_d$ соответствует морфизму $t : \{ \overline{x} \mid t\!\downarrow \} \to \{ y \mid \top \}$.
Используя этот факт, легко показать необходимое свойство формул.

Таким образом, $\cat{C}_T^{\aleph_0}$ действительно является моделью $\mathrm{Cart} \overline{\omega} T$.
Следовательно существует уникальный функтор $F : \cat{C}_T' \to \cat{C}_T^{\aleph_0}$, являющийся морфизмом моделей.
Постороим функтор $G$ в обратную сторону.
Объект $\{ \overline{x} \mid \varphi \}$ отображается в $d(\gamma^\varphi)$.
Если $(t_1, \ldots t_k)|_\chi : \{ \overline{x} \mid \varphi \} \to \{ \overline{y} \mid \psi \}$ -- морфизм, то секвенция $\varphi \sststile{}{\overline{x}} \psi[t_1/y_1, \ldots t_k/y_k]$ выводима.
\Rthm{phl-sound} влечет, что $\upgamma^\varphi$ является подобъектом $\upgamma^{\psi[t_1/y_1, \ldots t_k/y_k]}$.
По \dlem{form-subst} у нас есть стрелка $d(\upgamma^{\psi[t_1/y_1, \ldots t_k/y_k] \land t_1\!\downarrow \land \ldots \land t_k\!\downarrow}) \to d(\upgamma^\psi)$.
Мы определяем $G(t_1, \ldots t_k)$ как композицию этих двух стрелок.
Легко видеть, что $G$ сохраняет тождественные морфизмы.
\Rlem{term-subst} влечет, что $G$ сохраняет композицию.

Мы не можем воспользоваться универсальным свойством $\cat{C}_T'$, чтобы доказать, что $G \circ F = \fs{Id}$, так как $G$ не является морфизмом моделей $\mathrm{Cart} \overline{\omega} T$.
Вместо этого мы построим естественный изоморфизм между этими функторами.
Для этого мы определим частичную функцию $\alpha$ на замкнутых термах $t$ теории $\mathrm{Cart} \overline{\omega} T$ таких, что $\sststile{T}{} t\!\downarrow$.
Эта функция будет удовлетворять следующим условиям:
\begin{itemize}
\item Если $t$ имеет сорт $\fs{ob}$ и определен, то $\alpha_t$ -- это морфизм $GF(t) \to t$.
\item Если $t$ имеет сорт $\fs{hom}$ и определен, то $\alpha_t$ -- это пара морфизмов $\alpha_t^d : GF(d(t)) \to d(t)$ и $\alpha_t^c : GF(c(t)) \to c(t)$.
\end{itemize}
Функция $\alpha_t$ определяется рекурсией по $t$:
\begin{itemize}
\item $\alpha_{d(f)} = \alpha^d_f$ и $\alpha_{c(f)} = \alpha^c_f$.
\item $\alpha^d_{\mathrm{id}(x)} = \alpha^c_{\mathrm{id}(x)} = \alpha_x$.
\item $\alpha^d_{\circ(g,f)}$ и $\alpha^c_{\circ(g,f)}$ определены если $\sststile{\mathrm{Cart} \overline{\omega} T}{} \alpha^c_f = \alpha^d_g$.
В этом случае $\alpha^d_{\circ(g,f)} = \alpha^d_f$ и $\alpha^c_{\circ(g,f)} = \alpha^c_g$.
\item $\alpha^d_{!(x)} = \alpha_x$ и $\alpha^c_{!(x)} = \alpha_1 =\ !(GF(1))$.
\item $\alpha_{\pi_i(f_1,f_2)}$ определено если $\sststile{\mathrm{Cart} \overline{\omega} T}{} \alpha^c_{f_1} = \alpha^c_{f_2}$.
В этом случае $\alpha^d_{\pi_i(f_1,f_2)} = \fs{pair}(\circ(\alpha^d_{f_1},GF(\pi_1(f_1,f_2))),\circ(\alpha^d_{f_2},GF(\pi_2(f_1,f_2))),f_1,f_2)$ и $\alpha^c_{\pi_i(f_1,f_2)} = \alpha^d_{f_i}$.
\item $\alpha_{\fs{pair}(a,b,f,g)}$ определено если $\sststile{\mathrm{Cart} \overline{\omega} T}{} \alpha^d_a = \alpha^d_b \land \alpha^c_a = \alpha^d_f \land \alpha^c_b = \alpha^d_g \land \alpha^c_f = \alpha^c_g$.
В этом случае $\alpha^d_{\fs{pair}(a,b,f,g)} = \alpha^d_a$ и $\alpha^c_{\fs{pair}(a,b,f,g)} = \alpha^d_{\pi_1(f_1,f_2)}$.
\item Так как $GF(\upgamma^s) = \upgamma^s$, то мы можем определить $\alpha_{\upgamma^s}$ как $\mathrm{id}(\upgamma^s)$.
\item $GF(d(\upgamma^R)) = d(\upgamma^{R(x_1, \ldots x_n)})$. Этот объект изоморфен $d(\upgamma^R)$, так что мы можем определить $\alpha^d_{\upgamma^R}$ как этот изоморфизм.
Кроме того, мы определяем $\alpha^c_{\upgamma^R}$ как $\alpha_{\upgamma^{s_1} \times \ldots \times \upgamma^{s_n}}$.
\item Мы определяем $\alpha^d_{\upgamma^\sigma_m}$ и $\alpha^d_{\upgamma^\sigma_d}$ как изоморфизм между $d(\upgamma^{\sigma(x_1, \ldots x_n) \downarrow})$ и $d(\upgamma^\sigma)$.
Мы определяем $\alpha^c_{\upgamma^\sigma_m}$ как $\alpha_{\upgamma^{s_1} \times \ldots \times \upgamma^{s_n}}$ и $\alpha^c_{\upgamma^\sigma_d}$ как $\alpha_{\upgamma^s}$.
\item $\alpha^d_{\upgamma^a} = \alpha^d_{\upgamma^\varphi}$ и $\alpha^c_{\upgamma^a} = \alpha^d_{\upgamma^\psi}$.
\end{itemize}
Индукцией по естественному выводу секвенции $\sststile{}{} t = s$ легко показать, что $\alpha_t$ и $\alpha_s$ определены, если $t$ и $s$ имеют сорт $\fs{ob}$, то секвенция $\sststile{}{} \alpha_t = \alpha_s$ выводима,
и если $t$ и $s$ имеют сорт $\fs{hom}$, то секвенция $\sststile{}{} \alpha^d_t = \alpha^d_s \land \alpha^c_t = \alpha^c_s \land \circ(t,\alpha^d_t) = \circ(\alpha^c_t,GF(t))$ выводима.
Это влечет, что $\alpha$ задает естественное преобразование между функторами $G \circ F$ и $\fs{Id}$.
Легко видеть, что это преобразование является изоморфизмом.

Нам осталось доказать, что $F \circ G$ изоморфен $\fs{Id}$.
Пусть $X = \{ \overline{x} : \overline{s} \mid \varphi \}$ -- объект $\cat{C}_T^{\aleph_0}$.
Тогда $FG(X) = F(d(\upgamma_\varphi))$.
Мы уже видели в начале доказательства, что этот объект изоморфен исходному объекту $X$.
Легко видеть, что этот изоморфизм естественен.
\end{proof}

\subsection{Категория теорий}

В этом подразеделе мы определим категорию теорий, с которой мы будем работать на протяжении данного текста.
Нам понадобится ввести вспомогательные определения.
\emph{Суженный терм} -- это пара из терма $t$ и формулы $\varphi$.
Мы будем обозначать такой терм как $t|_\varphi$.
Если мы думаем о термах как о представлении частичных функций, то мы можем думать о суженном терме $t|_\varphi$ как о сужении частичной функции, представленной $t$, на пересечение ее домена и подмножества, представленного $\varphi$.
Любой терм $t$ является суженным термом $t|_\top$.

\begin{remark}
Мы определяли ранее понятие суженного производного терма.
Суженный терм сорта $s$ с переменными в $V$ -- это в точности суженный производный терм сигнатуры $V \to s$.
\end{remark}

Мы будем использовать следующие сокращения:
\begin{align*}
\varphi[ \{ t_i|_{\varphi_i}/x_i \}_{i \in \FV(\varphi)}] & = \varphi[\{ t_i/x_i \}_{i \in \FV(\varphi)}] \land \bigwedge_{i \in \FV(\varphi)} \varphi_i \\
t|_\varphi[ \{ t_i|_{\varphi_i}/x_i \}_{i \in \FV(t|_\varphi)}] & = t[\{ t_i/x_i \}_{i \in \FV(t)}]|_{\varphi[\{ t_i/x_i \}_{i \in \FV(\varphi)}] \land \bigwedge_{i \in \FV(t|_\varphi)} \varphi_i} \\
t|_\varphi|_\psi & = t|_{\varphi \land \psi} \\
R(\{ t_i|_{\varphi_i} \}_{i \in I}) & \Longleftrightarrow R(\{ t_i \}_{i \in I}) \land \bigwedge_{i \in I} \varphi_i \\
t|_\varphi = t'|_\psi & \Longleftrightarrow t = t' \land \varphi \land \psi \\
t|_\varphi\!\downarrow & \Longleftrightarrow t\!\downarrow\!\land \varphi \\
\chi \sststile{}{V} t|_\varphi \cong t'|_\psi & \Longleftrightarrow \chi \land t|_\varphi\!\downarrow\,\sststile{}{V} t = t' \land \psi \text{ и } \chi \land t'|_\psi\!\downarrow\,\sststile{}{V} t = t' \land \varphi
\end{align*}
Мы будем говорить, что формулы $\varphi$ и $\psi$ с переменными в $V$ эквивалентны, если следующая секвенция выводима:
\[ \varphi \ssststile{}{V} \psi \]
Мы будем говорить, что суженные термы $t$ и $t'$ с переменными в $V$ эквивалентны, если следующая секвенция выводима:
\[ \sststile{}{V} t \cong t' \]

Теперь мы можем определить категорию теорий с фиксированным множеством сортов.
Пусть $\Sigma = (\mathcal{S},\mathcal{F},\mathcal{P})$ и $\Sigma' = (\mathcal{S}',\mathcal{F}',\mathcal{P}')$ -- две сигнатуры с одинаковым множеством сортов.
Тогда \emph{интерпретация} $\Sigma$ в $\Sigma'$ -- это функция, сопоставляющая каждому сорту из $\mathcal{S}$ сорт из $\mathcal{S}'$, каждому функциональному символу $\sigma \in \mathcal{F}$, $\sigma : \prod_{i \in I} s_i \to s$,
суженный терм $f(\sigma)$ в $\Sigma'$ сорта $s$ с переменными в $I$, и каждому предикатному символу $R \in \mathcal{P}$, $R : \prod_{i \in I} s_i$, формулу $f(R)$ в $\Sigma'$ с переменными в $I$.

Пусть $f$ -- интерпретация $\Sigma$ в $\Sigma'$.
Тогда для любого терма $t$ в $\Sigma$ мы можем определить суженный терм $f(t)$ в $\Sigma'$.
Если $t = x$ -- переменная, то $f(t) = x$.
Если $t = \sigma(\{ t_i \}_{i \in I})$, то $f(t) = f(\sigma)[\{ f(t_i)/i \}_{i \in I}]|_{\bigwedge_{i \in I} f(t_i) \downarrow}$.
Для любой формулы $\varphi$ в $\Sigma$ мы можем определить формулу $f(\varphi)$ в $\Sigma'$.
Если $\varphi = (t = t')$, то $f(\varphi) = (f(t) = f(t'))$.
Если $\varphi = R(\{ t_i \}_{i \in I})$, то $f(\varphi) = f(R)[\{ f(t_i)/i \}_{i \in I}] \land \bigwedge_{i \in I} f(t_i)\!\downarrow$.

Пусть $T$ и $T'$ -- пара теорий.
Тогда \emph{интерпретация} $T$ в $T'$ -- это интерпретация $f$ сигнатуры $T$ в сигнатуре $T'$ такая,
что для любой аксиомы $\varphi \sststile{}{V} \psi$ теории $T$ секвенция $f(\varphi) \sststile{}{V} f(\psi)$ выводима в $T'$.
Мы будем говорить, что интерпретации $f$ и $f'$ \emph{эквивалентны}, если для всех функциональных символов $\sigma$ термы $f(\sigma)$ и $f'(\sigma)$ эквивалентны и для всех предикатных символов $R$ формулы $f(R)$ и $f(R')$ тоже эквивалентны.
\emph{Морфизм} теорий $T$ и $T'$ -- это класс эквивалентности интерпретаций.

Тождественные морфизмы определяются очевидным образом.
Композиция морфизмов $f : T \to T'$ и $g : T' \to T''$ определяется следующим образом: $(g \circ f)(S) = g(f(S))$ для всех символов $S$ теории $T$.
Легко индукцией по $t$ показать, что если $g$ и $g'$ эквивалентны, то $g(t)$ и $g'(t)$ тоже эквивалентны.
Кроме того, легко индукцией по выводу показать, что если $\varphi \sststile{}{V} \psi$ выводима, то $g(\varphi) \sststile{}{V} g(\psi)$ тоже выводима.
Из этих двух фактов следует, что композиция определена корректно.

Очевидно, что для любого морфизма теорий $f : T \to T'$ у нас есть равенства $f \circ \fs{id}_T = \fs{id}_{T'} \circ f = f$.
Индукцией по терму $t$ легко показать, что для всех морфизмов теорий $f : T \to T'$ и $g : T' \to T''$ суженные термы $g(f(t))$ и $(g \circ f)(t)$ эквивалентны.
Аналогично для каждой формулы $\varphi$ теории $T$ формулы $g(f(\varphi))$ и $(g \circ f)(\varphi)$ эквивалентны.
Из этих двух фактов следует, что композиция морфизмов теорий ассоциативна.
Категория теорий будет обозначаться как $\Th$.

Мы будем говорить, что интерпретация теорий $f : T \to T'$ \emph{$\lambda$-достижим}, если для всех предикатных символов $R$ теории $T$ формула $f(R)$ является $\lambda$-достижимой
и для всех функциональных символов $\sigma$ теории $T$, если $f(\sigma) = t|_\varphi$, то формула $\varphi$ является $\lambda$-достижимой.
Морфизм теорий является \emph{$\lambda$-достижимым}, если он является классом эквивалентности некоторой $\lambda$-достижимой интерпретации.
Категорию $\lambda$-достижимых теорий и $\lambda$-достижимых морфизмов мы будем обозначать как $\Th^\lambda$.

Пусть $f : \mathcal{S} \to \mathcal{S}'$ -- некоторая функция, и $B = (\mathcal{S},\mathcal{F},\mathcal{P},\mathcal{A})$ -- некоторая теория.
Тогда мы можем определить теорию $f^*(B)$ как $(\mathcal{S}',\mathcal{F},\mathcal{P},\mathcal{A})$,
где для любого функционального символа $\sigma : \prod_{i \in I} s_i \to s$ из $B$ мы добавляем функциональный символ $\sigma : \prod_{i \in I} f(s_i) \to f(s)$ и аналогично для предикатных символов.
Мы будем говорить, что морфизм теорий $f : B \to T$ является \emph{расширением} $B$, если $T$ содержит $f^*(B)$ как подтеорию.
Морфизмы расширений -- это морфизмы теорий, сохраняющие символы из $B$.

\begin{lem}[th-ext]
Для любой теории $B$ категория $B/\Th$ эквивалентна категории расширений $B$.
\end{lem}
\begin{proof}
Очевидно, что категория расширений вкладывается в $B/\Th$.
Если $f : B \to T$ -- некоторая теория под $B$, то она изоморфна $i : B \to (\mathcal{S}', \mathcal{F}_B \amalg \mathcal{F}_T, \mathcal{P}_B \amalg \mathcal{P}_T, \mathcal{A}_B \amalg \mathcal{A}_T \amalg \mathcal{A})$,
где $i$ -- очевидное вложение, и $\mathcal{A}$ состоит из следующих аксиом:
\[ \sststile{}{V} f(\sigma(V)) \cong \sigma(V) \]
для всех $\sigma \in \mathcal{F}_B$ и
\[ f(R(V)) \ssststile{}{V} R(V) \]
для всех $R \in \mathcal{P}_B$.
\end{proof}

Пусть $T_\mathcal{S} = (\mathcal{S},\varnothing,\varnothing,\varnothing)$.
Полную подкатегорию $T_\mathcal{S}/\Th$, состоящую из расширений с множеством сортов $\mathcal{S}$, мы будем обозначать $\Th_\mathcal{S}$.
Подкатегорию $\Th_\mathcal{S}$, состоящую из $\lambda$-достижимых теорий и $\lambda$-достижимых морфизмов, мы будем обозначать $\Th_\mathcal{S}^\lambda$.

\begin{prop}[th-colimits]
Категории $\Th$, $\Th_\mathcal{S}$, $\Th^\lambda$ и $\Th_\mathcal{S}^\lambda$ кополны.
\end{prop}
\begin{proof}
Покажем сначала, что в категориях $\Th$ и $\Th^\lambda$ есть копроизведения.
Пусть $\{ T_i \}_{i \in I} = \{ (\mathcal{S}_i,\mathcal{F}_i,\mathcal{P}_i,\mathcal{A}_i) \}_{i \in I}$ -- множество теорий.
Тогда мы можем определить их копроизведение как теорию
\[ (\coprod\limits_{i \in I} \mathcal{S}_i, \coprod\limits_{i \in I} \mathcal{F}_i, \coprod\limits_{i \in I} \mathcal{P}_i, \coprod\limits_{i \in I} \mathcal{A}_i). \]
Легко видеть, что универсальное свойство копроизведений выполнено для этого расширения.
Если все теории $T_i$ были $\lambda$-достижимыми, то и их копроизведение будет таковым, так как любой его символ принадлежит одной из теорий $T_i$, и то же самое верно для аксиом.

Конструкция копроизведений в $\Th_\mathcal{S}$ и $\Th_\mathcal{S}^\lambda$ аналогична.
Пусть $\{ T_i \}_{i \in I} = \{ (\mathcal{S},\mathcal{F}_i,\mathcal{P}_i,\mathcal{A}_i) \}_{i \in I}$ -- множество теорий.
Тогда мы можем определить их копроизведение в $\Th_\mathcal{S}$ как теорию
\[ (\mathcal{S}, \coprod\limits_{i \in I} \mathcal{F}_i, \coprod\limits_{i \in I} \mathcal{P}_i, \coprod\limits_{i \in I} \mathcal{A}_i). \]
Легко видеть, что универсальное свойство копроизведений выполнено для этого расширения.
Если все теории $T_i$ были $\lambda$-достижимыми, то и их копроизведение будет таковым.

Коуравнители строятся во всех категориях одинаково.
Пусть $f,g : T_1 \to T_2$ -- пара морфизмов теорий $T_1 = (\mathcal{S}_1,\mathcal{F}_1,\mathcal{P}_1,\mathcal{A}_1)$ и $T_2 = (\mathcal{S}_2,\mathcal{F}_2,\mathcal{P}_2,\mathcal{A}_2)$.
Пусть $e : \mathcal{S}_2 \to \mathcal{S}$ -- коуравнитель функций $f,g : \mathcal{S}_1 \to \mathcal{S}_2$.
Тогда мы можем определить коуравнитель $f$ и $g$ как расширение теории $e^*(T_2)$, к которой мы добавляем следующие аксиомы:
$\sststile{}{V} f(\sigma(V)) \cong g(\sigma(V))$ для каждого функционального символа $\sigma \in \mathcal{F}_1$
и $f(R(V)) \ssststile{}{V} g(R(V))$ для каждого предикатного символа $R \in \mathcal{P}_1$.
Морфизм $e : T_2 \to T$ определяется тождественным образом.
Легко видеть, что этот морфизм обладает универсальным свойством коуравнителей.
Если $T_2,f,g$ являются $\lambda$-достижимым, то все новые аксиомы $T$ и сама $T$ тоже будут таковыми.
\end{proof}

\begin{remark}[th-coproducts]
Копроизведение расширений $\{ T_i \}_{i \in I} = \{ (\mathcal{S}, \mathcal{F}_B \amalg \mathcal{F}_i, \mathcal{P}_B \amalg \mathcal{P}_i, \mathcal{A}_B \amalg \mathcal{A}_i) \}_{i \in I}$
некоторой теории $B$ в $B/\Th_\mathcal{S}$ и $B/\Th_\mathcal{S}^\lambda$ может быть описано явным образом как теория
$(\mathcal{S}, \mathcal{F}_B \amalg \coprod\limits_{i \in I} \mathcal{F}_i, \mathcal{P}_B \amalg \coprod\limits_{i \in I} \mathcal{P}_i, \mathcal{A}_B \amalg \coprod\limits_{i \in I} \mathcal{A}_i)$.
\end{remark}

\begin{prop}[th-pres]
Пусть $\lambda$ -- регулярный кардинал
Категория $\Th^\lambda$ является локально $\lambda$-представимой.
Если $\lambda \leq \kappa$, то теория является $\kappa$-представимой тогда и только тогда,
когда она изоморфна теории $(\mathcal{S}',\mathcal{F}',\mathcal{P}',\mathcal{A}')$ такой, что $|\mathcal{S}'| < \kappa$, $|\mathcal{F}'| < \kappa$, $|\mathcal{P}'| < \kappa$ и $|\mathcal{A}'| < \kappa$.

Для категории $\Th_\mathcal{S}^\lambda$ верно более сильное утверждение.
Пусть $B = (\mathcal{S},\mathcal{F},\mathcal{P},\mathcal{A})$ -- $\lambda$-достижимая теория.
Категория $B/\Th_\mathcal{S}^\lambda$ является локально $\lambda$-представимой.
Если $\lambda \leq \kappa$, то объект этой категории является $\kappa$-представимым тогда и только тогда,
когда он изоморфен расширению $B \to (\mathcal{S}, \mathcal{F} \amalg \mathcal{F}', \mathcal{P} \amalg \mathcal{P}', \mathcal{A} \amalg \mathcal{A}')$ такому, что $|\mathcal{F}'| < \kappa$, $|\mathcal{P}'| < \kappa$ и $|\mathcal{A}'| < \kappa$.
\end{prop}
\begin{proof}
В рамках данного доказательства теории $(\mathcal{S}',\mathcal{F}',\mathcal{P}',\mathcal{A}')$ и расширения $B \to (\mathcal{S}', \mathcal{F} \amalg \mathcal{F}', \mathcal{P} \amalg \mathcal{P}', \mathcal{A} \amalg \mathcal{A}')$ такие,
что $|\mathcal{F}'| < \kappa$, $|\mathcal{P}'| < \kappa$ и $|\mathcal{A}'| < \kappa$, мы будем называть $\kappa$-малыми.

Заметим, что каждый терм и каждая $\lambda$-достижимая формула любой $\lambda$-достижимой теории составлен(а) из множества функциональных и предикатных символов и переменных, мощность которого меньше $\lambda$.
Кроме того, если $\varphi$ и $\psi$ -- $\lambda$-достижимые формулы,
то любой вывод теоремы $\varphi \sststile{}{V} \psi$ в $\lambda$-достижимой теории сконструировн из множества функциональных символов, предикатных символов и аксиом, мощность которого меньше $\lambda$.

Докажем, что любая $\kappa$-малая теория $\kappa$-представима если $\lambda \leq \kappa$.
Пусть $h : T \to \colim_{j \in J} T_j$ -- морфизм в $\Th^\lambda$, где $T = (\mathcal{S}',\mathcal{F}',\mathcal{P}',\mathcal{A}')$ -- $\kappa$-малая теория, а $\colim_{j \in J} T_j$ -- $\kappa$-направленный копредел теорий в $\Th^\lambda$.
Так как $\colim_{j \in J} T_j$ -- $\lambda$-достижимая теория, то для каждого функционального символа $\sigma \in \mathcal{F}'$ существует суженный терм некоторой теории $T_j$, эквивалентный $h(\sigma)$.
То же верно для предикатных символов из $\mathcal{P}'$.
Кроме того, для любой аксиомы $\varphi \sststile{}{V} \psi$ из $\mathcal{A}'$ существует теория $T_j$, в которой выводима секвенция $h(\varphi) \sststile{}{V} h(\psi)$.
Так как $|\mathcal{S}'| < \kappa$, $|\mathcal{F}'| < \kappa$, $|\mathcal{P}'| < \kappa$ и $|\mathcal{A}'| < \kappa$, то существует теория $T_j$, в которой определены все необхоидмые сорта, термы, формулы и выводимы все теоремы.
Таким образом, $h$ факторизуется через $T_j$.

Пусть $h_1,h_2 : T \to T_j$ -- морфизмы такие, что $g_j \circ h_1 = g_j \circ h_2$, где $g_j : T_j \to \colim_{j \in J} T_j$.
Тогда для каждого $\sigma \in \mathcal{F}'$ секвенция
\[ \sststile{}{V} h_1(\sigma(V)) \cong h_2(\sigma(V)) \]
является теоремой $\colim_{j \in J} T_j$.
Но мы уже видели, что отсюда следует, что существует теория $T_{j'}$ такая, что $j \leq j'$ и эта секвенция выводима в $T_{j'}$.
То же верно и для предикатных символов и сортов $T$.
Отсюда следует, что $f \circ h_1 = f \circ h_2$, где $f : T_j \to T_{j'}$.

Аналогичный аргумент показывает, что любое $\kappa$-малое расширение $B \to T$ является $\kappa$-представимым.
Если $T = (\mathcal{S}, \mathcal{F} \amalg \mathcal{F}', \mathcal{P} \amalg \mathcal{P}', \mathcal{A} \amalg \mathcal{A}')$, то мы должны рассмотреть только как отбражаются символы из $\mathcal{F}'$ и $\mathcal{P}'$ и аксиомы из $\mathcal{A}'$.
Условие малости на эти множества как и раньше гарантирует, что $\Hom(T,-)$ сохраняет $\kappa$-направленные копределы.

Теперь докажем, что категория $\Th^\lambda$ является локально $\lambda$-представимой.
Нам необходимо показать, что каждая теория в этой категории является $\lambda$-направленным копределом малого множества $\lambda$-представимых теорий.
Мы докажем более общее утверждение, что для любого регулярного $\kappa \geq \lambda$ каждая теория является $\kappa$-направленным копределом ее $\kappa$-малых подтеорий.
Пусть $T$ -- $\lambda$-достижимая теория и $\{ f_i : T_i \to T' \}_{i \in I}$ -- коконус над диаграммой $\kappa$-малых подтеорий $T$.
Для каждого сорта $s$ теории $T$ мы определим подтеорию $T_s$ теории $T$ как теорию, состоящую из одного сорта $s$.
Морфизм коконусов $h : T \to T'$ должен коммутировать с морфизмами $T_s \to T$.
Следовательно, он должен быть определен на сортах как $h(s) = f_{T_s}(s)$.

Для каждого символа $p$ теории $T$ мы определим подтеорию $T_p$ теории $T$ как теорию, состоящую из одного символа $p$ и всех сортов, которые появляются в сигнатуре $p$.
Морфизм коконусов $h : T \to T'$ должен коммутировать с морфизмами $T_p \to T$.
Следовательно, он должен быть определен как $h(p(V)) = f_{T_p}(p(V))$, а значит он уникален.
Чтобы доказать, что это определение задает морфизм, нам нужно показать, что $h$ сохраняет аксиомы $T$.
Мы уже видели, что любая аксиома $T$ должна принадлежать некоторой $\kappa$-малой подтеории $T_i$ теории $T$.
Так как $f_i$ -- морфизм теорий, эта аксиома также выводима и в $T'$.

Аналогичным образом доказывается, что категория $B/\Th_\mathcal{S}^\lambda$ является локально $\lambda$-представимой.
Для любого регулярного $\kappa \geq \lambda$ каждое расширение $B \to T$ является $\kappa$-направленным копределом его $\kappa$-малых подрасширений.
Вместо теорий $T_p$ мы рассматриваем подрасширения $B \amalg \{ p \}$ расширения $B \to T$.
Остальное доказательство полностью аналогично.

Нам осталось доказать, что любая $\kappa$-представимая теория $T$ изоморфна $\kappa$-малой, и аналогичное утверждение для расширений.
Так как $T$ является $\kappa$-направленным копределом ее $\kappa$-малых подтеорий, то $\fs{id}_T$ факторизуется через некоторую $\kappa$-малую подтеорию $T'$ теории $T$.
Таким образом, $T$ является коуравнителем пары морфизмов $T' \to T'$.
В \pprop{th-colimits} был сконструирован коуравнитель любой пары стрелок $f,g : X \to Y$, который является $\kappa$-малым, если обе теории $X$ и $Y$ являются таковыми.
Для расширений доказательство аналогично.
\end{proof}

\begin{prop}[th-adj]
В следующей диграмме, состоящей из функторов вложения подкатегорий, все функторы являются левыми сопряженными:
\[ \xymatrix{ \Th_\mathcal{S}^\lambda \ar[r] \ar[d] & T_\mathcal{S}/\Th^\lambda \ar[d] \\
              \Th_\mathcal{S}         \ar[r]        & T_\mathcal{S}/\Th
            } \]
Функтор $\Th^\lambda \to \Th$ также является левым сопряженным.
\end{prop}
\begin{proof}
Конструкция копределов в \pprop{th-colimits} и \premark{th-coproducts} показывает, что все эти функторы сохраняют копределы.
По \dprop{th-pres} категории $\Th^\lambda$ и $\Th_\mathcal{S}^\lambda$ локально представимы.
По теореме о сопряженных функторах отсюда следует, что все функторы кроме $\Th_\mathcal{S} \to T_\mathcal{S}/\Th$ являются левыми сопряженными.
Докажем, что и этот функтор является левым сопряженным.

Пусть $T$ -- $\lambda$-достижимая теория с множеством сортов $\mathcal{S}'$ и функцией $f : \mathcal{S} \to \mathcal{S'}$.
Тогда мы определим теорию $R(T)$ с множеством сортов $\mathcal{S}$.
Для каждого множества $I < \lambda$, каждой коллекции сортов $\{ s_i \}_{i \in I}$ из $\mathcal{S}$, каждого сорта $s \in \mathcal{S}$ и каждого суженного терма $T$ сигнатуры $\prod_{i \in I} f(s_i) \to f(s)$
мы добавляем функциональный символ в $R(T)$ сигнатуры $\prod_{i \in I} s_i \to s$.
Для каждого множества $I < \lambda$, каждой коллекции сортов $\{ s_i \}_{i \in I}$ из $\mathcal{S}$ и каждой формулы $T$ сигнатуры $\prod_{i \in I} f(s_i)$
мы добавляем предикатный символ в $R(T)$ сигнатуры $\prod_{i \in I} s_i$.
Теперь можно определить морфизм теорий $\epsilon_T : R(T) \to T$, который отображает сорт $s$ в $f(s)$ и каждый символ в него же самого.
Теперь мы добавляем в $R(T)$ все аксиомы $\varphi \sststile{}{V} \psi$ для которых секвенция $\epsilon_T(\varphi) \sststile{}{f(V)} \epsilon_T(\psi)$ является теоремой в $T$.
Тогда $\epsilon_T$ всё еще остается морфизмом теорий.

Пусть $T'$ -- теория с множеством сортов $\mathcal{S}$ и $f : T' \to T$ -- морфизм в $T_\mathcal{S}/\Th$.
Нам нужно показать, что существует уникальный морфизм $g : T' \to R(T)$ в $\Th_\mathcal{S}$ такой, что $\epsilon_T \circ g = f$.
Для каждого символа $p$ теории $T'$ мы определяем $g(p)$ как $f(p)$.
Тогда по определению $\epsilon_T \circ g = f$.
Отсюда следует, что $g$ отображает аксиомы $T'$ в секвенции, которые становятся теоремами в $T$, то есть в аксиомы $R(T)$.
Таким образом, $g$ является морфизмом, удовлетворяющим необходимому условию.
Покажем теперь, что такой морфизм уникален.
Пусть $g,h : T' \to R(T)$ -- морфизмы такие, что $\epsilon_T \circ g = \epsilon_T \circ h$.
Тогда для любого предикатного символа $R$ теории $T'$ формулы $\epsilon_T(g(R))$ и$\epsilon_T(h(R))$ эквивалентны.
Отсюда следует, что $g(R)$ и $h(R)$ тоже эквивалентны.
Аналогичное утверждение верно и для функциональных символов.
Таким образом, $g = h$.
\end{proof}

\begin{prop}[th-limits]
Категории $\Th$, $\Th_\mathcal{S}$, $\Th^\lambda$ и $\Th_\mathcal{S}^\lambda$ полны.
\end{prop}
\begin{proof}
По \dprop{th-adj} нам достаточно доказать это утверждение для категорий $\Th$ и $\Th^\lambda$.
Для категории $\Th^\lambda$ это верно, так как она является локально представимой по \dprop{th-pres}.
Докажем, что в $\Th$ есть все малые пределы.
Пусть $F : J \to \Th$ -- диаграмма, индексированная малой категорией $J$.
Пусть $\lambda$ -- регулярный кардинал такой, что все теории $F_j$ и все морфизмы $F(f)$ являются $\lambda$-достижимыми.
Тогда мы определим теорию $L$ с множеством сортов $\mathcal{S} = \fs{lim}_{j \in J} \mathcal{S}_j$, где $\mathcal{S}_j$ -- множество сортов теории $F_j$.

Для каждого множества $I < \lambda$, каждой коллекции сортов $\{ s_i \}_{i \in I}$ из $\mathcal{S}$, каждого сорта $s \in \mathcal{S}$ мы добавляем функциональный символ $\{ t_j \}_{j \in J}$ в $L$ сигнатуры $\prod_{i \in I} s_i \to s$,
где $t_j$ -- суженные термы теории $T_j$ сигнатуры $\prod_{i \in I} \pi_j(s_i) \to \pi_j(s)$ такие, что для всех морфизмов $f : j \to j'$ термы $F(j)(t_j)$ и $t_j'$ эквивалентны в $F_{j'}$.
Для каждого множества $I < \lambda$, каждой коллекции сортов $\{ s_i \}_{i \in I}$ из $\mathcal{S}$ мы добавляем предикатный символ $\{ \varphi_j \}_{j \in J}$ в $L$ сигнатуры $\prod_{i \in I} s_i$,
где $\varphi_j$ -- формулы теории $T_j$ сигнатуры $\prod_{i \in I} \pi_j(s_i)$ такие, что для всех морфизмов $f : j \to j'$ формулы $F(j)(\varphi_j)$ и $\varphi_j'$ эквивалентны в $F_{j'}$.
Для каждого $j \in J$ можно определить морфизм теорий $\pi_j : L \to F_j$, который отображает сорт $s$ в $\pi_j(s)$ и каждый символ $\{ p_j \}_{j \in J}$ в $p_j$.
Теперь мы добавляем в $L$ все аксиомы $\varphi \sststile{}{V} \psi$ для которых секвенции $\pi_j(\varphi) \sststile{}{\pi_j(V)} \pi_j(\psi)$ выводимы в $F_j$ для всех $j \in J$.
Тогда $\pi_j$ всё еще являются морфизмами теорий.
Кроме того, они задают конус диаграммы $F$ с вершиной в $L$.

Пусть $\alpha$ -- конус $F$ с вершиной в некоторой теории $T'$.
Тогда существует уникальная функция $f : \mathcal{S}' \to \mathcal{S}$ из множества сортов $T'$ в $\mathcal{S}$ такая, что $\alpha_j = \pi_j \circ f$.
Для каждого символа $p$ теории $T'$ мы можем определить $f(p)$ как $\{ \alpha_j(p) \}_{j \in J}$.
По определению $L$ эта функция отправляет аксиомы $T'$ в аксиомы $L$.
Кроме того, $\pi_j \circ f = \alpha_j$.
Нам осталось доказать, что такой морфизм уникален.
Пусть $f,g : T' \to L$ -- морфизмы такие, что $\pi_j \circ f = \pi_j \circ g = \alpha_j$.
Тогда они действуют одинаково на сортах.
Кроме того, для каждого предикатного символа $R$ формулы $\pi_j(f(R))$ и $\pi_j(g(R))$ эквивалентны.
Отсюда следует, что $f(R)$ и $g(R)$ тоже эквивалентны.
Аналогичное утверждение верно и для функциональных символов.
Следовательно, $f = g$.
\end{proof}

\begin{prop}[th-mono]
Морфизм теорий $f : T_1 \to T_2$ (в любой из категорий $\Th$, $\Th_\mathcal{S}$) является мономорфизмом тогда и только тогда,
когда он инъективен на сортах и отражает теоремы, другими словами, когда для всех секвенций $\varphi \sststile{}{V} \psi$ теории $T_1$
если секвенция $f(\varphi) \sststile{}{V} f(\psi)$ является теоремой $T_2$, то секвенция $\varphi \sststile{}{V} \psi$ является теоремой $T_1$.

Морфизм $\lambda$-достижимых теорий (в любой из категорий $\Th^\lambda$, $\Th_\mathcal{S}^\lambda$) является мономорфизмом тогда и только тогда, когда он инъективен на сортах и отражает $\lambda$-достижимые теоремы.
\end{prop}
\begin{proof}
Во-первых, докажем часть ``тогда''.
Пусть $g,h : T \to T_1$ -- пара морфизмов таких, что $f \circ g = f \circ h$.
Если $s$ -- сорт $T$, то $f(g(s)) = f(h(s))$.
Так как $f$ инъективен на сортах, то $g(s) = h(s)$.
Если $\sigma$ -- функциональный символ теории $T$, то $\sststile{}{V} f(g(\sigma(V))) \cong f(h(\sigma(V)))$. и, следовательно, $\sststile{}{V} g(\sigma(V)) \cong h(\sigma(V))$.
Если $R$ -- предикатный символ теории $T$, то $f(g(R(V))) \ssststile{}{V} f(h(R(V)))$, и, следовательно, $g(R(V)) \ssststile{}{V} h(R(V))$.
Таким образом, $g = h$.
Если $T$, $g$ и $h$ являются $\lambda$-достижимыми, то секвенции $\sststile{}{V} g(\sigma(V)) \cong h(\sigma(V))$ и $g(R(V)) \ssststile{}{V} h(R(V))$ также являются таковыми, а значит это доказательство верно и для категорий $\lambda$-достижимых теорий.

Теперь докажем часть ``только тогда''.
Пусть $f$ -- мономорфизм.
Если $f$ -- морфизм в $\Th_\mathcal{S}$, то он всегда инъективен на сортах.
В противном случае пусть $s,s'$ -- пара сортов $T_1$ таких, что $f(s) = f(s')$.
Пусть $g,h : (\{x\},\varnothing,\varnothing,\varnothing) \to T_1$ -- пара морфизмов таких, что $g(x) = s$ и $h(x) = s'$.
Тогда $f \circ g = f \circ h$.
Так как $f$ мономорфизм, то $g = h$, то есть $s = s'$.

Пусть $\varphi \sststile{}{V} \psi$ -- секвенция теории $T_1$ такая, что $f(\varphi) \sststile{}{V} f(\psi)$ -- теорема теории $T_2$.
Пусть $T$ -- теория, состоящая из единственного предикатного символа $R : \prod V$.
Пусть $g : T \to T_1$ -- морфизм, определенный как $g(R(V)) = \varphi \land V\!\downarrow$, и пусть $h : T \to T_1$ -- морфизм, определенный как $h(R(V)) = \varphi \land \psi \land V\!\downarrow$.
Тогда $f \circ g = f \circ h$, и, следовательно, $g = h$, что влечет, что $\varphi \sststile{T_1}{V} \psi$.
\end{proof}

\begin{prop}[th-epi]
Морфизм теорий $f : (\mathcal{S},\mathcal{F},\mathcal{P},\mathcal{A}) \to T$ (в любой из категорий $\Th$, $\Th_\mathcal{S}$) является регулярным эпиморфизмом тогда и только тогда,
когда он сюръективен на сортах и изоморфен расширению вида $(\mathcal{S},\mathcal{F},\mathcal{P},\mathcal{A}) \to (\mathcal{S}',\mathcal{F},\mathcal{P},\mathcal{A} \cup \mathcal{A}')$.

В категориях $\Th^\lambda$, $\Th_\mathcal{S}^\lambda$ морфизм $f$ является регулярным эпиморфизмом тогда и только тогда,
когда он изоморфен расширению вида, указанному выше, в котором $\mathcal{A}'$ состоит из $\lambda$-достижимых секвенций.
\end{prop}
\begin{proof}
Коуравнитель такого вида можно сконструировать для любой пары стрелок как было показано в \pprop{th-colimits}.
Наоборот, покажем, что расширение такого вида является регулярным эпиморфизмом.
Пусть $\mathcal{P}'$ -- множество предикатных символов вида $R_{V,\varphi,\psi} : \prod V$ для всех секвенций $\varphi \sststile{}{V} \psi$ в $\mathcal{A}'$.
Тогда мы можем определить морфизмы $f,g : (\mathcal{S},\mathcal{F},\mathcal{P} \amalg \mathcal{P}',\mathcal{A}) \to (\mathcal{S},\mathcal{F},\mathcal{P},\mathcal{A})$
как $f(R_{V,\varphi,\psi}) = \varphi \land V\!\downarrow$ и $g(R_{V,\varphi,\psi}) = \varphi \land \psi \land V\!\downarrow$ и тождественным образом на остальных символах.
Тогда расширение $(\mathcal{S},\mathcal{F},\mathcal{P},\mathcal{A}) \to (\mathcal{S},\mathcal{F},\mathcal{P},\mathcal{A} \cup \mathcal{A}')$ является коуравнителем этих морфизмов.
Если секвенции в $\mathcal{A}'$ являются $\lambda$-достижимыми, то символы в $\mathcal{P}'$ и морфизмы $f$ и $g$ также являются таковыми.
\end{proof}

\begin{prop}[th-epi-mono]
Любой морфизм теорий факторизуется через регулярный эпиморфизм и мономорфизм (в любой из категорий $\Th$, $\Th_\mathcal{S}$, $\Th^\lambda$, $\Th_\mathcal{S}^\lambda$).
\end{prop}
\begin{proof}
Пусть $f : T_1 \to T_2$ -- морфизм теорий.
Пусть $\mathcal{S}_i$ -- множество сортов теории $T_i$ и пусть $g : \mathcal{S}_1 \to \fs{im}(f)$ -- огранчиение $f$ на ее образ.
Тогда вложение $T_1 \to g^*(T_1) \cup \{ \varphi \sststile{}{V} \psi \mid f(\varphi) \sststile{T_2}{V} f(\psi) \}$ является регулярным эпиморфизмом по \dprop{th-epi}.
В категориях $\Th^\lambda$ и $\Th_\mathcal{S}^\lambda$ мы берем только секвенции $\varphi \sststile{}{V} \psi$ с $|V| < \lambda$.
Морфизм $f$ факторизуется через это вложение и очевидный морфизм $g^*(T_1) \cup \{ \varphi \sststile{}{V} \psi \mid f(\varphi) \sststile{T_2}{V} f(\psi) \} \to T_2$, который является мономорфизмом по \dprop{th-mono}.
\end{proof}

\subsection{Категория моделей}
\label{sec:models}

В этом подразделе мы обсудим категорию моделей некоторой теории $T$ и ее связь с классифицирующей категорией $T$ и категорией расширений $T$.
Для начала мы приведем определение категории моделей $T$ из \cite{PHL}.
\emph{Интерпретация} сигнатуры $(\mathcal{S},\mathcal{F},\mathcal{P})$ -- это $\mathcal{S}$-множество $M$ вместе с функцией,
сопоставляющей каждому функциональному символу $\sigma : \prod_{i \in I} s_i \to s$ частичную функцию $M(\sigma) : \prod_{i \in I} M_{s_i} \to M_s$
и каждому предикатному символу $R : \prod_{i \in I} s_i$ отношение $M(R) \subseteq \prod_{i \in I} M_{s_i}$.

Пусть $M$ -- интерпретация некоторой сигнатуры.
Тогда для любого терма $t$ сорта $s$ с переменными в $\{ x_i : s_i \}_{i \in I}$ можно определить частичную функцию $M(t) : \prod_{i \in I} M_{s_i} \to M_s$ индукцией по $t$.
Если $t = x_i$, то $M(x_i)$ -- это просто $i$-ая проекция.
Если $t = \sigma(\{ t_j \}_{j \in J})$, то $M(t) = M(\sigma)(\{ M(t_j) \}_{j \in J})$.
Для любой формулы $\varphi$ с переменными в $\{ x_i : s_i \}_{i \in I}$ можно определить отношение $M(\varphi) \subseteq \prod_{i \in I} M_{s_i}$.
Если $\varphi = (t = t')$, то $M(\varphi)$ состоит из тех $a$ для которых $M(t)(a)$ и $M(t')(a)$ определены и $M(t)(a) = M(t')(a)$.
Если $\varphi = R(\{ t_j \}_{j \in J})$, то $M(\varphi)$ состоит из тех $a$ для которых $M(t_j)(a)$ определено для всех $j \in J$ и $\{ M(t_j)(a) \}_{j \in J} \in M(R)$.
Если $\varphi = \bigwedge_{j \in J} \varphi_j$, то $M(\varphi)$ -- это пересечение всех $M(\varphi_j)$.

Мы будем говорить, что сигнатура $\varphi \sststile{}{V} \psi$ верна в интерпретации $M$, если $M(\varphi) \subseteq M(\psi)$.
\emph{Модель} теории $T$ -- это интерпретация ее подлежащей сигнатуры, в которой верны все аксиомы $T$.
Морфизм интерпретаций $M$ и $N$ -- это функция $f$, сопоставляющая каждому сорту $s$ функцию $M_s \to N_s$, удовлетворяющую двум условиям.
Для каждого функционального символа $\sigma$ и всех $a$, если $M(\sigma)(a)$ определено, то $N(\sigma)(f(a))$ тоже определено и $f(M(\sigma)(a)) = N(\sigma)(f(a))$.
Для каждого предикатного символа $R$ и всех $a$, если $a \in M(R)$, то $f(a) \in N(\sigma)$.
Тождественный морфизм и композиция морфизмов задаются очевидным образом.
Легко видеть, что эти определения задают категорию.
Категория моделей теории $T$ будет обозначаться $\Mod{T}$.

Если $T$ является $\lambda$-достижимой теорией, то категория $\Mod{T}$ является локально $\lambda$-представимой.
Начальный объект $\Mod{T}$ можно сконструировать из термов теории $T$ как показано в \cite[Theorem~22]{PHL}.
Так как нам понадобится работать с начальными моделями, мы приведем эту конструкцию здесь.
Сначала мы определим частичное отношение эквивалентности на множестве замкнутых термов $T$.
Термы $t_1$ и $t_2$ эквивалентны тогда и только тогда, когда $\sststile{T}{} t_1 = t_2$.
Подлежащее $\mathcal{S}$-множество начальной модели определяется как факторизация множества замкнутых термов $T$ по этому отношению частичной эквивалентности.
Интерпретация предикатного символа $R$ состоит из $\{ t_i \}_{i \in I}$ таких, что $\sststile{T}{} R(\{ t_i \}_{i \in I})$.
Интерпретация функционального символа $\sigma$ -- это функция, определенная на $\{ t_i \}_{i \in I}$ как $\sigma(\{ t_i \}_{i \in I})$ в том случае, если $\sststile{T}{} \sigma(\{ t_i \}_{i \in I})\!\!\downarrow$.
Легко показать, что эти определения действительно задают модель $T$, и она является начальной.

\begin{prop}[th-func-mod]
Для каждого морфизма теорий $f : T \to T'$ существует функтор $f^* : \Mod{T'} \to \Mod{T}$ такой, что $\fs{id}_\mathbb{T}^*$ -- тождественный функтор и $(g \circ f)^* = f^* \circ g^*$.
Если $f$ сюръективен на сортах, то $f^*$ является строгим функтором.
\end{prop}
\begin{proof}
Если $M$ -- модель $T'$, то $f^*(M)_s = M_{f(s)}$.
Для всех символов $p$ теории $T'$ мы определяем $f^*(M)(p)$ как $M(f(p))$.
Тогда каждый морфизм моделей $M$ и $N$ теории $T'$ также является морфизмом теорий $f^*(M)$ и $f^*(N)$.
Это задает функтор $f^* : \Mod{T'} \to \Mod{T}$, удовлетворяющий необходимым условиям.

Допустим $f$ сюръективен на объектах.
Пусть $g,h : M \to N$ -- морфизмы моделей $T'$ такие, что $f^*(g) = f^*(h)$.
Для любого сорта $s'$ теории $T'$ существует сорт $s$ теории $T$ такой, что $f(s) = s'$.
Тогда $g_{s'} = f^*(g)_s = f^*(h)_s = h_{s'}$, то есть $g = h$.
\end{proof}

Для каждой модели $M$ теории $T$ мы определим расширение $\Lang(M)$ теории $T$.
Сорта этой теории -- это сорта $T$.
Кроме функциональных и предикатных символов $T$ эта теория содержит функциональные символы $O_a : s$ для всех $a \in M_s$.
Аксиомы $\Lang(M)$ -- это аксиомы $T$ вместе со следующими секвенциями:
\begin{align*}
& \sststile{}{} O_a \downarrow \\
& \sststile{}{} \sigma(\{ O_{a_i} \}_{i \in I}) = O_{M(\sigma)(\{ a_i \}_{i \in I})} \\
& \sststile{}{} R(\{ O_{a_i} \}_{i \in I})
\end{align*}
для всех $a \in M_s$, всех $a_i \in M_{s_i}$,
всех функциональных символов $\sigma$ таких, что $M(\sigma)(\{ a_i \}_{i \in I})$ определено,
и всех предикатных символов $R$ таких, что $\{ a_i \}_{i \in I} \in M(R)$.

Модели $\Lang(M)$ -- это просто модели $T$ вместе с морфизмом из $M$.
Другими словами, категории $M/\Mod{T}$ и $\Mod{\Lang(M)}$ изоморфны.
В частности, на $M$ есть естественная структура модели $\Lang(M)$ такая, что $M(O_a) = a$.

\begin{lem}[cl-term]
Если $t$ -- замкнутый терм сорта $s$ такой, что $\sststile{\Lang(M)}{} t \downarrow$,
то существует уникальный $a \in M_s$ такой, что $\sststile{\Lang(M)}{} t = O_a$.
\end{lem}
\begin{proof}
Если $\sststile{\Lang(M)}{} t = O_a$ и $\sststile{\Lang(M)}{} t = O_{a'}$, то $\sststile{\Lang(M)}{} O_a = O_{a'}$.
Так как $M$ -- модель $\Lang(M)$, то формула $O_a = O_{a'}$ верна в $M$, что означает, что $a = a'$, то есть такой $a$ действительно уникален.

Теперь докажем, что такой $a$ существует индукцией по $t$.
Если $t = O_a$, то это очевидно.
If $t = \sigma(\{ t_i \}_{i \in I})$, то по индукционной гипотезе $\sststile{\Lang(M)}{} t = \sigma(\{ O_{a_i} \}_{i \in I})$ для некоторых $a_i$.
Так как $M$ является моделью $\Lang(M)$ и $\sststile{\Lang(M)}{} \sigma(\{ O_{a_i} \}_{i \in I})\!\!\downarrow$, то $M(\sigma)(\{ a_i \}_{i \in I})$ определено.
Таким образом, секвенция $\sststile{}{} \sigma(\{ O_{a_i} \}_{i \in I}) = O_{M(\sigma)(\{ a_i \}_{i \in I})}$ выводима в $\Lang(M)$.
\end{proof}

Для каждого морфизма $h : M \to N$ моделей $T$ мы можем определить морфизм расширений $\Lang(h) : \Lang(M) \to \Lang(N)$, задав $\Lang(h)(O_a)$ как $O_{h(a)}$.
Таким образом, $\Lang$ является функтором $\Mod{T} \to T/\Th_\mathcal{S}$.

\begin{prop}[lang-ff]
Функтор $\Lang : \Mod{T} \to T/\Th_\mathcal{S}$ является полным и строгим.
\end{prop}
\begin{proof}
Пусть $h_1$, $h_2$ -- морфизмы моделей такие, что $\Lang(h_1) = \Lang(h_2)$.
Тогда $O_{h_1(a)} = \Lang(h_1)(O_a) = \Lang(h_2)(O_a) = O_{h_2(a)}$ и по \dlem{cl-term} верно, что $h_1(a) = h_2(a)$.
Таким образом, $\Lang$ строгий.

Пусть $M$ и $N$ -- модели $T$ и $h : \Lang(M) \to \Lang(N)$ -- морфизм расширений $T$.
Тогда по \dlem{cl-term} для каждого $a \in M_s$ существует уникальный $h'(a) \in N_s$ такой, что $\sststile{\Lang(N)}{} h(O_a) = O_{h'(a)}$.
Докажем, что $h' : M \to N$ является морфизмом моделей.
Действительно, если $M(\sigma)(\{ a_i \}_{i \in I})$ определено, то $\sststile{\Lang(M)}{} \sigma(\{ O_{a_i} \}_{i \in I}) = O_{M(\sigma)(\{ a_i \}_{i \in I})}$.
Следовательно, секвенция $\sststile{}{} \sigma(\{ O_{h'(a_i)} \}_{i \in I}) = O_{h'(M(\sigma)(\{ a_i \}_{i \in I}))}$ является теоремой $\Lang(N)$.
Но секвенция $\sststile{}{} \sigma(\{ O_{h'(a_i)} \}_{i \in I}) = O_{N(\sigma)(\{ h'(a_i) \}_{i \in I})}$ также является теоремеой $\Lang(N)$.
Следовательно, по \dlem{cl-term} верно, что $h'(M(\sigma)(\{ a_i \}_{i \in I}) = N(\sigma)(\{ h'(a_i) \}_{i \in I})$.

Если $\{ a_i \}_{i \in I} \in M(R)$, то $\sststile{\Lang(M)}{} R(\{ O_{a_i} \}_{i \in I})$.
Следовательно, секвенция $\sststile{}{} R(\{ O_{h'(a_i)} \}_{i \in I})$ выводима в $\Lang(N)$.
Так как $N$ является моделью $\Lang(N)$, то $\{ h'(a_i) \}_{i \in I} \in N(R)$.
Таким образом, $h'$ является морфизмом моделей.
По определению $h'$ верно, что $\Lang(h') = h$.
Следовательно, $\Lang$ полный.
\end{proof}

Теперь мы опишем функтор $\Syn : T/\Th_\mathcal{S} \to \Mod{T}$.
Для каждого морфизма $i : T \to T'$ мы определяем $\Syn(i)$ как $i^*(0_{T'})$, где $0_{T'}$ -- начальный объект $\Mod{T'}$.
Если $f : T_1 \to T_2$ -- морфизм между $i_1 : T \to T_1$ и $i_2 : T \to T_2$, то мы определяем $\Syn(f)$ как $i_1^*(!_{f^*(0_{T_2})})$, где $!_{f^*(0_{T_2})}$ -- уникальный морфизм $0_{T_1} \to f^*(0_{T_2})$.
Тот факт, что $\Syn$ сохраняет тождественные морфизмы и композицию следует из утверждения~\nprop{th-func-mod}.

\begin{prop}[syn-lang]
Функтор $\Syn$ является правым сопряженным к $\Lang$.
\end{prop}
\begin{proof}
Определим $\epsilon_{T'} : \Lang(\Syn(T')) \to T'$ как $\epsilon_{T'}(O_t) = t$.
Легко видеть, что $\epsilon_{T'}$ сохраняет аксиомы $\Lang(\Syn(T'))$.
Кроме того, $\epsilon$ естественен по $T'$.
Докажем, что $\epsilon$ является коединицей сопряжения.
Пусть $f : \Lang(M) \to T'$ -- морфизм.
Тогда нам нужно показать, что существует уникальный морфизм $g : \Lang(M) \to \Lang(\Syn(T'))$ такой, что $\epsilon_{T'} \circ g = f$.
По \dlem{cl-term} существует уникальный терм $t$ такой, что $g(O_a) = O_t$.
Так как $t = \epsilon_{T'}(g(O_a)) = f(O_a)$, то $g$ должен удовлетворять уравнению $g(O_a) = O_{f(O_a)}$.
Следовательно, $g$ уникален.
Легко видеть, что $g$ сохраняет аксиомы $\Lang(M)$ и, следовательно, задает морфизм $g : \Lang(M) \to \Lang(\Syn(T'))$.
\end{proof}

\begin{remark}[mod-colimits]
Утверждения \nprop{lang-ff} и \nprop{syn-lang} влекут, что копределы моделей могут быть сконструированы следующим образом:
\[ \colim_{j \in J}(M_j) = \Syn(\Lang(\colim_{j \in J}(M_j))) = \Syn(\colim_{j \in J}(\Lang(M_j))). \]
Так как копределы теорий имеют простое явное описание, то это дает явное описание копределов моделей.
\end{remark}

Для каждого морфизма теорий $f : T \to T'$ мы можем определить функтор $f_! : \Mod{T} \to \Mod{T'}$ как $f_!(M) = \Syn(\Lang(M) \amalg_{T} T')$.
В \cite[Theorem~29]{PHL} было показано, что $f_!$ является левым сопряженным к $f^*$.
Эта теорема была доказана только для более слабого понятия морфизмов теорий, но это доказательство работает и для более общего определения морфизмов.

Функтор $f_!$ можно использовать для представления модели через пораждающие и соотношения.
Модели пустой теории с множеством сортов $\mathcal{S}$ -- это просто $\mathcal{S}$-множества.
Если $f : 0 \to T$ -- уникальный морфизм из пустой теории в некоторую теорию $T$, то $f^*(M)$ -- это просто подлежащее $\mathcal{S}$-множество модели $M$, и $f_!(X)$ -- это свободная модель $T$ на $\mathcal{S}$-множестве $X$.
Если $R$ -- это множество аксиом в языке теории $\Lang(X) \amalg T$, то мы определяем модель $F(X,R)$ теории $T$ как $\Syn(\Lang(X) \amalg T \cup R)$.
По определению $\Syn$, для того, чтобы сконструировать морфизм $F(X,R) \to M$, необходимо и достаточно сконструировать морфизм из $X$ в подлежащее $\mathcal{S}$-множество $M$ таким образом, чтобы соотношения из $R$ были верны в $M$.
Иногда мы будем опускать множество порождающих в нотации $F(X,R)$, так как они обычно могут быть выведены из множества соотношений.

\begin{prop}[cart-mod-dual]
Категория $\cat{C}_T$ дуальна категории моделей $T$.
При этом категория $\cat{C}_T^\lambda$ соответствуют полной подкатегории $\Mod{T}$, состоящей из $\lambda$-представимых объектов.
\end{prop}
\begin{proof}
Определим функтор $F : \cat{C}_T^\fs{op} \to \Mod{T}$.
TODO
\end{proof}

\section{Модельная структура на категории теорий}

В этом разделе мы опишем несколько модельных структур на категории теорий.
Для этого нам понадобится определить несколько морфизмов теорий:

\begin{enumerate}
\item $i_s : (\varnothing,\varnothing,\varnothing,\varnothing) \to (\{ s \},\varnothing,\varnothing,\varnothing)$.
\item Пусть $V$ -- множество мощности $\kappa$. Тогда
\begin{align*}
i_t^\kappa : & (\{ s_i \}_{i \in V} \amalg \{ s \}, \varnothing, \varnothing, \varnothing) \to \\
             & (\{ s_i \}_{i \in V} \amalg \{ s \}, \{ \sigma : \prod_{i \in V} s_i \to s \}, \varnothing, \varnothing)
\end{align*}
\item Пусть $V$ -- множество мощности $\kappa$. Тогда
\begin{align*}
i_p^\kappa : & (\{ s_i \}_{i \in V}, \varnothing, \varnothing, \varnothing) \to \\
             & (\{ s_i \}_{i \in V}, \varnothing, \{ R : \prod_{i \in V} s_i \}, \varnothing)
\end{align*}
\item Пусть $V$ -- множество мощности $\kappa$. Тогда
\begin{align*}
i_f^\kappa : & (\{ s_i \}_{i \in V}, \varnothing, \{ R, R' : \prod_{i \in V} s_i \}, \varnothing) \to \\
             & (\{ s_i \}_{i \in V}, \varnothing, \{ R, R' : \prod_{i \in V} s_i \}, \{ R(V) \sststile{}{V} R'(V) \})
\end{align*}
\item $j_s : (\{ s \},\varnothing,\varnothing,\varnothing) \to \\$
$(\{ s, s' \}, \{ \sigma : s \to s', \sigma : s' \to s \}, \varnothing, \{ \sststile{}{x} \sigma'(\sigma(x)) = x, \sststile{}{x'} \sigma(\sigma'(x')) = x' \})$
\item Пусть $V$ -- множество мощности $\kappa$. Тогда
\begin{align*}
j_t^\kappa : & (\{ s_i \}_{i \in V} \amalg \{ s \}, \{ \sigma : \prod_{i \in V} s_i \to s \}, \varnothing, \varnothing) \to \\
             & (\{ s_i \}_{i \in V} \amalg \{ s \}, \{ \sigma, \sigma' : \prod_{i \in V} s_i \to s \}, \varnothing, \{ \sststile{}{V} \sigma(V) \cong \sigma'(V) \})
\end{align*}
\item Пусть $V$ -- множество мощности $\kappa$. Тогда
\begin{align*}
j_p^\kappa : & (\{ s_i \}_{i \in V}, \varnothing, \{ R : \prod_{i \in V} s_i \}, \varnothing) \to \\
             & (\{ s_i \}_{i \in V}, \varnothing, \{ R, R' : \prod_{i \in V} s_i \}, \{ R(V) \ssststile{}{V} R'(V) \})
\end{align*}
\item Пусть $\mathcal{S} = \{ s_i \}_{i \in I} \amalg \{ s_j' \}_{j \in J}$ -- множество сортов,
$U = \{ x_i : s_i \}_{i \in I}$ и $U' = \{ x_i' : s_i \}_{i \in I}$ -- множества мощности $\kappa$,
и $V = \{ y_j : s_j' \}_{j \in J}$ -- множество мощности $\kappa'$.
Тогда
\begin{align*}
j_m^{\kappa,\kappa'} : & (\mathcal{S}, \{ \sigma_j : \prod_{i \in I} s_i \to s_j' \mid j \in J \}, \varnothing, \\
                       & \qquad \{ \bigwedge_{j \in J} \sigma_j(U) = \sigma_j(U') \sststile{}{U,U'} \bigwedge_{i \in I} x_i = x_i' \}) \to \\
                       & (\mathcal{S}, \{ \sigma_j : \prod_{i \in I} s_i \to s_j' \mid j \in J \} \amalg \{ \sigma_i' : \prod_{j \in J} s_j' \to s_i \mid i \in I \}, \varnothing, \\
                       & \qquad \{ \bigwedge_{j \in J} \sigma_j(U)\!\downarrow\ \sststile{}{U} \bigwedge_{i \in I} \sigma_i'(\{ \sigma_j(x_i) \}_{j \in J}) = x_i \} \cup \\
                       & \qquad \{ \bigwedge_{i \in I} \sigma_i'(V)\!\downarrow\ \sststile{}{V} \bigwedge_{j \in J} \sigma_j(\{ \sigma_i'(y_j) \}_{i \in I}) = y_j \})
\end{align*}
TODO: Определить $j$ для уравнителей и произведений.
\end{enumerate}

% Мы будем говорить, что морфизм теорий является \emph{Морита-эквивалентностью}, если он порождает эквивалентность классифицирующих категорий.
% Мы будем говорить, что морфизм теорий является \emph{$\lambda$-Морита-эквивалентностью}, если он порождает эквивалентность $\lambda$-классифицирующих категорий.
% Мы будем говорить, что морфизм теорий является \emph{корасслоением}, если он инъективен на сортах.
% Класс корасслоенией пораждается множеством $\I$, состоящим из следующих морфизмов:

\section{Конфлюэнтные теории}

\subsection{Разделение аксиом}

Многие теории содержат аксиомы вида
\[ \sigma(x_1, \ldots x_k)\!\downarrow\ \sststile{}{x_1, \ldots x_k} \varphi \]
и зачастую эти аксиомы можно убрать из теории, не сильно ее меняя.
Конкретно, мы докажем, что если отсальные аксиомы удовлетворяют простому естественному условию, то теоремы определенного вида выводимы без этих аксиом.

Мы будем говорить, что аксиомы теории \emph{разделены}, если множество аксиом состоит из двух подмножеств $\mathcal{A}_f$ и $\mathcal{A}_e$, удовлетворяющих следующим условиям:
\begin{enumerate}
\item \label{it:sep-f} Секвенции в $\mathcal{A}_f$ имеют вид $\sigma(x_1, \ldots x_k)\!\downarrow\ \sststile{}{x_1, \ldots x_k} \chi$.
\item \label{it:sep-e} Если секвенция вида $\sststile{}{} \varphi$ выводима в $\mathcal{A}_f \cup \mathcal{A}_e$, то она выводима и в $\mathcal{A}_e$.
\end{enumerate}

Разумеется, мы всегда можем взять пустое множество в качестве $\mathcal{A}_f$, но, чем оно больше, тем лучше.
Зачастую в качестве $\mathcal{A}_f$ можно взять максимальное возможное множество.
Например, это верно для теорий категорий и конечно полных категорий.
Это следует из следующей леммы.
Пусть множество аксиом некоторой теории состоит из двух подмножеств $\mathcal{A}_f$ и $\mathcal{A}_e$.
Мы будем говорить, что подтермы некоторой формулы $\varphi$ определены в $\mathcal{A}_e$, если для любой аксиомы $\sigma(x_1, \ldots x_k)\!\downarrow\ \sststile{}{x_1, \ldots x_k} \chi$ в $\mathcal{A}_f$
и любого подтерма вида $\sigma(t_1, \ldots t_k)$ формулы $\varphi$ секвенция $\sststile{}{} \chi[t_1/x_1, \ldots t_k/x_k]$ выводима из $\mathcal{A}_e$.

\begin{lem}[der-separated-closed]
Пусть $\mathcal{A}_f$ -- подмножество множества аксиом некоторой теории, удовлетворяющее условию~\eqref{it:sep-f}.
Тогда аксиомы этой теории разделены тогда и только тогда, когда выполнено следующее условие.
Для каждой аксиомы $\varphi \sststile{}{V} \psi$ и каждой замкнутой подстановки $\rho$, если секвенция $\sststile{}{} \varphi[\rho] \land \rho\!\downarrow$ выводима из $\mathcal{A}_e$,
и подтермы $\varphi[\rho]$ определены, то подтермы $\psi[\rho]$ тоже определены.
\end{lem}
\begin{proof}
Допустим аксиомы разделены.
Тогда, если секвенция $\sststile{}{} \varphi[\rho] \land \rho\!\downarrow$ выводима из $\mathcal{A}_e$, то секвенция $\sststile{}{} \psi[\rho]$ выводима из $\mathcal{A}_e \cup \mathcal{A}_f$.
Отсюда следует, что подтермы $\psi$ определены в $\mathcal{A}_f \cup \mathcal{A}_e$ относительно $\rho$.
По предположению они определены и в $\mathcal{A}_e$.

Теперь предположим, что условие леммы выполнено.
Сначала мы докажем, что для любой замкнутой формулы $\varphi$ такой, что секвенция $\sststile{}{} \varphi$ выводима в $\mathcal{A}_e$, ее подтермы определены в $\mathcal{A}_e$,
Мы докажем это индукцией по выводу $\sststile{}{} \varphi$ в системе естественного вывода.
Для большинства правил это очевидно.
Для правила \axref{na} это верно по предположению.
Единственный нетривиальный случай -- это \axref{nl}:
\begin{center}
\AxiomC{$\sststile{}{} a = b$}
\AxiomC{$\sststile{}{} \psi[a/x]$}
\RightLabel{\axref{nl}}
\BinaryInfC{$\sststile{}{} \psi[b/x]$}
\DisplayProof
\end{center}
Если $\sigma(t_1, \ldots t_k)$ является подтермом $b$, то необходимое свойство следует из индукционной гипотезы для $\sststile{}{} a = b$.
Иначе $\sigma$ принадлежит $\psi$ и существуют термы $t_1'$, \ldots $t_k'$ и формула $\psi'$ такие, что $t_i = t_i'[b/x]$, $\psi = \psi'[\sigma(t_1', \ldots t_k')/y]$.
По индукционной гипотезе секвенция $\sststile{}{} \chi[t_1'[a/x]/x_1, \ldots t_k'[a/x]/x_k]$ выводима.
Так как секвенция $\sststile{}{} a = b$ выводима, это влечет, что секвенция $\sststile{}{} \chi[t_1/x_1, \ldots t_k/x_k]$ также выводима.

Теперь, если некоторая секвенция $\sststile{}{} \varphi$ выводима в $\mathcal{A}_f \cup \mathcal{A}_e$, то мы докажем индукцией по ее естественному выводу, что она выводится и в $\mathcal{A}_e$.
Единственный нетривиальный случай -- это правило \axref{na} для аксиом из $\mathcal{A}_f$, которое следует из только что доказанного факта.
\end{proof}

\begin{lem}[der-separated-closed]
Пусть $T$ -- теория с разделенными аксиомами.
Если секвенция $\sststile{}{} \psi$ выводима в $T$, то она выводима и из аксиом $\mathcal{A}_e$.
\end{lem}
\begin{proof}
Во-первых, докажем следующий факт.
Если секвенция $\sststile{}{} \psi$ выводима из $\mathcal{A}_e$, то для любой аксиомы $\sigma(x_1, \ldots x_k)\!\downarrow\ \sststile{}{x_1, \ldots x_k} \chi$ из $\mathcal{A}_f$ и любого подтерма $\sigma(t_1, \ldots t_k)$ формулы $\psi$
секвенция $\sststile{}{} \chi[t_1/x_1, \ldots t_k/x_k]$ выводима из $\mathcal{A}_e$.
Мы докажем это индукцией по выводу $\sststile{}{} \psi$ в системе естественного вывода.
Для большинства правил это очевидно.
Для правила \axref{na} это следует из \eqref{it:sep-e}.
Единственный нетривиальный случай -- это \axref{nl}:
\begin{center}
\AxiomC{$\sststile{}{} a = b$}
\AxiomC{$\sststile{}{} \psi[a/x]$}
\RightLabel{\axref{nl}}
\BinaryInfC{$\sststile{}{} \psi[b/x]$}
\DisplayProof
\end{center}
Если $\sigma(t_1, \ldots t_k)$ является подтермом $b$, то необходимое свойство следует из индукционной гипотезы для $\sststile{}{} a = b$.
Иначе $\sigma$ принадлежит $\psi$ и существуют термы $t_1'$, \ldots $t_k'$ и формула $\psi'$ такие, что $t_i = t_i'[b/x]$, $\psi = \psi'[\sigma(t_1', \ldots t_k')/y]$.
По индукционной гипотезе секвенция $\sststile{}{} \chi[t_1'[a/x]/x_1, \ldots t_k'[a/x]/x_k]$ выводима.
Так как секвенция $\sststile{}{} a = b$ выводима, это влечет, что секвенция $\sststile{}{} \chi[t_1/x_1, \ldots t_k/x_k]$ также выводима.

Теперь мы можем доказать утверждение леммы индукцией по выводу $\sststile{}{} \psi$.
Единственный нетривиальный случай -- это правило вывода для аксиом из $\mathcal{A}_f$:
\smallskip
\begin{center}
\AxiomC{$\sststile{}{} t_i\!\downarrow$, $1 \leq i \leq k$}
\AxiomC{$\sststile{}{} \sigma(t_1, \ldots t_k)\!\downarrow$}
\RightLabel{\axlabel{na}}
\BinaryInfC{$\sststile{}{} \chi[t_1/x_1, \ldots t_k/x_k]$}
\DisplayProof
\end{center}
По индукционной гипотезе секвенция $\sststile{}{} \sigma(t_1, \ldots t_k)\!\downarrow$ выводима из $\mathcal{A}_e$.
Только что доказанный факт влечет, что секвенция $\sststile{}{} \chi[t_1/x_1, \ldots t_k/x_k]$ также выводима из $\mathcal{A}_e$.
\end{proof}

Условие в определении разделения аксиом можно усилить.
Для этого нам понадобится ввести новое определение.
Пусть $\varphi_1 \land \ldots \land \varphi_n \sststile{}{V} \psi$ -- секвенция в некоторой теории $T$.
Мы будем говорить, что \emph{подтермы посылки этой секвенции определены} в $T$,
если секвенция $\varphi_1 \land \ldots \land \varphi_i \sststile{}{V} t\!\downarrow$ выводима в $T$ для любого подтерма $t$ формулы $\varphi_{i+1}$.

\begin{prop}[der-separated]
Пусть $T$ -- теория с разделенными аксиомами.
Если секвенция $\varphi \sststile{}{V} \psi$ выводима в $T$ и подтермы ее посылки определены в $T$, то она выводима из $\mathcal{A}_e$.
\end{prop}
\begin{proof}
Пусть $V = \{ x_1, \ldots x_m \}$ и $\varphi = \varphi_1 \land \ldots \land \varphi_n$.
Пусть $T_j = T \cup \{ \sststile{}{} c_i\!\downarrow\ \mid 1 \leq i \leq m \} \cup \{ \sststile{}{} \varphi_i[c_1/x_1, \ldots c_m/x_m]\ \mid 1 \leq i < j \}$.
Мы докажем индукцией по $j$, что аксиомы $T_j$ разделены.
Для $T_0$ это очевидно.
Докажем, что если аксиомы $T_j$ разделены, то это верно и для $T_{j+1}$.
Единственная новая аксиома $T_{j+1}$ -- это $\sststile{}{} \varphi_j[c_1/x_1, \ldots c_m/x_m]$.
Пусть $\sigma(y_1, \ldots y_k) \sststile{}{y_1, \ldots y_k} \chi$ -- аксиома из $\mathcal{A}_f$, и $\sigma(t_1, \ldots t_k)$ -- подтерм $\varphi_j[c_1/x_1, \ldots c_m/x_m]$.
Так как подтермы $\varphi$ определены, то по \dlem{mcf} секвенция $\sststile{}{} \sigma(t_1, \ldots t_k)\!\downarrow$ выводима в $T_j$.
Так как аксиомы $T_j$ разделены, то секвенция $\sststile{}{} \chi[t_1/y_1, \ldots t_k/y_k]$ выводима в $T_j \setminus \mathcal{A}_f$.

Теперь мы можем доказать, что $\varphi \sststile{}{V} \psi$ выводима из $\mathcal{A}_e$.
По \dlem{mcf} для этого достаточно доказать, что секвенция $\sststile{}{} \psi[c_1/x_1, \ldots c_m/x_m]$ выводима в $T_{n+1} \setminus \mathcal{A}_f$.
По \dlem{mcf} она выводима в $T_{n+1}$, и по \dlem{der-separated-closed} она выводима и в $T_{n+1} \setminus \mathcal{A}_f$.
\end{proof}

\subsection{Конфлюэнтные теории}

Зачастую можно выбрать направление для аксиом, постулирующих равенства, так, чтобы получившееся отношение обладало свойством конфлюэнтности.
Для таких теорий можно доказать несколько полезных утверждений.
В этом разделе мы определим понятие конфлюэнтных теорий, обладающих этим свойством, и докажем их свойства.
Для этого нам понадобится определить несколько понятий из теории абстрактных систем редукций \cite{Terese,klop-trs,ohlebusch-advanced}:

\begin{enumerate}
\item \emph{Абстрактная система редукций} -- это множество $A$ вместе с бинарным отношением $\Rightarrow$ на нем.
Мы будем обозначать $\Rightarrow^*$ рефлексивное и транзитивное замыкание отношения $\Rightarrow$.
Если $\Rightarrow_1$ и $\Rightarrow_2$ -- два отношения, то мы будем писать $\Rightarrow_1 \Rightarrow_2$ для обозначения следующего отношения:
$t \Rightarrow_1 \Rightarrow_2 t'$ тогда и только тогда, когда существует терм $s$ такой, что $t \Rightarrow_1 s$ и $s \Rightarrow_2 t'$.
\item Элемент $a$ \emph{редуцируется} к элементу $a'$ если $a \Rightarrow^* a'$.
\emph{Последовательность редукций} -- это конечная или бесконечная последовательность элементов $a_i$ таких, что $a_0 \Rightarrow a_1 \Rightarrow a_2 \Rightarrow \ldots$.
\item Два элемента $a$ и $b$ \emph{соединимы} если существует элемент $c$ такой, что $a \Rightarrow^* c$ и $b \Rightarrow^* c$.
Мы будем также говорить, что $a$ и $b$ соединимы отношением $\Rightarrow$ если оно не ясно из контекста.
Элемент $a$ \emph{конфлюэнтен} если $a \Rightarrow^* b$ и $a \Rightarrow^* c$ влечет, что термы $b$ и $c$ соединимы.
Система \emph{конфлюэнтна} если все ее элементы конфлюэнтны.
Эквивалентно, система конфлюэнтны если любая пара ее элементов соединима.
\item Два элемента $a$ и $b$ называются \emph{$\Rightarrow$-эквивалентными}, если существует последовательность элементов $a_1$, \ldots $a_n$ такая, что $a = a_1$, $b = a_n$,
и для всех $1 \leq i < n$ либо $a_i \Rightarrow a_{i+1}$, либо $a_{i+1} \Rightarrow a_i$.
\item Элемент $a$ называется \emph{нормальной формой} если не существует элемента $a'$ такого, что $a \Rightarrow a'$.
Мы будем писать $a \Rightarrow^\nf b$ когда $a \Rightarrow^* b$ и $b$ является нормальной формой.
Мы будем говорить, что элемент $a$ \emph{имеет нормальную форму} (или, что оно \emph{слабо нормализуем}), если $a \Rightarrow^\nf b$ для некоторого $b$.
Система является \emph{слабо нормализующей} (WN), если все ее элементы имеют нормальную форму.
\item Элемент $a$ \emph{сильно нормалищуем}, если не существует бесконечной последовательности редукций, начинающейся в $a$.
Система является \emph{сильно нормалиющей} (SN), если все ее элементы сильно нормализуемы.
\item Подмножество $A'$ множества $A$ \emph{замкнуто} относительно $\Rightarrow$, если $a' \in A'$ и $a' \Rightarrow a$ влечет, что $a \in A'$.
\end{enumerate}

Лемма Ньюмана говорит, что для того, чтобы проверить, что сильно нормализующая система конфлюэнтна, достаточно проверить более слабое условие, которое называется \emph{локальной конфлюэнтностью}:

\begin{lem}[newman][Лемма Ньюмана]
Пусть $A$ -- сильно нормализующая абстрактная система редукций.
Допустим, что для любых $a,b,c \in A$ таких, что $a \Rightarrow b$ и $a \Rightarrow c$, существует $d \in A$ такой, что $b \Rightarrow^* d$ и $c \Rightarrow^* d$.
Тогда $A$ конфлюэнтна.
\end{lem}
\begin{proof}
Доказательство приведено, например, в \cite[Lemma~2.2.5]{ohlebusch-advanced}.
\end{proof}

\emph{Система переписывания термов} -- это бинарное множество $R$ на множестве термов некоторой теории, удовлетворяющее следующим условиям:
\begin{enumerate}
\item Если $R(t,s)$, то $\FV(s) \subseteq \FV(t)$.
\item Если $R(t,s)$, то $t$ не является переменной.
\end{enumerate}
Система переписываения термов $R$ называется \emph{лево-линейной}, если для всех термов $t$ и $s$ таких, что $R(t,s)$, каждая переменная встречается в $t$ не более одного раза.

Для каждой системы переписывания термов $R$ мы можем определить отношение $\Rightarrow_R$ на множестве термов следующим образом: если $R(t,s)$, то
\[ c[x \repl t[x_1 \repl t_1, \ldots x_k \repl t_k]] \Rightarrow_R c[x \repl s[x_1 \repl t_1, \ldots x_k \repl t_k]] \]
для всех $c$, $x_1$, \ldots $x_k$ и $t_1$, \ldots $t_k$.
Мы будем обозначать $\Term_T$ множество термов теории $T$.
Таким образом, у любой системы переписывания термов есть подлежащая абстрактная система редукций $(\Term_T,\Rightarrow_R)$.

Пусть $V$ -- множество переменных, а $\varphi$ -- формула такая, что $\FV(\varphi) \subseteq V$.
Мы будем говорить, что терм $t$ некоторой теории $T$ \emph{определен} по отношению к паре $(V,\varphi)$, если секвенция $\varphi \sststile{}{V} t\!\downarrow$ выводима в $T$.
Мы будем писать $\Term_{T,V,\varphi}^d$ для обозначения множества термов, определенных по отношению к $(V,\varphi)$.
Мы будем писать $\Term_T^d$ для обозначения множества $\Term_{T,\varnothing,\top}^d$.

\begin{defn}[directed]
Пусть $T$ -- теория с разделенными аксиомами.
\emph{Система редукций} на $T$ -- это абстрактная система редукций $\Rightarrow_T$ на $\Term^d_T$ такая, что следующие условие выполнены:
\begin{enumerate}
\item \label{it:dir-first} Для каждой пары термов $t$ и $s$ таких, что $t \Rightarrow_T s$, секвенция $\sststile{}{} t = s$ выводима.
\item \label{it:dir-second} Для каждой подстановки $\rho$, каждого терма $c$ и каждой аксиомы вида $\psi \sststile{}{V} t = s$ в $\mathcal{A}_e$ таких,
что секвенция $\sststile{}{} \psi[\rho] \land \rho\!\downarrow \land c[t[\rho]/x]\!\downarrow$ выводима,
термы $c[t[\rho]/x]$ и $c[s[\rho]/x]$ эквивалентны в системе $(\Term_T^d,\Rightarrow_T)$.
\end{enumerate}
\end{defn}

\begin{remark}[trs-theory]
Зачастую система редукций на теории $T$ определена как сужение $\Rightarrow_R$ на множество $\Term^d_T$ для некоторой системы переписывания термов $R$.
В этом случае условия \eqref{it:dir-first} и \eqref{it:dir-second} эквивалентны следующим условиям:
\begin{enumerate}
\item \label{it:trs-dir-first} Для каждой подстановки $\rho$ и каждой пары термов $t$ и $s$ таких, что $(t,s) \in R$, если $\sststile{T}{} t[\rho]\!\downarrow \land s[\rho]\!\downarrow$, то $\sststile{T}{} t[\rho] = s[\rho]$.
\item \label{it:trs-dir-second} Для каждой подстановки $\rho$ и каждой аксиомы вида $\psi \sststile{}{V} t = s$ в $\mathcal{A}_e$ таких,
что секвенция $\sststile{}{} \psi[\rho] \land \rho\!\downarrow$ выводима, термы $t[\rho]$ и $s[\rho]$ эквивалентны в системе $(\Term_T^d,\Rightarrow_T)$.
\end{enumerate}
\end{remark}

\begin{example}[dir-ax]
Пусть $\mathcal{A}_f$ -- множество аксиом в некоторой теории $T$, удовлетворяющее условию~\eqref{it:sep-f}.
Пусть $\mathcal{A}_d$ -- множество аксиом в $T$ вида $\varphi \sststile{}{x_1, \ldots x_k} \sigma(x_1, \ldots x_k)\!\downarrow$ такое,
что для любой такой аксиомы в $\mathcal{A}_d$ и любой аксиомы вида $\sigma(x_1, \ldots x_k)\!\downarrow\ \sststile{}{x_1, \ldots x_k} \chi$ верно, что $\varphi = \chi$.

Пусть $R$ -- система переписывания термов на $T$, сохраняющая сорта термов.
Пусть $\mathcal{A}_c$ -- множество аксиом вида $t\!\downarrow\ \sststile{}{\FV(t)} t = s$ для каждой пары $(t,s) \in R$.
Если аксиомы $\mathcal{A}_f \cup (\mathcal{A}_d \cup \mathcal{A}_c)$ разделены, то $R$ задает систему редукций на $\mathcal{A}_f \cup \mathcal{A}_d \cup \mathcal{A}_c$ как описано в \premark{trs-theory}.
\end{example}

\begin{example}[cat-red]
Теорию категорий можно представить в виде, описаном в \pexample{dir-ax}.
Аксиомы $\mathcal{A}_f \cup \mathcal{A}_d$ эквивалентны следующему набору аксиом:
\begin{align*}
& \sststile{}{f} d(f)\!\downarrow \land c(f)\!\downarrow \\
& \sststile{}{x} \fs{id}(x)\!\downarrow \\
c(f) = d(g) & \ssststile{}{f,g} \circ(g,f)\!\downarrow
\end{align*}
Отношение $R$ состоит из следующих пар:
\begin{align*}
d(\fs{id}(x)) & \Rightarrow_R x \\
c(\fs{id}(x)) & \Rightarrow_R x \\
d(\circ(g,f)) & \Rightarrow_R d(f) \\
c(\circ(g,f)) & \Rightarrow_R c(g) \\
\circ(\fs{id}(x),f) & \Rightarrow_R f \\
\circ(f,\fs{id}(x)) & \Rightarrow_R f \\
\circ(\circ(h,g),f) & \Rightarrow_R \circ(h,\circ(g,f))
\end{align*}
\end{example}

Теперь мы докажем техническую лемму, которая говорит, что секвенция $\varphi \sststile{}{V} t = s$ доказуема в теории $T$ тогда и только тогда,
когда термы $t$ и $s$ эквивалентны в отношении, которое пораждается правой стороной аксиом и равенствами в $\varphi$.

\begin{lem}[der-eq]
Секвенция $\varphi \sststile{}{V} t = s$ выводима в теории $T$ тогда и только тогда, когда существуют термы $t_1, \ldots t_n$ такие, что $t = t_1$, $s = t_n$ и для всех $1 \leq i < n$ верно, что $t_i = c[a/x]$ и $t_{i+1} = c[b/x]$
для некоторых термов $a$, $b$ и $c$ таких, что переменная $x$ встречается в $c$ ровно один раз, и одно из следующих условий выполнено:
\begin{enumerate}
\item Существует применение правила \axref{na}, в котором посылка выводима и заключение имеет вид либо $\varphi \sststile{}{V} a = b$, либо $\varphi \sststile{}{V} b = a$.
Кроме того, естественный вывод этого заключения является подвыводом вывода секвенции $\varphi \sststile{}{V} t = s$.
\item $\varphi = \varphi_1 \land \ldots \land \varphi_k$, и существует $j$ такой, что $\varphi_j$ равно либо $a = b$, либо $b = a$.
\end{enumerate}
\end{lem}
Кроме того, секвенции $\varphi \sststile{}{V} t_i\!\downarrow$ выводимы для всех $1 \leq i \leq n$.
\begin{proof}
Если такая последовательность термов существует, то легко показать, что секвенция $\varphi \sststile{}{V} t = s$ выводима по правилам естественного вывода.
Обратное утверждение мы докажем индукцией по естественному выводу секвенции $\varphi \sststile{}{V} t = s$.
Правила \axref{nv}, \axref{np} и \axref{nf} очевидны.
Правила \axref{nh} и \axref{na} следует из предположения.
В этом случае мы берем $t_1 = a = t$, $t_2 = b = s$ и $c = x$.
Теперь рассмотрим правило \axref{ns}.
Если $t_1$, \ldots $t_n$ -- последовательность для $\varphi \sststile{}{V} s = t$, то мы можем взять последовательность $t_n$, \ldots $t_1$ для $\varphi \sststile{}{V} t = s$.

Нам осталось рассмотреть правило \axref{nl}:
\begin{center}
\AxiomC{$\varphi \sststile{}{V} p = q$}
\AxiomC{$\varphi \sststile{}{V} t'[p/y] = s'[q/y]$}
\RightLabel{\axref{nl}}
\BinaryInfC{$\varphi \sststile{}{V} t'[q/y] = s'[q/y]$}
\DisplayProof
\end{center}
Мы можем предположить, что переменная $y$ встречается ровно один раз в формуле $t' = s'$, так как общий случай следует из этого частного.
Пусть $t_1$, \ldots $t_n$ -- последовательность термов для $\varphi \sststile{}{V} p = q$, и $s_1$, \ldots $s_m$ -- последовательность для $\varphi \sststile{}{V} t'[p/y] = s'[p/y]$.
Тогда $t'[t_n/y]$, \ldots $t'[t_1/y] = s_1$, \ldots $s_m = s'[t_1/y]$, \ldots $s'[t_n/y]$ -- последовательность для $\varphi \sststile{}{V} t'[q/y] = s'[q/y]$.

Теперь мы докажем, что секвенция $\varphi \sststile{}{V} t_i\!\downarrow$ выводима индукцией по $i$.
Это верно для $i = 1$ по предположению.
Препдоложим, что это верно для некоторого $i$.
Тогда $t_i = c[a/x]$, $t_{i+1} = c[b/x]$ и секвенция $\varphi \sststile{}{V} a = b$ выводима.
По правилу \axref{nl} секвенция $\varphi \sststile{}{V} t_{i+1}\!\downarrow$ также выводима.
\end{proof}

В следующем утверждении мы докажем основное свойство теорий с системами редукцией.

\begin{prop}[conf-main]
Пусть $T$ -- теория с системой редукций.
Секвенция $\sststile{}{} t = s$ выводим тогда и только тогда, когда термы $t$ и $s$ эквивалентны в системе $(\Term_T^d,\Rightarrow_T)$.
\end{prop}
\begin{proof}
Если $t$ и $s$ эквивалентны в $(\Term_T^d,\Rightarrow_T)$, то существует зигзаг $\Rightarrow_T$-редукций между ними.
Так как отношение $\sststile{T}{} - = -$ является отношением эквивалентности на множестве $\Term_T^d$, то мы можем предположить, что $t \Rightarrow_T s$.
Тогда условие~\eqref{it:dir-first} определения~\ndefn{directed} влечет, что $\sststile{T}{} t = s$.

Если $t$ и $s$ такие термы, что $\sststile{T}{} t = s$, то эта секвенция выводима из аксиом $\mathcal{A}_e$.
Тогда \rlem{der-eq} влечет, что существует последовательность $t_1$, \ldots $t_n$ элементов $\Term^d_T$ такая, что $t = t_1$, $s = t_n$ и для всех $1 \leq i < n$
существуют аксиома $\psi \sststile{}{V} a = b$ в $\mathcal{A}_e$, подстановка $\rho$ и терм $c$ такие,
что секвенция $\sststile{}{} \psi[\rho] \land \rho\!\downarrow$ выводима, $t_i = c[a[\rho]/y]$ и $t_{i+1} = c[b[\rho]/y]$ (или наоборот).
Условие~\eqref{it:dir-second} определения~\ndefn{directed} влечет, что $t_i$ и $t_{i+1}$ эквивалентны в системе $(\Term_T^d,\Rightarrow_T)$.
\end{proof}

\begin{cor}[conf-main]
Пусть $T$ -- теория с системой редукций.
Тогда система $(\Term_T^d,\Rightarrow_T)$ конфлюэнтна тогда и только тогда, когда любая пара термов $t$ и $s$ таких, что $\sststile{T}{} t = s$, соединима в этой системе.
\end{cor}

\begin{example}
Теория категорий конфлюэнтна.
Легко видеть, что она SN.
По \dlem{newman} достаточно проверить локальную конфлюэнтность, что легко сделать, перебрав варианты.
\end{example}

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
