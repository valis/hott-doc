\documentclass[reqno]{amsart}

\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{turnstile}
\usepackage{verbatim}

\hypersetup{colorlinks=true,linkcolor=blue}

\renewcommand{\turnstile}[6][s]
    {\ifthenelse{\equal{#1}{d}}
        {\sbox{\first}{$\displaystyle{#4}$}
        \sbox{\second}{$\displaystyle{#5}$}}{}
    \ifthenelse{\equal{#1}{t}}
        {\sbox{\first}{$\textstyle{#4}$}
        \sbox{\second}{$\textstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{s}}
        {\sbox{\first}{$\scriptstyle{#4}$}
        \sbox{\second}{$\scriptstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{ss}}
        {\sbox{\first}{$\scriptscriptstyle{#4}$}
        \sbox{\second}{$\scriptscriptstyle{#5}$}}{}
    \setlength{\dashthickness}{0.111ex}
    \setlength{\ddashthickness}{0.35ex}
    \setlength{\leasturnstilewidth}{2em}
    \setlength{\extrawidth}{0.2em}
    \ifthenelse{%
      \equal{#3}{n}}{\setlength{\tinyverdistance}{0ex}}{}
    \ifthenelse{%
      \equal{#3}{s}}{\setlength{\tinyverdistance}{0.5\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{d}}{\setlength{\tinyverdistance}{0.5\ddashthickness}
        \addtolength{\tinyverdistance}{\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{t}}{\setlength{\tinyverdistance}{1.5\dashthickness}
        \addtolength{\tinyverdistance}{\ddashthickness}}{}
        \setlength{\verdistance}{0.4ex}
        \settoheight{\lengthvar}{\usebox{\first}}
        \setlength{\raisedown}{-\lengthvar}
        \addtolength{\raisedown}{-\tinyverdistance}
        \addtolength{\raisedown}{-\verdistance}
        \settodepth{\raiseup}{\usebox{\second}}
        \addtolength{\raiseup}{\tinyverdistance}
        \addtolength{\raiseup}{\verdistance}
        \setlength{\lift}{0.8ex}
        \settowidth{\firstwidth}{\usebox{\first}}
        \settowidth{\secondwidth}{\usebox{\second}}
        \ifthenelse{\lengthtest{\firstwidth = 0ex}
            \and
            \lengthtest{\secondwidth = 0ex}}
                {\setlength{\turnstilewidth}{\leasturnstilewidth}}
                {\setlength{\turnstilewidth}{2\extrawidth}
        \ifthenelse{\lengthtest{\firstwidth < \secondwidth}}
            {\addtolength{\turnstilewidth}{\secondwidth}}
            {\addtolength{\turnstilewidth}{\firstwidth}}}
        \ifthenelse{\lengthtest{\turnstilewidth < \leasturnstilewidth}}{\setlength{\turnstilewidth}{\leasturnstilewidth}}{}
    \setlength{\turnstileheight}{1.5ex}
    \sbox{\turnstilebox}
    {\raisebox{\lift}{\ensuremath{
        \makever{#2}{\dashthickness}{\turnstileheight}{\ddashthickness}
        \makehor{#3}{\dashthickness}{\turnstilewidth}{\ddashthickness}
        \hspace{-\turnstilewidth}
        \raisebox{\raisedown}
        {\makebox[\turnstilewidth]{\usebox{\first}}}
            \hspace{-\turnstilewidth}
            \raisebox{\raiseup}
            {\makebox[\turnstilewidth]{\usebox{\second}}}
        \makever{#6}{\dashthickness}{\turnstileheight}{\ddashthickness}}}}
        \mathrel{\usebox{\turnstilebox}}}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{#3~\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\expandafter\newcommand\csname n#2\endcsname[1]{\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{theorem}{Theorem}
\newref{lem}{lemma}{Lemma}
\newref{prop}{proposition}{Proposition}
\newref{cor}{corollary}{Corollary}
\newref{cond}{condition}{Condition}
\newref{conj}{conjecture}{Conjecture}

\theoremstyle{definition}
\newref{defn}{definition}{Definition}
\newref{example}{example}{Example}

\theoremstyle{remark}
\newref{rem}{remark}{Remark}

\newcommand{\red}{\Rightarrow}
\newcommand{\deq}{\equiv}
\newcommand{\repl}{:=}
\newcommand{\idtype}{\rightsquigarrow}

\newcommand{\cat}[1]{\mathbf{#1}}
\newcommand{\C}{\cat{C}}
\newcommand{\Cat}{\cat{Cat}}
\newcommand{\Mod}[1]{#1\text{-}\cat{Mod}}
\newcommand{\Th}{\cat{Th}}
\newcommand{\emptyCtx}{\mathbf{1}}
\newcommand{\Set}{\cat{Set}}
\newcommand{\sSet}{\cat{sSet}}
\newcommand{\lc}{lc}
\newcommand{\lcc}{lcc}
\newcommand{\mlc}{\mathrm{\lc}}
\newcommand{\mlcc}{\mathrm{\lcc}}
\newcommand{\K}{$\mathcal{K}$}
\newcommand{\csSet}{\sSet_\mathcal{L}}
\newcommand{\cqCat}{\cat{qcat}_\mathcal{L}}
\newcommand{\lcsSet}{\sSet^\mlc}
\newcommand{\lccsSet}{\sSet^\mlcc}
\newcommand{\lcN}{N^\mlc}
\newcommand{\lcC}{\mathfrak{C}^\mlc}
\newcommand{\cI}{\I_\mathcal{K}}
\newcommand{\cJ}{\J_\mathcal{K}}
\newcommand{\join}{\star}
\newcommand{\cSet}{\cat{cSet}}
\newcommand{\Hom}{\mathrm{Hom}}
\newcommand{\Map}{\mathrm{Map}}
\newcommand{\colim}{\mathrm{colim}}

\newcommand{\we}{\mathcal{W}}
\newcommand{\I}{\mathrm{I}}
\newcommand{\J}{\mathrm{J}}
\newcommand{\class}[2]{#1\text{-}\mathrm{#2}}
\newcommand{\Icell}[1][\I]{\class{#1}{cell}}
\newcommand{\Icof}[1][\I]{\class{#1}{cof}}
\newcommand{\Iinj}[1][\I]{\class{#1}{inj}}
\newcommand{\Jinj}[1][]{\Iinj[\J#1]}
\newcommand{\Jcell}[1][]{\Icell[\J#1]}
\newcommand{\Jcof}[1][]{\Icof[\J#1]}
\newcommand{\cyli}{i}

\numberwithin{figure}{section}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\begin{document}

\title[Equivalence between quasicategories and models of type theory]{Equivalence between locally cartesian (closed) quasicategories and models of homotopy type theory with an interval type}

\author{Valery Isaev}

\begin{abstract}
Abstract.
\end{abstract}

\maketitle

\section{Introduction}

\begin{comment}
\section{Cubically enriched categories}

In this section we recall the definition of the category $\Cat_\square$ of cubically enriched categories and Quillen adjunction between
the cateogry simplicial sets $\sSet$ (with Joyal model structure) and $\Cat_\square$.
We also define Quillen adjunction between $\Cat_\square$ and categories of models of suitable algebraic dependent type theories.

Let $D$ be poset $\{0,1\}$ where $0 \leq 1$.
For every $0 \leq n$, $1 \leq i \leq n+1$, $\epsilon \in D$, let $\delta^{i,\epsilon}_n : D^n \to D^{n+1}$ and $\sigma^i_n : D^{n+1} \to D^n$ be the following morphisms of posets:
\begin{align*}
\delta^{i,\epsilon}_n(x_1, \ldots x_n) & = (x_1, \ldots x_{i-1}, \epsilon, x_{i+1}, \ldots x_n) \\
\sigma^i_n(x_1, \ldots x_{n+1}) & = (x_1, \ldots x_{i-1}, x_{i+1}, \ldots x_{n+1})
\end{align*}
Category of cubes $\square$ is the subcategory of the category of posets on objects of the form $D^n$ generated by morphisms $\delta^{i,\epsilon}_n$ and $\sigma^i_n$.
Let $\cSet$ be the category of cubical sets $\Set^{\square^{op}}$.
Let $\square^n \in \cSet$ be the representable presheaf on $D^n$.
Let $d^{i,\epsilon}_n : \square^n \to \square^{n+1}$ and $s^i_n : \square^{n+1} \to \square^n$ be the maps represented by $\delta^{i,\epsilon}_n$ and $\sigma^i_n$.

There is a (unique) closed monoidal structure $(\otimes,1)$ on $\cSet$ such that $\square^n \otimes \square^m \cong \square^{n+m}$ and $1 = \square^0$ (see, for example, \cite{jardine}).
Let $X$ be an object of a cocomplete monoidal category $\C$.
Then there exists a (unique) colimit-preserving strong monoidal functor $F : \cSet \to \C$ such that $F(\square^1) = X$.
This functor has a right adjoint $G : \C \to \cSet$ given by formula $G(X) = \Hom_\C(F(y(-)),X)$, where $y : \square \to \cSet$ is the Yoneda embedding.
An examples of this construction is the adjunction $|-| : \cSet \rightleftarrows \sSet : S$ such that $|\square^1| = \Delta^1$.

For every $n \geq 0$, let $\partial \square^n$ be the following coequalizer:
\[ \coprod_{1 \leq i < j \leq n, \epsilon_1,\epsilon_2 \in D} \square^{n-2} \rightrightarrows \coprod_{1 \leq i \leq n, \epsilon \in D} \square^{n-1} \to \partial \square^n, \]
where one of the morphisms maps $(i,j,\epsilon_1,\epsilon_2)$-th component to $(i,\epsilon_1)$-th component by map $d^{j-1,\epsilon_2}_{n-2}$,
the other one maps $(i,j,\epsilon_1,\epsilon_2)$-th component to $(j,\epsilon_2)$-th component by map $d^{i,\epsilon_1}_{n-2}$,
Consider morphism $f : \coprod_{1 \leq i \leq n, \epsilon \in D} \square^{n-1}$ that is defined on $(i,\epsilon)$-th component by $d^{i,\epsilon}_{n-1}$.
Then this morphism determines a morphism $i^n : \partial \square^n \to \square^n$.

For every $n \geq 0$, $1 \leq i \leq n$, $\epsilon \in D$, let $\sqcap^n_{i,\epsilon}$ be the following coequalizer:
\[ \coprod_{\substack{1 \leq j_1 < j_2 \leq n, \gamma_1,\gamma_2 \in D, \\ (j_1,\gamma_1) \neq (i,\epsilon), (j_2,\gamma_2) \neq (i,\epsilon)}} \square^{n-2} \rightrightarrows \coprod_{\substack{1 \leq j \leq n, \gamma \in D, \\ (j,\gamma) \neq (i,\epsilon)}} \square^{n-1} \to \sqcap^n_{i,\epsilon}, \]
where morphisms are defined as before.
The restriction of $f$ determines a morphism $u^n_{i,\epsilon} : \sqcap^n_{i,\epsilon} \to \square^n$.

There is a model structure on $\cSet$ with maps $i^n : \partial \square^n \to \square^n$ as generating cofibrations
and maps $u^n_{i,\epsilon} : \sqcap^n_{i,\epsilon} \to \square^n$ as generating trivial cofibrations (see, for example, \cite[Example~52, Theorem~88]{jardine}).
Functors $|-| : \cSet \rightleftarrows \sSet : S$ determine a Quillen equivalence.

Let $\Cat_\Delta$ and $\Cat_\square$ be the categories of simplicially and cubically enriched categories respectively (that is, categories enriched in $\sSet$ and $\cSet$).
Bergner constructed a model structure on $\Cat_\Delta$ in \cite{bergner}.
Lurie generalized this construction (\cite[Proposition~A.3.2.4]{lurie-topos}).
In particular, this proposition applies to the category of cubically enriched categories.
To describe the class of cofibrations of this model category, we need too define a functor $ar : \cSet \to \Cat_\square$.
For every cubical set $A$, let $ar(A)$ be the cubically enriched category with two objects $X$ and $Y$ and $\Hom(X,Y) = A$, $\Hom(X,X) = \Hom(Y,Y) = 1$, $\Hom(Y,X) = \varnothing$.
The class of cofibrations is generated by the set of maps of the form $ar(i^n)$ and map $\varnothing \to 1$.

\begin{rem}
Fibrations in $\Cat_\square$ do not have simple description, but fibrant objects have.
Since the category of simplicial sets is excellent, the category of cubical sets is also excellent by \cite[Remark~A.3.2.21]{lurie-topos}.
By \cite[Theorem~A.3.2.24]{lurie-topos}, a cubically enriched category $C$ is fibrant
if and only if for every objects $X$ and $Y$ of $C$, $\Hom_C(X,Y)$ is a fibrant cubical set.
Also, a map $F : C \to D$ between cubically enriched categories, where $D$ is fibrant, is a fibration if and only if the following conditions are satisfied:
\begin{enumerate}
\item For every object $X$ and $Y$ of $C$, $\Hom_C(X,Y) \to \Hom_D(F(X),F(Y))$ is a fibration of cubical sets.
\item For every object $X$ of $C$ and every equivalence $f : F(X) \to Y$ in $D$, there exists an equivalence $f' : X \to Y'$ in $C$ such that $F(f') = f$.
\end{enumerate}
\end{rem}

There is a pair of adjoint functors $\mathfrak{C}_\Delta : \sSet \rightleftarrows \Cat_\Delta : N_\Delta$ which is defined in \cite[Section~1.1.5]{lurie-topos}.
We will need analogous functors for cubically enriched categories.
We define a cubically enriched category $\mathfrak{C}_\square(\Delta^n)$ as follows:
\begin{itemize}
\item The objects of $\mathfrak{C}_\square(\Delta^n)$ are natural numbers between $0$ and $n$.
\item For every $0 \leq j < i \leq n$, $\Hom_{\mathfrak{C}_\square(\Delta^n)}(i,j) = \varnothing$.
\item For every $0 \leq i \leq n$, $\Hom_{\mathfrak{C}_\square(\Delta^n)}(i,i) = 1$.
\item For every $0 \leq i < j \leq n$, $\Hom_{\mathfrak{C}_\square(\Delta^n)}(i,j) = \square^{j-i-1}$.
\item For every object $i$ of $\mathfrak{C}_\square(\Delta^n)$, the identity morphism on $i$ is the unique element of $\Hom_{\mathfrak{C}_\square(\Delta^n)}(i,i)$.
\item For every $0 \leq i < j < k \leq n$, the composition
\[ \Hom_{\mathfrak{C}_\square(\Delta^n)}(i,j) \otimes \Hom_{\mathfrak{C}_\square(\Delta^n)}(j,k) \to \Hom_{\mathfrak{C}_\square(\Delta^n)}(i,k) \]
is the composite $\square^{j-i-1} \otimes \square^{k-j-1} \cong \square^{k-i-2} \to \square^{k-i-1}$.
\end{itemize}
\end{comment}

\section{Functors between $\sSet$ and $\Mod{T}$}

In this section we define a Quillen adjunction between $\sSet$ and $\Mod{T}$ for every appropriate algebraic dependent type theory $T$.
Recall that $sq_l$ is the theory with the following axioms:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash i : I$}
\AxiomC{$\Gamma \vdash j : I$}
\BinaryInfC{$\Gamma \vdash sq_l(i,j) : I$}
\DisplayProof
\end{center}
\begin{align*}
sq_l(left,j) & = left \\
sq_l(right,j) & = j \\
sq_l(i,left) & = left \\
sq_l(i,right) & = i
\end{align*}
To define functors between $\sSet$ and $\Mod{T}$, we also need to assume that $sq_l$ is associative.
Let $sq^a_l$ be the theory which has the same axioms as $sq_l$ together with the following axiom:
\[ sq_l(sq_l(i,j),k) = sq_l(i,sq_l(j,k)) \]

Let $T$ be any theory under $sq^a_l$.
For every finite nonempty linearly ordered set $J$, we define a model $\mathfrak{C}(\Delta^J)$ of $T$.
It is freely generated by generators and relations described below.
Generators of $\mathfrak{C}(\Delta^J)$ are $O_j : (ty,0)$ for every $j \in J$, and $M_{J'} : (tm,|J'|-1)$ for every subset $J'$ of $J$ such that $|J'| \geq 2$.
For every $j \in J$, $\mathfrak{C}(\Delta^J)$ has relation $\vdash O_j\ type$.
For every $J' = \{ j_1 < \ldots < j_n \} \subseteq J$ such that $n \geq 2$, it has the following relation:
\[ x : O_{j_1}, x_{j_2} : I, \ldots x_{j_{n-1}} : I \vdash M_{J'} : O_{j_n} \]
For every $j \notin J'$ such that $j_1 < j < j_n$, it has the following relations:
\begin{align}
x : O_{j_1}, x_{j_2} : I, \ldots x_{j_{n-1}} : I & \vdash M_{J' \cup \{j\}}[x_j \repl left] \deq M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}] \label{rel:left} \\
x : O_{j_1}, x_{j_2} : I, \ldots x_{j_{n-1}} : I & \vdash M_{J' \cup \{j\}}[x_j \repl right] \deq M_{J'} \label{rel:right}
\end{align}

The idea of this definition is similar to \cite[Definition~1.1.5.1]{lurie-topos}.
For every vertex $j$ of $\Delta^J$, we have a type $O_j$,
and for every $(n+1)$-dimensional face $J'$ of $\Delta^J$, we have an $n$-dimensional cube $M_{J'}$.
Relations describe faces of these cubes.

Let $sq_l(x_1, \ldots x_n) = sq_l(x_1, \ldots sq_l(x_{n-1},x_n) \ldots )$.
In particular, $sq_l(X) = x$ and $sq_l() = right$.
Now, we can extend $\mathfrak{C}$ to a functor $\Delta \to \Mod{T}$.
Let $f : J \to K$ be a monotone map between linearly ordered sets.
Then we define $\mathfrak{C}(f)$ as follows:
\begin{align*}
\mathfrak{C}(f)(O_j) & = O_{f(j)} \\
\mathfrak{C}(f)(M_{J'}) & =
\begin{cases}
    x                                                                  & \text{if } |f(J')| = 1 \\
    M_{f(J')}[\ \ldots\ x_{k_i} \repl sq_l(x_{f^{-1}(k_i)})\ \ldots\ ] & \text{if } |f(J')| > 1 \\
\end{cases}
\end{align*}
where $k_i$ runs from $k_2$ to $k_{m-1}$, $\{ k_1 < \ldots < k_m \} = f(J')$,
and $x_{f^{-1}(k_i)} = x_{j_1}, \ldots x_{j_n}$, $\{ j_1 < \ldots < j_n \} = f^{-1}(k_i)$.

Let us check that $\mathfrak{C}(f)$ preserves relations.
Let $J' = \{ j_1 < \ldots < j_i < j < j_{i+1} < \ldots < j_n \}$ be a subset of $J$, and let $f'$ be the restriction of $f$ to $J'$.
If $|f(J')| = 1$, then $\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) = \mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) = \mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl right]) = \mathfrak{C}(f)(M_{J'}) = x$.
Thus we may assume that $|f(J')| > 1$. 

Let $\rho(x_{f(j_i)}) = sq_l(x_{f'^{-1}(f(j_1))})$ for every $1 \leq i \leq n$ such that $f(j_i) \neq f(j)$.
Let us consider the first relation.
If $f(j) = f(j_1)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) & = \\
M_{f(J')}[\rho] & = \\
M_{\{ f(j), \ldots f(j_n) \}}[\rho][x \repl x] & = \\
\mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) & .
\end{align*}
If $f(j) = f(j_n)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) & = \\
M_{f(J')}[\rho] & = \\
x[x \repl M_{\{f(j_1), \ldots f(j)\}}[\rho]] & = \\
\mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) & .
\end{align*}
If $f(j_1) < f(j) < f(j_n)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl sq_l(x_{f'^{-1}(f(j))}, x_j)][x_j \repl left] & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl left] & = \\
M_{\{f(j), \ldots f(j_n)\}}[x \repl M_{\{f(j_1), \ldots f(j)\}}][\rho] & = \\
\mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) & .
\end{align*}

Let us consider the second relation.
If either $f(j) = f(j_1)$ or $f(j) = f(j_n)$, then $\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl right]) = M_{f(J')}[\rho] = \mathfrak{C}(f)(M_{J'})$.
If $f(j_1) < f(j) < f(j_n)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl right]) & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl sq_l(x_{f'^{-1}(f(j))}, x_j)][x_j \repl right] & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl sq_l(x_{f'^{-1}(f(j))})] & = \\
\mathfrak{C}(f)(M_{J'}) & ,
\end{align*}
If $f(j_i) < f(j) < f(j_{i+1})$, then the last equality holds by \eqref{rel:right},
otherwise it holds immediately by definition of $\mathfrak{C}(f)(M_{J'})$.

Let $[n]$ be the set of natural numbers $\{ 0, \ldots n \}$ with the obvious linear order.
Then $\Delta$ is the full subcategory of linearly ordered sets on objects of the form $[n]$.
It is easy to see that $\mathfrak{C}$ preserves identity morphisms,
and the fact that it preserves compositions follows from associativity of $sq_l$.
Thus we have a functor $\mathfrak{C} : \Delta \to \Mod{T}$.
This functor (uniquely) extends to a colimit-preserving functor $\mathfrak{C} : \sSet \to \Mod{T}$,
which has a right adjoint $N : \Mod{T} \to \sSet$ defined by equation $N(X) = \Hom(\mathfrak{C}(-),X)$.

We can explicitly describe $\mathfrak{C} : \sSet \to \Mod{T}$.
Model $\mathfrak{C}(X)$ is generated by symbols $O_a : (ty,0)$ for every $a \in X_0$, and $M_a : (tm,n)$ for every $a \in X_n$, $n \geq 1$.
For every $a \in X_0$, $\mathfrak{C}(X)$ has relations $\vdash O_a\ type$ and $M_{s_0(a)} = (x : O_a \vdash x : O_a)$.
For every $a \in X_n$, $n \geq 1$, it has the following relation:
\[ x : O_{a|\Delta^{\{0\}}}, x_1 : I, \ldots x_{n-1} : I \vdash M_a : O_{a|\Delta^{\{n\}}} \]
For every $1 \leq j \leq n-1$, it has the following relations:
\begin{align*}
M_a[x_j \repl left] & = M_{a|\Delta^{\{ j, \ldots n \}}}[x \repl M_{a|\Delta^{\{ 0, \ldots j \}}}] \\
M_a[x_j \repl right] & = M_{a|\Delta^{\{0, \ldots j-1, j+1, \ldots n\}}}
\end{align*}
For every $0 \leq j \leq n$, it has the following relation:
\[ M_{s_j(a)} =
\begin{cases}
    M_a[x_1 \repl x_2, \ldots x_{n-1} \repl x_n]                                      & \text{if } j = 0 \\
    M_a[x_j \repl sq_l(x_j,x_{j+1}), x_{j+1} \repl x_{j+2}, \ldots x_{n-1} \repl x_n] & \text{if } 1 \leq j \leq n-1 \\
    M_a                                                                               & \text{if } j = n \\
\end{cases}
\]
For every morphism $f : X \to Y$ of simplicial sets, let $\mathfrak{C}(f)(O_a) = O_{f(a)}$ and $\mathfrak{C}(f)(M_a) = M_{f(a)}$.
It is easy to see that this definition preserves relations, identity morphisms and compositions.

\begin{prop}
Functors $\mathfrak{C} \dashv N$ determine a Quillen adjunction between $\sSet$ with the Joyal model structure and $\Mod{T}$ with the model structure defined in \cite{alg-models}.
\end{prop}
\begin{proof}
Note that $\mathfrak{C}(\partial \Delta^n)$ is isomorphic (over $\mathfrak{C}(\Delta^n)$) to the theory
freely generated by the same generators and relations as $\mathfrak{C}(\Delta^n)$ except for $M_{[n]}$.
Similarly, if $i \in [n]$, then $\mathfrak{C}(\Lambda^n_i)$ is freely generated by the same generators
and relations as $\mathfrak{C}(\partial \Delta^n)$ except for $M_{\{ 0, \ldots i-1, i+1, \ldots n \}}$.

Let us prove that $\mathfrak{C}$ preserves cofibration.
To do this, it is enough to show that $\mathfrak{C}(\partial \Delta^n) \to \mathfrak{C}(\Delta^n)$ is a cofibration for every $n$.
If $n = 0$, then this map equals to $i_{(ty,0)}$.
Suppose that $n > 0$.
First, let us define objects $\square^k$ and $\partial \square^k$.
Let $\square^k = F(\{ x : A, x_1 : I, \ldots x_k : I \vdash b : B \})$,
and let $\partial \square^k$ be freely generated by generators and relations described below.
Generators of $\partial \square^k$ are $A,B : (ty,0)$ and $b_{[i=c]} : (tm,k)$ for every $1 \leq i \leq k$, $c \in \{left,right\}$.
For every $1 \leq i \leq k$ and $c \in \{left,right\}$, it has the following relation:
\[ x : A, x_1 : I, \ldots x_{i-1} : I, x_{i+1} : I, \ldots x_k : I \vdash b_{[i=c]} : B \]
For every $1 \leq i_1 < i_2 \leq k$ and $c,c' \in \{left,right\}$, it has the following relation:
\[ b_{[i_2=c']}[x_{i_1} \repl c] = b_{[i_1=c]}[x_{i_2} \repl c'] \]

Map $i^k : \partial \square^k \to \square^k$ is defined in the obvious way: $i^k(b_{[i=c]}) = b[x_i \repl c]$.
Let $v : \square^{n-1} \to \mathfrak{C}(\Delta^n)$ be defined as follows: $v(A) = O_0$, $v(B) = O_n$, $v(b) = M_{[n]}$.
Map $v \circ i^k$ factors through $\mathfrak{C}(\partial \Delta^n) \to \mathfrak{C}(\Delta^n)$, and the following square is cocartesian:
\[ \xymatrix{ \partial \square^{n-1} \ar[r] \ar[d]_{i^k} & \mathfrak{C}(\partial \Delta^n) \ar[d] \\
              \square^{n-1} \ar[r]_v & \mathfrak{C}(\Delta^n)
            } \]
Thus we just need to show that $i^k$ is a cofibration.
But it is a pushout of $i_{(tm,1)} : F(\{ x : A \vdash B\ type \}) \to F(\{ x : A \vdash b : B \})$.
Indeed, let $v' : F(\{ x : A \vdash b : B \}) \to \square^k$ be defined as follows: $v'(b) = path(x_1.\,\ldots path(x_n.\,b) \ldots)$ and $v'(B)$ equals to
\begin{align*}
Path(x_1.\, \ldots Path(x_{n-2}.\, & Path(x_{n-1}.\,     Path(x_n.\,B, b[x_n \repl left], b[x_n \repl right]), \\
                                   & \qquad \qquad \quad path(x_n.\,b[x_{n-1} \repl left]), \\
                                   & \qquad \qquad \quad path(x_n.\,b[x_{n-1} \repl right])), \\
                                   & path(x_{n-1}.\,     path(x_n.\,b[x_{n-2} \repl left])), \\
                                   & path(x_{n-1}.\,     path(x_n.\,b[x_{n-2} \repl right]))) \ldots )
\end{align*}
Then $v' \circ i_{(tm,1)}$ factors through $i^k$, and the following square is cocartesian:
\[ \xymatrix{ F(\{ x : A \vdash B\ type \}) \ar[r] \ar[d]_{i_{(tm,1)}} & \partial \square^k \ar[d]^{i^k} \\
              F(\{ x : A \vdash b : B \}) \ar[r]_-{v'} & \square^k
            } \]

Now, let us prove that for every $X \in \Mod{T}$, $N(X)$ is fibrant.
Since fibrant objects in $\sSet$ are precisely quasicategories,
it is enough to show that $\mathfrak{C}(\Lambda^n_i) \to \mathfrak{C}(\Delta^n)$ is a trivial cofibration for every inner horn $\Lambda^n_i \to \Delta^n$.
First, for every $1 \leq i \leq k$, let $\sqcap^k_i$ be the object defined by the same generators and relations as $\partial \square^k$ except for $b_{[i=right]}$.
Then we have the following cocartesian square:
\[ \xymatrix{ \sqcap^{n-1}_i \ar[r] \ar[d] & \mathfrak{C}(\Lambda^n_i) \ar[d] \\
              \partial \square^{n-1} \ar[r] & \mathfrak{C}(\partial \Delta^n)
            } \]

Since $\sqcap^k_i \to \square^k$ is a cofibration, we just need to show that it is a weak equivalence.
Note that $\sqcap^k_i \to \square^k$ is isomorphic to $\sqcap^k_k \to \square^k$ for every $1 \leq i \leq k$.
Indeed, we can define isomorphism $g : \square^k \to \square^k$ as $g(b) = b[x_i \repl x_k, x_k \repl x_i]$
and isomorphism $f : \sqcap^k_i \to \sqcap^k_k$ as $f(b_{[i=left]}) = b_{[k=left]}[x_i \repl x_k]$, $f(b_{[k=c]}) = b_{[i=c]}[x_k \repl x_i]$,
and $f(b_{[j=c]}) = b_{[j=c]}[x_i \repl x_k, x_k \repl x_i]$ for every $j \neq i,k$.
Then $f$ and $g$ commute with $\sqcap^k_i \to \square^k$ and $\sqcap^k_k \to \square^k$.
Thus we just need to prove that $\sqcap^k_k \to \square^k$ is a weak equivalence.

Note that $\square^{k+1}$ is a (relative) cylinder object for $F(\{ A : (ty,0), B : (ty,0) \}) \to \square^k$.
Indeed, $\square^k \amalg_{F(\{ A : (ty,0), B : (ty,0) \})} \square^k \to \square^{k+1}$ is a cofibration,
and $\square^k \to \square^{k+1}$ is a weak equivalence since it is a pushout of
a generating trivial cofibration $F(\{ \Gamma \vdash b : B \}) \to F(\{ \Gamma, y : I \vdash h : B \})$.

Every object has RLP with respect to $\sqcap^k_k \to \square^k$ (see \cite[Section~2.4]{alg-models}).
In particular, $\sqcap^k_k \to \square^k$ has a retract $\square^k \to \sqcap^k_k$.
The composite map $\square^k \to \sqcap^k_k \to \square^k$ is homotopic to $id$.
To show this, we just need to construct an appropriate map $\square^{k+1} \to \square^k$,
which is easy to do using filler operations from \cite[Section~2.4]{alg-models}.
Thus $\sqcap^k_k \to \square^k$ is a homotopy equivalence.

Finally, let us prove that if $f : X \to Y$ is a fibration in $\Mod{T}$, then $N(f)$ is a fibration in $\sSet$.
Since $N(Y)$ is fibrant, by \cite[Corollary~2.4.6.5]{lurie-topos}, we just need to prove the following conditions:
\begin{enumerate}
\item $N(f)$ is an inner fibration.
\item For every object $A$ of $N(X)$ and every equivalence $p : N(f)(A) \to B$ in $N(Y)$, there exists an equivalence $p' : A \to B'$ in $N(X)$ such that $N(f)(p') = p$.
\end{enumerate}
The first condition follows from the fact that maps $\mathfrak{C}(\Lambda^n_i) \to \mathfrak{C}(\Delta^n)$ are trivial cofibrations.
The second condition can be reformulated as follows: for every closed type $A$ of $X$ and every equivalence $p : f(A) \to B$ in $Y$,
there exists an equivalence $p' : A \to B'$ in $X$ such that $f(p') = p$.
But this follows from the fact that $f$ has RLP with respect to $\J_{\I_{ty}}$.
\end{proof}

\section{Category of marked objects}

In this section for every combinatorial model category $\C$, we define a new model category $\C^m$ of marked objects of $\C$.
This model category is usually not useful by itself.
The idea is that we should take a left Bousfield localization of $\C^m$ to obtain an interesting model category.
We will show examples of this construction in the next section.

\begin{defn}
Let $\C$ be a category and let $\mathcal{K}$ be a multiset of objects of $\C$ (that is, a set $\mathcal{K}$ together with a function $\mathcal{K} \to \mathrm{Ob}(\C)$).
A \emph{\K-marked object} (or just marked object) of $\C$ is a pair $(X,\mathcal{E})$
where $X$ is an object of $\C$ and $\mathcal{E}$ is a subset of $\coprod_{K \in \mathcal{K}} \Hom(K,X)$.
Morphisms that belong to $\mathcal{E}$ will be caled \emph{marked}.
A morphism of marked objects is a morphism of the underlying objects that preserves marked morphisms.
The category of marked objects will be denoted by $\C^m$.
\end{defn}

Forgetful functor $U : \C^m \to \C$ has a left adjoint $(-)^\flat : \C \to \C^m$ and a right adjoint $(-)^\sharp : \C \to \C^m$.
For every $X \in \C$, $X^\flat$ is the marked object in which no morphisms are marked (that is, $X^\flat = (X,\varnothing)$),
and $X^\sharp$ is the marked object in which all morphisms are marked (that is, $X^\sharp = (X,\coprod_{K \in \mathcal{K}} \Hom(K,X))$).
Objects of the form $X^\flat$ and of the form $X^\sharp$ will be called \emph{flat} and \emph{sharp} respectively.

Category $\C^m$ has the same limits and colimits as $\C$.
Let $D : J \to \C^m$ be a diagram.
Then underlying objects of $\lim(D)$ and $\colim(D)$ are a limit and a colimit of underlying objects in $\C$ respectively.
Morphism $K \to \lim(D)$ is marked if and only if morphism $K \to \lim(D) \to D_j$ is marked for every $j \in J$.
Morphism $K \to \colim(D)$ is marked if and only if it factors through some marked morphism $K \to D_j$.

\begin{prop}[mark-comb]
If $\C$ is locally presentable, then so is $\C^m$.
\end{prop}
\begin{proof}
First, let us prove that there exists a set of objects $S^m$ of $\C^m$ which generates the whole category under colimits.
Let $\lambda$ be a regular cardinal such that $\C$ is locally $\lambda$-presentable and every $K \in \mathcal{K}$ is $\lambda$-presentable.
Let $S$ be a set of objects of $\C$ such that every object of $X$ is a $\lambda$-filtered colimit of objects from $S$.
Note that for every object $X$ of $\C$, there is only a set of marked objects $Y$ such that $U(Y) = X$.
Let $S^m$ be the set of objects $Y$ such that $U(Y) \in S$.
Let $X$ be a marked object, and let $D : J \to \C$ be a $\lambda$-filtered diagram such that $\colim(D) = U(X)$.
Then define diagram $D' : J \to \C^m$ so that $U(D'_j) = D_j$ and $f : K \to D_j$ is marked if and only if $K \xrightarrow{f} D_j \to \colim(D) = U(X)$ is marked.
To prove that $\colim(D') = X$, we need to show that $f : K \to U(X)$ is marked in $X$ only if it factors through some $D_j \to U(X)$.
But this follows from the fact that $D$ is $\lambda$-filtered and $K$ is $\lambda$-presentable.

Now, let us prove that every object of $\C^m$ is small.
Let $(X,\mathcal{E})$ be a marked object, and let $\lambda$ be a regular cardinal such that
every $K \in \mathcal{K}$ is $\lambda$-presentable, $X$ is $\lambda$-presentable, and $|\mathcal{E}| < \lambda$.
Let $D : J \to \C^m$ be a $\lambda$-filtered diagram.
It is easy to see that $\colim_{j \in J} \Hom((X,\mathcal{E}), D_j) \to \Hom((X,\mathcal{E}), \colim_{j \in J} D_j)$ is injective.
Let us show that it is surjective.
Let $f : (X,\mathcal{E}) \to \colim_{j \in J} D_j$ be a map of marked objects.
Then $U(f)$ factors as $X \xrightarrow{g} U(D_j) \to \colim_{j \in J} U(D_j)$ for some $j$.
By the description of colimts that we gave above, for every marked $k : K \to X$, map $U(f) \circ k$ factors through some marked $h_k : K \to U(D_k)$.
Since $K$ is $\lambda$-presentable and maps $K \xrightarrow{h_k} U(D_k) \to \colim_{j \in J} U(D_j)$
and $K \xrightarrow{k} X \xrightarrow{g} U(D_j) \to \colim_{j \in J} U(D_j)$ are equal,
there exists an object $D'_k$ and maps $D_j \to D'_k$ and $D_k \to D'_k$ in the diagram such that
$K \xrightarrow{h_k} U(D_k) \to U(D'_k)$ and $K \xrightarrow{k} X \xrightarrow{g} U(D_j) \to U(D'_k)$ are also equal.
In particular, $K \xrightarrow{k} X \xrightarrow{g} U(D_j) \to U(D'_k)$ is marked.
Finally, since $D$ is $\lambda$-filtered and $|\mathcal{E}| < \lambda$, there exists an object $D_i$ together with maps $D'_k \to D_i$ for every $k$.
For every $k : K \to X$, map $K \xrightarrow{k} X \xrightarrow{g} U(D_j) \to U(D_i)$ is marked.
Hence $X \xrightarrow{g} U(D_j) \to U(D_i)$ is a morphism of marked objects.
Thus $f : (X,\mathcal{E}) \to \colim_{j \in J} D_j$ factors through $D_i \to \colim_{j \in J} D_j$.
\end{proof}

Now, we assume that there is a structure of a model category on $\C$ such that every object in $\mathcal{K}$ is cofibrant.
We will say that a map $f : X \to Y$ of marked objects is a \emph{cofibration} if and only if $U(f)$ is a cofibration in $\C$. 
\begin{prop}
If $\I$ is a set of generating cofibrations of $\C$, then cofibrations of $\C^m$ are generated by the set $\I^m$ which consists of the following maps:
\begin{enumerate}
\item Map $i^\flat$ for every $i \in \I$.
\item Map $K^\flat \to (K,\{ id : K \to K \})$ for every $K \in \mathcal{K}$.
\end{enumerate}
\end{prop}
\begin{proof}
Since every map in $\I^m$ is a cofibration and $U$ preserves colimits, $\Icof[\I^m]$ consists of cofibrations.
Let us show that every cofibration $f : X \to Y$ belongs to $\Icof[\I^m]$.
First, assume that $U(f)$ is an isomorphism.
Then $f$ is the following pushout:
\[ \xymatrix{ \coprod\limits_\mathcal{E} K^\flat \ar[r] \ar[d] & X \ar[d] \\
              \coprod\limits_\mathcal{E} (K,\{id\}) \ar[r] & \po Y,
            } \]
where $\mathcal{E}$ is the set of marked maps of $Y$.

Now, assume that $U(f)$ is a relative $\Icell$ complex.
Then it is a transfinite composition $X_0 \to X_\lambda$, where for each $\alpha$, $X_\alpha \to X_{\alpha+1}$ is a pushout of a map $U_\alpha \to V_\alpha$ from $\I$.
We define a transfinite sequence $X = X'_0 \to \ldots \to X'_\lambda$ such that $U(X'_\alpha \to X'_\beta)$ equals to $X_\alpha \to X_\beta$ for every $\alpha$ and $\beta$.
Map $X'_\alpha \to X'_{\alpha+1}$ is defined as a pushout of $U^\flat_\alpha \to V^\flat_\alpha$.
Then $f$ factors as $X \to X'_\lambda \xrightarrow{g} Y$ so that $U(g)$ is an isomorphism.
Hence $f$ is a relative $\Icell[\I^m]$ complex.

Finally, in the general case, $U(f)$ is a retract of a relative $\Icell$ complex $U(X) \to Z$.
Let $Z'$ be the marked object such that $U(Z') = Z$ and $K \to Z$ is marked if and only if it factors through $Y \to Z$.
Then $f$ is a retract of $X \to Z'$.
Hence $f$ belongs to $\Icof[\I^m]$.
\end{proof}

Let us define fibrant replacement functor $R^m$ for $\C^m$.
Let $R : \C \to \C$, $t_X : X \to R(X)$ be a fibrant replacement functor for $\C$.
For every marked $X$, underlying object of $R^m(X)$ is $R(U(X))$, and a map $K \to R(U(X))$ is marked if and only if
it is homotopic to a map that factors as $K \to U(X) \xrightarrow{t_{U(X)}} R(U(X))$, where the first map is marked.

We will say that a map $f$ of marked objects is a \emph{weak equivalence}
if and only if the underlying map of $f$ is a weak equivalence and $R^m(f)$ reflects marked maps.
Unfolding the definition of $R^m$, we obtain the following characterization of weak equivalences.
A map $f : (X,\mathcal{E}_X) \to (Y,\mathcal{E}_Y)$ of marked objects is a weak equivalence if and only if $U(f)$ is a weak equivalence,
and for every $h : K \to R(X)$ and every marked $k : K \to Y$ such that $R(U(f)) \circ h$ and $t_{Y} \circ k$ are homotopic,
there exists a marked map $k' : K \to X$ such that $t_X \circ k'$ and $h$ are homotopic:
\[ \xymatrix{                                          & X \ar[r]^{t_X} \ar@{}[d]|(.35){\sim} \ar@{}[dr]_(.6){\sim} & R(X) \ar[d]^{R(U(f))} \\
              K \ar[r]_k \ar[urr]_h \ar@{-->}[ur]^{k'} & Y \ar[r]_{t_Y}                                             & R(Y)
            } \]

Since $R(U(f))$ is a weak equivalence between fibrant objects, to prove that $t_X \circ k'$ and $h$ are homotopic,
it is enough to show that $R(U(f)) \circ t_X \circ k'$ and $t_Y \circ k$ are homotopic.
This implies that every map $f \in \Iinj[\I^m]$ is a weak equivalence since we have a lift in the following diagram:
\[ \xymatrix{                                         & (X,\mathcal{E}_X) \ar[d]^f \\
              (K,\{id\}) \ar[r]_-k \ar@{-->}[ur]^{k'} & (Y,\mathcal{E}_Y)
            } \]

Let $f : (X,\mathcal{E}_X) \to (Y,\mathcal{E}_Y)$ be a cofibration of marked objects such that $U(f)$ is a weak equivalence.
Then $t_X : X \to R(X)$ factors as $X \xrightarrow{U(f)} Y \xrightarrow{g} R(X)$ for some map $g$.
We prove that $f$ is a weak equivalence if and only if for every marked $k : K \to Y$, there exists a marked $k' : K \to X$ such that $g \circ k$ and $t_X \circ k'$ are homotopic:
\[ \xymatrix{                                                  & X \ar[r]^-{t_X} & R(X) \\
              K \ar[r]_k \ar@{-->}[ur]^{k'} \ar@{}[urr]|{\sim} & Y \ar[ur]_g
            } \]

First, assume that $f$ satisfies this condition.
Let $k : K \to Y$ be a marked map.
Then there exists a marked map $k' : K \to X$ such that $t_X \circ k'$ is homotopic to $g \circ k$.
Since $U(f)$ is a trivial cofibration, $R(U(f)) \circ g$ is homotopic to $t_Y$.
Hence $R(U(f)) \circ t_X \circ k'$ is homotopic to $t_Y \circ k$.
Conversely, suppose that $f$ is a weak equivalence.
Let $k : K \to Y$ be a marked map.
Since $R(U(f)) \circ g \circ k$ is homotopic to $t_Y \circ k$, there exists a marked map $k' : K \to X$ such that $t_X \circ k'$ is homotopic to $g \circ k$.

Using this characterization of trivial cofibrations, we can prove that they are closed under pushout and transfinite compositions.
First, let us prove the latter.
Let $X_0 \to X_\lambda$ be a transfinite composition of a sequence $X : \lambda \to \C^m$.
Let $k : K \to U(X_\lambda)$ be a marked map.
Then it factors through some marked map $k' : K \to U(X_\alpha)$.
Since $X_0 \to X_\alpha$ is a trivial cofibration, there exists a marked map $k'' : K \to U(X_0)$
such that $t_{U(X_0)} \circ k''$ is homotopic to $U(X_\alpha) \to U(X_\lambda) \to R(U(X_0))$.

Now, let us prove that trivial cofibrations are closed under pushouts.
Let $f : (X,\mathcal{E}_X) \to (Y,\mathcal{E}_Y)$ be a trivial cofibration,
and let $(Z,\mathcal{E}_Z) \to (T,\mathcal{E}_T)$ be a pushout of $f$.
Let $k : K \to T$ be a marked map.
Then $k$ factors through either $Z$ or $Y$.
If $k$ factors through $Z$, then this gives us the required lifting immediately.
If $k$ factors through a marked map $K \xrightarrow{k'} Y$, then there exists a marked map $k'' : K \to X$
such that $t_X \circ k''$ is homotopic to $g \circ k'$, where $g : Y \to R(X)$ is such that $t_X = g \circ U(f)$:
\[ \xymatrix{ \ar@{}[rdd]_(0.6){\sim}           & X \ar[r] \ar[d]^{U(f)} & Z \ar[d] \\
              K \ar[d]_{k'} \ar@{-->}[ur]^{k''} & Y \ar[r] \ar[d]^g      & \po T \ar[d]^{g'} \\
              Y \ar[r]_-g                       & R(X) \ar[r]            & R(Z)
            } \]
Since $t_X$ is a trivial cofibration and $R(Z)$ is fibrant, there exists a map $R(X) \to R(Z)$.
Then there exists a (unique) map $g' : T \to R(Z)$ such that the diagram above commutes and $Z \to T \xrightarrow{g'} R(Z)$ equals to $t_Z$.
We can define the required map as $K \xrightarrow{k''} X \to Z$.
Then $K \xrightarrow{k''} X \to Z \xrightarrow{t_Z} R(Z)$ is homotopic to $K \xrightarrow{k} T \xrightarrow{g'} R(Z)$.

To construct a model structure on $\C^m$, we will need the following theorem by Jeff Smith (see, for example, \cite[Proposition~A.2.6.8]{lurie-topos}):
\begin{thm}[mod-comb]
Let $\C$ be a locally presentable category, let $\I$ be a set of maps of $\C$, and let $\we$ be a class of maps of $\C$.
Suppose that the following conditions hold:
\begin{enumerate}
\item The intersection $\Icof \cap \we$ is closed under pushouts and transfinite compositions.
\item The full subcategory $\we$ of the category of arrows of $\C$ is accessible subcategory.
\item The class $\we$ has the 2-out-of-3 property.
\item $\Iinj \subseteq \we$.
\end{enumerate}
Then there exists a cofibrantly generated model structure on $\C$ with $\Icof$ as the class of cofibrations and $\we$ as the class of weak equivalences.
\end{thm}

We will also need the following theorem (see, for example, \cite{hovey}):
\begin{thm}[mod-cof]
Suppose that $\C$ is a complete and cocomplete category, $\we$ is a class of morphisms of $\C$, and $\I$, $\J$ are sets of morphisms of $\C$.
Then $\C$ is a cofibrantly generated model category with $\I$ as the set of generating cofibrations,
$\J$ as the set of generating trivial cofibrations, and $\we$ as the class of weak equivalences if and only if the following conditions are satisfied:
\begin{enumerate}
\item The domains of $\I$ and $\J$ are small relative to $\Icell$.
\item $\we$ has 2-out-of-3 property and is closed under retracts.
\item $\Iinj \subseteq \we$.
\item $\Jcell \subseteq \we \cap \Icof$.
\item Either $\Jinj \cap \we \subseteq \Iinj$ or $\Icof \cap \we \subseteq \Jcof$.
\end{enumerate}
\end{thm}

Now, we can prove the main theorem of this section:

\begin{thm}[mark-main]
Let $\C$ be a model category, and let $\mathcal{K}$ be a multiset of cofibrant objects of $\C$.
Suppose that one of the following conditions hold:
\begin{enumerate}
\item \label{it:comb} $\C$ is a combinatorial model category.
\item \label{it:fib} Every object of $\C$ is fibrant and there exists a set $\I$ of generating cofibrations such that
the domains and the codomains of maps in $\I$ are small relative to $\Icell$.
\end{enumerate}
Then there exists a cofibrantly generated model structure on $\C^m$.
A marked object $X$ is fibrant in $\C^m$ if and only if the underlying object $U(X)$ is fibrant in $\C$ and marked maps in $X$ are stable under homotopy equivalence
(that is, if two maps $K \to U(X)$ are homotopic and one of them is marked, then so is the other).
Both adjoint pairs $(-)^\flat \dashv U$ and $U \dashv (-)^\sharp$ are Quillen pairs.
If $\C$ is left proper, then so is $\C^m$.
\end{thm}
\begin{proof}
We already proved that every map in $\Iinj[\I^m]$ is a weak equivalence and that trivial cofibrations are stable under pushouts and transfinite compositions.
It is easy to see that weak equivalences are closed under retracts.
Let us prove that the class of weak equivalences has 2-out-of-3 property.
Let $f : X \to Y$ and $g : Y \to Z$ be maps of marked objects such that $U(f)$ and $U(g)$ are equivalences.
If $R^m(f)$ and $R^m(g)$ reflect marked maps, then so is $R^m(g \circ f)$.
If $R^m(g \circ f)$ reflects marked maps, then so is $R^m(f)$.
Let us prove that if $R^m(g \circ f)$ reflects marked maps, then so is $R^m(g)$.
Let $k : K \to R(U(Y))$ be a map such that $R(U(g)) \circ k$ is marked.
Since $K$ is cofibrant and $R(U(f))$ is a weak equivalence between fibrant objects,
there exists a map $k' : K \to R(U(X))$ such that $R(U(f)) \circ k'$ is homotopic to $k$.
Since $R(U(g)) \circ k$ and $R(U(g \circ f)) \circ k'$ are homotopicc and $R(U(g)) \circ k$ is marked, $R(U(g \circ f)) \circ k'$ is also marked.
Since $g \circ f$ reflects marked maps, $k'$ is marked.
Since $R(U(f)) \circ k'$ and $k$ are homotopic and $R(U(f)) \circ k'$ is marked, $k$ is also marked.

Assume that \eqref{it:comb} holds.
By \rprop{mark-comb}, $\C^m$ is locally presentable.
By \rthm{mod-comb}, we just need to prove that the class of weak equivalences is an accessible subcategory of $\C^m$.
Let $\J$ be a set of generating trivial cofibrations in $\C$.
Then we can take $R$ to be the functor obtained form the small object argument for $\J$.
Let $\J_\mathcal{K}$ be the set of maps $(C(K),\{i_0\}) \to (C(K),\{i_0,i_1\})$ for every $K \in \mathcal{K}$, where $[i_0,i_1] : K \amalg K \to C(K)$ is a cylinder object for $K$.
Then $R^m$ can be described as the composition of two functors $R_1$ and $R_2$.
The former is obtained from the small object argument for $\J^\flat$ and the latter from the small object argument for $\J_\mathcal{K}$.
Thus $R^m$ preserves $\kappa$-filtered colimits for some regular cardinal $\kappa$.

Let $\C^m_0$ be the full subcategory of the arrow category of $\C^m$ on maps $f$ such that $U(f)$ is a weak equivalence and $f$ reflects marked maps.
Since $R^m$ preserves $\kappa$-filtered colimits, by \cite[Corollary~A.2.6.5]{lurie-topos},
to prove that the class of weak equivalences is an accessible subcategory of $\C^m$,
we just need to show that $\C^m_0$ is closed under $\kappa$-filtered colimits.
But this is obvious if we take $\kappa$ such that the class of weak equivalences in $\C$
is closed under $\kappa$-filtered colimits and every object in $\mathcal{K}$ is $\kappa$-presentable.

Now, assume that \eqref{it:fib} holds.
By \cite[Corollary~3.2]{f-model-structures}, there exists a set $\J_\I$ of generating trivial cofibrations for $\C$.
Then $\J^m = \J_\I^\flat \cup \J_\mathcal{K}$ is a set of generating trivial cofibrations for $\C^m$.
Indeed, every map in $\J^m$ is cofibration and a weak equivalence.
Every map in $\J_\I^\flat$ is a weak equivalence since its underlying map is a weak equivalence and its codomain is flat, so $R^m(f) = R(f)^\flat$.
Every map $f$ in $\J_\mathcal{K}$ is a weak equivalence since $R^m(f)$ is an isomorphism.

By \rthm{mod-cof}, we just need to prove that every weak equivalence that has RLP with respect to $\J^m$ also has RLP with respect to $\I^m$.
Let $f$ be such a map.
Since $U(f)$ is a weak equivalence and a fibration, it has RLP with respect to $\I$.
Hence $f$ has RLP with respect to $\I^\flat$.
Since every object of $\C$ is fibrant, we can take $R$ to be the identity functor.
Let $k : K \to U(X)$ be a map such that $U(f) \circ k$ is marked.
Since $f$ is a weak equivalence, there exists a marked map $k' : K \to U(X)$ such that $U(f) \circ k'$ is homotopic to $U(f) \circ k$.
Since $U(f)$ is a weak equivalence between fibrant objects, this implies that $k'$ is homotopic to $k$.
Since $f$ has RLP with respect to $\J_\mathcal{K}$, $k'$ and $U(f) \circ k$ are marked, $k$ is also marked.
Thus $f$ has RLP with respect to $K^\flat \to (K,\{id\})$ for every $K \in \mathcal{K}$.

Since $\J_\mathcal{K}$ are trivial cofibrations, for every fibrant marked object $X$, marked maps in $X$ are stable under homotopy equivalence.
Conversely, let $Z$ be a marked object such that $U(Z)$ is fibrant and maps in $Z$ are stable under homotopy equivalence.
Let $f : X \to Y$ be a trivial cofibration, and let $g : X \to Z$ be a map.
Since $U(Z)$ is fibrant, $U(g)$ factors through $t_{U(X)}$:
\[ \xymatrix{ U(X) \ar[r]^-{t_{U(X)}} \ar[d]_{U(f)} & R(U(X)) \ar[r] & U(Z) \\
              U(Y) \ar@{-->}[ur]_h
            } \]

Since $U(f)$ is a trivial cofibration, there exists a lift $h : U(Y) \to R(U(X))$ in the diagram above.
We just need to prove that $U(Y) \xrightarrow{h} R(U(X)) \to U(Z)$ preserves marked maps.
Since $U(f)$ is a trivial cofibration, for every marked $k : K \to U(Y)$, there exists a marked $k' : K \to U(X)$
such that $t_{U(X)} \circ k'$ and $h \circ k$ are homotopic.
Since marked maps in $Z$ are stable under homotopy equivalence and the composite $K \xrightarrow{k'} U(X) \xrightarrow{t_{U(X)}} R(U(X)) \to U(Z)$ is marked,
so is the composite $K \xrightarrow{k} U(Y) \xrightarrow{h} R(U(X)) \to U(Z)$.
So $U(Y) \xrightarrow{h} R(U(X)) \to U(Z)$ preserves marked maps.

Functor $U$ preserve cofibrations and weak equivalences by definition.
Functor $(-)^\flat$ also preserves cofibrations and weak equivalences since it sends objects to flat marked objects.
Thus both adjoint pairs of functors $(-)^\flat \dashv U$ and $U \dashv (-)^\sharp$ are Quillen adjunctions.

Finally, let us prove that if $\C$ is left proper, then so is $\C^m$.
Let $Z \to T$ be a pushout of a weak equivalence $f : X \to Y$ along a cofibration.
We may assume that $f$ is a trivial fibration.
Let $k : K \to U(T)$ be a marked map.
Then it factors through either $U(Z)$ or $U(Y)$.
In the first case, we obtained the required lift immediately.
In the second case, we have a marked map $k' : K \to U(Y)$.
Since $f : X \to Y$ is a trivial fibration, $k'$ lifts to a marked map $K \to U(X)$.
\end{proof}

Since we often want to localize the model category of marked object, it is useful to have a simple description of homotopy function complexes.
Let $X$ and $Y$ be a pair of marked objects such that $X$ is cofibrant and $Y$ is fibrant.
Let $QU(X)^\bullet$ be a cosimplicial frame on $U(X)$.
Then vertices of the Kan complex $\Map(U(X),U(Y)) = \Hom(QU(X)^\bullet,U(Y))$ can be identified with maps $U(X) \to U(Y)$.
We will denote this bijection by $e : \Hom(\Delta^0,\Map(U(X),U(Y))) \simeq \Hom(U(X),U(Y))$.

Let $x$ and $y$ be a pair of vertices of $\Map(U(X),U(Y))$ that belongs to the same component.
If $e(x) : U(X) \to U(Y)$ lifts to a map of marked objects, then so does the map $e(y)$.
Indeed, there exists an edge $\Delta^1 \to \Map(U(X),U(Y))$ between $x$ and $y$.
But such an edge corresponds to a homotopy between $e(x)$ and $e(y)$.
Since $Y$ is fibrant and $e(x)$ preserves marked maps, so does every map homotopic to $e(x)$.

Let $\Map(X,Y)$ be the Kan subcomplex of $\Map(U(X),U(Y))$ which consists of those components of
$\Map(U(X),U(Y))$ in which some (and hence every) vertex corresponds to a map $U(X) \to U(Y)$ that lifts to a map of marked objects.

\begin{lem}
Kan complex $\Map(X,Y)$ is equivalent to the homotopy function complex from $X$ to $Y$.
\end{lem}
\begin{proof}
We may assume that $QU(X)^\bullet$ is a fibrant cosimplicial frame on $U(X)$.
Then we can define a fibrant cosimplicial frame $QX^\bullet$ on $X$ as $(QU(X)^\bullet,\mathcal{E})$,
where $\mathcal{E}$ consists of those maps $K \to QU(X)^\bullet$ such that $K \to QU(X)^\bullet \to U(X)$ is marked.
Obviously, $L_n QX^\bullet \to QX^n$ is a cofibration since its underlying map is $L_n QU(X)^\bullet \to QU(X)^n$.
Map $QX^n \to X$ has RLP with respect to $\I^\flat$ since $QU(X)^\bullet$ is fibrant.
It also has RLP with respect to $K^\flat \to (K,\{id\})$ by definition of $QX^n$.
Thus it is a trivial fibration.

Kan complex $\Hom(QX^\bullet,Y)$ is a subcomplex of $\Map(X,Y)$.
Let us prove that they are actually equal.
Consider a simplex $\Delta^n \to \Map(X,Y)$.
Such simplex corresponds to a map $QU(X)^n \to U(Y)$.
We need to show that this maps lifts to a map $QX^n \to Y$.
Let $k : K \to QU(X)^n$ be a marked map.
But every such map is homotopic to the map $K \to QU(X)^n \to U(X) \simeq QU(X)^0 \to QU(X)^n$,
where the last map is given by any map $\Delta^0 \to \Delta^n$.
By definition of $\Map(X,Y)$ every such map gives a marked map in $Y$.
Since $Y$ is fibrant, $K \xrightarrow{k} QU(X)^n \to U(Y)$ is also marked in $Y$.
\end{proof}

\section{Marked simplicial sets}

In this section for every set $\mathcal{L}$ of simplicial sets, we define a model category $\csSet$
which represents the $(\infty,1)$-category of $(\infty,1)$-categories in which for every $L \in \mathcal{L}$ limits of shape $L$ exist.
For example, if $\mathcal{L} = \{ \varnothing, \Lambda^2_2 \}$, then $\csSet$ represents $(\infty,1)$-category of finitely complete categories and exact functors.
We also define a model category which represents the $(\infty,1)$-category of locally cartesian closed $(\infty,1)$-categories.
These model categories are left Bousfield localizations of certain categories of marked simplicial sets.

For every set $\mathcal{L}$ of simplicial sets, we define set $\Delta^0 \join \mathcal{L}$ as $\{ \Delta^0 \join L\ |\ L \in \mathcal{L} \}$.
Then let $\csSet$ be the category of $(\Delta^0 \join \mathcal{L})$-marked simplicial sets.

We will say that a quasicategory $X$ is \K-complete if for every $K \in \mathcal{K}$, limits of shape $K$ exist in $X$.
Let $\cqCat$ be the full subcategory of $\sSet$ on \K-complete quasicategories.
For every $X \in \cqCat$, we define a \K-marked simplicial set $X^\natural$ as simplicial set $X$ in which a cone is marked if and only if it is a limit cone.
We will later see that fibrant objects of $\csSet$ are precisely objects of the form $X^\natural$.

Let $S : \Delta \to \sSet$ be a cosimplicial frame on $\Delta^0$ (in the Quillen model structure) such that $S(\Delta^n)$ is a Kan complex for every $n$.
First, extend $S$ to a colimit-preserving functor $S : \sSet \to \sSet$.
For every \K-marked simplicial sets $X$ and $Y$, we define a simplicial set $\Map(X,Y)$ as follows:
\[ \Map(X,Y) = \Hom(S(-)^\sharp \times X, Y). \]
Note that cartesian product in $\csSet$ preserves colimits.
It follows that $\Map(-,Y)$ sends colimits to limits.

We will say that a map $f : X \to Y$ of \K-marked simplicial sets is a \emph{weak equivalence} if for every $Z \in \cqCat$,
induced map $\Map(Y,Z^\natural) \to \Map(X,Z^\natural)$ is a weak equivalence of simplicial sets in the Quillen model structure.

\begin{prop}[map-fib]
For every cofibration $f : X \to Y$, induced map $\Map(Y,Z^\natural) \to \Map(X,Z^\natural)$ is a fibration in the Quillen model structure.
\end{prop}
\begin{proof}
Map $\Map(Y,Z^\natural) \to \Map(X,Z^\natural)$ has RLP with respect to a horn inclusion
$j : \Lambda^n_i \to \Delta^n$ if and only if $Z^\natural$ has RLP with respect to the following map:
\[ j \wedge f : S(\Delta^n)^\sharp \times X \amalg_{(S(\Lambda^n_i),\mathcal{E}) \times X} (S(\Lambda^n_i),\mathcal{E}) \times Y \to S(\Delta^n)^\sharp \times Y \]
A cone $\Delta^0 \join K \to S(\Lambda^n_i)$ belongs to $\mathcal{E}$ if and only if it factors through some face $S(\Delta^{n-1}) \to S(\Lambda^n_i)$.

Since cartesian product of \K-marked simplicial sets preserve colimits, $X \times -$ has a right adjoint.
Hence we may assume that $f : X \to Y$ belongs to $\I$.
First, let us consider the case when $f$ is a map $(\partial \Delta^k)^\flat \to (\Delta^k)^\flat$.
Then both the domain and the codomain of $j \wedge f$ are flat.
Hence $Z^\natural$ has RLP with respect to $j \wedge f$ if and only if $Z$ has RLP with respect to $U(j) \wedge U(f)$.
Since $Z$ is fibrant in the Joyal model structure and $U(j) \wedge U(f)$ is a cofibration,
we just need to show that $U(j) \wedge U(f)$ is a weak equivalence in the Joyal model structure.
Since $S$ is a cosimplicial frame on $\Delta^0$, map $U(j)$ is a weak equivalence.
By \cite[Corollary~2.2.5.4]{lurie-topos}, for every simplicial set $X$, $U(j) \times X$ is also a weak equivalence.
Since $U(j)$ is a trivial cofibration, $S(\Lambda^n_i) \times U(Y) \to S(\Delta^n) \times U(X) \amalg_{S(\Lambda^n_i) \times U(X)} S(\Lambda^n_i) \times U(Y)$ is also a trivial cofibration.
Hence by 2-out-of-3 property, $U(j) \wedge U(f)$ is a weak equivalence.

Now, assume that $f$ is a map $(\Delta^0 \join K)^\flat \to (\Delta^0 \join K, \{ id \})$.
Then $j \wedge f$ is the following map: $(S(\Delta^n),\mathcal{E}') \times (\Delta^0 \join K, \{ id \}) \to S(\Delta^n)^\sharp \times (\Delta^0 \join K, \{ id \})$.
A cone $\Delta^0 \join K' \to S(\Delta^n)$ belongs to $\mathcal{E}'$ if and only if
it factors through $S(\Lambda^n_i)$ and $\Delta^0 \join K' \to S(\Lambda^n_i)$ belongs to $\mathcal{E}$.
Consider a map $g : (S(\Delta^n),\mathcal{E}') \times (\Delta^0 \join K, \{ id \}) \to Z^\natural$.
Since $U(j \wedge f)$ is an isomorphism, we just need to show that for every cone $k' : \Delta^0 \join K' \to S(\Delta^n) \times (\Delta^0 \join K)$,
if $k'$ is marked in $S(\Delta^n)^\sharp \times (\Delta^0 \join K, \{ id \})$, then $U(g) \circ k'$ is marked in $Z^\natural$.
Cone $k'$ is marked in $S(\Delta^n)^\sharp \times (\Delta^0 \join K, \{ id \})$ only if it is of the form $\langle k, id \rangle$ for some cone $k : \Delta^0 \join K \to S(\Delta^n)$.
Since $S(\Delta^n)$ is a contractible Kan complex, every two cones $k_1,k_2 : \Delta^0 \join K \to S(\Delta^n)$ are homotopic.

Since there exists at least one marked cone in $(S(\Delta^n),\mathcal{E}') \times (\Delta^0 \join K, \{ id \})$,
we just need to prove that if a cone $k_1 : \Delta^0 \join K \to Z$ is marked in $Z^\natural$ and $k_2$ is homotopic to $k_1$, then $k_2$ is also marked in $Z^\natural$.
But a cone is marked in $Z^\natural$ if and only if it is a limit cone.
It is easy to see that a cone homotopic to a limit cone is also a limit cone.
\end{proof}

\begin{cor}[obj-fib]
For every $X \in \csSet$ and $Z \in \cqCat$, $\Map(X,Z^\natural)$ is a Kan complex.
\end{cor}

\begin{cor}
Trivial cofibrations in $\csSet$ are closed under pushouts.
\end{cor}
\begin{proof}
Consider the following pushout where $A \to B$ is a trivial cofibration:
\[ \xymatrix{ A \ar[r] \ar[d] & C \ar[d] \\
              B \ar[r]        & \po D
            } \]
By \rprop{map-fib}, $\Map(B,Z^\natural) \to \Map(A,Z^\natural)$ is a trivial fibration in the Quillen model structure.
Since $\Map(-,Z^\natural)$ sends colimits to limits, we have the following cartesian square:
\[ \xymatrix{ \Map(D,Z^\natural) \ar[r] \ar[d] \pb & \Map(B,Z^\natural) \ar[d] \\
              \Map(C,Z^\natural) \ar[r]            & \Map(A,Z^\natural)
            } \]
Thus $\Map(D,Z^\natural) \to \Map(C,Z^\natural)$ is also a trivial fibration.
Hence $C \to D$ is a weak equivalence.
\end{proof}

\begin{prop}[hom-we]
Let $f : X \to Y$ and $g : Y \to X$ be maps of \K-marked simplicial sets such that $U(g \circ f)$ and $U(f \circ g)$ are left homotopic to identity morphisms.
Then $f$ and $g$ are weak equivalences.
\end{prop}
\begin{proof}
To prove this, it is enough to show that if $f,g : X \to Y$ are maps of \K-marked simplicial sets such that $U(f)$ and $U(g)$ are left homotopic,
then corresponding maps $\Map(Y,Z^\natural) \to \Map(X,Z^\natural)$ are also homotopic.
Let $S(\Delta^1) \times U(X) \to U(Y)$ be a homotopy between $U(f)$ and $U(g)$.
Then we can lift it to a map $h : C(X) \to Y$, where $C(X) = (S(\Delta^1),\mathcal{E}) \times X$,
a cone belongs to $\mathcal{E}$ if and only if it factors through one of the two faces $S(\Delta^0) \to S(\Delta^1)$.

Homotopy $h$ determines a map $\Map(Y,Z^\natural) \to \Map(C(X),Z^\natural)$.
Thus we just need to prove that $\Map(C(X),Z^\natural)$ is a path object for $\Map(X,Z^\natural)$.
First, note that $\Map(C(X),Z^\natural) \to \Map(X,Z^\natural) \times \Map(X,Z^\natural)$
is a fibration by \rprop{map-fib} and $\Map(X,Z^\natural) \to \Map(C(X),Z^\natural)$ is a cofibration.
Thus it is enough to show that $\Map(C(X),Z^\natural) \to \Map(X,Z^\natural)$ is a trivial fibration.
This map has RLP with respect to $i : \partial \Delta^n \to \Delta^n$ if and only if $Z^\natural$ has RLP with respect to the following map:
\[ t : S(\Delta^n)^\sharp \times X \amalg_{(S(\partial \Delta^n),\mathcal{E'}) \times X} (S(\partial \Delta^n),\mathcal{E'}) \times C(X) \to S(\Delta^n)^\sharp \times C(X) \]

First, note that the underlying map of simplicial sets $U(t)$ is a trivial cofibration in the Joyal model structure.
Indeed, it follows from the fact that $S(\partial \Delta^n) \to S(\Delta^n)$ is a cofibration
and $X \to S(\Delta^1) \times X$ is a trivial cofibration in the same way as in \rprop{map-fib}.
It follows that $Z$ has RLP with respect to $U(t)$.
To prove that this lifting $g : S(\Delta^n) \times U(C(X)) \to Z$ extends to a morphism of \K-marked simplicial sets,
we just need to show that for every cone $k : (\Delta^0 \join K, \{id\}) \to S(\Delta^n)^\sharp \times C(X)$, cone $g \circ U(k)$ is marked in $Z^\natural$.
Note that cone $\Delta^0 \join K \to S(\Delta^n) \times U(C(X)) \to S(\Delta^n) \times U(X) \to S(\Delta^n) \times U(C(X)) \to Z$ is marked in $Z^\natural$.
Since this cone is homotopic to $k$, $k$ is also marked in $Z^\natural$.
\end{proof}

\begin{cor}[iinj]
If a map $f : X \to Y$ of \K-marked simplicial sets has RLP with respect to $\I$, then $f$ is a weak equivalence.
\end{cor}
\begin{proof}
Since $Y$ is cofibrant, $f$ has a section $g : Y \to X$.
Since $U(f)$ is a trivial fibration, $U(g \circ f)$ and $U(f \circ g)$ are homotopic to identities.
\end{proof}

\begin{prop}
A map $f : X^\natural \to Y^\natural$ is a weak equivalence if and only if $U(f)$ is a weak equivalence in the Joyal model structure.
\end{prop}
\begin{proof}
First, suppose that $f$ is a weak equivalence.
Then $\Map(Y^\natural,X^\natural) \to \Map(X^\natural,X^\natural)$ is a weak equivalence.
By \rcor{obj-fib}, simplicial sets $\Map(Y^\natural,X^\natural)$ and $\Map(X^\natural,X^\natural)$ are Kan complexes.
Hence for every vertex $v : \Delta^0 \to \Map(X^\natural,X^\natural)$ there exists a vertex $u : \Delta^0 \to \Map(Y^\natural,X^\natural)$
such that $\Delta^0 \xrightarrow{u} \Map(Y^\natural,X^\natural) \to \Map(X^\natural,X^\natural)$ is homotopic to $v$.
Since vertices of $\Map(A,B)$ classify maps $\Hom(A,B)$, we can take the vertex $\Delta^0 \to \Map(X^\natural,X^\natural)$ that classifies the identity morphism,
to obtain a map $g : Y^\natural \to X^\natural$ and a homotopy $h : S(\Delta^1)^\sharp \times X^\natural \to X^\natural$ between $g \circ f$ and $id$.
Now, consider the following diagram:
\[ \xymatrix{ \partial \Delta^1 \ar[d] \ar[r] & \Map(Y^\natural,Y^\natural) \ar[d] \\
              \Delta^1 \ar[r] & \Map(X^\natural,Y^\natural)
            } \]
where the top map classifies maps $f \circ g$ and $id$, and the bottom map is $f \circ h$.
Since the right map is a weak equivalence between fibrant objects, there exists a homotopy $h' : S(\Delta^1)^\sharp \times Y^\natural \to Y^\natural$ between $f \circ g$ and $id$.
Thus $U(f)$ is a homotopy equivalence.

Now, assume that $U(f)$ is a weak equivalence.
Factor $f$ as a cofibration $g : X^\natural \to Z$ followed by a map $h : Z \to Y^\natural$ that has RLP with respect to $\I$.
By \rcor{iinj}, $h$ is a weak equivalence.
Thus by 2-out-of-3 property, we just need to show that $g$ is a weak equivalence.
Since $U(g)$ is a trivial cofibration and $U(Z)$ is fibrant object, there exists a retraction $g' : U(Z) \to U(X)$ of $U(g) : U(X) \to U(Z)$.
To prove that $g'$ lifts to a morphism of \K-marked simplicial sets, we just need to show that for every limit cone $k : \Delta^0 \join K \to U(Z)$, $g' \circ k'$ is also a limit cone.
But $g'$ is a weak equivalence by 2-out-of-3 property, so it preserves limit cones.
Thus we have maps $g : X^\natural \to Z$ and $g'' : Z \to X^\natural$ such that $U(g'' \circ g)$ and $U(g \circ g'')$ are homotopic to identity morphisms.
By \rprop{hom-we}, $g$ is a weak equivalence.
\end{proof}

Let $\J$ be the set which consists of the following maps:
\begin{enumerate}
\item For every $0 < i < n$, inclusions $(\Lambda^n_i)^\flat \to (\Delta^n)^\flat$.
\item For every $K \in \mathcal{K}$, maps $K^\flat \to (\Delta^0 \join K, \{ id : \Delta^0 \join K \to \Delta^0 \join K \})$.
\item For every $n > 0$ and $K \in \mathcal{K}$, maps $(\partial \Delta^n \join K, \{ \Delta^{\{n\}} \join K : \Delta^0 \join K \to \partial \Delta^n \join K \}) \to (\Delta^n \join K, \{ \Delta^{\{n\}} \join K : \Delta^0 \join K \to \Delta^n \join K \})$.
\item For every $K \in \mathcal{K}$, maps $(N(\{ 0 \cong 1 \}) \join K,\{ f_1 \}) \to (N(\{ 0 \cong 1 \}) \join K,\{ f_0, f_1 \})$, where
$\{ 0 \cong 1 \}$ is the groupoid with two objects and a unique isomorphism between them, and
$f_i$ is the map $\Delta^0 \join K \cong N(\{i\}) \join K \to N(\{ 0 \cong 1 \}) \join K$.
% \item For every $K \in \{ \varnothing, \Lambda^2_2 \}$, maps $(S,\{ f_1 \}) \to (S,\{ f_0, f_1 \})$, where
% \[ S = \Delta^1 \join K \amalg_{\Delta^1} N(\{ 0 \cong 1 \}), \]
% $\{ 0 \cong 1 \}$ is the groupoid with two objects and a unique isomorphism between them, and
% $f_i$ is the composite $\Delta^0 \join K \xrightarrow{\Delta^{\{i\}} \join K} \Delta^1 \join K \to S$.
\end{enumerate}

% A map $f : X \to Y$ of \lc-marked simplicial sets is a \emph{weak equivalence} if for

\begin{comment}
\begin{defn}
An \emph{\lcc-marked simplicial set} is an \lc-marked simplicial set $X$ together with a subset of the set of edges $\Delta^1 \to X$.
Edges that belong to this subset will be caled \emph{marked}.
A morphism of \lcc-marked simplicial sets is a map of the underlying \lc-marked simplicial sets that preserves marked edges.
The category of \lcc-marked simplicial sets will be denoted by $\lccsSet$.
\end{defn}
\end{comment}

\begin{comment}
Let $T^a_\Sigma = coe_1 + \sigma + Path + wUA + \Sigma + sq^a_l$.
Quillen adjunction between $\sSet$ and $\Mod{T^a_\Sigma}$ that we constructed in the previous section is not a Quillen equivalence.
Model category $\Mod{T^a_\Sigma}$ should represent the $(\infty,1)$-category of finitely complete $(\infty,1)$-categories (and exact functor),
but $\sSet$ represent the $(\infty,1)$-category of all $(\infty,1)$-categories.
To fix this problem, we define model category $\lcsSet$ which is closely related to $\sSet$ and which is Quillen equivalent to $\Mod{T^a_\Sigma}$.
We will prove later that the fibration category corresponding to $\lcsSet$ is equivalent to the fibration category of finitely complete quasicategories.

We will consider simplicial sets with marked vertices and squares.
This marking is not related to the marking of simplicial sets as defined in \cite{lurie-topos}.
So we will call such simplicial sets \emph{\lc-marked}.
The intention is that marked vertices should be terminal objects and marked squares should be cartesian.
Of course, in general, this may not be the case, but we will construct a model structure on
the category of \lc-marked simplicial sets in which fibrant objects have this property.

The set of generating cofibrations $\lcI$ consists of the following maps:
\begin{enumerate}
\item Inclusions $(\partial \Delta^n)^\flat \to (\Delta^n)^\flat$.
\item Inclusion $\varnothing \to (\Delta^0)^\sharp$.
\item Inclusion $L^\flat \to S$, where $S$ is simplicial set $\Delta^1 \times \Delta^1$ in which only $id : \Delta^1 \times \Delta^1 \to \Delta^1 \times \Delta^1$ is marked,
and $L$ is simplicial set with three vertexes and two nondegenerate edges which looks like this:
\[ \xymatrix{                & \bullet \ar[d] \\
              \bullet \ar[r] & \bullet
            } \]
The map $L^\flat \to S$ is the obvious inclusion.
\end{enumerate}

\begin{prop}
A map $f : X \to Y$ of \lc-marked simplicial sets is a cofibration if and only if the following conditions hold:
\begin{enumerate}
\item $f$ is a monomorphism of simplicial sets.
\item For every vertex or square $x$ of $X$, if $f(x)$ is marked in $Y$, then $x$ is marked in $X$.
\item For every marked square of $Y$ which does not belong to $X$, every nondegenerate simplex of $\Delta^1 \times \Delta^1$,
which is degenerate in $Y$, belongs to $L^\flat$.
\item For every distinct marked squares $y_1$ and $y_2$ of $Y$ at least one of which does not belong to $X$,
every common simplex of $y_1$ and $y_2$ belongs to $L^\flat$.
\end{enumerate}
\end{prop}

Let $X$ be a model of some theory $T$.
Edges of $N(X)$ are classified by maps $\mathfrak{C}(\Delta^1) \to X$, or equivalently by terms $x : A \vdash b : B$.
Squares $\Delta^1 \times \Delta^1 \to N(X)$ are classified by the following data:
types $A,B,C,D \in X_{(ty,0)}$ and terms $f,g,f',g',r \in X_{(tm,1)}$, $h_1,h_2 \in X_{(tm,2)}$ such that
$y : B \vdash f : D$, $z : C \vdash g : D$, $x : A \vdash f' : C$, $x : A \vdash g' : B$, $x : A \vdash r : D$,
$x : A, i : I \vdash h_1 : D$, $x : A, i : I \vdash h_2 : D$, $h_1[left] = f[y \repl g']$, $h_1[right] = h_2[right] = r$, and $h_2[left] = g[z \repl f']$.
These data can be depicted in the following diagram (where the top and the bottom triangles correspond to $h_1$ and $h_2$ respectively):
\[ \xymatrix{ A \ar[r]^{g'} \ar[d]_{f'} \ar[rd]^r & B \ar[d]^f \\
              C \ar[r]_g & D
            } \]

If $T$ is under $T^a_\Sigma$, then $N : \Mod{T} \to \sSet$ factors through the forgetful functor $U : \lcsSet \to \sSet$.
Let the chosen vertex of $N(X)$ be the interval type.
For every $y : B \vdash f : D$ and $z : C \vdash g : D$, the chosen square in $N(X)$ is defined as follows:
$A = \Sigma(y : B, \Sigma(z : C, f \idtype g))$, $f' = (x : A \vdash \pi_1(\pi_2(x)) : C)$, $g' = (x : A \vdash \pi_1(x) : B)$,
$r = (x : A \vdash g[z \repl f'] : D)$, $h_1 = (x : A, y : I \vdash at(\pi_2(\pi_2(x)),y) : D)$, and $h_2 = (x : A, y : I \vdash r : D)$.
We will denote this functor by $\lcN : \Mod{T} \to \lcsSet$.

Functor $\lcN$ has a left adjoint $\lcC : \lcsSet \to \Mod{T}$.
For every $X \in \lcsSet$, $\lcC(X)$ is defined by the same generators and relations as $\mathfrak{C}(X)$
together relations that make chosen cones in $X$ equal to corresponding data in the theory.
Let us give a more explicit description of models of the form $\mathfrak{C}(X)$.
By \cite[Remark~3.4]{alg-models}, elements of $\mathfrak{C}(X)_{(p,n)}$ are equivalence classes of closed terms constructed from function symbols of $T^a_\Sigma$.
The (partial) equivalence relation on the set of terms is generated by a relation $\red$ such that every term has a unique normal form
(that is, for every term $t$, there exists a unique term $t'$ such that $t \red^* t'$ and there is no term $t''$ such that $t' \red t''$).
This implies that there is a bijection between the set of equivalences classes of terms and the set of terms in a normal form.

Relation $\red$ is defined as the minimal relation that is closed under application of function symbols and that contains all axioms in which direction is chosen in the obvious way.

To construct a model structure on $\lcsSet$, we need to prove a few technical lemmas.

\begin{lem}
\end{lem}
\begin{proof}
\end{proof}

\begin{prop}
There is a combinatorial model structure on $\lcsSet$ such that $\lcI$ is a set of generating cofibrations
and a map $f$ is a weak equivalence if and only if $\lcC(f)$ is a weak equivalence in $\Mod{T^a_\Sigma}$.
Adjunction $\lcC \dashv \lcN$ is a Quillen equivalence.
\end{prop}
\begin{proof}
By a theorem of Jeff Smith (see, for example, \cite[Proposition~A.2.6.8]{lurie-topos}),
to construct such model structure, it is enough to prove that for every map $f$ in $\lcsSet$ which has RLP with respect to $\lcI$, $\lcC(f)$ is a weak equivalence.
Let $f : X \to Y$ be such a map.
\end{proof}
\end{comment}

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
