\documentclass[reqno]{amsart}

\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{turnstile}
\usepackage{verbatim}

\hypersetup{colorlinks=true,linkcolor=blue}

\renewcommand{\turnstile}[6][s]
    {\ifthenelse{\equal{#1}{d}}
        {\sbox{\first}{$\displaystyle{#4}$}
        \sbox{\second}{$\displaystyle{#5}$}}{}
    \ifthenelse{\equal{#1}{t}}
        {\sbox{\first}{$\textstyle{#4}$}
        \sbox{\second}{$\textstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{s}}
        {\sbox{\first}{$\scriptstyle{#4}$}
        \sbox{\second}{$\scriptstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{ss}}
        {\sbox{\first}{$\scriptscriptstyle{#4}$}
        \sbox{\second}{$\scriptscriptstyle{#5}$}}{}
    \setlength{\dashthickness}{0.111ex}
    \setlength{\ddashthickness}{0.35ex}
    \setlength{\leasturnstilewidth}{2em}
    \setlength{\extrawidth}{0.2em}
    \ifthenelse{%
      \equal{#3}{n}}{\setlength{\tinyverdistance}{0ex}}{}
    \ifthenelse{%
      \equal{#3}{s}}{\setlength{\tinyverdistance}{0.5\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{d}}{\setlength{\tinyverdistance}{0.5\ddashthickness}
        \addtolength{\tinyverdistance}{\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{t}}{\setlength{\tinyverdistance}{1.5\dashthickness}
        \addtolength{\tinyverdistance}{\ddashthickness}}{}
        \setlength{\verdistance}{0.4ex}
        \settoheight{\lengthvar}{\usebox{\first}}
        \setlength{\raisedown}{-\lengthvar}
        \addtolength{\raisedown}{-\tinyverdistance}
        \addtolength{\raisedown}{-\verdistance}
        \settodepth{\raiseup}{\usebox{\second}}
        \addtolength{\raiseup}{\tinyverdistance}
        \addtolength{\raiseup}{\verdistance}
        \setlength{\lift}{0.8ex}
        \settowidth{\firstwidth}{\usebox{\first}}
        \settowidth{\secondwidth}{\usebox{\second}}
        \ifthenelse{\lengthtest{\firstwidth = 0ex}
            \and
            \lengthtest{\secondwidth = 0ex}}
                {\setlength{\turnstilewidth}{\leasturnstilewidth}}
                {\setlength{\turnstilewidth}{2\extrawidth}
        \ifthenelse{\lengthtest{\firstwidth < \secondwidth}}
            {\addtolength{\turnstilewidth}{\secondwidth}}
            {\addtolength{\turnstilewidth}{\firstwidth}}}
        \ifthenelse{\lengthtest{\turnstilewidth < \leasturnstilewidth}}{\setlength{\turnstilewidth}{\leasturnstilewidth}}{}
    \setlength{\turnstileheight}{1.5ex}
    \sbox{\turnstilebox}
    {\raisebox{\lift}{\ensuremath{
        \makever{#2}{\dashthickness}{\turnstileheight}{\ddashthickness}
        \makehor{#3}{\dashthickness}{\turnstilewidth}{\ddashthickness}
        \hspace{-\turnstilewidth}
        \raisebox{\raisedown}
        {\makebox[\turnstilewidth]{\usebox{\first}}}
            \hspace{-\turnstilewidth}
            \raisebox{\raiseup}
            {\makebox[\turnstilewidth]{\usebox{\second}}}
        \makever{#6}{\dashthickness}{\turnstileheight}{\ddashthickness}}}}
        \mathrel{\usebox{\turnstilebox}}}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{#3~\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\expandafter\newcommand\csname n#2\endcsname[1]{\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{theorem}{Theorem}
\newref{lem}{lemma}{Lemma}
\newref{prop}{proposition}{Proposition}
\newref{cor}{corollary}{Corollary}
\newref{cond}{condition}{Condition}
\newref{conj}{conjecture}{Conjecture}

\theoremstyle{definition}
\newref{defn}{definition}{Definition}
\newref{example}{example}{Example}

\theoremstyle{remark}
\newref{rem}{remark}{Remark}

\newcommand{\red}{\Rightarrow}
\newcommand{\deq}{\equiv}
\newcommand{\repl}{:=}
\newcommand{\idtype}{\rightsquigarrow}

\newcommand{\cat}[1]{\mathbf{#1}}
\newcommand{\C}{\cat{C}}
\newcommand{\Cat}{\cat{Cat}}
\newcommand{\Mod}[1]{#1\text{-}\cat{Mod}}
\newcommand{\Th}{\cat{Th}}
\newcommand{\emptyCtx}{\mathbf{1}}
\newcommand{\Set}{\cat{Set}}
\newcommand{\sSet}{\cat{sSet}}
\newcommand{\lc}{lc}
\newcommand{\lcc}{lcc}
\newcommand{\mlc}{\mathrm{\lc}}
\newcommand{\mlcc}{\mathrm{\lcc}}
\newcommand{\K}{$\mathcal{K}$}
\newcommand{\csSet}{\sSet_\mathcal{K}}
\newcommand{\cqCat}{\cat{qcat}_\mathcal{K}}
\newcommand{\lcsSet}{\sSet^\mlc}
\newcommand{\lccsSet}{\sSet^\mlcc}
\newcommand{\lcN}{N^\mlc}
\newcommand{\lcC}{\mathfrak{C}^\mlc}
\newcommand{\cI}{\I_\mathcal{K}}
\newcommand{\cJ}{\J_\mathcal{K}}
\newcommand{\join}{\star}
\newcommand{\cSet}{\cat{cSet}}
\newcommand{\Hom}{\mathrm{Hom}}
\newcommand{\Map}{\mathrm{Map}}

\newcommand{\we}{\mathcal{W}}
\newcommand{\I}{\mathrm{I}}
\newcommand{\J}{\mathrm{J}}
\newcommand{\class}[2]{#1\text{-}\mathrm{#2}}
\newcommand{\Icell}[1][\I]{\class{#1}{cell}}
\newcommand{\Icof}[1][\I]{\class{#1}{cof}}
\newcommand{\Iinj}[1][\I]{\class{#1}{inj}}
\newcommand{\Jcell}[1][]{\Icell[\J#1]}
\newcommand{\cyli}{i}

\numberwithin{figure}{section}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\begin{document}

\title[Equivalence between quasicategories and models of type theory]{Equivalence between locally cartesian (closed) quasicategories and models of homotopy type theory with an interval type}

\author{Valery Isaev}

\begin{abstract}
Abstract.
\end{abstract}

\maketitle

\section{Introduction}

\begin{comment}
\section{Cubically enriched categories}

In this section we recall the definition of the category $\Cat_\square$ of cubically enriched categories and Quillen adjunction between
the cateogry simplicial sets $\sSet$ (with Joyal model structure) and $\Cat_\square$.
We also define Quillen adjunction between $\Cat_\square$ and categories of models of suitable algebraic dependent type theories.

Let $D$ be poset $\{0,1\}$ where $0 \leq 1$.
For every $0 \leq n$, $1 \leq i \leq n+1$, $\epsilon \in D$, let $\delta^{i,\epsilon}_n : D^n \to D^{n+1}$ and $\sigma^i_n : D^{n+1} \to D^n$ be the following morphisms of posets:
\begin{align*}
\delta^{i,\epsilon}_n(x_1, \ldots x_n) & = (x_1, \ldots x_{i-1}, \epsilon, x_{i+1}, \ldots x_n) \\
\sigma^i_n(x_1, \ldots x_{n+1}) & = (x_1, \ldots x_{i-1}, x_{i+1}, \ldots x_{n+1})
\end{align*}
Category of cubes $\square$ is the subcategory of the category of posets on objects of the form $D^n$ generated by morphisms $\delta^{i,\epsilon}_n$ and $\sigma^i_n$.
Let $\cSet$ be the category of cubical sets $\Set^{\square^{op}}$.
Let $\square^n \in \cSet$ be the representable presheaf on $D^n$.
Let $d^{i,\epsilon}_n : \square^n \to \square^{n+1}$ and $s^i_n : \square^{n+1} \to \square^n$ be the maps represented by $\delta^{i,\epsilon}_n$ and $\sigma^i_n$.

There is a (unique) closed monoidal structure $(\otimes,1)$ on $\cSet$ such that $\square^n \otimes \square^m \cong \square^{n+m}$ and $1 = \square^0$ (see, for example, \cite{jardine}).
Let $X$ be an object of a cocomplete monoidal category $\C$.
Then there exists a (unique) colimit-preserving strong monoidal functor $F : \cSet \to \C$ such that $F(\square^1) = X$.
This functor has a right adjoint $G : \C \to \cSet$ given by formula $G(X) = \Hom_\C(F(y(-)),X)$, where $y : \square \to \cSet$ is the Yoneda embedding.
An examples of this construction is the adjunction $|-| : \cSet \rightleftarrows \sSet : S$ such that $|\square^1| = \Delta^1$.

For every $n \geq 0$, let $\partial \square^n$ be the following coequalizer:
\[ \coprod_{1 \leq i < j \leq n, \epsilon_1,\epsilon_2 \in D} \square^{n-2} \rightrightarrows \coprod_{1 \leq i \leq n, \epsilon \in D} \square^{n-1} \to \partial \square^n, \]
where one of the morphisms maps $(i,j,\epsilon_1,\epsilon_2)$-th component to $(i,\epsilon_1)$-th component by map $d^{j-1,\epsilon_2}_{n-2}$,
the other one maps $(i,j,\epsilon_1,\epsilon_2)$-th component to $(j,\epsilon_2)$-th component by map $d^{i,\epsilon_1}_{n-2}$,
Consider morphism $f : \coprod_{1 \leq i \leq n, \epsilon \in D} \square^{n-1}$ that is defined on $(i,\epsilon)$-th component by $d^{i,\epsilon}_{n-1}$.
Then this morphism determines a morphism $i^n : \partial \square^n \to \square^n$.

For every $n \geq 0$, $1 \leq i \leq n$, $\epsilon \in D$, let $\sqcap^n_{i,\epsilon}$ be the following coequalizer:
\[ \coprod_{\substack{1 \leq j_1 < j_2 \leq n, \gamma_1,\gamma_2 \in D, \\ (j_1,\gamma_1) \neq (i,\epsilon), (j_2,\gamma_2) \neq (i,\epsilon)}} \square^{n-2} \rightrightarrows \coprod_{\substack{1 \leq j \leq n, \gamma \in D, \\ (j,\gamma) \neq (i,\epsilon)}} \square^{n-1} \to \sqcap^n_{i,\epsilon}, \]
where morphisms are defined as before.
The restriction of $f$ determines a morphism $u^n_{i,\epsilon} : \sqcap^n_{i,\epsilon} \to \square^n$.

There is a model structure on $\cSet$ with maps $i^n : \partial \square^n \to \square^n$ as generating cofibrations
and maps $u^n_{i,\epsilon} : \sqcap^n_{i,\epsilon} \to \square^n$ as generating trivial cofibrations (see, for example, \cite[Example~52, Theorem~88]{jardine}).
Functors $|-| : \cSet \rightleftarrows \sSet : S$ determine a Quillen equivalence.

Let $\Cat_\Delta$ and $\Cat_\square$ be the categories of simplicially and cubically enriched categories respectively (that is, categories enriched in $\sSet$ and $\cSet$).
Bergner constructed a model structure on $\Cat_\Delta$ in \cite{bergner}.
Lurie generalized this construction (\cite[Proposition~A.3.2.4]{lurie-topos}).
In particular, this proposition applies to the category of cubically enriched categories.
To describe the class of cofibrations of this model category, we need too define a functor $ar : \cSet \to \Cat_\square$.
For every cubical set $A$, let $ar(A)$ be the cubically enriched category with two objects $X$ and $Y$ and $\Hom(X,Y) = A$, $\Hom(X,X) = \Hom(Y,Y) = 1$, $\Hom(Y,X) = \varnothing$.
The class of cofibrations is generated by the set of maps of the form $ar(i^n)$ and map $\varnothing \to 1$.

\begin{rem}
Fibrations in $\Cat_\square$ do not have simple description, but fibrant objects have.
Since the category of simplicial sets is excellent, the category of cubical sets is also excellent by \cite[Remark~A.3.2.21]{lurie-topos}.
By \cite[Theorem~A.3.2.24]{lurie-topos}, a cubically enriched category $C$ is fibrant
if and only if for every objects $X$ and $Y$ of $C$, $\Hom_C(X,Y)$ is a fibrant cubical set.
Also, a map $F : C \to D$ between cubically enriched categories, where $D$ is fibrant, is a fibration if and only if the following conditions are satisfied:
\begin{enumerate}
\item For every object $X$ and $Y$ of $C$, $\Hom_C(X,Y) \to \Hom_D(F(X),F(Y))$ is a fibration of cubical sets.
\item For every object $X$ of $C$ and every equivalence $f : F(X) \to Y$ in $D$, there exists an equivalence $f' : X \to Y'$ in $C$ such that $F(f') = f$.
\end{enumerate}
\end{rem}

There is a pair of adjoint functors $\mathfrak{C}_\Delta : \sSet \rightleftarrows \Cat_\Delta : N_\Delta$ which is defined in \cite[Section~1.1.5]{lurie-topos}.
We will need analogous functors for cubically enriched categories.
We define a cubically enriched category $\mathfrak{C}_\square(\Delta^n)$ as follows:
\begin{itemize}
\item The objects of $\mathfrak{C}_\square(\Delta^n)$ are natural numbers between $0$ and $n$.
\item For every $0 \leq j < i \leq n$, $\Hom_{\mathfrak{C}_\square(\Delta^n)}(i,j) = \varnothing$.
\item For every $0 \leq i \leq n$, $\Hom_{\mathfrak{C}_\square(\Delta^n)}(i,i) = 1$.
\item For every $0 \leq i < j \leq n$, $\Hom_{\mathfrak{C}_\square(\Delta^n)}(i,j) = \square^{j-i-1}$.
\item For every object $i$ of $\mathfrak{C}_\square(\Delta^n)$, the identity morphism on $i$ is the unique element of $\Hom_{\mathfrak{C}_\square(\Delta^n)}(i,i)$.
\item For every $0 \leq i < j < k \leq n$, the composition
\[ \Hom_{\mathfrak{C}_\square(\Delta^n)}(i,j) \otimes \Hom_{\mathfrak{C}_\square(\Delta^n)}(j,k) \to \Hom_{\mathfrak{C}_\square(\Delta^n)}(i,k) \]
is the composite $\square^{j-i-1} \otimes \square^{k-j-1} \cong \square^{k-i-2} \to \square^{k-i-1}$.
\end{itemize}
\end{comment}

\section{Functors between $\sSet$ and $\Mod{T}$}

In this section we define a Quillen adjunction between $\sSet$ and $\Mod{T}$ for every appropriate algebraic dependent type theory $T$.
Recall that $sq_l$ is the theory with the following axioms:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash i : I$}
\AxiomC{$\Gamma \vdash j : I$}
\BinaryInfC{$\Gamma \vdash sq_l(i,j) : I$}
\DisplayProof
\end{center}
\begin{align*}
sq_l(left,j) & = left \\
sq_l(right,j) & = j \\
sq_l(i,left) & = left \\
sq_l(i,right) & = i
\end{align*}
To define functors between $\sSet$ and $\Mod{T}$, we also need to assume that $sq_l$ is associative.
Let $sq^a_l$ be the theory which has the same axioms as $sq_l$ together with the following axiom:
\[ sq_l(sq_l(i,j),k) = sq_l(i,sq_l(j,k)) \]

Let $T$ be any theory under $sq^a_l$.
For every finite nonempty linearly ordered set $J$, we define a model $\mathfrak{C}(\Delta^J)$ of $T$.
It is freely generated by generators and relations described below.
Generators of $\mathfrak{C}(\Delta^J)$ are $O_j : (ty,0)$ for every $j \in J$, and $M_{J'} : (tm,|J'|-1)$ for every subset $J'$ of $J$ such that $|J'| \geq 2$.
For every $j \in J$, $\mathfrak{C}(\Delta^J)$ has relation $\vdash O_j\ type$.
For every $J' = \{ j_1 < \ldots < j_n \} \subseteq J$ such that $n \geq 2$, it has the following relation:
\[ x : O_{j_1}, x_{j_2} : I, \ldots x_{j_{n-1}} : I \vdash M_{J'} : O_{j_n} \]
For every $j \notin J'$ such that $j_1 < j < j_n$, it has the following relations:
\begin{align}
x : O_{j_1}, x_{j_2} : I, \ldots x_{j_{n-1}} : I & \vdash M_{J' \cup \{j\}}[x_j \repl left] \deq M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}] \label{rel:left} \\
x : O_{j_1}, x_{j_2} : I, \ldots x_{j_{n-1}} : I & \vdash M_{J' \cup \{j\}}[x_j \repl right] \deq M_{J'} \label{rel:right}
\end{align}

The idea of this definition is similar to \cite[Definition~1.1.5.1]{lurie-topos}.
For every vertex $j$ of $\Delta^J$, we have a type $O_j$,
and for every $(n+1)$-dimensional face $J'$ of $\Delta^J$, we have an $n$-dimensional cube $M_{J'}$.
Relations describe faces of these cubes.

Let $sq_l(x_1, \ldots x_n) = sq_l(x_1, \ldots sq_l(x_{n-1},x_n) \ldots )$.
In particular, $sq_l(X) = x$ and $sq_l() = right$.
Now, we can extend $\mathfrak{C}$ to a functor $\Delta \to \Mod{T}$.
Let $f : J \to K$ be a monotone map between linearly ordered sets.
Then we define $\mathfrak{C}(f)$ as follows:
\begin{align*}
\mathfrak{C}(f)(O_j) & = O_{f(j)} \\
\mathfrak{C}(f)(M_{J'}) & =
\begin{cases}
    x                                                                  & \text{if } |f(J')| = 1 \\
    M_{f(J')}[\ \ldots\ x_{k_i} \repl sq_l(x_{f^{-1}(k_i)})\ \ldots\ ] & \text{if } |f(J')| > 1 \\
\end{cases}
\end{align*}
where $k_i$ runs from $k_2$ to $k_{m-1}$, $\{ k_1 < \ldots < k_m \} = f(J')$,
and $x_{f^{-1}(k_i)} = x_{j_1}, \ldots x_{j_n}$, $\{ j_1 < \ldots < j_n \} = f^{-1}(k_i)$.

Let us check that $\mathfrak{C}(f)$ preserves relations.
Let $J' = \{ j_1 < \ldots < j_i < j < j_{i+1} < \ldots < j_n \}$ be a subset of $J$, and let $f'$ be the restriction of $f$ to $J'$.
If $|f(J')| = 1$, then $\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) = \mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) = \mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl right]) = \mathfrak{C}(f)(M_{J'}) = x$.
Thus we may assume that $|f(J')| > 1$. 

Let $\rho(x_{f(j_i)}) = sq_l(x_{f'^{-1}(f(j_1))})$ for every $1 \leq i \leq n$ such that $f(j_i) \neq f(j)$.
Let us consider the first relation.
If $f(j) = f(j_1)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) & = \\
M_{f(J')}[\rho] & = \\
M_{\{ f(j), \ldots f(j_n) \}}[\rho][x \repl x] & = \\
\mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) & .
\end{align*}
If $f(j) = f(j_n)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) & = \\
M_{f(J')}[\rho] & = \\
x[x \repl M_{\{f(j_1), \ldots f(j)\}}[\rho]] & = \\
\mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) & .
\end{align*}
If $f(j_1) < f(j) < f(j_n)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl sq_l(x_{f'^{-1}(f(j))}, x_j)][x_j \repl left] & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl left] & = \\
M_{\{f(j), \ldots f(j_n)\}}[x \repl M_{\{f(j_1), \ldots f(j)\}}][\rho] & = \\
\mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) & .
\end{align*}

Let us consider the second relation.
If either $f(j) = f(j_1)$ or $f(j) = f(j_n)$, then $\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl right]) = M_{f(J')}[\rho] = \mathfrak{C}(f)(M_{J'})$.
If $f(j_1) < f(j) < f(j_n)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl right]) & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl sq_l(x_{f'^{-1}(f(j))}, x_j)][x_j \repl right] & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl sq_l(x_{f'^{-1}(f(j))})] & = \\
\mathfrak{C}(f)(M_{J'}) & ,
\end{align*}
If $f(j_i) < f(j) < f(j_{i+1})$, then the last equality holds by \eqref{rel:right},
otherwise it holds immediately by definition of $\mathfrak{C}(f)(M_{J'})$.

Let $[n]$ be the set of natural numbers $\{ 0, \ldots n \}$ with the obvious linear order.
Then $\Delta$ is the full subcategory of linearly ordered sets on objects of the form $[n]$.
It is easy to see that $\mathfrak{C}$ preserves identity morphisms,
and the fact that it preserves compositions follows from associativity of $sq_l$.
Thus we have a functor $\mathfrak{C} : \Delta \to \Mod{T}$.
This functor (uniquely) extends to a colimit-preserving functor $\mathfrak{C} : \sSet \to \Mod{T}$,
which has a right adjoint $N : \Mod{T} \to \sSet$ defined by equation $N(X) = \Hom(\mathfrak{C}(-),X)$.

We can explicitly describe $\mathfrak{C} : \sSet \to \Mod{T}$.
Model $\mathfrak{C}(X)$ is generated by symbols $O_a : (ty,0)$ for every $a \in X_0$, and $M_a : (tm,n)$ for every $a \in X_n$, $n \geq 1$.
For every $a \in X_0$, $\mathfrak{C}(X)$ has relations $\vdash O_a\ type$ and $M_{s_0(a)} = (x : O_a \vdash x : O_a)$.
For every $a \in X_n$, $n \geq 1$, it has the following relation:
\[ x : O_{a|\Delta^{\{0\}}}, x_1 : I, \ldots x_{n-1} : I \vdash M_a : O_{a|\Delta^{\{n\}}} \]
For every $1 \leq j \leq n-1$, it has the following relations:
\begin{align*}
M_a[x_j \repl left] & = M_{a|\Delta^{\{ j, \ldots n \}}}[x \repl M_{a|\Delta^{\{ 0, \ldots j \}}}] \\
M_a[x_j \repl right] & = M_{a|\Delta^{\{0, \ldots j-1, j+1, \ldots n\}}}
\end{align*}
For every $0 \leq j \leq n$, it has the following relation:
\[ M_{s_j(a)} =
\begin{cases}
    M_a[x_1 \repl x_2, \ldots x_{n-1} \repl x_n]                                      & \text{if } j = 0 \\
    M_a[x_j \repl sq_l(x_j,x_{j+1}), x_{j+1} \repl x_{j+2}, \ldots x_{n-1} \repl x_n] & \text{if } 1 \leq j \leq n-1 \\
    M_a                                                                               & \text{if } j = n \\
\end{cases}
\]
For every morphism $f : X \to Y$ of simplicial sets, let $\mathfrak{C}(f)(O_a) = O_{f(a)}$ and $\mathfrak{C}(f)(M_a) = M_{f(a)}$.
It is easy to see that this definition preserves relations, identity morphisms and compositions.

\begin{prop}
Functors $\mathfrak{C} \dashv N$ determine a Quillen adjunction between $\sSet$ with the Joyal model structure and $\Mod{T}$ with the model structure defined in \cite{alg-models}.
\end{prop}
\begin{proof}
Note that $\mathfrak{C}(\partial \Delta^n)$ is isomorphic (over $\mathfrak{C}(\Delta^n)$) to the theory
freely generated by the same generators and relations as $\mathfrak{C}(\Delta^n)$ except for $M_{[n]}$.
Similarly, if $i \in [n]$, then $\mathfrak{C}(\Lambda^n_i)$ is freely generated by the same generators
and relations as $\mathfrak{C}(\partial \Delta^n)$ except for $M_{\{ 0, \ldots i-1, i+1, \ldots n \}}$.

Let us prove that $\mathfrak{C}$ preserves cofibration.
To do this, it is enough to show that $\mathfrak{C}(\partial \Delta^n) \to \mathfrak{C}(\Delta^n)$ is a cofibration for every $n$.
If $n = 0$, then this map equals to $i_{(ty,0)}$.
Suppose that $n > 0$.
First, let us define objects $\square^k$ and $\partial \square^k$.
Let $\square^k = F(\{ x : A, x_1 : I, \ldots x_k : I \vdash b : B \})$,
and let $\partial \square^k$ be freely generated by generators and relations described below.
Generators of $\partial \square^k$ are $A,B : (ty,0)$ and $b_{[i=c]} : (tm,k)$ for every $1 \leq i \leq k$, $c \in \{left,right\}$.
For every $1 \leq i \leq k$ and $c \in \{left,right\}$, it has the following relation:
\[ x : A, x_1 : I, \ldots x_{i-1} : I, x_{i+1} : I, \ldots x_k : I \vdash b_{[i=c]} : B \]
For every $1 \leq i_1 < i_2 \leq k$ and $c,c' \in \{left,right\}$, it has the following relation:
\[ b_{[i_2=c']}[x_{i_1} \repl c] = b_{[i_1=c]}[x_{i_2} \repl c'] \]

Map $i^k : \partial \square^k \to \square^k$ is defined in the obvious way: $i^k(b_{[i=c]}) = b[x_i \repl c]$.
Let $v : \square^{n-1} \to \mathfrak{C}(\Delta^n)$ be defined as follows: $v(A) = O_0$, $v(B) = O_n$, $v(b) = M_{[n]}$.
Map $v \circ i^k$ factors through $\mathfrak{C}(\partial \Delta^n) \to \mathfrak{C}(\Delta^n)$, and the following square is cocartesian:
\[ \xymatrix{ \partial \square^{n-1} \ar[r] \ar[d]_{i^k} & \mathfrak{C}(\partial \Delta^n) \ar[d] \\
              \square^{n-1} \ar[r]_v & \mathfrak{C}(\Delta^n)
            } \]
Thus we just need to show that $i^k$ is a cofibration.
But it is a pushout of $i_{(tm,1)} : F(\{ x : A \vdash B\ type \}) \to F(\{ x : A \vdash b : B \})$.
Indeed, let $v' : F(\{ x : A \vdash b : B \}) \to \square^k$ be defined as follows: $v'(b) = path(x_1.\,\ldots path(x_n.\,b) \ldots)$ and $v'(B)$ equals to
\begin{align*}
Path(x_1.\, \ldots Path(x_{n-2}.\, & Path(x_{n-1}.\,     Path(x_n.\,B, b[x_n \repl left], b[x_n \repl right]), \\
                                   & \qquad \qquad \quad path(x_n.\,b[x_{n-1} \repl left]), \\
                                   & \qquad \qquad \quad path(x_n.\,b[x_{n-1} \repl right])), \\
                                   & path(x_{n-1}.\,     path(x_n.\,b[x_{n-2} \repl left])), \\
                                   & path(x_{n-1}.\,     path(x_n.\,b[x_{n-2} \repl right]))) \ldots )
\end{align*}
Then $v' \circ i_{(tm,1)}$ factors through $i^k$, and the following square is cocartesian:
\[ \xymatrix{ F(\{ x : A \vdash B\ type \}) \ar[r] \ar[d]_{i_{(tm,1)}} & \partial \square^k \ar[d]^{i^k} \\
              F(\{ x : A \vdash b : B \}) \ar[r]_-{v'} & \square^k
            } \]

Now, let us prove that for every $X \in \Mod{T}$, $N(X)$ is fibrant.
Since fibrant objects in $\sSet$ are precisely quasicategories,
it is enough to show that $\mathfrak{C}(\Lambda^n_i) \to \mathfrak{C}(\Delta^n)$ is a trivial cofibration for every inner horn $\Lambda^n_i \to \Delta^n$.
First, for every $1 \leq i \leq k$, let $\sqcap^k_i$ be the object defined by the same generators and relations as $\partial \square^k$ except for $b_{[i=right]}$.
Then we have the following cocartesian square:
\[ \xymatrix{ \sqcap^{n-1}_i \ar[r] \ar[d] & \mathfrak{C}(\Lambda^n_i) \ar[d] \\
              \partial \square^{n-1} \ar[r] & \mathfrak{C}(\partial \Delta^n)
            } \]

Since $\sqcap^k_i \to \square^k$ is a cofibration, we just need to show that it is a weak equivalence.
Note that $\sqcap^k_i \to \square^k$ is isomorphic to $\sqcap^k_k \to \square^k$ for every $1 \leq i \leq k$.
Indeed, we can define isomorphism $g : \square^k \to \square^k$ as $g(b) = b[x_i \repl x_k, x_k \repl x_i]$
and isomorphism $f : \sqcap^k_i \to \sqcap^k_k$ as $f(b_{[i=left]}) = b_{[k=left]}[x_i \repl x_k]$, $f(b_{[k=c]}) = b_{[i=c]}[x_k \repl x_i]$,
and $f(b_{[j=c]}) = b_{[j=c]}[x_i \repl x_k, x_k \repl x_i]$ for every $j \neq i,k$.
Then $f$ and $g$ commute with $\sqcap^k_i \to \square^k$ and $\sqcap^k_k \to \square^k$.
Thus we just need to prove that $\sqcap^k_k \to \square^k$ is a weak equivalence.

Note that $\square^{k+1}$ is a (relative) cylinder object for $F(\{ A : (ty,0), B : (ty,0) \}) \to \square^k$.
Indeed, $\square^k \amalg_{F(\{ A : (ty,0), B : (ty,0) \})} \square^k \to \square^{k+1}$ is a cofibration,
and $\square^k \to \square^{k+1}$ is a weak equivalence since it is a pushout of a generating trivial cofibration $F(\{ \Gamma \vdash b : B \}) \to F(\{ \Gamma, y : I \vdash h : B \})$.

Every object has RLP with respect to $\sqcap^k_k \to \square^k$ (see \cite[Section~2.4]{alg-models}).
In particular, $\sqcap^k_k \to \square^k$ has a retract $\square^k \to \sqcap^k_k$.
The composite map $\square^k \to \sqcap^k_k \to \square^k$ is homotopic to $id$.
To show this, we just need to construct an appropriate map $\square^{k+1} \to \square^k$, which is easy to do using filler operations from \cite[Section~2.4]{alg-models}.
Thus $\sqcap^k_k \to \square^k$ is a homotopy equivalence.

Finally, let us prove that if $f : X \to Y$ is a fibration in $\Mod{T}$, then $N(f)$ is a fibration in $\sSet$.
Since $N(Y)$ is fibrant, by \cite[Corollary~2.4.6.5]{lurie-topos}, we just need to prove the following conditions:
\begin{enumerate}
\item $N(f)$ is an inner fibration.
\item For every object $A$ of $N(X)$ and every equivalence $p : N(f)(A) \to B$ in $N(Y)$, there exists an equivalence $p' : A \to B'$ in $N(X)$ such that $N(f)(p') = p$.
\end{enumerate}
The first condition follows from the fact that maps $\mathfrak{C}(\Lambda^n_i) \to \mathfrak{C}(\Delta^n)$ are trivial cofibrations.
The second condition can be reformulated as follows: for every closed type $A$ of $X$ and every equivalence $p : f(A) \to B$ in $Y$,
there exists an equivalence $p' : A \to B'$ in $X$ such that $f(p') = p$.
But this follows from the fact that $f$ has RLP with respect to $\J_{\I_{ty}}$.
\end{proof}

\section{Marked simplicial sets}

In this section for every set $\mathcal{K}$ of simplicial sets, we define a model category $\csSet$ of \K-marked simplicial sets.
This marking of simplicial sets is not related to the marking that was defined in \cite{lurie-topos}.
Category $\csSet$ represents $(\infty,1)$-category of $(\infty,1)$-categories in which for every $K \in \mathcal{K}$ limits of shape $K$ exist, and functors between these categories preserve them.
For example, if $\mathcal{K} = \{ \varnothing, \Lambda^2_2 \}$, then $\csSet$ represents $(\infty,1)$-category of finitely complete categories and exact functors.
We are mostly interested in this example, but the treatment of the general case does not require much additional effort, so we consider arbitrary $\mathcal{K}$.

\begin{comment}
In this section we define model categories $\lcsSet$ and $\lccsSet$ of \lc- and \lcc-marked simplicial sets.
These model categories represent $(\infty,1)$-categories of locally caretesian (that is, finitely complete) and locally cartesian closed $(\infty,1)$-categories respectively.
Objects of $\lcsSet$ and $\lccsSet$ are simplicial sets in which certain simplices are marked.
To distinguish these marking from each other and from marking defined in \cite{lurie-topos}, we call such simplicial sets \lc-marked and \lcc-marked.
\end{comment}

\begin{defn}
Let $\mathcal{K}$ be a set of simplicial sets.
A \emph{\K-marked simplicial set} is a pair $(X,\mathcal{E})$, where $X$ is a simplicial set and $\mathcal{E}$ is a subset of $\bigcup_{K \in \mathcal{K}} \Hom(\Delta^0 \join K, X)$.
Cones that belong to $\mathcal{E}$ will be caled \emph{marked}.
A morphism of \K-marked simplicial sets is a map of the underlying simplicial sets that preserves marked cones.
The category of \K-marked simplicial sets will be denoted by $\csSet$.
\end{defn}

Forgetful functor $U : \csSet \to \sSet$ has a left adjoint $(-)^\flat : \sSet \to \csSet$ and a right adjoint $(-)^\sharp : \sSet \to \csSet$.
For every simplicial set $X$, $X^\flat$ is the \K-marked simplicial set in which no cones are marked (that is, $X^\flat = (X,\varnothing)$),
and $X^\sharp$ is the \K-marked simplicial set in which all cones are marked (that is, $X^\sharp = (X,\bigcup_{K \in \mathcal{K}} \Hom(\Delta^0 \join K, X))$).
Objects of the form $X^\flat$ and of the form $X^\sharp$ will be called \emph{flat} and \emph{sharp} respectively.

To construct a model structure on $\csSet$, we will need the following theorem by Jeff Smith (see \cite[Proposition~A.2.6.8]{lurie-topos}):
\begin{thm}
Let $\C$ be a locally presentable category, let $\I$ be a set of maps of $\C$, and let $\we$ be a class of maps of $\C$.
Suppose that the following conditions hold:
\begin{enumerate}
\item The intersection $\Icof \cap \we$ is closed under pushouts and transfinite compositions.
\item The full subcategory $\we$ of the category of arrows of $\C$ is accessible subcategory.
\item The class $\we$ has the 2-out-of-3 property.
\item $\Iinj \subseteq \we$.
\end{enumerate}
Then there exists a cofibrantly generated model structure on $\C$ with $\Icof$ as the class of cofibrations and $\we$ as the class of weak equivalences.
\end{thm}

We will say that a map $f : X \to Y$ of \K-marked simplicial sets is a \emph{cofibration} if and only if $U(f)$ is a monomorphism of simplicial sets. 
The class of cofibrations is generated by the set $\I$ which consists of the following maps:
\begin{enumerate}
\item For every $n \geq 0$, inclusions $(\partial \Delta^n)^\flat \to (\Delta^n)^\flat$.
\item For every $K \in \mathcal{K}$, maps $(\Delta^0 \join K)^\flat \to (\Delta^0 \join K, \{ id : \Delta^0 \join K \to \Delta^0 \join K \})$.
\end{enumerate}

We will say that a quasicategory $X$ is \K-complete if for every $K \in \mathcal{K}$, limits of shape $K$ exist in $X$.
Let $\cqCat$ be the full subcategory of $\sSet$ on \K-complete quasicategories.
For every $X \in \cqCat$, we define a \K-marked simplicial set $X^\natural$ as simplicial set $X$ in which a cone is marked if and only if it is a limit cone.
We will later see that fibrant objects of $\csSet$ are precisely objects of the form $X^\natural$.

Let $S : \Delta \to \sSet$ be a cosimplicial frame on $\Delta^0$ (in the Quillen model structure) such that $S(\Delta^n)$ is a Kan complex for every $n$.
First, extend $S$ to a colimit-preserving functor $S : \sSet \to \sSet$.
For every \K-marked simplicial sets $X$ and $Y$, we define a simplicial set $\Map(X,Y)$ as follows:
\[ \Map(X,Y) = \Hom(S(-)^\sharp \times X, Y). \]
Note that cartesian product in $\csSet$ preserves colimits.
It follows that $\Map(-,Y)$ sends colimits to limits.

We will say that a map $f : X \to Y$ of \K-marked simplicial sets is a \emph{weak equivalence} if for every $Z \in \cqCat$,
induced map $\Map(Y,Z^\natural) \to \Map(X,Z^\natural)$ is a weak equivalence of simplicial sets in the Quillen model structure.

\begin{prop}[map-fib]
For every cofibration $f : X \to Y$, induced map $\Map(Y,Z^\natural) \to \Map(X,Z^\natural)$ is a fibration in the Quillen model structure.
\end{prop}
\begin{proof}
Map $\Map(Y,Z^\natural) \to \Map(X,Z^\natural)$ has RLP with respect to a horn inclusion $j : \Lambda^n_i \to \Delta^n$ if and only if $Z^\natural$ has RLP with respect to the following map:
\[ j \wedge f : S(\Delta^n)^\sharp \times X \amalg_{(S(\Lambda^n_i),\mathcal{E}) \times X} (S(\Lambda^n_i),\mathcal{E}) \times Y \to S(\Delta^n)^\sharp \times Y \]
A cone $\Delta^0 \join K \to S(\Lambda^n_i)$ belongs to $\mathcal{E}$ if and only if it factors through some face $S(\Delta^{n-1}) \to S(\Lambda^n_i)$.

Since cartesian product of \K-marked simplicial sets preserve colimits, $X \times -$ has a right adjoint.
Hence we may assume that $f : X \to Y$ belongs to $\I$.
First, let us consider the case when $f$ is a map $(\partial \Delta^k)^\flat \to (\Delta^k)^\flat$.
Then both the domain and the codomain of $j \wedge f$ are flat.
Hence $Z^\natural$ has RLP with respect to $j \wedge f$ if and only if $Z$ has RLP with respect to $U(j) \wedge U(f)$.
Since $Z$ is fibrant in the Joyal model structure and $U(j) \wedge U(f)$ is a cofibration,
we just need to show that $U(j) \wedge U(f)$ is a weak equivalence in the Joyal model structure.
Since $S$ is a cosimplicial frame on $\Delta^0$, map $U(j)$ is a weak equivalence.
By \cite[Corollary~2.2.5.4]{lurie-topos}, for every simplicial set $X$, $U(j) \times X$ is also a weak equivalence.
Since $U(j)$ is a trivial cofibration, $S(\Lambda^n_i) \times U(Y) \to S(\Delta^n) \times U(X) \amalg_{S(\Lambda^n_i) \times U(X)} S(\Lambda^n_i) \times U(Y)$ is also a trivial cofibration.
Hence by 2-out-of-3 property, $U(j) \wedge U(f)$ is a weak equivalence.

Now, assume that $f$ is a map $(\Delta^0 \join K)^\flat \to (\Delta^0 \join K, \{ id \})$.
Then $j \wedge f$ is the following map: $(S(\Delta^n),\mathcal{E}') \times (\Delta^0 \join K, \{ id \}) \to S(\Delta^n)^\sharp \times (\Delta^0 \join K, \{ id \})$.
A cone $\Delta^0 \join K' \to S(\Delta^n)$ belongs to $\mathcal{E}'$ if and only if it factors through $S(\Lambda^n_i)$ and $\Delta^0 \join K' \to S(\Lambda^n_i)$ belongs to $\mathcal{E}$.
Consider a map $g : (S(\Delta^n),\mathcal{E}') \times (\Delta^0 \join K, \{ id \}) \to Z^\natural$.
Since $U(j \wedge f)$ is an isomorphism, we just need to show that for every cone $k' : \Delta^0 \join K' \to S(\Delta^n) \times (\Delta^0 \join K)$,
if $k'$ is marked in $S(\Delta^n)^\sharp \times (\Delta^0 \join K, \{ id \})$, then $U(g) \circ k'$ is marked in $Z^\natural$.
Cone $k'$ is marked in $S(\Delta^n)^\sharp \times (\Delta^0 \join K, \{ id \})$ only if it is of the form $\langle k, id \rangle$ for some cone $k : \Delta^0 \join K \to S(\Delta^n)$.
Since $S(\Delta^n)$ is a contractible Kan complex, every two cones $k_1,k_2 : \Delta^0 \join K \to S(\Delta^n)$ are homotopic.

Since there exists at least one marked cone in $(S(\Delta^n),\mathcal{E}') \times (\Delta^0 \join K, \{ id \})$,
we just need to prove that if a cone $k_1 : \Delta^0 \join K \to Z$ is marked in $Z^\natural$ and $k_2$ is homotopic to $k_1$, then $k_2$ is also marked in $Z^\natural$.
But a cone is marked in $Z^\natural$ if and only if it is a limit cone.
It is easy to see that a cone homotopic to a limit cone is also a limit cone.
\end{proof}

\begin{cor}[obj-fib]
For every $X \in \csSet$ and $Z \in \cqCat$, $\Map(X,Z^\natural)$ is a Kan complex.
\end{cor}

\begin{cor}
Trivial cofibrations in $\csSet$ are closed under pushouts.
\end{cor}
\begin{proof}
Consider the following pushout where $A \to B$ is a trivial cofibration:
\[ \xymatrix{ A \ar[r] \ar[d] & C \ar[d] \\
              B \ar[r]        & \po D
            } \]
By \rprop{map-fib}, $\Map(B,Z^\natural) \to \Map(A,Z^\natural)$ is a trivial fibration in the Quillen model structure.
Since $\Map(-,Z^\natural)$ sends colimits to limits, we have the following cartesian square:
\[ \xymatrix{ \Map(D,Z^\natural) \ar[r] \ar[d] \pb & \Map(B,Z^\natural) \ar[d] \\
              \Map(C,Z^\natural) \ar[r]            & \Map(A,Z^\natural)
            } \]
Thus $\Map(D,Z^\natural) \to \Map(C,Z^\natural)$ is also a trivial fibration.
Hence $C \to D$ is a weak equivalence.
\end{proof}

\begin{prop}[hom-we]
Let $f : X \to Y$ and $g : Y \to X$ be maps of \K-marked simplicial sets such that $U(g \circ f)$ and $U(f \circ g)$ are left homotopic to identity morphisms.
Then $f$ and $g$ are weak equivalences.
\end{prop}
\begin{proof}
To prove this, it is enough to show that if $f,g : X \to Y$ are maps of \K-marked simplicial sets such that $U(f)$ and $U(g)$ are left homotopic,
then corresponding maps $\Map(Y,Z^\natural) \to \Map(X,Z^\natural)$ are also homotopic.
Let $S(\Delta^1) \times U(X) \to U(Y)$ be a homotopy between $U(f)$ and $U(g)$.
Then we can lift it to a map $h : C(X) \to Y$, where $C(X) = (S(\Delta^1),\mathcal{E}) \times X$,
a cone belongs to $\mathcal{E}$ if and only if it factors through one of the two faces $S(\Delta^0) \to S(\Delta^1)$.

Homotopy $h$ determines a map $\Map(Y,Z^\natural) \to \Map(C(X),Z^\natural)$.
Thus we just need to prove that $\Map(C(X),Z^\natural)$ is a path object for $\Map(X,Z^\natural)$.
First, note that $\Map(C(X),Z^\natural) \to \Map(X,Z^\natural) \times \Map(X,Z^\natural)$ is a fibration by \rprop{map-fib} and $\Map(X,Z^\natural) \to \Map(C(X),Z^\natural)$ is a cofibration.
Thus it is enough to show that $\Map(C(X),Z^\natural) \to \Map(X,Z^\natural)$ is a trivial fibration.
This map has RLP with respect to $i : \partial \Delta^n \to \Delta^n$ if and only if $Z^\natural$ has RLP with respect to the following map:
\[ t : S(\Delta^n)^\sharp \times X \amalg_{(S(\partial \Delta^n),\mathcal{E'}) \times X} (S(\partial \Delta^n),\mathcal{E'}) \times C(X) \to S(\Delta^n)^\sharp \times C(X) \]

First, note that the underlying map of simplicial sets $U(t)$ is a trivial cofibration in the Joyal model structure.
Indeed, it follows from the fact that $S(\partial \Delta^n) \to S(\Delta^n)$ is a cofibration and $X \to S(\Delta^1) \times X$ is a trivial cofibration in the same way as in \rprop{map-fib}.
It follows that $Z$ has RLP with respect to $U(t)$.
To prove that this lifting $g : S(\Delta^n) \times U(C(X)) \to Z$ extends to a morphism of \K-marked simplicial sets,
we just need to show that for every cone $k : (\Delta^0 \join K, \{id\}) \to S(\Delta^n)^\sharp \times C(X)$, cone $g \circ U(k)$ is marked in $Z^\natural$.
Note that cone $\Delta^0 \join K \to S(\Delta^n) \times U(C(X)) \to S(\Delta^n) \times U(X) \to S(\Delta^n) \times U(C(X)) \to Z$ is marked in $Z^\natural$.
Since this cone is homotopic to $k$, $k$ is also marked in $Z^\natural$.
\end{proof}

\begin{cor}[iinj]
If a map $f : X \to Y$ of \K-marked simplicial sets has RLP with respect to $\I$, then $f$ is a weak equivalence.
\end{cor}
\begin{proof}
Since $Y$ is cofibrant, $f$ has a section $g : Y \to X$.
Since $U(f)$ is a trivial fibration, $U(g \circ f)$ and $U(f \circ g)$ are homotopic to identities.
\end{proof}

\begin{prop}
A map $f : X^\natural \to Y^\natural$ is a weak equivalence if and only if $U(f)$ is a weak equivalence in the Joyal model structure.
\end{prop}
\begin{proof}
First, suppose that $f$ is a weak equivalence.
Then $\Map(Y^\natural,X^\natural) \to \Map(X^\natural,X^\natural)$ is a weak equivalence.
By \rcor{obj-fib}, simplicial sets $\Map(Y^\natural,X^\natural)$ and $\Map(X^\natural,X^\natural)$ are Kan complexes.
Hence for every vertex $v : \Delta^0 \to \Map(X^\natural,X^\natural)$ there exists a vertex $u : \Delta^0 \to \Map(Y^\natural,X^\natural)$
such that $\Delta^0 \overset{u}\to \Map(Y^\natural,X^\natural) \to \Map(X^\natural,X^\natural)$ is homotopic to $v$.
Since vertices of $\Map(A,B)$ classify maps $\Hom(A,B)$, we can take the vertex $\Delta^0 \to \Map(X^\natural,X^\natural)$ that classifies the identity morphism,
to obtain a map $g : Y^\natural \to X^\natural$ and a homotopy $h : S(\Delta^1)^\sharp \times X^\natural \to X^\natural$ between $g \circ f$ and $id$.
Now, consider the following diagram:
\[ \xymatrix{ \partial \Delta^1 \ar[d] \ar[r] & \Map(Y^\natural,Y^\natural) \ar[d] \\
              \Delta^1 \ar[r] & \Map(X^\natural,Y^\natural)
            } \]
where the top map classifies maps $f \circ g$ and $id$, and the bottom map is $f \circ h$.
Since the right map is a weak equivalence between fibrant objects, there exists a homotopy $h' : S(\Delta^1)^\sharp \times Y^\natural \to Y^\natural$ between $f \circ g$ and $id$.
Thus $U(f)$ is a homotopy equivalence.

Now, assume that $U(f)$ is a weak equivalence.
Factor $f$ as a cofibration $g : X^\natural \to Z$ followed by a map $h : Z \to Y^\natural$ that has RLP with respect to $\I$.
By \rcor{iinj}, $h$ is a weak equivalence.
Thus by 2-out-of-3 property, we just need to show that $g$ is a weak equivalence.
Since $U(g)$ is a trivial cofibration and $U(Z)$ is fibrant object, there exists a retraction $g' : U(Z) \to U(X)$ of $U(g) : U(X) \to U(Z)$.
To prove that $g'$ lifts to a morphism of \K-marked simplicial sets, we just need to show that for every limit cone $k : \Delta^0 \join K \to U(Z)$, $g' \circ k'$ is also a limit cone.
But $g'$ is a weak equivalence by 2-out-of-3 property, so it preserves limit cones.
Thus we have maps $g : X^\natural \to Z$ and $g'' : Z \to X^\natural$ such that $U(g'' \circ g)$ and $U(g \circ g'')$ are homotopic to identity morphisms.
By \rprop{hom-we}, $g$ is a weak equivalence.
\end{proof}

Let $\J$ be the set which consists of the following maps:
\begin{enumerate}
\item For every $0 < i < n$, inclusions $(\Lambda^n_i)^\flat \to (\Delta^n)^\flat$.
\item For every $K \in \mathcal{K}$, maps $K^\flat \to (\Delta^0 \join K, \{ id : \Delta^0 \join K \to \Delta^0 \join K \})$.
\item For every $n > 0$ and $K \in \mathcal{K}$, maps $(\partial \Delta^n \join K, \{ \Delta^{\{n\}} \join K : \Delta^0 \join K \to \partial \Delta^n \join K \}) \to (\Delta^n \join K, \{ \Delta^{\{n\}} \join K : \Delta^0 \join K \to \Delta^n \join K \})$.
\item For every $K \in \mathcal{K}$, maps $(N(\{ 0 \cong 1 \}) \join K,\{ f_1 \}) \to (N(\{ 0 \cong 1 \}) \join K,\{ f_0, f_1 \})$, where
$\{ 0 \cong 1 \}$ is the groupoid with two objects and a unique isomorphism between them, and
$f_i$ is the map $\Delta^0 \join K \cong N(\{i\}) \join K \to N(\{ 0 \cong 1 \}) \join K$.
% \item For every $K \in \{ \varnothing, \Lambda^2_2 \}$, maps $(S,\{ f_1 \}) \to (S,\{ f_0, f_1 \})$, where
% \[ S = \Delta^1 \join K \amalg_{\Delta^1} N(\{ 0 \cong 1 \}), \]
% $\{ 0 \cong 1 \}$ is the groupoid with two objects and a unique isomorphism between them, and
% $f_i$ is the composite $\Delta^0 \join K \xrightarrow{\Delta^{\{i\}} \join K} \Delta^1 \join K \to S$.
\end{enumerate}

% A map $f : X \to Y$ of \lc-marked simplicial sets is a \emph{weak equivalence} if for

\begin{comment}
\begin{defn}
An \emph{\lcc-marked simplicial set} is an \lc-marked simplicial set $X$ together with a subset of the set of edges $\Delta^1 \to X$.
Edges that belong to this subset will be caled \emph{marked}.
A morphism of \lcc-marked simplicial sets is a map of the underlying \lc-marked simplicial sets that preserves marked edges.
The category of \lcc-marked simplicial sets will be denoted by $\lccsSet$.
\end{defn}
\end{comment}

\begin{comment}
Let $T^a_\Sigma = coe_1 + \sigma + Path + wUA + \Sigma + sq^a_l$.
Quillen adjunction between $\sSet$ and $\Mod{T^a_\Sigma}$ that we constructed in the previous section is not a Quillen equivalence.
Model category $\Mod{T^a_\Sigma}$ should represent the $(\infty,1)$-category of finitely complete $(\infty,1)$-categories (and exact functor),
but $\sSet$ represent the $(\infty,1)$-category of all $(\infty,1)$-categories.
To fix this problem, we define model category $\lcsSet$ which is closely related to $\sSet$ and which is Quillen equivalent to $\Mod{T^a_\Sigma}$.
We will prove later that the fibration category corresponding to $\lcsSet$ is equivalent to the fibration category of finitely complete quasicategories.

We will consider simplicial sets with marked vertices and squares.
This marking is not related to the marking of simplicial sets as defined in \cite{lurie-topos}.
So we will call such simplicial sets \emph{\lc-marked}.
The intention is that marked vertices should be terminal objects and marked squares should be cartesian.
Of course, in general, this may not be the case, but we will construct a model structure on
the category of \lc-marked simplicial sets in which fibrant objects have this property.

The set of generating cofibrations $\lcI$ consists of the following maps:
\begin{enumerate}
\item Inclusions $(\partial \Delta^n)^\flat \to (\Delta^n)^\flat$.
\item Inclusion $\varnothing \to (\Delta^0)^\sharp$.
\item Inclusion $L^\flat \to S$, where $S$ is simplicial set $\Delta^1 \times \Delta^1$ in which only $id : \Delta^1 \times \Delta^1 \to \Delta^1 \times \Delta^1$ is marked,
and $L$ is simplicial set with three vertexes and two nondegenerate edges which looks like this:
\[ \xymatrix{                & \bullet \ar[d] \\
              \bullet \ar[r] & \bullet
            } \]
The map $L^\flat \to S$ is the obvious inclusion.
\end{enumerate}

\begin{prop}
A map $f : X \to Y$ of \lc-marked simplicial sets is a cofibration if and only if the following conditions hold:
\begin{enumerate}
\item $f$ is a monomorphism of simplicial sets.
\item For every vertex or square $x$ of $X$, if $f(x)$ is marked in $Y$, then $x$ is marked in $X$.
\item For every marked square of $Y$ which does not belong to $X$, every nondegenerate simplex of $\Delta^1 \times \Delta^1$,
which is degenerate in $Y$, belongs to $L^\flat$.
\item For every distinct marked squares $y_1$ and $y_2$ of $Y$ at least one of which does not belong to $X$,
every common simplex of $y_1$ and $y_2$ belongs to $L^\flat$.
\end{enumerate}
\end{prop}

Let $X$ be a model of some theory $T$.
Edges of $N(X)$ are classified by maps $\mathfrak{C}(\Delta^1) \to X$, or equivalently by terms $x : A \vdash b : B$.
Squares $\Delta^1 \times \Delta^1 \to N(X)$ are classified by the following data:
types $A,B,C,D \in X_{(ty,0)}$ and terms $f,g,f',g',r \in X_{(tm,1)}$, $h_1,h_2 \in X_{(tm,2)}$ such that $y : B \vdash f : D$, $z : C \vdash g : D$, $x : A \vdash f' : C$, $x : A \vdash g' : B$, $x : A \vdash r : D$,
$x : A, i : I \vdash h_1 : D$, $x : A, i : I \vdash h_2 : D$, $h_1[left] = f[y \repl g']$, $h_1[right] = h_2[right] = r$, and $h_2[left] = g[z \repl f']$.
These data can be depicted in the following diagram (where the top and the bottom triangles correspond to $h_1$ and $h_2$ respectively):
\[ \xymatrix{ A \ar[r]^{g'} \ar[d]_{f'} \ar[rd]^r & B \ar[d]^f \\
              C \ar[r]_g & D
            } \]

If $T$ is under $T^a_\Sigma$, then $N : \Mod{T} \to \sSet$ factors through the forgetful functor $U : \lcsSet \to \sSet$.
Let the chosen vertex of $N(X)$ be the interval type.
For every $y : B \vdash f : D$ and $z : C \vdash g : D$, the chosen square in $N(X)$ is defined as follows:
$A = \Sigma(y : B, \Sigma(z : C, f \idtype g))$, $f' = (x : A \vdash \pi_1(\pi_2(x)) : C)$, $g' = (x : A \vdash \pi_1(x) : B)$,
$r = (x : A \vdash g[z \repl f'] : D)$, $h_1 = (x : A, y : I \vdash at(\pi_2(\pi_2(x)),y) : D)$, and $h_2 = (x : A, y : I \vdash r : D)$.
We will denote this functor by $\lcN : \Mod{T} \to \lcsSet$.

Functor $\lcN$ has a left adjoint $\lcC : \lcsSet \to \Mod{T}$.
For every $X \in \lcsSet$, $\lcC(X)$ is defined by the same generators and relations as $\mathfrak{C}(X)$
together relations that make chosen cones in $X$ equal to corresponding data in the theory.
Let us give a more explicit description of models of the form $\mathfrak{C}(X)$.
By \cite[Remark~3.4]{alg-models}, elements of $\mathfrak{C}(X)_{(p,n)}$ are equivalence classes of closed terms constructed from function symbols of $T^a_\Sigma$.
The (partial) equivalence relation on the set of terms is generated by a relation $\red$ such that every term has a unique normal form
(that is, for every term $t$, there exists a unique term $t'$ such that $t \red^* t'$ and there is no term $t''$ such that $t' \red t''$).
This implies that there is a bijection between the set of equivalences classes of terms and the set of terms in a normal form.

Relation $\red$ is defined as the minimal relation that is closed under application of function symbols and that contains all axioms in which direction is chosen in the obvious way.

To construct a model structure on $\lcsSet$, we need to prove a few technical lemmas.

\begin{lem}
\end{lem}
\begin{proof}
\end{proof}

\begin{prop}
There is a combinatorial model structure on $\lcsSet$ such that $\lcI$ is a set of generating cofibrations and a map $f$ is a weak equivalence if and only if $\lcC(f)$ is a weak equivalence in $\Mod{T^a_\Sigma}$.
Adjunction $\lcC \dashv \lcN$ is a Quillen equivalence.
\end{prop}
\begin{proof}
By a theorem of Jeff Smith (see, for example, \cite[Proposition~A.2.6.8]{lurie-topos}),
to construct such model structure, it is enough to prove that for every map $f$ in $\lcsSet$ which has RLP with respect to $\lcI$, $\lcC(f)$ is a weak equivalence.
Let $f : X \to Y$ be such a map.
\end{proof}
\end{comment}

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
