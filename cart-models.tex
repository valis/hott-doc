\documentclass[reqno]{amsart}

\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{verbatim}

\hypersetup{colorlinks=true,linkcolor=blue}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{#3~\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\expandafter\newcommand\csname n#2\endcsname[1]{\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{theorem}{Theorem}
\newref{lem}{lemma}{Lemma}
\newref{prop}{proposition}{Proposition}
\newref{cor}{corollary}{Corollary}
\newref{cond}{condition}{Condition}
\newref{conj}{conjecture}{Conjecture}

\theoremstyle{definition}
\newref{defn}{definition}{Definition}
\newref{example}{example}{Example}

\theoremstyle{remark}
\newref{rem}{remark}{Remark}

\newcommand{\red}{\Rightarrow}
\newcommand{\deq}{\equiv}
\newcommand{\repl}{:=}
\newcommand{\idtype}{\rightsquigarrow}

\newcommand{\cat}[1]{\mathbf{#1}}
\newcommand{\C}{\cat{C}}
\newcommand{\Cat}{\cat{Cat}}
\newcommand{\Mod}[1]{#1\text{-}\cat{Mod}}
\newcommand{\Th}{\cat{Th}}
\newcommand{\emptyCtx}{\mathbf{1}}
\newcommand{\Set}{\cat{Set}}
\newcommand{\sSet}{\cat{sSet}}
\newcommand{\qcat}{\cat{qcat}}
\newcommand{\K}{$\mathcal{K}$}
\newcommand{\join}{\star}
\newcommand{\fjoin}{\diamond}
\newcommand{\Hom}{\mathrm{Hom}}
\newcommand{\Map}{\mathrm{Map}}
\newcommand{\Fun}{\mathrm{Fun}}
\newcommand{\colim}{\mathrm{colim}}

\newcommand{\we}{\mathcal{W}}
\newcommand{\I}{\mathrm{I}}
\newcommand{\J}{\mathrm{J}}
\newcommand{\class}[2]{#1\text{-}\mathrm{#2}}
\newcommand{\Icell}[1][\I]{\class{#1}{cell}}
\newcommand{\Icof}[1][\I]{\class{#1}{cof}}
\newcommand{\Iinj}[1][\I]{\class{#1}{inj}}
\newcommand{\Jinj}[1][]{\Iinj[\J#1]}
\newcommand{\Jcell}[1][]{\Icell[\J#1]}
\newcommand{\Jcof}[1][]{\Icof[\J#1]}

\numberwithin{figure}{section}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\begin{document}

\title[Equivalence between quasicategories and models of type theory]{Equivalence between finitely complete quasicategories and models of homotopy type theory with an interval type}

\author{Valery Isaev}

\begin{abstract}
Abstract.
\end{abstract}

\maketitle

\section{Introduction}

\section{Functors between $\sSet$ and $\Mod{T}$}

In this section we define a Quillen adjunction between $\sSet$ and $\Mod{T}$ for every appropriate algebraic dependent type theory $T$.
Recall that $sq_l$ is the theory with the following axioms:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash i : I$}
\AxiomC{$\Gamma \vdash j : I$}
\BinaryInfC{$\Gamma \vdash sq_l(i,j) : I$}
\DisplayProof
\end{center}
\begin{align*}
sq_l(left,j) & = left \\
sq_l(right,j) & = j \\
sq_l(i,left) & = left \\
sq_l(i,right) & = i
\end{align*}
To define functors between $\sSet$ and $\Mod{T}$, we also need to assume that $sq_l$ is associative.
Let $sq^a_l$ be the theory which has the same axioms as $sq_l$ together with the following axiom:
\[ sq_l(sq_l(i,j),k) = sq_l(i,sq_l(j,k)) \]

Let $T$ be any theory under $sq^a_l$.
For every finite nonempty linearly ordered set $J$, we define a model $\mathfrak{C}(\Delta^J)$ of $T$.
It is freely generated by generators and relations described below.
Generators of $\mathfrak{C}(\Delta^J)$ are $O_j : (ty,0)$ for every $j \in J$, and $M_{J'} : (tm,|J'|-1)$ for every subset $J'$ of $J$ such that $|J'| \geq 2$.
For every $j \in J$, $\mathfrak{C}(\Delta^J)$ has relation $\vdash O_j\ type$.
For every $J' = \{ j_1 < \ldots < j_n \} \subseteq J$ such that $n \geq 2$, it has the following relation:
\[ x : O_{j_1}, x_{j_2} : I, \ldots x_{j_{n-1}} : I \vdash M_{J'} : O_{j_n} \]
For every $j \notin J'$ such that $j_1 < j < j_n$, it has the following relations:
\begin{align}
x : O_{j_1}, x_{j_2} : I, \ldots x_{j_{n-1}} : I & \vdash M_{J' \cup \{j\}}[x_j \repl left] \deq M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}] \label{rel:left} \\
x : O_{j_1}, x_{j_2} : I, \ldots x_{j_{n-1}} : I & \vdash M_{J' \cup \{j\}}[x_j \repl right] \deq M_{J'} \label{rel:right}
\end{align}

The idea of this definition is similar to \cite[Definition~1.1.5.1]{lurie-topos}.
For every vertex $j$ of $\Delta^J$, we have a type $O_j$,
and for every $(n+1)$-dimensional face $J'$ of $\Delta^J$, we have an $n$-dimensional cube $M_{J'}$.
Relations describe faces of these cubes.

Let $sq_l(x_1, \ldots x_n) = sq_l(x_1, \ldots sq_l(x_{n-1},x_n) \ldots )$.
In particular, $sq_l(X) = x$ and $sq_l() = right$.
Now, we can extend $\mathfrak{C}$ to a functor $\Delta \to \Mod{T}$.
Let $f : J \to K$ be a monotone map between linearly ordered sets.
Then we define $\mathfrak{C}(f)$ as follows:
\begin{align*}
\mathfrak{C}(f)(O_j) & = O_{f(j)} \\
\mathfrak{C}(f)(M_{J'}) & =
\begin{cases}
    x                                                                  & \text{if } |f(J')| = 1 \\
    M_{f(J')}[\ \ldots\ x_{k_i} \repl sq_l(x_{f^{-1}(k_i)})\ \ldots\ ] & \text{if } |f(J')| > 1 \\
\end{cases}
\end{align*}
where $k_i$ runs from $k_2$ to $k_{m-1}$, $\{ k_1 < \ldots < k_m \} = f(J')$,
and $x_{f^{-1}(k_i)} = x_{j_1}, \ldots x_{j_n}$, $\{ j_1 < \ldots < j_n \} = f^{-1}(k_i)$.

Let us check that $\mathfrak{C}(f)$ preserves relations.
Let $J' = \{ j_1 < \ldots < j_i < j < j_{i+1} < \ldots < j_n \}$ be a subset of $J$, and let $f'$ be the restriction of $f$ to $J'$.
If $|f(J')| = 1$, then $\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) = \mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) = \mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl right]) = \mathfrak{C}(f)(M_{J'}) = x$.
Thus we may assume that $|f(J')| > 1$. 

Let $\rho(x_{f(j_i)}) = sq_l(x_{f'^{-1}(f(j_1))})$ for every $1 \leq i \leq n$ such that $f(j_i) \neq f(j)$.
Let us consider the first relation.
If $f(j) = f(j_1)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) & = \\
M_{f(J')}[\rho] & = \\
M_{\{ f(j), \ldots f(j_n) \}}[\rho][x \repl x] & = \\
\mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) & .
\end{align*}
If $f(j) = f(j_n)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) & = \\
M_{f(J')}[\rho] & = \\
x[x \repl M_{\{f(j_1), \ldots f(j)\}}[\rho]] & = \\
\mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) & .
\end{align*}
If $f(j_1) < f(j) < f(j_n)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl sq_l(x_{f'^{-1}(f(j))}, x_j)][x_j \repl left] & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl left] & = \\
M_{\{f(j), \ldots f(j_n)\}}[x \repl M_{\{f(j_1), \ldots f(j)\}}][\rho] & = \\
\mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) & .
\end{align*}

Let us consider the second relation.
If either $f(j) = f(j_1)$ or $f(j) = f(j_n)$, then $\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl right]) = M_{f(J')}[\rho] = \mathfrak{C}(f)(M_{J'})$.
If $f(j_1) < f(j) < f(j_n)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl right]) & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl sq_l(x_{f'^{-1}(f(j))}, x_j)][x_j \repl right] & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl sq_l(x_{f'^{-1}(f(j))})] & = \\
\mathfrak{C}(f)(M_{J'}) & ,
\end{align*}
If $f(j_i) < f(j) < f(j_{i+1})$, then the last equality holds by \eqref{rel:right},
otherwise it holds immediately by definition of $\mathfrak{C}(f)(M_{J'})$.

Let $[n]$ be the set of natural numbers $\{ 0, \ldots n \}$ with the obvious linear order.
Then $\Delta$ is the full subcategory of linearly ordered sets on objects of the form $[n]$.
It is easy to see that $\mathfrak{C}$ preserves identity morphisms,
and the fact that it preserves compositions follows from associativity of $sq_l$.
Thus we have a functor $\mathfrak{C} : \Delta \to \Mod{T}$.
This functor (uniquely) extends to a colimit-preserving functor $\mathfrak{C} : \sSet \to \Mod{T}$,
which has a right adjoint $N : \Mod{T} \to \sSet$ defined by equation $N(X) = \Hom(\mathfrak{C}(-),X)$.

We can explicitly describe $\mathfrak{C} : \sSet \to \Mod{T}$.
Model $\mathfrak{C}(X)$ is generated by symbols $O_a : (ty,0)$ for every $a \in X_0$, and $M_a : (tm,n)$ for every $a \in X_n$, $n \geq 1$.
For every $a \in X_0$, $\mathfrak{C}(X)$ has relations $\vdash O_a\ type$ and $M_{s_0(a)} = (x : O_a \vdash x : O_a)$.
For every $a \in X_n$, $n \geq 1$, it has the following relation:
\[ x : O_{a|\Delta^{\{0\}}}, x_1 : I, \ldots x_{n-1} : I \vdash M_a : O_{a|\Delta^{\{n\}}} \]
For every $1 \leq j \leq n-1$, it has the following relations:
\begin{align*}
M_a[x_j \repl left] & = M_{a|\Delta^{\{ j, \ldots n \}}}[x \repl M_{a|\Delta^{\{ 0, \ldots j \}}}] \\
M_a[x_j \repl right] & = M_{a|\Delta^{\{0, \ldots j-1, j+1, \ldots n\}}}
\end{align*}
For every $0 \leq j \leq n$, it has the following relation:
\[ M_{s_j(a)} =
\begin{cases}
    M_a[x_1 \repl x_2, \ldots x_{n-1} \repl x_n]                                      & \text{if } j = 0 \\
    M_a[x_j \repl sq_l(x_j,x_{j+1}), x_{j+1} \repl x_{j+2}, \ldots x_{n-1} \repl x_n] & \text{if } 1 \leq j \leq n-1 \\
    M_a                                                                               & \text{if } j = n \\
\end{cases}
\]
For every morphism $f : X \to Y$ of simplicial sets, let $\mathfrak{C}(f)(O_a) = O_{f(a)}$ and $\mathfrak{C}(f)(M_a) = M_{f(a)}$.
It is easy to see that this definition preserves relations, identity morphisms and compositions.

\begin{prop}
Functors $\mathfrak{C} \dashv N$ determine a Quillen adjunction between $\sSet$ with the Joyal model structure and $\Mod{T}$ with the model structure defined in \cite{alg-models}.
\end{prop}
\begin{proof}
Note that $\mathfrak{C}(\partial \Delta^n)$ is isomorphic (over $\mathfrak{C}(\Delta^n)$) to the theory
freely generated by the same generators and relations as $\mathfrak{C}(\Delta^n)$ except for $M_{[n]}$.
Similarly, if $i \in [n]$, then $\mathfrak{C}(\Lambda^n_i)$ is freely generated by the same generators
and relations as $\mathfrak{C}(\partial \Delta^n)$ except for $M_{\{ 0, \ldots i-1, i+1, \ldots n \}}$.

Let us prove that $\mathfrak{C}$ preserves cofibration.
To do this, it is enough to show that $\mathfrak{C}(\partial \Delta^n) \to \mathfrak{C}(\Delta^n)$ is a cofibration for every $n$.
If $n = 0$, then this map equals to $i_{(ty,0)}$.
Suppose that $n > 0$.
First, let us define objects $\square^k$ and $\partial \square^k$.
Let $\square^k = F(\{ x : A, x_1 : I, \ldots x_k : I \vdash b : B \})$,
and let $\partial \square^k$ be freely generated by generators and relations described below.
Generators of $\partial \square^k$ are $A,B : (ty,0)$ and $b_{[i=c]} : (tm,k)$ for every $1 \leq i \leq k$, $c \in \{left,right\}$.
For every $1 \leq i \leq k$ and $c \in \{left,right\}$, it has the following relation:
\[ x : A, x_1 : I, \ldots x_{i-1} : I, x_{i+1} : I, \ldots x_k : I \vdash b_{[i=c]} : B \]
For every $1 \leq i_1 < i_2 \leq k$ and $c,c' \in \{left,right\}$, it has the following relation:
\[ b_{[i_2=c']}[x_{i_1} \repl c] = b_{[i_1=c]}[x_{i_2} \repl c'] \]

Map $i^k : \partial \square^k \to \square^k$ is defined in the obvious way: $i^k(b_{[i=c]}) = b[x_i \repl c]$.
Let $v : \square^{n-1} \to \mathfrak{C}(\Delta^n)$ be defined as follows: $v(A) = O_0$, $v(B) = O_n$, $v(b) = M_{[n]}$.
Map $v \circ i^k$ factors through $\mathfrak{C}(\partial \Delta^n) \to \mathfrak{C}(\Delta^n)$, and the following square is cocartesian:
\[ \xymatrix{ \partial \square^{n-1} \ar[r] \ar[d]_{i^k} & \mathfrak{C}(\partial \Delta^n) \ar[d] \\
              \square^{n-1} \ar[r]_v & \mathfrak{C}(\Delta^n)
            } \]
Thus we just need to show that $i^k$ is a cofibration.
But it is a pushout of $i_{(tm,1)} : F(\{ x : A \vdash B\ type \}) \to F(\{ x : A \vdash b : B \})$.
Indeed, let $v' : F(\{ x : A \vdash b : B \}) \to \square^k$ be defined as follows: $v'(b) = path(x_1.\,\ldots path(x_n.\,b) \ldots)$ and $v'(B)$ equals to
\begin{align*}
Path(x_1.\, \ldots Path(x_{n-2}.\, & Path(x_{n-1}.\,     Path(x_n.\,B, b[x_n \repl left], b[x_n \repl right]), \\
                                   & \qquad \qquad \quad path(x_n.\,b[x_{n-1} \repl left]), \\
                                   & \qquad \qquad \quad path(x_n.\,b[x_{n-1} \repl right])), \\
                                   & path(x_{n-1}.\,     path(x_n.\,b[x_{n-2} \repl left])), \\
                                   & path(x_{n-1}.\,     path(x_n.\,b[x_{n-2} \repl right]))) \ldots )
\end{align*}
Then $v' \circ i_{(tm,1)}$ factors through $i^k$, and the following square is cocartesian:
\[ \xymatrix{ F(\{ x : A \vdash B\ type \}) \ar[r] \ar[d]_{i_{(tm,1)}} & \partial \square^k \ar[d]^{i^k} \\
              F(\{ x : A \vdash b : B \}) \ar[r]_-{v'} & \square^k
            } \]

Now, let us prove that for every $X \in \Mod{T}$, $N(X)$ is fibrant.
Since fibrant objects in $\sSet$ are precisely quasicategories,
it is enough to show that $\mathfrak{C}(\Lambda^n_i) \to \mathfrak{C}(\Delta^n)$ is a trivial cofibration for every inner horn $\Lambda^n_i \to \Delta^n$.
First, for every $1 \leq i \leq k$, let $\sqcap^k_i$ be the object defined by the same generators and relations as $\partial \square^k$ except for $b_{[i=right]}$.
Then we have the following cocartesian square:
\[ \xymatrix{ \sqcap^{n-1}_i \ar[r] \ar[d] & \mathfrak{C}(\Lambda^n_i) \ar[d] \\
              \partial \square^{n-1} \ar[r] & \mathfrak{C}(\partial \Delta^n)
            } \]

Since $\sqcap^k_i \to \square^k$ is a cofibration, we just need to show that it is a weak equivalence.
Note that $\sqcap^k_i \to \square^k$ is isomorphic to $\sqcap^k_k \to \square^k$ for every $1 \leq i \leq k$.
Indeed, we can define isomorphism $g : \square^k \to \square^k$ as $g(b) = b[x_i \repl x_k, x_k \repl x_i]$
and isomorphism $f : \sqcap^k_i \to \sqcap^k_k$ as $f(b_{[i=left]}) = b_{[k=left]}[x_i \repl x_k]$, $f(b_{[k=c]}) = b_{[i=c]}[x_k \repl x_i]$,
and $f(b_{[j=c]}) = b_{[j=c]}[x_i \repl x_k, x_k \repl x_i]$ for every $j \neq i,k$.
Then $f$ and $g$ commute with $\sqcap^k_i \to \square^k$ and $\sqcap^k_k \to \square^k$.
Thus we just need to prove that $\sqcap^k_k \to \square^k$ is a weak equivalence.

Note that $\square^{k+1}$ is a (relative) cylinder object for $F(\{ A : (ty,0), B : (ty,0) \}) \to \square^k$.
Indeed, $\square^k \amalg_{F(\{ A : (ty,0), B : (ty,0) \})} \square^k \to \square^{k+1}$ is a cofibration,
and $\square^k \to \square^{k+1}$ is a weak equivalence since it is a pushout of
a generating trivial cofibration $F(\{ \Gamma \vdash b : B \}) \to F(\{ \Gamma, y : I \vdash h : B \})$.

Every object has RLP with respect to $\sqcap^k_k \to \square^k$ (see \cite[Section~2.4]{alg-models}).
In particular, $\sqcap^k_k \to \square^k$ has a retract $\square^k \to \sqcap^k_k$.
The composite map $\square^k \to \sqcap^k_k \to \square^k$ is homotopic to $id$.
To show this, we just need to construct an appropriate map $\square^{k+1} \to \square^k$,
which is easy to do using filler operations from \cite[Section~2.4]{alg-models}.
Thus $\sqcap^k_k \to \square^k$ is a homotopy equivalence.

Finally, let us prove that if $f : X \to Y$ is a fibration in $\Mod{T}$, then $N(f)$ is a fibration in $\sSet$.
Since $N(Y)$ is fibrant, by \cite[Corollary~2.4.6.5]{lurie-topos}, we just need to prove the following conditions:
\begin{enumerate}
\item $N(f)$ is an inner fibration.
\item For every object $A$ of $N(X)$ and every equivalence $p : N(f)(A) \to B$ in $N(Y)$, there exists an equivalence $p' : A \to B'$ in $N(X)$ such that $N(f)(p') = p$.
\end{enumerate}
The first condition follows from the fact that maps $\mathfrak{C}(\Lambda^n_i) \to \mathfrak{C}(\Delta^n)$ are trivial cofibrations.
The second condition can be reformulated as follows: for every closed type $A$ of $X$ and every equivalence $p : f(A) \to B$ in $Y$,
there exists an equivalence $p' : A \to B'$ in $X$ such that $f(p') = p$.
But this follows from the fact that $f$ has RLP with respect to $\J_{\I_{ty}}$.
\end{proof}

\section{Category of marked objects}
\label{sec:marked}

In this section for every combinatorial model category $\C$, we define a new model category $\C^m$ of marked objects of $\C$.
This model category is usually not useful by itself.
The idea is that we should take a left Bousfield localization of $\C^m$ to obtain an interesting model category.
We will show examples of this construction in the next section.

\begin{defn}
Let $\C$ be a category, let $\mathcal{K}$ be a small category, and let $\mathcal{F} : \mathcal{K} \to \C$ be a functor.
A \emph{\K-marked object} of $\C$ is a pair $(X,\mathcal{E})$ where $X$ is an object of $\C$ and $\mathcal{E} : \mathcal{K}^{op} \to \Set$ is a subfunctor of $\Hom(\mathcal{F}(-),X)$.
Morphisms $f : \mathcal{F}(K) \to X$ that belong to $\mathcal{E}$ will be caled \emph{marked}.
A morphism of marked objects is a morphism of the underlying objects that preserves marked morphisms.
The category of marked objects will be denoted by $\C^m$.
\end{defn}

We will sometimes omit mention of $\mathcal{F}$ and identify an object $K$ of $\mathcal{K}$ with its image in $\C$.

Let $S$ be a set of maps of the form $\mathcal{F}(K) \to X$.
Then we will write $GS : \mathcal{K}^{op} \to \Set$ for the subfunctor of $\Hom(\mathcal{F}(-),X)$ generated by $S$.
A map $f : \mathcal{F}(K) \to X$ belongs to $GS$ if and only if it factors as $\mathcal{F}(K) \xrightarrow{\mathcal{F}(k)} \mathcal{F}(K') \xrightarrow{f'} X$
for some $k : K \to K'$ and some $f' \in S$.

Forgetful functor $U : \C^m \to \C$ has a left adjoint $(-)^\flat : \C \to \C^m$ and a right adjoint $(-)^\sharp : \C \to \C^m$.
For every $X \in \C$, $X^\flat$ is the marked object in which no morphisms are marked (that is, $X^\flat = (X,\varnothing)$),
and $X^\sharp$ is the marked object in which all morphisms are marked (that is, $X^\sharp = (X,\coprod_{K \in \mathcal{K}} \Hom(K,X))$).
Objects of the form $X^\flat$ and of the form $X^\sharp$ will be called \emph{flat} and \emph{sharp} respectively.

Category $\C^m$ has the same limits and colimits as $\C$.
Let $D : J \to \C^m$ be a diagram.
Then underlying objects of $\lim(D)$ and $\colim(D)$ are a limit and a colimit of underlying objects in $\C$ respectively.
Morphism $K \to \lim(D)$ is marked if and only if morphism $K \to \lim(D) \to D_j$ is marked for every $j \in J$.
Morphism $K \to \colim(D)$ is marked if and only if it factors through some marked morphism $K \to D_j$.

\begin{prop}[mark-comb]
If $\C$ is locally presentable, then so is $\C^m$.
\end{prop}
\begin{proof}
First, let us prove that there exists a set of objects $S^m$ of $\C^m$ which generates the whole category under colimits.
Let $\lambda$ be a regular cardinal such that $\C$ is locally $\lambda$-presentable and for every $K \in \mathcal{K}$, $\mathcal{F}(K)$ is $\lambda$-presentable.
Let $S$ be a set of objects of $\C$ such that every object of $X$ is a $\lambda$-filtered colimit of objects from $S$.
Note that for every object $X$ of $\C$, there is only a set of marked objects $Y$ such that $U(Y) = X$.
Let $S^m$ be the set of objects $Y$ such that $U(Y) \in S$.
Let $X$ be a marked object, and let $D : J \to \C$ be a $\lambda$-filtered diagram such that $\colim(D) = U(X)$.
Then define diagram $D' : J \to \C^m$ so that $U(D'_j) = D_j$ and $f : K \to D_j$ is marked if and only if $K \xrightarrow{f} D_j \to \colim(D) = U(X)$ is marked.
To prove that $\colim(D') = X$, we need to show that $f : K \to U(X)$ is marked in $X$ only if it factors through some $D_j \to U(X)$.
But this follows from the fact that $D$ is $\lambda$-filtered and $K$ is $\lambda$-presentable.

Now, let us prove that every object of $\C^m$ is small.
Let $(X,\mathcal{E})$ be a marked object, and let $\lambda$ be a regular cardinal such that
for every $K \in \mathcal{K}$, $\mathcal{F}(K)$ is $\lambda$-presentable, $X$ is $\lambda$-presentable, and $|\mathcal{E}| < \lambda$.
Let $D : J \to \C^m$ be a $\lambda$-filtered diagram.
It is easy to see that $\colim_{j \in J} \Hom((X,\mathcal{E}), D_j) \to \Hom((X,\mathcal{E}), \colim_{j \in J} D_j)$ is injective.
Let us show that it is surjective.
Let $f : (X,\mathcal{E}) \to \colim_{j \in J} D_j$ be a map of marked objects.
Then $U(f)$ factors as $X \xrightarrow{g} U(D_j) \to \colim_{j \in J} U(D_j)$ for some $j$.
By the description of colimts that we gave above, for every marked $k : K \to X$, map $U(f) \circ k$ factors through some marked $h_k : K \to U(D_k)$.
Since $K$ is $\lambda$-presentable and maps $K \xrightarrow{h_k} U(D_k) \to \colim_{j \in J} U(D_j)$
and $K \xrightarrow{k} X \xrightarrow{g} U(D_j) \to \colim_{j \in J} U(D_j)$ are equal,
there exists an object $D'_k$ and maps $D_j \to D'_k$ and $D_k \to D'_k$ in the diagram such that
$K \xrightarrow{h_k} U(D_k) \to U(D'_k)$ and $K \xrightarrow{k} X \xrightarrow{g} U(D_j) \to U(D'_k)$ are also equal.
In particular, $K \xrightarrow{k} X \xrightarrow{g} U(D_j) \to U(D'_k)$ is marked.
Finally, since $D$ is $\lambda$-filtered and $|\mathcal{E}| < \lambda$, there exists an object $D_i$ together with maps $D'_k \to D_i$ for every $k$.
For every $k : K \to X$, map $K \xrightarrow{k} X \xrightarrow{g} U(D_j) \to U(D_i)$ is marked.
Hence $X \xrightarrow{g} U(D_j) \to U(D_i)$ is a morphism of marked objects.
Thus $f : (X,\mathcal{E}) \to \colim_{j \in J} D_j$ factors through $D_i \to \colim_{j \in J} D_j$.
\end{proof}

Now, we assume that there is a structure of a model category on $\C$ such that every object in $\mathcal{K}$ is cofibrant.
We will say that a map $f : X \to Y$ of marked objects is a \emph{cofibration} if and only if $U(f)$ is a cofibration in $\C$. 
\begin{prop}
If $\I$ is a set of generating cofibrations of $\C$, then cofibrations of $\C^m$ are generated by the set $\I^m$ which consists of the following maps:
\begin{enumerate}
\item Map $i^\flat$ for every $i \in \I$.
\item Map $K^\flat \to (K, G \{ id : K \to K \})$ for every $K \in \mathcal{K}$.
\end{enumerate}
\end{prop}
\begin{proof}
Since every map in $\I^m$ is a cofibration and $U$ preserves colimits, $\Icof[\I^m]$ consists of cofibrations.
Let us show that every cofibration $f : X \to Y$ belongs to $\Icof[\I^m]$.
First, assume that $U(f)$ is an isomorphism.
Then $f$ is the following pushout:
\[ \xymatrix{ \coprod\limits_\mathcal{E} K^\flat \ar[r] \ar[d] & X \ar[d] \\
              \coprod\limits_\mathcal{E} (K, G \{id\}) \ar[r] & \po Y,
            } \]
where $\mathcal{E}$ is the set of marked maps of $Y$.

Now, assume that $U(f)$ is a relative $\Icell$ complex.
Then it is a transfinite composition $X_0 \to X_\lambda$, where for each $\alpha$, $X_\alpha \to X_{\alpha+1}$ is a pushout of a map $U_\alpha \to V_\alpha$ from $\I$.
We define a transfinite sequence $X = X'_0 \to \ldots \to X'_\lambda$ such that $U(X'_\alpha \to X'_\beta)$ equals to $X_\alpha \to X_\beta$ for every $\alpha$ and $\beta$.
Map $X'_\alpha \to X'_{\alpha+1}$ is defined as a pushout of $U^\flat_\alpha \to V^\flat_\alpha$.
Then $f$ factors as $X \to X'_\lambda \xrightarrow{g} Y$ so that $U(g)$ is an isomorphism.
Hence $f$ is a relative $\Icell[\I^m]$ complex.

Finally, in the general case, $U(f)$ is a retract of a relative $\Icell$ complex $U(X) \to Z$.
Let $Z'$ be the marked object such that $U(Z') = Z$ and $K \to Z$ is marked if and only if it factors through $Y \to Z$.
Then $f$ is a retract of $X \to Z'$.
Hence $f$ belongs to $\Icof[\I^m]$.
\end{proof}

Let us define fibrant replacement functor $R^m$ for $\C^m$.
Let $R : \C \to \C$, $t_X : X \to R(X)$ be a fibrant replacement functor for $\C$.
For every marked $X$, underlying object of $R^m(X)$ is $R(U(X))$, and a map $K \to R(U(X))$ is marked if and only if
it is homotopic to a map that factors as $K \to U(X) \xrightarrow{t_{U(X)}} R(U(X))$, where the first map is marked.

We will say that a map $f$ of marked objects is a \emph{weak equivalence}
if and only if the underlying map of $f$ is a weak equivalence and $R^m(f)$ reflects marked maps.
Unfolding the definition of $R^m$, we obtain the following characterization of weak equivalences.
A map $f : (X,\mathcal{E}_X) \to (Y,\mathcal{E}_Y)$ of marked objects is a weak equivalence if and only if $U(f)$ is a weak equivalence,
and for every $h : K \to R(X)$ and every marked $k : K \to Y$ such that $R(U(f)) \circ h$ and $t_{Y} \circ k$ are homotopic,
there exists a marked map $k' : K \to X$ such that $t_X \circ k'$ and $h$ are homotopic:
\[ \xymatrix{                                          & X \ar[r]^{t_X} \ar@{}[d]|(.35){\sim} \ar@{}[dr]_(.6){\sim} & R(X) \ar[d]^{R(U(f))} \\
              K \ar[r]_k \ar[urr]_h \ar@{-->}[ur]^{k'} & Y \ar[r]_{t_Y}                                             & R(Y)
            } \]

Since $R(U(f))$ is a weak equivalence between fibrant objects, $t_X \circ k'$ and $h$ are homotopic
if and only if $t_Y \circ U(f) \circ k'$ and $t_Y \circ k$ are homotopic.
This implies that every map $f \in \Iinj[\I^m]$ is a weak equivalence since we have a lift in the following diagram:
\[ \xymatrix{                                            & (X,\mathcal{E}_X) \ar[d]^f \\
              (K, G \{id\}) \ar[r]_-k \ar@{-->}[ur]^{k'} & (Y,\mathcal{E}_Y)
            } \]

Let $f : (X,\mathcal{E}_X) \to (Y,\mathcal{E}_Y)$ be a cofibration of marked objects such that $U(f)$ is a weak equivalence.
Then $t_X : X \to R(X)$ factors as $X \xrightarrow{U(f)} Y \xrightarrow{g} R(X)$ for some map $g$.
We prove that $f$ is a weak equivalence if and only if for every marked $k : K \to Y$, there exists a marked $k' : K \to X$ such that $g \circ k$ and $t_X \circ k'$ are homotopic:
\[ \xymatrix{                                                  & X \ar[r]^-{t_X} & R(X) \\
              K \ar[r]_k \ar@{-->}[ur]^{k'} \ar@{}[urr]|{\sim} & Y \ar[ur]_g
            } \]

First, assume that $f$ satisfies this condition.
Let $k : K \to Y$ be a marked map.
Then there exists a marked map $k' : K \to X$ such that $t_X \circ k'$ is homotopic to $g \circ k$.
Since $U(f)$ is a trivial cofibration, $R(U(f)) \circ g$ is homotopic to $t_Y$.
Hence $R(U(f)) \circ t_X \circ k' = t_Y \circ U(f) \circ k'$ is homotopic to $t_Y \circ k$.
Conversely, suppose that $f$ is a weak equivalence.
Let $k : K \to Y$ be a marked map.
Since $R(U(f)) \circ g \circ k$ is homotopic to $t_Y \circ k$, there exists a marked map $k' : K \to X$ such that $t_X \circ k'$ is homotopic to $g \circ k$.

Using this characterization of trivial cofibrations, we can prove that they are closed under pushout and transfinite compositions.
First, let us prove the latter.
Let $X_0 \to X_\lambda$ be a transfinite composition of a sequence $X : \lambda \to \C^m$.
Let $k : K \to U(X_\lambda)$ be a marked map.
Then it factors through some marked map $k' : K \to U(X_\alpha)$.
Since $X_0 \to X_\alpha$ is a trivial cofibration, there exists a marked map $k'' : K \to U(X_0)$
such that $t_{U(X_0)} \circ k''$ is homotopic to $U(X_\alpha) \to U(X_\lambda) \to R(U(X_0))$.

Now, let us prove that trivial cofibrations are closed under pushouts.
Let $f : (X,\mathcal{E}_X) \to (Y,\mathcal{E}_Y)$ be a trivial cofibration,
and let $(Z,\mathcal{E}_Z) \to (T,\mathcal{E}_T)$ be a pushout of $f$.
Let $k : K \to T$ be a marked map.
Then $k$ factors through either $Z$ or $Y$.
If $k$ factors through $Z$, then this gives us the required lifting immediately.
If $k$ factors through a marked map $K \xrightarrow{k'} Y$, then there exists a marked map $k'' : K \to X$
such that $t_X \circ k''$ is homotopic to $g \circ k'$, where $g : Y \to R(X)$ is such that $t_X = g \circ U(f)$:
\[ \xymatrix{ \ar@{}[rdd]_(0.6){\sim}           & X \ar[r] \ar[d]^{U(f)} & Z \ar[d] \\
              K \ar[d]_{k'} \ar@{-->}[ur]^{k''} & Y \ar[r] \ar[d]^g      & \po T \ar[d]^{g'} \\
              Y \ar[r]_-g                       & R(X) \ar[r]            & R(Z)
            } \]
Since $t_X$ is a trivial cofibration and $R(Z)$ is fibrant, there exists a map $R(X) \to R(Z)$.
Then there exists a (unique) map $g' : T \to R(Z)$ such that the diagram above commutes and $Z \to T \xrightarrow{g'} R(Z)$ equals to $t_Z$.
We can define the required map as $K \xrightarrow{k''} X \to Z$.
Then $K \xrightarrow{k''} X \to Z \xrightarrow{t_Z} R(Z)$ is homotopic to $K \xrightarrow{k} T \xrightarrow{g'} R(Z)$.

To construct a model structure on $\C^m$, we will need the following theorem by Jeff Smith (see, for example, \cite[Proposition~A.2.6.8]{lurie-topos}):
\begin{thm}[mod-comb]
Let $\C$ be a locally presentable category, let $\I$ be a set of maps of $\C$, and let $\we$ be a class of maps of $\C$.
Suppose that the following conditions hold:
\begin{enumerate}
\item The intersection $\Icof \cap \we$ is closed under pushouts and transfinite compositions.
\item The full subcategory $\we$ of the category of arrows of $\C$ is accessible subcategory.
\item The class $\we$ has the 2-out-of-3 property.
\item $\Iinj \subseteq \we$.
\end{enumerate}
Then there exists a cofibrantly generated model structure on $\C$ with $\Icof$ as the class of cofibrations and $\we$ as the class of weak equivalences.
\end{thm}

We will also need the following theorem (see, for example, \cite{hovey}):
\begin{thm}[mod-cof]
Suppose that $\C$ is a complete and cocomplete category, $\we$ is a class of morphisms of $\C$, and $\I$, $\J$ are sets of morphisms of $\C$.
Then $\C$ is a cofibrantly generated model category with $\I$ as the set of generating cofibrations,
$\J$ as the set of generating trivial cofibrations, and $\we$ as the class of weak equivalences if and only if the following conditions are satisfied:
\begin{enumerate}
\item The domains of $\I$ and $\J$ are small relative to $\Icell$.
\item $\we$ has 2-out-of-3 property and is closed under retracts.
\item $\Iinj \subseteq \we$.
\item $\Jcell \subseteq \we \cap \Icof$.
\item Either $\Jinj \cap \we \subseteq \Iinj$ or $\Icof \cap \we \subseteq \Jcof$.
\end{enumerate}
\end{thm}

Now, we can prove the main theorem of this section:

\begin{thm}[mark-main]
Let $\C$ be a model category, and let $\mathcal{K}$ be a multiset of cofibrant objects of $\C$.
Suppose that one of the following conditions hold:
\begin{enumerate}
\item \label{it:comb} $\C$ is a combinatorial model category.
\item \label{it:fib} Every object of $\C$ is fibrant and there exists a set $\I$ of generating cofibrations such that
the domains and the codomains of maps in $\I$ are small relative to $\Icell$.
\end{enumerate}
Then there exists a cofibrantly generated model structure on $\C^m$.
A marked object $X$ is fibrant in $\C^m$ if and only if the underlying object $U(X)$ is fibrant in $\C$ and marked maps in $X$ are stable under homotopy
(that is, if two maps $K \to U(X)$ are homotopic and one of them is marked, then so is the other).
Both adjoint pairs $(-)^\flat \dashv U$ and $U \dashv (-)^\sharp$ are Quillen pairs.
If $\C$ is left proper, then so is $\C^m$.
\end{thm}
\begin{proof}
We already proved that every map in $\Iinj[\I^m]$ is a weak equivalence and that trivial cofibrations are stable under pushouts and transfinite compositions.
It is easy to see that weak equivalences are closed under retracts.
Let us prove that the class of weak equivalences has 2-out-of-3 property.
Let $f : X \to Y$ and $g : Y \to Z$ be maps of marked objects such that $U(f)$ and $U(g)$ are equivalences.
If $R^m(f)$ and $R^m(g)$ reflect marked maps, then so is $R^m(g \circ f)$.
If $R^m(g \circ f)$ reflects marked maps, then so is $R^m(f)$.
Let us prove that if $R^m(g \circ f)$ reflects marked maps, then so is $R^m(g)$.
Let $k : K \to R(U(Y))$ be a map such that $R(U(g)) \circ k$ is marked.
Since $K$ is cofibrant and $R(U(f))$ is a weak equivalence between fibrant objects,
there exists a map $k' : K \to R(U(X))$ such that $R(U(f)) \circ k'$ is homotopic to $k$.
Since $R(U(g)) \circ k$ and $R(U(g \circ f)) \circ k'$ are homotopicc and $R(U(g)) \circ k$ is marked, $R(U(g \circ f)) \circ k'$ is also marked.
Since $g \circ f$ reflects marked maps, $k'$ is marked.
Since $R(U(f)) \circ k'$ and $k$ are homotopic and $R(U(f)) \circ k'$ is marked, $k$ is also marked.

Assume that \eqref{it:comb} holds.
By \rprop{mark-comb}, $\C^m$ is locally presentable.
By \rthm{mod-comb}, we just need to prove that the class of weak equivalences is an accessible subcategory of $\C^m$.
Let $\J$ be a set of generating trivial cofibrations in $\C$.
Then we can take $R$ to be the functor obtained form the small object argument for $\J$.
Let $\J_\mathcal{K}$ be the set of maps $(C(K), G \{i_0\}) \to (C(K), G \{i_0,i_1\})$ for every $K \in \mathcal{K}$, where $[i_0,i_1] : K \amalg K \to C(K)$ is a cylinder object for $K$.
Then $R^m$ can be described as the composition of two functors $R_1$ and $R_2$.
The former is obtained from the small object argument for $\J^\flat$ and the latter from the small object argument for $\J_\mathcal{K}$.
Thus $R^m$ preserves $\kappa$-filtered colimits for some regular cardinal $\kappa$.

Let $\C^m_0$ be the full subcategory of the arrow category of $\C^m$ on maps $f$ such that $U(f)$ is a weak equivalence and $f$ reflects marked maps.
Since $R^m$ preserves $\kappa$-filtered colimits, by \cite[Corollary~A.2.6.5]{lurie-topos},
to prove that the class of weak equivalences is an accessible subcategory of $\C^m$,
we just need to show that $\C^m_0$ is closed under $\kappa$-filtered colimits.
But this is obvious if we take $\kappa$ such that the class of weak equivalences in $\C$
is closed under $\kappa$-filtered colimits and every object in $\mathcal{K}$ is $\kappa$-presentable.

Now, assume that \eqref{it:fib} holds.
By \cite[Corollary~3.2]{f-model-structures}, there exists a set $\J_\I$ of generating trivial cofibrations for $\C$.
Then $\J^m = \J_\I^\flat \cup \J_\mathcal{K}$ is a set of generating trivial cofibrations for $\C^m$.
Indeed, every map in $\J^m$ is cofibration and a weak equivalence.
Every map in $\J_\I^\flat$ is a weak equivalence since its underlying map is a weak equivalence and its codomain is flat, so $R^m(f) = R(f)^\flat$.
Every map $f$ in $\J_\mathcal{K}$ is a weak equivalence since $R^m(f)$ is an isomorphism.

By \rthm{mod-cof}, we just need to prove that every weak equivalence that has RLP with respect to $\J^m$ also has RLP with respect to $\I^m$.
Let $f$ be such a map.
Since $U(f)$ is a weak equivalence and a fibration, it has RLP with respect to $\I$.
Hence $f$ has RLP with respect to $\I^\flat$.
Since every object of $\C$ is fibrant, we can take $R$ to be the identity functor.
Let $k : K \to U(X)$ be a map such that $U(f) \circ k$ is marked.
Since $f$ is a weak equivalence, there exists a marked map $k' : K \to U(X)$ such that $U(f) \circ k'$ is homotopic to $U(f) \circ k$.
Since $U(f)$ is a weak equivalence between fibrant objects, this implies that $k'$ is homotopic to $k$.
Since $f$ has RLP with respect to $\J_\mathcal{K}$, $k'$ and $U(f) \circ k$ are marked, $k$ is also marked.
Thus $f$ has RLP with respect to $K^\flat \to (K, G \{id\})$ for every $K \in \mathcal{K}$.

Since $\J_\mathcal{K}$ are trivial cofibrations, for every fibrant marked object $X$, marked maps in $X$ are stable under homotopy.
Conversely, let $Z$ be a marked object such that $U(Z)$ is fibrant and maps in $Z$ are stable under homotopy.
Let $f : X \to Y$ be a trivial cofibration, and let $g : X \to Z$ be a map.
Since $U(Z)$ is fibrant, $U(g)$ factors through $t_{U(X)}$:
\[ \xymatrix{ U(X) \ar[r]^-{t_{U(X)}} \ar[d]_{U(f)} & R(U(X)) \ar[r] & U(Z) \\
              U(Y) \ar@{-->}[ur]_h
            } \]

Since $U(f)$ is a trivial cofibration, there exists a lift $h : U(Y) \to R(U(X))$ in the diagram above.
We just need to prove that $U(Y) \xrightarrow{h} R(U(X)) \to U(Z)$ preserves marked maps.
Since $U(f)$ is a trivial cofibration, for every marked $k : K \to U(Y)$, there exists a marked $k' : K \to U(X)$
such that $t_{U(X)} \circ k'$ and $h \circ k$ are homotopic.
Since marked maps in $Z$ are stable under homotopy equivalence and the composite $K \xrightarrow{k'} U(X) \xrightarrow{t_{U(X)}} R(U(X)) \to U(Z)$ is marked,
so is the composite $K \xrightarrow{k} U(Y) \xrightarrow{h} R(U(X)) \to U(Z)$.
So $U(Y) \xrightarrow{h} R(U(X)) \to U(Z)$ preserves marked maps.

Functor $U$ preserve cofibrations and weak equivalences by definition.
Functor $(-)^\flat$ also preserves cofibrations and weak equivalences since it sends objects to flat marked objects.
Thus both adjoint pairs of functors $(-)^\flat \dashv U$ and $U \dashv (-)^\sharp$ are Quillen adjunctions.

Finally, let us prove that if $\C$ is left proper, then so is $\C^m$.
Let $Z \to T$ be a pushout of a weak equivalence $f : X \to Y$ along a cofibration.
We may assume that $f$ is a trivial fibration.
Let $k : K \to U(T)$ be a marked map.
Then it factors through either $U(Z)$ or $U(Y)$.
In the first case, we obtained the required lift immediately.
In the second case, we have a marked map $k' : K \to U(Y)$.
Since $f : X \to Y$ is a trivial fibration, $k'$ lifts to a marked map $K \to U(X)$.
\end{proof}

Since we often want to localize the model category of marked object, it is useful to have a simple description of homotopy function complexes.
Let $X$ and $Y$ be a pair of marked objects such that $X$ is cofibrant and $Y$ is fibrant.
Let $QU(X)^\bullet$ be a cosimplicial frame on $U(X)$.
Then vertices of the Kan complex $\Map(U(X),U(Y)) = \Hom(QU(X)^\bullet,U(Y))$ can be identified with maps $U(X) \to U(Y)$.
We will denote this bijection by $e : \Hom(\Delta^0,\Map(U(X),U(Y))) \simeq \Hom(U(X),U(Y))$.

Let $x$ and $y$ be a pair of vertices of $\Map(U(X),U(Y))$ that belongs to the same component.
If $e(x) : U(X) \to U(Y)$ lifts to a map of marked objects, then so does the map $e(y)$.
Indeed, there exists an edge $\Delta^1 \to \Map(U(X),U(Y))$ between $x$ and $y$.
But such an edge corresponds to a homotopy between $e(x)$ and $e(y)$.
Since $Y$ is fibrant and $e(x)$ preserves marked maps, so does every map homotopic to $e(x)$.

Let $\Map(X,Y)$ be the Kan subcomplex of $\Map(U(X),U(Y))$ which consists of those components of
$\Map(U(X),U(Y))$ in which some (and hence every) vertex corresponds to a map $U(X) \to U(Y)$ that lifts to a map of marked objects.

\begin{lem}[mark-map]
Kan complex $\Map(X,Y)$ is equivalent to the homotopy function complex from $X$ to $Y$.
\end{lem}
\begin{proof}
We may assume that $QU(X)^\bullet$ is a fibrant cosimplicial frame on $U(X)$.
Then we can define a fibrant cosimplicial frame $QX^\bullet$ on $X$ as $(QU(X)^\bullet,\mathcal{E})$,
where $\mathcal{E}$ consists of those maps $K \to QU(X)^\bullet$ such that $K \to QU(X)^\bullet \to U(X)$ is marked.
Map $L_n QX^\bullet \to QX^n$ is a cofibration since its underlying map $L_n QU(X)^\bullet \to QU(X)^n$ is a cofibration.
Map $QX^n \to X$ has RLP with respect to $\I^\flat$ since $QU(X)^\bullet$ is fibrant.
It also has RLP with respect to $K^\flat \to (K, G \{id\})$ by definition of $QX^n$.
Thus it is a trivial fibration.

Kan complex $\Hom(QX^\bullet,Y)$ is a subcomplex of $\Map(X,Y)$.
Let us prove that they are actually equal.
Consider a simplex $\Delta^n \to \Map(X,Y)$.
Such simplex corresponds to a map $QU(X)^n \to U(Y)$.
We need to show that this map lifts to a map $QX^n \to Y$.
Let $k : K \to QU(X)^n$ be a marked map.
Then it is homotopic to the map $K \xrightarrow{k} QU(X)^n \to U(X) \simeq QU(X)^0 \to QU(X)^n$,
where the last map is given by any map $\Delta^0 \to \Delta^n$.
By definition of $\Map(X,Y)$ every such map gives a marked map in $Y$.
Since $Y$ is fibrant, $K \xrightarrow{k} QU(X)^n \to U(Y)$ is also marked.
\end{proof}

\section{Marked simplicial sets}

In this section for every set $\mathcal{L}$ of simplicial sets, we define a model category $\sSet_\mathcal{L}$ of marked simplicial sets
which represents the $(\infty,1)$-category of $(\infty,1)$-categories which have a limit for every diagram of every shape from $\mathcal{L}$.
In particular, if $\mathcal{L} = \{ \varnothing, \Lambda^2_2 \}$, then $\sSet_\mathcal{L}$ represents the $(\infty,1)$-category of finitely complete $(\infty,1)$-categories.

For every set of simplicial sets $\mathcal{L}$, we define set $\mathcal{K}$ as $\{ \Delta^0 \join L\ |\ L \in \mathcal{L} \}$.
Let $\sSet_\mathcal{L}$ be the category of \K-marked objects.
Let $\J$ be the following set of maps of $\sSet_\mathcal{L}$:
\begin{enumerate}
\item For every $L \in \mathcal{L}$, maps $L^\flat \to (\Delta^0 \join L, \{ id : \Delta^0 \join L \to \Delta^0 \join L \})$.
\item For every $n > 0$ and $L \in \mathcal{L}$, maps $(\partial \Delta^n \join L, \{ \Delta^{\{n\}} \join L : \Delta^0 \join L \to \partial \Delta^n \join L \}) \to (\Delta^n \join L, \{ \Delta^{\{n\}} \join L : \Delta^0 \join L \to \Delta^n \join L \})$.
\end{enumerate}
We define a model structure on $\sSet_\mathcal{L}$ as the left Bousfield localization of the model structure defined in section~\ref{sec:marked} with respect to $\J$.
The following propositions give us a characterization of fibrant objects and fibrations between them in $\sSet_\mathcal{L}$.

\begin{comment}
Let $\J'$ be the set of maps of $\sSet_\mathcal{L}$ which consists of the maps in $\J$ and the following maps:
\begin{enumerate}
\item For every $0 < i < n$, inclusions $(\Lambda^n_i)^\flat \to (\Delta^n)^\flat$.
\item For every $L \in \mathcal{L}$, maps $(S,\{ f_1 \}) \to (S,\{ f_0, f_1 \})$, where
\[ S = \Delta^1 \join L \amalg_{\Delta^1} N(\{ 0 \cong 1 \}), \]
$\{ 0 \cong 1 \}$ is the groupoid with two objects and a unique isomorphism between them, and
$f_i$ is the composite $\Delta^0 \join L \xrightarrow{\Delta^{\{i\}} \join L} \Delta^1 \join L \to S$.
\end{enumerate}
\end{comment}

\begin{prop}[mark-fib-obj]
For every marked simplicial set $Z$, the following conditions are equivalent:
\begin{enumerate}
\item \label{it:fib} $Z$ is a fibrant object of $\sSet_\mathcal{L}$.
% \item \label{it:jp} $Z$ has RLP with respect to $\J'$.
\item \label{it:exp} $Z$ is a quasicategory which has a limit for every diagram of every shape from $\mathcal{L}$, and a cone is marked in $Z$ if and only if it is a limit cone.
\end{enumerate}
\end{prop}
\begin{proof}
% It is easy to see that \eqref{it:fib} implies \eqref{it:jp}, and that \eqref{it:jp} and \eqref{it:exp} are equivalent.
% To prove that \eqref{it:exp} implies \eqref{it:fib}, we need to define homotopy function complexes for $\sSet_\mathcal{L}$.
It is easy to see that \eqref{it:fib} implies \eqref{it:exp}.
To prove the converse, we need to define homotopy function complexes for $\sSet_\mathcal{L}$.
First, recall that the inclusion of Kan complexes into quasicategories has a right adjoint which we denote by $E$ (see, for example, \cite[Proposition~1.2.5.3]{lurie-topos}).
Let $\Fun(X,Y)$ be the internal Hom in the category of simplicial sets.
By \cite[Corollary~3.1.4.4]{lurie-topos}, $E(\Fun(X,Y))$ is a homotopy function complex in the Joyal model structure.
If $X$ and $Y$ are marked simplicial sets, then by \rlem{mark-map}, we can define a homotopy function complex $\Map(X,Y)$ as certain subcomplex of $E(\Fun(U(X),U(Y)))$.

Let $X$ be a marked simplicial set of the form $(A \join L, \{ p \join L \})$ for some $L \in \mathcal{L}$ and $p : \Delta^0 \to A$.
Then we can give an equivalent definition of a homotopy function complex $\Map'(X,Y)$ in terms of fat join.
Let $\Map'(X,Y)$ be the subcomplex of $E(\Fun(A \fjoin L, Y))$ which consists of those components in which some (and hence every) vertex
corresponds to a map $f : A \fjoin L \to Y$ such that $\Delta^0 \fjoin L \xrightarrow{p \fjoin L} A \fjoin L \xrightarrow{f} Y$ is a limit cone.
Since $A \fjoin L \to A \join L$ is a weak equivalence in the Joyal model structure, induced map $\Map(X,Y) \to \Map'(X,Y)$ is a weak equivalence of Kan complexes.

An object $Z$ of $\sSet_\mathcal{L}$ is fibrant if and only if it is a quasicategory, marked maps in $Z$ are stable under homotopy,
and for every map $X \to Y$ in $\J$, induced map of Kan complexes $\Map(Y,Z) \to \Map(X,Z)$ is a weak equivalence.
Let $Z$ be a marked simplicial set that satisfies \eqref{it:exp}.
Since limits cones are stable under homotopy, we just need to prove that $\Map(Y,Z) \to \Map(X,Z)$ is a weak equivalence for every $X \to Y$ in $\J$.
By assumption, this map is surjective on vertices.
Thus we only need to prove that for every $p : X \to Z$, the fiber of $\Map(Y,Z) \to \Map(X,Z)$ over $p$ is contractible.

First, let us consider maps of the form $L^\flat \to (\Delta^0 \join L, \{ id \})$.
Since $L^\flat$ is flat, $\Map(L^\flat,Z) = E(\Fun(L,U(Z)))$.
For any simplicial sets $K$, $A$ and $Z'$ and every map $p : K \to Z'$, we have the following cartesian square:
\[ \xymatrix{ \Fun(A,Z'^{/p}) \ar[r] \ar[d] \pb & \Fun(A \fjoin K, Z') \ar[d] \\
              \Delta^0 \ar[r]_-p & \Fun(K,Z')
            } \]
In particuler, if we let $K = L$, $A = \Delta^0$ and $Z' = U(Z)$, then we obtain the following cartesian square:
\[ \xymatrix{ U(Z)^{/p} \ar[r] \ar[d] \pb & \Fun(\Delta^0 \fjoin L, U(Z)) \ar[d] \\
              \Delta^0 \ar[r]_-p & \Fun(L,U(Z))
            } \]
Since $E$ is a right adjoint, it preserves pullbacks.
Hence fiber of $\Map'((\Delta^0 \join L, \{ id \}), Z) \to \Map(L^\flat, Z)$ is the subcomplex of $E(U(Z)^{/p})$
spanned by vertices that correspond to limit cones, and it is easy to see that it is contractible (see, for example, \cite[Lemma~2.11]{szumilo}).

Now, let us consider maps of the form $(\partial \Delta^n \join L, \{ \Delta^{\{n\}} \join L \}) \to (\Delta^n \join L, \{ \Delta^{\{n\}} \join L \})$.
First, let us consider the special case when $L = \varnothing$.
We prove that fibers of $\Map((\Delta^n, \{ \Delta^{\{n\}} \}), Z) \to \Map((\partial \Delta^n, \{ \Delta^{\{n\}} \}), Z)$ are contractible by induction on $n$.
If $n = 1$, then for every $p : \Delta^0 \to X$, we have the following diagram:
\[ \xymatrix{ U(Z)^{/p} \ar[d] \ar[r] \pb & \Fun(\Delta^1, U(Z)) \ar[d] \\
              U(Z) \ar[d] \ar[r] \pb & \Fun(\partial \Delta^1, U(Z)) \ar[d] \\
              \Delta^0 \ar[r]_p & U(Z)
            } \]
If $p$ is final, then $U(Z)^{/p} \to U(Z)$ is a weak equivalence (see, for example, \cite[Corollary~1.2.12.5]{lurie-topos}).
Since every map $\Delta^0 \to \Map((\partial \Delta^1, \{ \Delta^{\{1\}} \}), Z)$ factors through $U(Z)$ for some final $p$,
fibers of $\Map((\Delta^1, \{ \Delta^{\{1\}} \}), Z) \to \Map((\partial \Delta^1, \{ \Delta^{\{1\}} \}), Z)$ are contractible.

Now, assume $n > 1$.
Consider the following diagram:
\[ \xymatrix{ \Map((\Delta^n, \{ \Delta^{\{n\}} \}), Z) \ar[d] \\
              \Map((\partial \Delta^n, \{ \Delta^{\{n\}} \}), Z) \ar[r] \ar[d] \pb & \Map((\Delta^{n-1}, \{ \Delta^{\{n-1\}} \}), Z) \ar[d] \\
              \Map((\Lambda^n_1, \{ \Delta^{\{n\}} \}), Z) \ar[r] & \Map((\partial \Delta^{n-1}, \{ \Delta^{\{n-1\}} \}), Z)
            } \]
Since $\Lambda^n_1 \to \Delta^n$ is a weak equivalence in the Joyal model structure, map
\[ \Map((\Delta^n, \{ \Delta^{\{n\}} \}), Z) \to \Map((\Lambda^n_1, \{ \Delta^{\{n\}} \}), Z) \]
is also a weak equivalence.
By induction hypothesis, $\Map((\Delta^{n-1}, \{ \Delta^{\{n-1\}} \}), Z) \to \Map((\partial \Delta^{n-1}, \{ \Delta^{\{n-1\}} \}), Z)$ is a weak equivalence.
Since it is a fibration, map
\[ \Map((\partial \Delta^n, \{ \Delta^{\{n\}} \}), Z) \to \Map((\Lambda^n_1, \{ \Delta^{\{n\}} \}), Z) \]
is also a weak equivalence.
Hence by 2-out-of-3 property, $\Map((\Delta^n, \{ \Delta^{\{n\}} \}), Z) \to \Map((\partial \Delta^n, \{ \Delta^{\{n\}} \}), Z)$ is a weak equivalence.

Finally, we consider the general case.
For every $p : L \to U(Z)$, we have the following diagram:
\[ \xymatrix{ \Fun(\Delta^n, U(Z)^{/p}) \ar[r] \ar[d] \pb & \Fun(\Delta^n \fjoin L, U(Z)) \ar[d] \\
              \Fun(\partial \Delta^n, U(Z)^{/p}) \ar[r] \ar[d] \pb & \Fun(\partial \Delta^n \fjoin L, U(Z)) \ar[d] \\
              \Delta^0 \ar[r]_-p & \Fun(L,U(Z))
            } \]
It follows that the following square is cartesian:
\[ \xymatrix{ \Map(\Delta^n, U(Z)^{/p}) \ar[r] \ar[d] \pb & \Map'(\Delta^n \join L, U(Z)) \ar[d] \\
              \Map(\partial \Delta^n, U(Z)^{/p}) \ar[r] & \Map'(\partial \Delta^n \join L, U(Z))
            } \]
Since every vertex $\Delta^0 \to \Map'(\partial \Delta^n \join L, U(Z))$ factors through $\Map(\partial \Delta^n, U(Z)^{/p})$
for some $p$, it is enough to show that every fiber of \[ \Map(\Delta^n, U(Z)^{/p}) \to \Map(\partial \Delta^n, U(Z)^{/p}) \] is contractible.
But this follows from the special case when $L = \varnothing$.
\end{proof}

\begin{prop}[mark-fib-map]
A map $f : X \to Y$ between fibrant marked simplicial sets is a fibration if and only if its underlying map is a fibration in the Joyal model structure.
\end{prop}
\begin{proof}
\Rprop{mark-fib-obj} implies that an object of $\sSet_\mathcal{L}$ is fibrant if and only if it is a quasicategory
and has RLP with respect to sets $\J$ and $\J_\mathcal{K}$ (which was defined in \rthm{mark-main}).
By \cite[Proposition~3.6]{f-model-structures}, a map of marked simplicial sets with fibrant codomain is a fibration
if and only if it is a fibration in the Joyal model structure and has RLP with respect to $\J \cup \J_\mathcal{K}$.
Let us prove that every map $f : X \to Y$ between fibrant marked simplicial sets which is a fibration in the Joyal model structure has RLP with respect to $\J \cup \J_\mathcal{K}$.

Since $X$ has RLP with respect to $\J_\mathcal{K}$, $f$ also has RLP with respect to this set.
Consider the following commutative square:
\[ \xymatrix{ L \ar[r] \ar[d] & U(X) \ar[d]^f \\
              \Delta^0 \join L \ar[r]_v \ar@{-->}[ur]^g & U(Y),
            } \]
where $v$ is marked in $Y$.
Since $X$ is fibrant, there exists a marked map $g : \Delta^0 \join L \to U(X)$ such that the top triangle in the square above commutes.
Since $f \circ g$ and $v$ are limit cones, they are homotopic relative to $L$.
Sincce $U(f)$ is a fibration in the Joyal model structure, we can lift this homotopy to obtain a lift in the square above such that both triangles commute.
The same argument shows that $f$ has RLP with respect to maps $(\partial \Delta^n \join L, \{ \Delta^{\{n\}} \join L \}) \to (\Delta^n \join L, \{ \Delta^{\{n\}} \join L \})$.
\end{proof}

Let $\kappa$ be a regular cardinal, and let $\mathcal{L}$ be the set of all (representatives of) sets with cardinality less than $\kappa$ together with simplicial set $\Lambda^2_2$.
Let $\sSet_\mathcal{L}^f$ be the full subcategory of $\sSet_\mathcal{L}^f$ on the fibrant object.
Then $\sSet_\mathcal{L}^f$ is a category with fibrations.
Let $\qcat^c$ be the category of $\kappa$-complete quasicategories and functors that preserve $\kappa$-small limits.
A structure of a category with fibrations on $\qcat^c$ was constructed in \cite{szumilo}.
These two categories with fibrations are isomorphic.
Indeed, \rprop{mark-fib-obj} implies that forgetful functor $U : \sSet_\mathcal{L}^f \to \qcat^c$ is an isomorphism of categories.
Thus we just need to show that $U$ preserves weak equivalences and fibrations.
Weak equivalences in both cases are just weak equivalences of underlying quasicategories.
Fibrations in $\qcat^c$ are fibrations of underlying quasicategories.
By \rprop{mark-fib-map}, this is also true in $\sSet_\mathcal{L}^f$.

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
