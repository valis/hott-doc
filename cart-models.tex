\documentclass[reqno]{amsart}

\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage[all]{xy}
\usepackage{ifthen}
\usepackage{xargs}
\usepackage{bussproofs}
\usepackage{verbatim}
\usepackage{turnstile}

\hypersetup{colorlinks=true,linkcolor=blue}

\renewcommand{\turnstile}[6][s]
    {\ifthenelse{\equal{#1}{d}}
        {\sbox{\first}{$\displaystyle{#4}$}
        \sbox{\second}{$\displaystyle{#5}$}}{}
    \ifthenelse{\equal{#1}{t}}
        {\sbox{\first}{$\textstyle{#4}$}
        \sbox{\second}{$\textstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{s}}
        {\sbox{\first}{$\scriptstyle{#4}$}
        \sbox{\second}{$\scriptstyle{#5}$}}{}
    \ifthenelse{\equal{#1}{ss}}
        {\sbox{\first}{$\scriptscriptstyle{#4}$}
        \sbox{\second}{$\scriptscriptstyle{#5}$}}{}
    \setlength{\dashthickness}{0.111ex}
    \setlength{\ddashthickness}{0.35ex}
    \setlength{\leasturnstilewidth}{2em}
    \setlength{\extrawidth}{0.2em}
    \ifthenelse{%
      \equal{#3}{n}}{\setlength{\tinyverdistance}{0ex}}{}
    \ifthenelse{%
      \equal{#3}{s}}{\setlength{\tinyverdistance}{0.5\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{d}}{\setlength{\tinyverdistance}{0.5\ddashthickness}
        \addtolength{\tinyverdistance}{\dashthickness}}{}
    \ifthenelse{%
      \equal{#3}{t}}{\setlength{\tinyverdistance}{1.5\dashthickness}
        \addtolength{\tinyverdistance}{\ddashthickness}}{}
        \setlength{\verdistance}{0.4ex}
        \settoheight{\lengthvar}{\usebox{\first}}
        \setlength{\raisedown}{-\lengthvar}
        \addtolength{\raisedown}{-\tinyverdistance}
        \addtolength{\raisedown}{-\verdistance}
        \settodepth{\raiseup}{\usebox{\second}}
        \addtolength{\raiseup}{\tinyverdistance}
        \addtolength{\raiseup}{\verdistance}
        \setlength{\lift}{0.8ex}
        \settowidth{\firstwidth}{\usebox{\first}}
        \settowidth{\secondwidth}{\usebox{\second}}
        \ifthenelse{\lengthtest{\firstwidth = 0ex}
            \and
            \lengthtest{\secondwidth = 0ex}}
                {\setlength{\turnstilewidth}{\leasturnstilewidth}}
                {\setlength{\turnstilewidth}{2\extrawidth}
        \ifthenelse{\lengthtest{\firstwidth < \secondwidth}}
            {\addtolength{\turnstilewidth}{\secondwidth}}
            {\addtolength{\turnstilewidth}{\firstwidth}}}
        \ifthenelse{\lengthtest{\turnstilewidth < \leasturnstilewidth}}{\setlength{\turnstilewidth}{\leasturnstilewidth}}{}
    \setlength{\turnstileheight}{1.5ex}
    \sbox{\turnstilebox}
    {\raisebox{\lift}{\ensuremath{
        \makever{#2}{\dashthickness}{\turnstileheight}{\ddashthickness}
        \makehor{#3}{\dashthickness}{\turnstilewidth}{\ddashthickness}
        \hspace{-\turnstilewidth}
        \raisebox{\raisedown}
        {\makebox[\turnstilewidth]{\usebox{\first}}}
            \hspace{-\turnstilewidth}
            \raisebox{\raiseup}
            {\makebox[\turnstilewidth]{\usebox{\second}}}
        \makever{#6}{\dashthickness}{\turnstileheight}{\ddashthickness}}}}
        \mathrel{\usebox{\turnstilebox}}}

\newcommand{\newref}[4][]{
\ifthenelse{\equal{#1}{}}{\newtheorem{h#2}[hthm]{#4}}{\newtheorem{h#2}{#4}[#1]}
\expandafter\newcommand\csname r#2\endcsname[1]{#3~\ref{#2:##1}}
\expandafter\newcommand\csname R#2\endcsname[1]{#4~\ref{#2:##1}}
\expandafter\newcommand\csname n#2\endcsname[1]{\ref{#2:##1}}
\newenvironmentx{#2}[2][1=,2=]{
\ifthenelse{\equal{##2}{}}{\begin{h#2}}{\begin{h#2}[##2]}
\ifthenelse{\equal{##1}{}}{}{\label{#2:##1}}
}{\end{h#2}}
}

\newref[section]{thm}{theorem}{Theorem}
\newref{lem}{lemma}{Lemma}
\newref{prop}{proposition}{Proposition}
\newref{cor}{corollary}{Corollary}
\newref{cond}{condition}{Condition}
\newref{conj}{conjecture}{Conjecture}

\theoremstyle{definition}
\newref{defn}{definition}{Definition}
\newref{example}{example}{Example}

\theoremstyle{remark}
\newref{rem}{remark}{Remark}

\newcommand{\red}{\Rightarrow}
\newcommand{\deq}{\equiv}
\newcommand{\repl}{:=}
\newcommand{\idtype}{\rightsquigarrow}

\newcommand{\cat}[1]{\mathbf{#1}}
\newcommand{\C}{\cat{C}}
\newcommand{\Cat}{\cat{Cat}}
\newcommand{\Mod}[1]{#1\text{-}\cat{Mod}}
\newcommand{\Th}{\cat{Th}}
\newcommand{\emptyCtx}{\mathbf{1}}
\newcommand{\Set}{\cat{Set}}
\newcommand{\sSet}{\cat{sSet}}
\newcommand{\qcat}{\cat{qcat}}
\newcommand{\K}{$\mathcal{K}$}
\newcommand{\Hom}{\mathrm{Hom}}

\newcommand{\cmap}[1]{\mathrm{c}_{#1}}
\newcommand{\nf}{\mathrm{nf}}

\newcommand{\we}{\mathcal{W}}
\newcommand{\I}{\mathrm{I}}
\newcommand{\J}{\mathrm{J}}
\newcommand{\class}[2]{#1\text{-}\mathrm{#2}}
\newcommand{\Icell}[1][\I]{\class{#1}{cell}}
\newcommand{\Icof}[1][\I]{\class{#1}{cof}}
\newcommand{\Iinj}[1][\I]{\class{#1}{inj}}
\newcommand{\Jinj}[1][]{\Iinj[\J#1]}
\newcommand{\Jcell}[1][]{\Icell[\J#1]}
\newcommand{\Jcof}[1][]{\Icof[\J#1]}

\numberwithin{figure}{section}

\newcommand{\pb}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\newcommand{\po}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}

\begin{document}

\title[Equivalence between quasicategories and models of type theory]{Equivalence between finitely complete quasicategories and models of homotopy type theory with an interval type}

\author{Valery Isaev}

\begin{abstract}
Abstract.
\end{abstract}

\maketitle

\section{Introduction}

\section{Morita equivalences of theories}

In this section we define a Morita equivalence of algebraic dependent type theories as defined in \cite{alg-tt}.
We also give several equivalent descriptions of Morita equivalences.

Let $T$ be a theory with the interval type (that is, $T$ is equipped with a morphism from theory $I$, which was defined in \cite{alg-models}).
Let $X$ be a model of $T$.
A \emph{homotopy} between elements $a,a' \in X_{(p,n)}$ is an element $h \in X_{(p,n+1)}$ such that $ctx^n(h) = I$, $left^*(h) = a$, and $right^*(h) = a'$.
We will say that $h$ is a \emph{relative homotopy} if $e_p(h) = I \times e_p(a)$, where $e_p : (p,n) \to (d_p,n)$, $d_{tm} = ty$, $e_{tm} = ty$, $d_{ty} = ctx$ and $e_{ty} = ft$.
We will say that a morphism of models $f : X \to Y$ is \emph{weak equivalence} if it satisfies the following conditions:
\begin{enumerate}
\item For every $A \in X_{(ty,n)}$ and $a \in Y_{(tm,n)}$ such that $ty(a) = f(A)$,
there is a term $a' \in X_{(tm,n)}$ such that $ty(a') = A$ and $f(a')$ is relatively homotopic to $a$.
In this case we will say that $f$ is \emph{essentially surjective on terms}.
\item For every $\Gamma \in X_{(ctx,n)}$ and $A \in Y_{(ty,n)}$ such that $ft(A) = f(\Gamma)$,
there is a type $A' \in X_{(ty,n)}$ such that $ft(A') = \Gamma$ and $f(A')$ is relatively homotopic to $A$.
In this case we will say that $f$ is \emph{essentially surjective on types}.
\end{enumerate}

\begin{defn}
A \emph{Morita equivalence} between theories $T_1$ and $T_2$ under $I$ is a morphism $f : T_1 \to T_2$ under $I$ such that for every model $X$ of $T_1$,
the unit $\eta_X : X \to f^*(f_!(X))$ of the adjunction $f_! \dashv f^*$ is a weak equivalence.
\end{defn}

Let $B$ be the regular theory that can be described as $coe_1 + \sigma + Path + wUA$.
This theory was defined in \cite{alg-models}, and it was proved there that if $T$ is a regular theory under $B$,
then there is a model structure on $\Mod{T}$ in which the class of weak equivalences agrees with the one defined above.
The following simple proposition characterizes Morita equivalences between such theories in terms of this model stucture.

\begin{prop}
Let $T_1$ and $T_2$ be regular theories under $B$, and let $f : T_1 \to T_2$ be a morphism under $B$.
Then $f_! \dashv f^*$ is a Quillen adjunction.
It is a Quillen equivalence if and only if $f$ is a Morita equivalence.
\end{prop}
\begin{proof}
Since $f_!$ is a left adjoint, it preserves object defined by generators and relations.
Since the set of generating cofibration $\I$ and the set of generating trivial cofibration $\J_\I$
are both defined in terms of generators and relations, this implies that $f_!$ preserves them.
Hence $f_! \dashv f^*$ is a Quillen adjunction.
Moreover, this implies that $U$ reflects weak equivalences.
Hence a Quillen adjunction is a Quillen equivalence if and only if the unit of the adjunction is a weak equivalence.
\end{proof}

The following propositions gives a useful characterization of Morita equivalences:

\begin{prop}
Let $f : T_1 \to T_2$ be a morphism of theories under $I$.
Then $f$ is a Morita equivalence if and only if for every set $V$, every formula $\varphi \in Form_{T_1}(V)$,
every term $A \in Term_{T_1}(V)_{(d_p,n)}$, and every term $a \in Term_{T_2}(V)_{(p,n)}$ such that $\varphi \sststile{}{V} A$ and $f(\varphi) \sststile{}{V} e_p(a) = f(A)$,
there exist terms $a' \in Term_{T_1}(V)_{(p,n)}$ and $h \in Term_{T_2}(V)_{(p,n+1)}$, which satisfy the following conditions:
\begin{enumerate}
\item \label{it:mcf} $\varphi \sststile{}{V} e_p(a') = A$,
\item $f(\varphi) \sststile{}{V} e_p(h) = I \times f(A)$,
\item $f(\varphi) \sststile{}{V} left^*(h) = f(a')$,
\item \label{it:mcl} $f(\varphi) \sststile{}{V} right^*(h) = a$.
\end{enumerate}
\end{prop}
\begin{proof}
First, recall that if $T'$ is a theory under $T$, then $Syn(T')$ is a model $T$ which is defined as the set of closed terms of $T'$ quotiented by a partial equivalence relation.
We can generalize this construction as follows.
For every set $V$, we define a model $Syn(T',V)$ as $Term_{T'}(V)/\!\sim$, where $Term_{T'}(V)$ is the set of terms of $T'$ with variables in $V$,
and $\sim$ is a partial equivalence relation, defined as follows: $t_1 \sim t_2$ if and only if $\sststile{}{V} t_1 = t_2$.
For every predicate symbol $R$, we define $R(Syn(T',V))$ as the set of tuples $t_1, \ldots t_k$ such that $\sststile{}{V} R(t_1, \ldots t_k)$.
If $f : T_1 \to T_2$ is a morphism of theories under $T$, then it is easy to see that $f_!(Syn(T_1,V)) = Syn(T_2,V)$.

Now we can prove the ``only if'' direction.
Note that elements of $Syn(T_1 \cup \{\,\sststile{}{}~\varphi\,\}, V)$ correspond to terms $t$ of $T_1$ with variables in $V$ such that $\varphi \sststile{}{V} t\!\downarrow$.
Moreover, two terms $t_1$ and $t_2$ map to the same element under this correspondence if and only if $\varphi \sststile{}{V} t_1 = t_2$.
Analogous statement holds for $Syn(T_2 \cup \{\,\sststile{}{}~f(\varphi)\,\}, V)$.
Using this correspondence, the required property immediately follows from the fact that
map $Syn(T_1 \cup \{\,\sststile{}{}~\varphi\,\}, V) \to f^*(Syn(T_2 \cup \{\,\sststile{}{}~f(\varphi)\,\}, V))$ is a weak equivalence.

Now, let us prove the ``if'' direction.
Let $M$ be a model of $T_1$.
Note that $M = Syn(T_1 \cup \mathcal{A}, U(M))$, where $\mathcal{A}$ is the set of axioms of $Lang(M)$ in which elements $O_a$ are replaced with $a$.
Let $A \in M_{(d_p,n)}$ and $a \in f^*(f_!(M))$ be elements such that $e_p(a) = A$.
Since $f_!(M) = Syn(T_2 \cup f(\mathcal{A}), U(M))$, $a$ corresponds to a term of $T_2$ with variables in $U(M)$.
There is a finite subset $\mathcal{A}'$ of $\mathcal{A}$ such that $\sststile{}{U(M)} e_p(a) = A$ is derivable in $T_2 \cup \mathcal{A}'$.
Let $\varphi$ be the conjunction of $\mathcal{A}'$.
Then $\varphi \sststile{}{U(M)} e_p(a) = A$.
By assumption, there exist terms $a' \in Term_{T_1}(U(M))_{(p,n)}$ and $h \in Term_{T_2}(U(M))_{(p,n+1)}$ which satisfy conditions \eqref{it:mcf} -- \eqref{it:mcl}.
These terms correspond to elements of $M$ and $f^*(f_!(M))$ respectively.
These conditions imply that $a'$ is the required lifting and $h$ is the required homotopy.
\end{proof}

The proof implies that we can assume that $A$ is a variable in this characterization of Morita equivalences.
Also, this proposition implies that Morita equivalences can be characterized in terms of a lifting property.
Let $\I$ be the set of the following morphisms of theories:
For every predicate symbol $P : s_1 \times \ldots \times s_k$ and every function symbols $A : s_1 \times \ldots \times s_k \to (d_p,n)$ and $a : s_1 \times \ldots \times s_k \to (p,n)$,
let $i_{P,A,a}$ be the following morphism of theories:
\[ \{ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} A(x_1, \ldots x_k)\!\downarrow \} \to \{ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} a(x_1, \ldots x_k)\!\downarrow \}, \]
where $i_{P,A,a}(A) = e_p(a)$.
We can define a relative cylinder object for $i_{P,A,a}$ as
\[ \{ P(x_1, \ldots x_k) \sststile{}{x_1, \ldots x_k} e_p(h(x_1, \ldots x_k)) = I \times A(x_1, \ldots x_k) \}, \]
where $h : s_1 \times \ldots \times s_k \to (p,n+1)$.
Then the previous proposition immediately implies the following corollary:

\begin{cor}
A morphism of theories is a Morita equivalence if and only if it has RLP up to $\sim_i$ with respect to every $i \in \I$.
\end{cor}

Let $f : T_1 \to T_2$ be a morphism of theories with a retraction $g : T_2 \to T_1$.
If we want to prove that $f$ is a Morita equivalence, we can try to define for every term $a$ of $T_2$ its lift as $g(a)$.
Then we only need to prove that $f(g(a))$ is homotopic to $a$.
We can try to do this using the same idea as in the proof of \cite[Lemma~3.7]{alg-models}.
For this we need to define a function on terms that for every term $a$ constructs a homotopy $h(a)$ between $f(g(a))$ and $a$.
If $h$ preserves axioms and satisfies some other conditions, then we can show that it define the required homotopy.

The problem with this construction is that $h$ might not preserve all axioms.
But sometimes it is enough to know that $h$ preserves only some axioms.
These ideas are formalized in the following lemma:

% Let $f : T_1 \to T_2$ be a morphism of theories with a retraction $g : T_2 \to T_1$.
% If we want to prove that $f$ is a Morita equivalence, we can try to define for every term $a$ of $T_2$ its lift as $g(a)$.
% Then we only need to prove that $f(g(a))$ is homotopic to $a$.
% We can try to do this using the same idea as in the proof of \cite[Lemma~3.7]{alg-models}.
% First, we need to define a function $h : Term_{T_2}(V)_{(p,n)} \to Term_{T_2}(V)_{(p,n+1)}$ which preserves theorems.
% Let $a$ be a term of $T_2$, let $A$ be a variable, and let $\varphi$ be a formula of $T_1$ such that $f(\varphi) \sststile{}{V} e_p(a) = A$.
% Since $h$ preserves theorems, it follows that $h(f(\varphi)) \sststile{}{V} h(e_p(a)) = h(A)$.
% If we assume that $h(A) = I \times A$ and sequents $f(\varphi) \sststile{}{V} h(f(\varphi))$ and $\sststile{}{V} h(e_p(a)) \simeq e_p(h(a))$ are derivable,
% then it follows that $f(\varphi) \sststile{}{V} e_p(h(a)) = I \times A$.
% Then we just need to prove that sequents $h(a)\!\downarrow\ \sststile{}{V} left^*(h(a)) = f(g(a))$ and $h(a)\!\downarrow\ \sststile{}{V} right^*(h(a)) = a$ are derivable.

% The problem with this construction is that $h$ might not preserve all axioms.
% But sometimes it is possible to prove that some sequents of $T_2$ are derivable from a subset of axioms of $T_2$ which is preserved by $h$.
% Then we can show that sequent $f(\varphi) \sststile{}{V} e_p(a) = A$ in the proof above can be replaced with a sequent which has this property
% and which is close enough to the original sequent so that the proof still works.
% These ideas are formalized in the following lemma:

\begin{lem}
Let $f : T_1 \to T_2$ and $g : T_2 \to T_1$ be morphisms of theories such that $g \circ f = id_{T_1}$.
Suppose that the following conditions hold:
\begin{enumerate}
\item There is a function $\nf : Term_{T_2} \to Term_{T_2}$ such that for every term $t$, sequent $t\!\downarrow\ \sststile{}{V} \nf(t) = t$ is derivable in $T_2$.
\item There is a subtheory $T_2' \subseteq T_2$ which has the same sets of function and predicate symbols such that
for every theorem $\varphi \sststile{}{V} \psi$ of $T_2$, sequent $\nf(\varphi) \sststile{}{V} \nf(\psi)$ is derivable in $T_2'$.
\item There is a function $h : Term_{T_2}(V)_{(p,n)} \to Term_{T_2}(L(V))_{(p,n+1)}$ which preserves $ft$, $ty$, variables, substitutions, and axioms of $T_2'$.
\item For every formula $\varphi$, sequent $f(\varphi) \sststile{}{V} h'(f(\varphi))$ is derivable, where $h'(t) = h(t)[\rho_V]$ and $\rho_V(x) = I \times x$ for every $x \in V$.
\item For every term $a$, sequent $h'(a)\!\downarrow\ \sststile{}{V} e_p(h'(a)) = I \times e_p(a) \land left^*(h'(a)) = f(g(a)) \land right^*(h'(a)) = a$ is derivable.
\end{enumerate}
Then $f$ is a Morita equivalence.
\end{lem}
\begin{proof}
\end{proof}

\section{Simplicial type theories}

In this section we define regular theory $T_\Delta$ under $coe_1$.
We prove that for every theory $T$ under $B$, the categories of models of $T$ and $T \amalg_{coe_1} T_\Delta$ are Quillen equivalent.
The advantage of theories under $T_\Delta$ is that there is a forgetful functor from the category of models of simplicial type theories to the category of simplicial categories.

Theory $T_\Delta$ is a regular theory with the following function symbols:
\begin{align*}
\Delta^n & : (ty,0) \text{, for every } n \geq 0 \\
\Delta^1_l & : (tm,0) \\
\Delta^1_r & : (tm,0) \\
\cmap{f} & : (tm,0) \to (tm,0) \text{, for every map $f$ in $\Delta$} \\
fill^n_i & : (ty,1) \times (tm,1)^n \times (tm,0) \to (tm,0) \text{, for every } n \geq 1 \text{, } 0 \leq i \leq n
\end{align*}

Theory $T_\Delta$ has the following typing axioms:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash$}
\RightLabel{, for every $n \geq 1$}
\UnaryInfC{$\Gamma \vdash \Delta^n\ type$}
\DisplayProof
\qquad
\AxiomC{$\Gamma \vdash$}
\UnaryInfC{$\Gamma \vdash \Delta^1_l : \Delta^1$}
\DisplayProof
\qquad
\AxiomC{$\Gamma \vdash$}
\UnaryInfC{$\Gamma \vdash \Delta^1_r : \Delta^1$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a : \Delta^m$}
\RightLabel{, for every $f : \Delta^m \to \Delta^n$}
\UnaryInfC{$\Gamma \vdash \cmap{f}(a) : \Delta^n$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\def\extraVskip{1pt}
\Axiom$\fCenter \Gamma, x : \Delta^n \vdash A\ type$
\noLine
\UnaryInf$\fCenter \Gamma, y : \Delta^{n-1} \vdash a_j : A[x \repl \cmap{\delta^n_j}(y)] \text{, for every } 0 \leq j \leq n, j \neq i$
\noLine
\UnaryInf$\fCenter \Gamma \vdash d : \Delta^n$
\noLine
\UnaryInf$\fCenter S^n_i$
\RightLabel{, for every $0 \leq i \leq n$}
\def\extraVskip{2pt}
\UnaryInf$\fCenter \Gamma \vdash fill^n_i(x. A, y.a_0, \ldots y.a_{\hat{i}}, \ldots a.a_n, d) : A[x \repl d]$
\DisplayProof
\end{center}
\medskip
where $S^n_i$ consists of equations $\Gamma, z : \Delta^{n-2} \vdash a_j[y \repl \cmap{\delta^{n-1}_{k-1}}(z)] \deq a_k[y \repl \cmap{\delta^{n-1}_j}(z)]$
for every $0 \leq j < k \leq n$ such that $j \neq i$ and $k \neq i$.

The theory also has the following equality axioms:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a : \Delta^n$}
\UnaryInfC{$\Gamma \vdash \cmap{id}(a) \deq a : \Delta^n$}
\DisplayProof
\end{center}

\medskip
\begin{center}
\AxiomC{$\Gamma \vdash a : \Delta^m$}
\RightLabel{, $f : \Delta^m \to \Delta^n$, $f' : \Delta^n \to \Delta^k$}
\UnaryInfC{$\Gamma \vdash \cmap{f'}(\cmap{f}(a)) \deq \cmap{f' \circ f}(a) : \Delta^k$}
\DisplayProof
\end{center}
\medskip

Finally, for every $0 \leq i \leq n$ and $f : \Delta^m \to \Delta^n$ which factors through inclusion $\Lambda^n_i \to \Delta^n$, we have the following axiom:
\medskip
\begin{center}
\def\extraVskip{1pt}
\Axiom$\fCenter \Gamma, x : \Delta^n \vdash A\ type$
\noLine
\UnaryInf$\fCenter \Gamma, y : \Delta^{n-1} \vdash a_j : A[x \repl \cmap{\delta^n_j}(y)] \text{, for every } 0 \leq j \leq n, j \neq i$
\noLine
\UnaryInf$\fCenter \Gamma \vdash d : \Delta^m$
\noLine
\UnaryInf$\fCenter S^n_i$
\def\extraVskip{2pt}
\UnaryInf$\fCenter \Gamma \vdash fill^n_i(x.A, y.a_0, \ldots y.a_{\hat{i}}, \ldots y.a_n, \cmap{f}(d)) \deq a_k[y \repl \cmap{f'}(d)] : A[x \repl \cmap{f}(d)]$
\DisplayProof
\end{center}
where $k$ and $f'$ are such that $k \neq i$, $f = \delta^n_k \circ f'$, and $k$ is the minimal such number.

There is a morphism of theories $F : I \to T_\Delta$, which is defined as follows: $F(I) = \Delta^1$, $F(left) = \Delta^1_l$, and $F(right) = \Delta^1_r$.
This morphism has a retraction $G : T_\Delta \to I$, which is defined as follows: $G(\Delta^n) = I$, $G(\Delta^1_l) = left$, $G(\Delta^1_r) = right$, $G(\cmap{f})(a) = a$,
and $G(fill^n_i)(x.A, a_0, \ldots a_{i-1}, a_{i+1}, \ldots a_n, d) = a_k[y \repl d]$, where $k = 0$ if $i > 0$ and $k = 1$ if $i = 0$.

\section{Functors between $\sSet$ and $\Mod{T}$}

In this section we define a Quillen adjunction between $\sSet$ and $\Mod{T}$ for every appropriate algebraic dependent type theory $T$.
Recall that $sq_l$ is the theory with the following axioms:
\medskip
\begin{center}
\AxiomC{$\Gamma \vdash i : I$}
\AxiomC{$\Gamma \vdash j : I$}
\BinaryInfC{$\Gamma \vdash sq_l(i,j) : I$}
\DisplayProof
\end{center}
\begin{align*}
sq_l(left,j) & = left \\
sq_l(right,j) & = j \\
sq_l(i,left) & = left \\
sq_l(i,right) & = i
\end{align*}
To define functors between $\sSet$ and $\Mod{T}$, we also need to assume that $sq_l$ is associative.
Let $sq^a_l$ be the theory which has the same axioms as $sq_l$ together with the following axiom:
\[ sq_l(sq_l(i,j),k) = sq_l(i,sq_l(j,k)) \]

Let $T$ be any theory under $sq^a_l$.
For every finite nonempty linearly ordered set $J$, we define a model $\mathfrak{C}(\Delta^J)$ of $T$.
It is freely generated by generators and relations described below.
Generators of $\mathfrak{C}(\Delta^J)$ are $O_j : (ty,0)$ for every $j \in J$, and $M_{J'} : (tm,|J'|-1)$ for every subset $J'$ of $J$ such that $|J'| \geq 2$.
For every $j \in J$, $\mathfrak{C}(\Delta^J)$ has relation $\vdash O_j\ type$.
For every $J' = \{ j_1 < \ldots < j_n \} \subseteq J$ such that $n \geq 2$, it has the following relation:
\[ x : O_{j_1}, x_{j_2} : I, \ldots x_{j_{n-1}} : I \vdash M_{J'} : O_{j_n} \]
For every $j \notin J'$ such that $j_1 < j < j_n$, it has the following relations:
\begin{align}
x : O_{j_1}, x_{j_2} : I, \ldots x_{j_{n-1}} : I & \vdash M_{J' \cup \{j\}}[x_j \repl left] \deq M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}] \label{rel:left} \\
x : O_{j_1}, x_{j_2} : I, \ldots x_{j_{n-1}} : I & \vdash M_{J' \cup \{j\}}[x_j \repl right] \deq M_{J'} \label{rel:right}
\end{align}

The idea of this definition is similar to \cite[Definition~1.1.5.1]{lurie-topos}.
For every vertex $j$ of $\Delta^J$, we have a type $O_j$,
and for every $(n+1)$-dimensional face $J'$ of $\Delta^J$, we have an $n$-dimensional cube $M_{J'}$.
Relations describe faces of these cubes.

Let $sq_l(x_1, \ldots x_n) = sq_l(x_1, \ldots sq_l(x_{n-1},x_n) \ldots )$.
In particular, $sq_l(X) = x$ and $sq_l() = right$.
Now, we can extend $\mathfrak{C}$ to a functor $\Delta \to \Mod{T}$.
Let $f : J \to K$ be a monotone map between linearly ordered sets.
Then we define $\mathfrak{C}(f)$ as follows:
\begin{align*}
\mathfrak{C}(f)(O_j) & = O_{f(j)} \\
\mathfrak{C}(f)(M_{J'}) & =
\begin{cases}
    x                                                                  & \text{if } |f(J')| = 1 \\
    M_{f(J')}[\ \ldots\ x_{k_i} \repl sq_l(x_{f^{-1}(k_i)})\ \ldots\ ] & \text{if } |f(J')| > 1 \\
\end{cases}
\end{align*}
where $k_i$ runs from $k_2$ to $k_{m-1}$, $\{ k_1 < \ldots < k_m \} = f(J')$,
and $x_{f^{-1}(k_i)} = x_{j_1}, \ldots x_{j_n}$, $\{ j_1 < \ldots < j_n \} = f^{-1}(k_i)$.

Let us check that $\mathfrak{C}(f)$ preserves relations.
Let $J' = \{ j_1 < \ldots < j_i < j < j_{i+1} < \ldots < j_n \}$ be a subset of $J$, and let $f'$ be the restriction of $f$ to $J'$.
If $|f(J')| = 1$, then $\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) = \mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) = \mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl right]) = \mathfrak{C}(f)(M_{J'}) = x$.
Thus we may assume that $|f(J')| > 1$. 

Let $\rho(x_{f(j_i)}) = sq_l(x_{f'^{-1}(f(j_1))})$ for every $1 \leq i \leq n$ such that $f(j_i) \neq f(j)$.
Let us consider the first relation.
If $f(j) = f(j_1)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) & = \\
M_{f(J')}[\rho] & = \\
M_{\{ f(j), \ldots f(j_n) \}}[\rho][x \repl x] & = \\
\mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) & .
\end{align*}
If $f(j) = f(j_n)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) & = \\
M_{f(J')}[\rho] & = \\
x[x \repl M_{\{f(j_1), \ldots f(j)\}}[\rho]] & = \\
\mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) & .
\end{align*}
If $f(j_1) < f(j) < f(j_n)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl left]) & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl sq_l(x_{f'^{-1}(f(j))}, x_j)][x_j \repl left] & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl left] & = \\
M_{\{f(j), \ldots f(j_n)\}}[x \repl M_{\{f(j_1), \ldots f(j)\}}][\rho] & = \\
\mathfrak{C}(f)(M_{\{ j, \ldots j_n \}}[x \repl M_{\{ j_1, \ldots j \}}]) & .
\end{align*}

Let us consider the second relation.
If either $f(j) = f(j_1)$ or $f(j) = f(j_n)$, then $\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl right]) = M_{f(J')}[\rho] = \mathfrak{C}(f)(M_{J'})$.
If $f(j_1) < f(j) < f(j_n)$, then
\begin{align*}
\mathfrak{C}(f)(M_{J' \cup \{j\}}[x_j \repl right]) & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl sq_l(x_{f'^{-1}(f(j))}, x_j)][x_j \repl right] & = \\
M_{f(J') \cup \{f(j)\}}[\rho, x_{f(j)} \repl sq_l(x_{f'^{-1}(f(j))})] & = \\
\mathfrak{C}(f)(M_{J'}) & ,
\end{align*}
If $f(j_i) < f(j) < f(j_{i+1})$, then the last equality holds by \eqref{rel:right},
otherwise it holds immediately by definition of $\mathfrak{C}(f)(M_{J'})$.

Let $[n]$ be the set of natural numbers $\{ 0, \ldots n \}$ with the obvious linear order.
Then $\Delta$ is the full subcategory of linearly ordered sets on objects of the form $[n]$.
It is easy to see that $\mathfrak{C}$ preserves identity morphisms,
and the fact that it preserves compositions follows from associativity of $sq_l$.
Thus we have a functor $\mathfrak{C} : \Delta \to \Mod{T}$.
This functor (uniquely) extends to a colimit-preserving functor $\mathfrak{C} : \sSet \to \Mod{T}$,
which has a right adjoint $N : \Mod{T} \to \sSet$ defined by equation $N(X) = \Hom(\mathfrak{C}(-),X)$.

We can explicitly describe $\mathfrak{C} : \sSet \to \Mod{T}$.
Model $\mathfrak{C}(X)$ is generated by symbols $O_a : (ty,0)$ for every $a \in X_0$, and $M_a : (tm,n)$ for every $a \in X_n$, $n \geq 1$.
For every $a \in X_0$, $\mathfrak{C}(X)$ has relations $\vdash O_a\ type$ and $M_{s_0(a)} = (x : O_a \vdash x : O_a)$.
For every $a \in X_n$, $n \geq 1$, it has the following relation:
\[ x : O_{a|\Delta^{\{0\}}}, x_1 : I, \ldots x_{n-1} : I \vdash M_a : O_{a|\Delta^{\{n\}}} \]
For every $1 \leq j \leq n-1$, it has the following relations:
\begin{align*}
M_a[x_j \repl left] & = M_{a|\Delta^{\{ j, \ldots n \}}}[x \repl M_{a|\Delta^{\{ 0, \ldots j \}}}] \\
M_a[x_j \repl right] & = M_{a|\Delta^{\{0, \ldots j-1, j+1, \ldots n\}}}
\end{align*}
For every $0 \leq j \leq n$, it has the following relation:
\[ M_{s_j(a)} =
\begin{cases}
    M_a[x_1 \repl x_2, \ldots x_{n-1} \repl x_n]                                      & \text{if } j = 0 \\
    M_a[x_j \repl sq_l(x_j,x_{j+1}), x_{j+1} \repl x_{j+2}, \ldots x_{n-1} \repl x_n] & \text{if } 1 \leq j \leq n-1 \\
    M_a                                                                               & \text{if } j = n \\
\end{cases}
\]
For every morphism $f : X \to Y$ of simplicial sets, let $\mathfrak{C}(f)(O_a) = O_{f(a)}$ and $\mathfrak{C}(f)(M_a) = M_{f(a)}$.
It is easy to see that this definition preserves relations, identity morphisms and compositions.

\begin{prop}
Functors $\mathfrak{C} \dashv N$ determine a Quillen adjunction between $\sSet$ with the Joyal model structure and $\Mod{T}$ with the model structure defined in \cite{alg-models}.
\end{prop}
\begin{proof}
Note that $\mathfrak{C}(\partial \Delta^n)$ is isomorphic (over $\mathfrak{C}(\Delta^n)$) to the theory
freely generated by the same generators and relations as $\mathfrak{C}(\Delta^n)$ except for $M_{[n]}$.
Similarly, if $i \in [n]$, then $\mathfrak{C}(\Lambda^n_i)$ is freely generated by the same generators
and relations as $\mathfrak{C}(\partial \Delta^n)$ except for $M_{\{ 0, \ldots i-1, i+1, \ldots n \}}$.

Let us prove that $\mathfrak{C}$ preserves cofibration.
To do this, it is enough to show that $\mathfrak{C}(\partial \Delta^n) \to \mathfrak{C}(\Delta^n)$ is a cofibration for every $n$.
If $n = 0$, then this map equals to $i_{(ty,0)}$.
Suppose that $n > 0$.
First, let us define objects $\square^k$ and $\partial \square^k$.
Let $\square^k = F(\{ x : A, x_1 : I, \ldots x_k : I \vdash b : B \})$,
and let $\partial \square^k$ be freely generated by generators and relations described below.
Generators of $\partial \square^k$ are $A,B : (ty,0)$ and $b_{[i=c]} : (tm,k)$ for every $1 \leq i \leq k$, $c \in \{left,right\}$.
For every $1 \leq i \leq k$ and $c \in \{left,right\}$, it has the following relation:
\[ x : A, x_1 : I, \ldots x_{i-1} : I, x_{i+1} : I, \ldots x_k : I \vdash b_{[i=c]} : B \]
For every $1 \leq i_1 < i_2 \leq k$ and $c,c' \in \{left,right\}$, it has the following relation:
\[ b_{[i_2=c']}[x_{i_1} \repl c] = b_{[i_1=c]}[x_{i_2} \repl c'] \]

Map $i^k : \partial \square^k \to \square^k$ is defined in the obvious way: $i^k(b_{[i=c]}) = b[x_i \repl c]$.
Let $v : \square^{n-1} \to \mathfrak{C}(\Delta^n)$ be defined as follows: $v(A) = O_0$, $v(B) = O_n$, $v(b) = M_{[n]}$.
Map $v \circ i^k$ factors through $\mathfrak{C}(\partial \Delta^n) \to \mathfrak{C}(\Delta^n)$, and the following square is cocartesian:
\[ \xymatrix{ \partial \square^{n-1} \ar[r] \ar[d]_{i^k} & \mathfrak{C}(\partial \Delta^n) \ar[d] \\
              \square^{n-1} \ar[r]_v & \mathfrak{C}(\Delta^n)
            } \]
Thus we just need to show that $i^k$ is a cofibration.
But it is a pushout of $i_{(tm,1)} : F(\{ x : A \vdash B\ type \}) \to F(\{ x : A \vdash b : B \})$.
Indeed, let $v' : F(\{ x : A \vdash b : B \}) \to \square^k$ be defined as follows: $v'(b) = path(x_1.\,\ldots path(x_n.\,b) \ldots)$ and $v'(B)$ equals to
\begin{align*}
Path(x_1.\, \ldots Path(x_{n-2}.\, & Path(x_{n-1}.\,     Path(x_n.\,B, b[x_n \repl left], b[x_n \repl right]), \\
                                   & \qquad \qquad \quad path(x_n.\,b[x_{n-1} \repl left]), \\
                                   & \qquad \qquad \quad path(x_n.\,b[x_{n-1} \repl right])), \\
                                   & path(x_{n-1}.\,     path(x_n.\,b[x_{n-2} \repl left])), \\
                                   & path(x_{n-1}.\,     path(x_n.\,b[x_{n-2} \repl right]))) \ldots )
\end{align*}
Then $v' \circ i_{(tm,1)}$ factors through $i^k$, and the following square is cocartesian:
\[ \xymatrix{ F(\{ x : A \vdash B\ type \}) \ar[r] \ar[d]_{i_{(tm,1)}} & \partial \square^k \ar[d]^{i^k} \\
              F(\{ x : A \vdash b : B \}) \ar[r]_-{v'} & \square^k
            } \]

Now, let us prove that for every $X \in \Mod{T}$, $N(X)$ is fibrant.
Since fibrant objects in $\sSet$ are precisely quasicategories,
it is enough to show that $\mathfrak{C}(\Lambda^n_i) \to \mathfrak{C}(\Delta^n)$ is a trivial cofibration for every inner horn $\Lambda^n_i \to \Delta^n$.
First, for every $1 \leq i \leq k$, let $\sqcap^k_i$ be the object defined by the same generators and relations as $\partial \square^k$ except for $b_{[i=right]}$.
Then we have the following cocartesian square:
\[ \xymatrix{ \sqcap^{n-1}_i \ar[r] \ar[d] & \mathfrak{C}(\Lambda^n_i) \ar[d] \\
              \partial \square^{n-1} \ar[r] & \mathfrak{C}(\partial \Delta^n)
            } \]

Since $\sqcap^k_i \to \square^k$ is a cofibration, we just need to show that it is a weak equivalence.
Note that $\sqcap^k_i \to \square^k$ is isomorphic to $\sqcap^k_k \to \square^k$ for every $1 \leq i \leq k$.
Indeed, we can define isomorphism $g : \square^k \to \square^k$ as $g(b) = b[x_i \repl x_k, x_k \repl x_i]$
and isomorphism $f : \sqcap^k_i \to \sqcap^k_k$ as $f(b_{[i=left]}) = b_{[k=left]}[x_i \repl x_k]$, $f(b_{[k=c]}) = b_{[i=c]}[x_k \repl x_i]$,
and $f(b_{[j=c]}) = b_{[j=c]}[x_i \repl x_k, x_k \repl x_i]$ for every $j \neq i,k$.
Then $f$ and $g$ commute with $\sqcap^k_i \to \square^k$ and $\sqcap^k_k \to \square^k$.
Thus we just need to prove that $\sqcap^k_k \to \square^k$ is a weak equivalence.

Note that $\square^{k+1}$ is a (relative) cylinder object for $F(\{ A : (ty,0), B : (ty,0) \}) \to \square^k$.
Indeed, $\square^k \amalg_{F(\{ A : (ty,0), B : (ty,0) \})} \square^k \to \square^{k+1}$ is a cofibration,
and $\square^k \to \square^{k+1}$ is a weak equivalence since it is a pushout of
a generating trivial cofibration $F(\{ \Gamma \vdash b : B \}) \to F(\{ \Gamma, y : I \vdash h : B \})$.

Every object has RLP with respect to $\sqcap^k_k \to \square^k$ (see \cite[Section~2.4]{alg-models}).
In particular, $\sqcap^k_k \to \square^k$ has a retract $\square^k \to \sqcap^k_k$.
The composite map $\square^k \to \sqcap^k_k \to \square^k$ is homotopic to $id$.
To show this, we just need to construct an appropriate map $\square^{k+1} \to \square^k$,
which is easy to do using filler operations from \cite[Section~2.4]{alg-models}.
Thus $\sqcap^k_k \to \square^k$ is a homotopy equivalence.

Finally, let us prove that if $f : X \to Y$ is a fibration in $\Mod{T}$, then $N(f)$ is a fibration in $\sSet$.
Since $N(Y)$ is fibrant, by \cite[Corollary~2.4.6.5]{lurie-topos}, we just need to prove the following conditions:
\begin{enumerate}
\item $N(f)$ is an inner fibration.
\item For every object $A$ of $N(X)$ and every equivalence $p : N(f)(A) \to B$ in $N(Y)$, there exists an equivalence $p' : A \to B'$ in $N(X)$ such that $N(f)(p') = p$.
\end{enumerate}
The first condition follows from the fact that maps $\mathfrak{C}(\Lambda^n_i) \to \mathfrak{C}(\Delta^n)$ are trivial cofibrations.
The second condition can be reformulated as follows: for every closed type $A$ of $X$ and every equivalence $p : f(A) \to B$ in $Y$,
there exists an equivalence $p' : A \to B'$ in $X$ such that $f(p') = p$.
But this follows from the fact that $f$ has RLP with respect to $\J_{\I_{ty}}$.
\end{proof}

\bibliographystyle{amsplain}
\bibliography{ref}

\end{document}
